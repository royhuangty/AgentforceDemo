(function(){var n=function(c){function g(a){var a=a.data.dialog,d="info"===a.currentPage?"txtUrl":e.getIdBySimpleId("file");if(!e.limitMaxNumberOfImages(d,"info"===a.currentPage?"info":null,a))if("info"===a.currentPage){var d=a.getContentElement("info","txtUrl").getValue(),f=CKEDITOR.dialog.getCurrent();f.getElement().getDocument();f=f.getContentElement("info","txtUrl");e.isEmpty(f.getValue())?h("txtUrl","<b>"+c.config.sfdcLabels.CkeImageDialog.error+"</b> "+c.config.sfdcLabels.CkeImageDialog.missingUrlError,
"info"):j("txtUrl","info");e.isEmpty(d)||!1!==a.fire("ok",{hide:!0}).hide&&a.hide()}else d=CKEDITOR.document,a.imageEditMode&&e.isEmpty(d.getById(e.getIdBySimpleId("file")).getValue())?!1!==a.fire("ok",{hide:!0}).hide&&a.hide():(a=e.getEl("file").value,(f=a.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/))?e.getEl("fileName").value=f[2]:e.getEl("fileName").value=a,e.getEl("altText").value=e.getEl("txtAlt2").value,CKEDITOR.env.ie&&(window.frames[c.name+":uploadWindow"].name=c.name+":uploadWindow"),d.getById(e.getIdBySimpleId("frmUpload")).$.submit())}
function h(a,d,f){var b=CKEDITOR.dialog.getCurrent(),c=b.getElement().getDocument();f&&0<f.length?(f=b.getContentElement(f,a).getElement(),a=f.getId(),a=a.substring(0,a.length-10)+"_errorMsg"):(f=c.getById("cke_"+a+"_uiElement"),a+="_errorMsg");(b=c.getById(a))?b.setHtml(d):(c=c.$.createElement("div"),c.id=a,c.className="ck_dialog_ui_errorMsg",c.innerHTML=d,f.$.appendChild(c));d=f.getAttribute("class");-1==d.indexOf(m)&&f.setAttribute("class",(d+" "+m).replace(/^\s+|\s+$/g,""))}function j(a,d){var f=
CKEDITOR.dialog.getCurrent(),b=f.getElement().getDocument(),c;d&&0<d.length?(f=f.getContentElement(d,a).getElement(),c=f.getId(),c=c.substring(0,c.length-10)+"_errorMsg"):(f=b.getById("cke_"+a+"_uiElement"),c=a+"_errorMsg");(b=b.getById(c))&&b.$.parentNode.removeChild(b.$);b=f.getAttribute("class");f.setAttribute("class",b.replace(m,"").replace(/^\s+|\s+$/g,""))}function n(){var a=arguments;this.foreach(function(d){d.commit&&d.commit.apply(d,a)})}var m="cke_dialog_ui_error",k=c.config;CKEDITOR.plugins.get("sfdcImage").sfdcUtils=
{getIdBySimpleId:function(a){return CKEDITOR.dialog.getCurrent()._.editor.name+":"+a},getEl:function(a){return window.document.getElementById(this.getIdBySimpleId(a))},isEmpty:function(a){return null===a||0===a.length},disableEventPropagation:function(a){a.stopPropagation?a.stopPropagation():window.event&&(window.event.cancelBubble=!0)},isValidFiletype:function(){var a=CKEDITOR.dialog.getCurrent().getParentEditor().config,d=RegExp(a.imageUploadAllowedExtensions,"i"),b=RegExp(a.imageUploadDeniedExtensions,
"i"),c=this.getEl("file").value;return c&&(0<a.imageUploadAllowedExtensions.length&&!d.test(c)||0<a.imageUploadDeniedExtensions.length&&b.test(c))?!1:!0},checkValidFiletype:function(){var a=CKEDITOR.dialog.getCurrent();if(e.isValidFiletype())j(e.getIdBySimpleId("file")),a.enableButton("update"),a.enableButton("insert");else{var d=a.getParentEditor().config,d="<b>"+d.sfdcLabels.CkeImageDialog.error+"</b>&nbsp;"+d.sfdcLabels.CkeImageDialog.wrongFileTypeError;h(e.getIdBySimpleId("file"),d);a.disableButton("update");
a.disableButton("insert")}},evalAjaxServletOutput:function(a){if("while(1);"!==a.substring(0,9))throw Error("CSRF protect string not added to servlet response.");return eval("("+a.substring(9,a.length)+")")},onUploadCompleted:function(){var a=this.getEl("uploadWindow");a&&(a=a.contentDocument?a.contentDocument.body.innerHTML:a.contentWindow?a.contentWindow.document.body.innerHTML:a.document.body.innerHTML,a=a.replace(/^\s*/,""),0<a.length&&CKEDITOR.dialog.getCurrent().fire("onUploadCompleted",a))},
limitMaxNumberOfImages:function(a,d,b){var e=k.imageUploadLimit;if(e){var g=c.document.getElementsByTag("img").count();if(!b.imageEditMode&&g>=e)return h(a,k.sfdcLabels.CkeImageDialog.imageUploadLimit_info,d),!0;j(a,d);return!1}}};var e=CKEDITOR.plugins.get("sfdcImage").sfdcUtils,b=[];CKEDITOR.env.ie?b.push('<form id="'+c.name+':frmUpload" method="post" action="" enctype="multipart/form-data" accept-charset="UTF-8">'):b.push('<form id="'+c.name+':frmUpload" method="post" target="'+c.name+':uploadWindow" action="" enctype="multipart/form-data" accept-charset="UTF-8">');
b.push('  <input type="hidden" name="fileName" id="'+c.name+':fileName" value="" />');b.push('  <input type="hidden" name="altText" id="'+c.name+':altText" value="" />');b.push('\t<div class="cke_dialog_ui_vbox">');b.push('  <table cellspacing="0" border="0" align="left" style="width: 100%;" role="presentation">');b.push("    <tr>");b.push('      <td class="cke_dialog_ui_vbox_child">');b.push('          <div id="cke_'+c.name+':file_uiElement" class="cke_dialog_ui_text" role="presentation">');b.push('            <label for="'+
c.name+':file" class="cke_dialog_ui_labeled_label">'+k.sfdcLabels.CkeImageDialog.uploadTab_file+"</label>");b.push('            <div class="cke_dialog_ui_labeled_content">');b.push('                <div class="cke_dialog_ui_input_file">');b.push('                    <input id="'+c.name+':file" type="file" size="40" name="file" aria-labelledby="file" ');b.push("\t\t\t\t\t\tonclick=\"CKEDITOR.plugins.get('sfdcImage').sfdcUtils.disableEventPropagation(event);\" ");b.push("\t\t\t\t\t\tonchange=\"CKEDITOR.plugins.get('sfdcImage').sfdcUtils.checkValidFiletype();\" /><br/>");
b.push("                </div>");b.push("            </div>");b.push("          </div>");b.push("      </td>");b.push("    </tr>");b.push("    <tr>");b.push('      <td class="cke_dialog_ui_vbox_child">');b.push('          <div class="cke_dialog_ui_input_desc">'+k.sfdcLabels.CkeImageDialog.uploadTab_file_info+"</div>");b.push("      </td>");b.push("    </tr>");b.push("    <tr>");b.push('      <td sclass="cke_dialog_ui_vbox_child">');b.push('          <div class="cke_dialog_ui_text" role="presentation">');
b.push('            <label for="'+c.name+':txtAlt2" class="cke_dialog_ui_labeled_label">'+k.sfdcLabels.CkeImageDialog.uploadTab_desc+"</label>");b.push('            <div class="cke_dialog_ui_labeled_content">');b.push('                <div class="cke_dialog_ui_input_text" role="presentation">');b.push('                    <input id="'+c.name+':txtAlt2" class="cke_dialog_ui_input_text" style="width: 100%" type="text" aria-labelledby="file" />');b.push("                </div>");b.push("            </div>");
b.push("          </div>");b.push("      </td>");b.push("    </tr>");b.push("    <tr>");b.push('      <td class="cke_dialog_ui_vbox_child">');b.push('          <div class="cke_dialog_ui_input_desc">'+k.sfdcLabels.CkeImageDialog.uploadTab_desc_info+"</div>");b.push("      </td>");b.push("    </tr>");b.push("  </table>");b.push("  </div>");b.push("</form>");CKEDITOR.env.ie?b.push('<div id="uploadWindowDiv"></div>'):b.push('<iframe name="'+c.name+':uploadWindow" id="'+c.name+':uploadWindow" style="display:none;" onload="CKEDITOR.plugins.get(\'sfdcImage\').sfdcUtils.onUploadCompleted();" src="/blank.html"></iframe>');
var b=b.join("\n"),l=function(){var a=this.originalElement;a.setCustomData("isReady","true");a.removeListener("load",l);a.removeListener("error",i);a.removeListener("abort",i);this.firstLoad=!1},i=function(){var a=this.originalElement;a.removeListener("load",l);a.removeListener("error",i);a.removeListener("abort",i);CKEDITOR.getUrl(CKEDITOR.plugins.get("sfdcImage").path+"images/noimage.png")};return{title:c.config.sfdcLabels.CkeImageDialog.title,minWidth:420,minHeight:200,buttons:[{type:"button",
id:"update",title:c.config.sfdcLabels.CkeImageDialog.btn_update_tooltip,label:c.config.sfdcLabels.CkeImageDialog.btn_update,"class":"cke_dialog_ui_button_ok",onClick:function(a){g(a)}},{type:"button",id:"insert",title:c.config.sfdcLabels.CkeImageDialog.btn_insert_tooltip,label:c.config.sfdcLabels.CkeImageDialog.btn_insert,"class":"cke_dialog_ui_button_ok",onClick:function(a){g(a)}},CKEDITOR.dialog.cancelButton],showUpdateBtn:function(){var a=CKEDITOR.dialog.getCurrent();a.getButton("insert").getElement().setStyle("display",
"none");a.getButton("update").getElement().setStyle("display","")},showInsertBtn:function(){var a=CKEDITOR.dialog.getCurrent();a.getButton("insert").getElement().setStyle("display","");a.getButton("update").getElement().setStyle("display","none")},showInfoTab:function(){var a=CKEDITOR.dialog.getCurrent();a.showPage("info");a.hidePage("upload");a.selectPage("info");a.currentPage="info"},showUploadTab:function(){var a=CKEDITOR.dialog.getCurrent();a.showPage("upload");a.hidePage("info");a.selectPage("upload");
a.currentPage="upload";e.getEl("file").focus()},showBothTabs:function(){var a=CKEDITOR.dialog.getCurrent();a.showPage("info");a.showPage("upload");a.selectPage("upload");a.currentPage="upload";e.getEl("file").focus()},onShow:function(){this.imageEditMode=this.imageElement=!1;this.firstLoad=!0;var a=this.getParentEditor(),d=a.getSelection(),d=d&&d.getSelectedElement();this.originalElement=a.document.createElement("img");this.originalElement.setAttribute("alt","");this.originalElement.setCustomData("isReady",
"false");this.customImageElement?(this.imageEditMode="img",this.imageElement=this.customImageElement,delete this.customImageElement):d&&("img"==d.getName()&&!d.data("cke-realelement"))&&(this.imageEditMode=d.getName(),this.imageElement=d);this.imageEditMode?(this.cleanImageElement=this.imageElement,this.imageElement=this.cleanImageElement.clone(!0,!0),this.setupContent(1,this.imageElement)):this.imageElement=a.document.createElement("img");var b=this.definition;this.getContentElement("info","imgWidth").getElement().hide();
this.getContentElement("info","imgHeight").getElement().hide();this.imageEditMode&&d.getAttribute("src")?(-1==d.getAttribute("src").indexOf("/servlet/rtaImage?")?b.showInfoTab():(b.showUploadTab(),this.getElement().getDocument().getById(a.name+":txtAlt2").setValue(d.getAttribute("alt"))),b.showUpdateBtn()):(b.showBothTabs(),b.showInsertBtn());a.config.filebrowserImageUploadUrl||(b.showInfoTab(),b.showInsertBtn())},onOk:function(){this.imageEditMode?(this.imageElement=this.cleanImageElement,delete this.cleanImageElement):
(this.imageElement=c.document.createElement("img"),this.imageElement.setAttribute("alt",c.config.sfdcLabels.CkeImageDialog.defaultImageDescription));var a=this.getElement().getDocument();this.imageEditMode&&e.isEmpty(a.getById(c.name+":file").getValue())&&"upload"===this.currentPage?this.imageElement.setAttribute("alt",a.getById(c.name+":txtAlt2").getValue()):this.commitContent(1,this.imageElement);this.imageElement.getAttribute("style")||this.imageElement.removeAttribute("style");this.imageEditMode||
c.insertElement(this.imageElement)},onLoad:function(){this.commitContent=n;CKEDITOR.document.getById(e.getIdBySimpleId("frmUpload")).setAttribute("action",c.config.filebrowserImageUploadUrl);this.on("selectPage",function(a){this.currentPage=a.data.page});this.on("onUploadCompleted",function(a){a=e.evalAjaxServletOutput(a.data);a.isRunningTests&&(isRunningTests=a.isRunningTests);a.uploadStatus?(this.setValueOf("info","txtUrl",a.src),a.alt&&this.setValueOf("info","txtAlt",a.alt),a.width&&this.setValueOf("info",
"imgWidth",a.width),a.height&&this.setValueOf("info","imgHeight",a.height),a=!0):(h(e.getIdBySimpleId("file"),a.errMsg),a=!1);a&&!1!==this.fire("ok",{hide:!0}).hide&&(this.hide(),c.config.uploadedImages++)});if(CKEDITOR.env.ie){var a=document.getElementById(c.name+":file");if(0!=(a.onclick?a.onclick.toString():"undefined").indexOf(CKEDITOR.env.ie9Compat||CKEDITOR.env.ie10Compat?"function onclick(event)":"function onclick()"))a.addEventListener?a.addEventListener("click",function(){CKEDITOR.plugins.get("sfdcImage").sfdcUtils.disableEventPropagation(event)},
!1):a.attachEvent&&a.attachEvent("onclick",function(){CKEDITOR.plugins.get("sfdcImage").sfdcUtils.disableEventPropagation(event)});if(0!=(a.onchange?a.onchange.toString():"undefined").indexOf(CKEDITOR.env.ie9Compat||CKEDITOR.env.ie10Compat?"function onchange(event)":"function onchange()"))a.addEventListener?a.addEventListener("change",function(){CKEDITOR.plugins.get("sfdcImage").sfdcUtils.checkValidFiletype()},!1):a.attachEvent&&a.attachEvent("onchange",function(){CKEDITOR.plugins.get("sfdcImage").sfdcUtils.checkValidFiletype()});
var a=document.getElementById("uploadWindowDiv"),d=document.createElement("iframe");d.name=c.name+":uploadWindow";d.style.display="none";d.setAttribute("id",c.name+":uploadWindow");d.setAttribute("src","/blank.html");d.addEventListener?d.addEventListener("load",function(){CKEDITOR.plugins.get("sfdcImage").sfdcUtils.onUploadCompleted()},!1):d.attachEvent&&d.attachEvent("onload",function(){CKEDITOR.plugins.get("sfdcImage").sfdcUtils.onUploadCompleted()});a.appendChild(d);CKEDITOR.document.getById(e.getIdBySimpleId("frmUpload")).setAttribute("target",
c.name+":uploadWindow")}},onHide:function(){this.originalElement&&(this.originalElement.removeListener("load",l),this.originalElement.removeListener("error",i),this.originalElement.removeListener("abort",i),this.originalElement.remove(),this.originalElement=!1);delete this.imageElement;var a=CKEDITOR.dialog.getCurrent().getElement().getDocument();a.getById(e.getIdBySimpleId("file")).setValue("");a.getById(e.getIdBySimpleId("txtAlt2")).setValue("");a.getById(e.getIdBySimpleId("fileName")).setValue("");
a.getById(e.getIdBySimpleId("altText")).setValue("");j("txtUrl","info");j(e.getIdBySimpleId("file"))},contents:[{id:"upload",label:c.config.sfdcLabels.CkeImageDialog.uploadTab,accessKey:"U",elements:[{id:"ignore",type:"text",style:"display:none"},{type:"html",html:b}]},{id:"info",label:c.config.sfdcLabels.CkeImageDialog.infoTab,accessKey:"I",elements:[{type:"vbox",children:[{id:"txtUrl",type:"text",label:c.lang.common.url,"default":"",onChange:function(){var a=this.getDialog(),d=this.getValue();if(0<
d.length){var a=this.getDialog(),b=a.originalElement;b.setCustomData("isReady","false");b.on("load",l,a);b.on("error",i,a);b.on("abort",i,a);b.setAttribute("src",d)}},setup:function(a,b){1==a&&(this.setValue(b.data("cke-saved-src")||b.getAttribute("src")),this.setInitValue())},commit:function(a,b){1==a&&(this.getValue()||this.isChanged())?(b.data("cke-saved-src",this.getValue()),b.setAttribute("src",this.getValue())):8==a&&(b.setAttribute("src",""),b.removeAttribute("src"))},validate:CKEDITOR.dialog.validate.notEmpty(c.config.sfdcLabels.CkeImageDialog.missingUrlError)},
{type:"html",html:'<div class="cke_dialog_ui_input_desc">'+c.config.sfdcLabels.CkeImageDialog.infoTab_url_info+"<div>"},{type:"text",id:"imgWidth",width:"40px",style:"display:none;",label:c.lang.common.width,labelLayout:"horizontal",setup:function(a,b){this.setValue(b.getAttribute("width"))},commit:function(a,b){(this.getValue()||this.isChanged())&&b.setAttribute("width",this.getValue())}},{type:"text",id:"imgHeight",width:"40px",style:"display:none;",label:c.lang.common.height,labelLayout:"horizontal",
setup:function(a,b){this.setValue(b.getAttribute("height"))},commit:function(a,b){(this.getValue()||this.isChanged())&&b.setAttribute("height",this.getValue())}},{id:"txtAlt",type:"text",label:c.config.sfdcLabels.CkeImageDialog.infoTab_desc,accessKey:"T","default":"",setup:function(a,b){1==a&&this.setValue(b.getAttribute("alt"))},commit:function(a,b){1==a?(this.getValue()||this.isChanged())&&b.setAttribute("alt",this.getValue()):8==a&&b.removeAttribute("alt")}},{type:"html",html:'<div class="cke_dialog_ui_input_desc">'+
c.config.sfdcLabels.CkeImageDialog.infoTab_desc_info+"<div>"}]}]}]}};CKEDITOR.dialog.add("sfdcImage",function(c){try{var g=[];g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents .ck_dialog_ui_errorMsg {display:none;width:100%;}");g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents .cke_dialog_ui_error .ck_dialog_ui_errorMsg {color:red;display:block;}");g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents .cke_dialog_ui_error .ck_dialog_ui_errorMsg b {color:red;font-weight:bold;}");
g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents .cke_dialog_ui_error div.cke_dialog_ui_input_text {border:1px solid red;}");g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents .cke_dialog_ui_error div.cke_dialog_ui_input_file input {border:1px solid red;}");g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents .cke_dialog_ui_input_select {border: 1px solid #a0a0a0;background-color: #fff;}");g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents .cke_dialog_ui_input_file {width:100%;height:25px;}");
if(Sfdc&&(Sfdc.userAgent.isIE8||Sfdc.userAgent.isIE9))g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents div.cke_dialog_ui_input_file input {height:20px;overflow:visible;border:1px solid #959595;border-collapse:separate;}"),g.push(".cke_dialog_body .cke_dialog_contents .cke_dialog_page_contents div.cke_dialog_ui_input_file {width:99%;height:auto;border:1px solid white;}");var g=g.join("\n"),h=document.createElement("style");h.type="text/css";h.styleSheet?h.styleSheet.cssText=
g:h.appendChild(document.createTextNode(g));document.getElementsByTagName("head")[0].appendChild(h)}catch(j){}return n(c,"sfdcImage")})})();