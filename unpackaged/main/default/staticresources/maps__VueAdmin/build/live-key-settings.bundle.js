(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[9916],{5981:(t,e,s)=>{t.exports=s.p+"images/c014dd95afd4a62abfd6f50902e31d50.svg"},8419:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>h});var i=s(2646),a=s(3088);const{MAToastMessages:n}=window,l={components:{TextInput:i.oi,ButtonIcon:i.Ei,Modal:i.u_},data:()=>({liveTokenInput:"",liveTokenStored:"",isKeyReadOnly:!0,showWarning:!1,warningConfirmation:null}),computed:{isKeySaved(){return(""!==this.liveTokenInput||""!==this.liveTokenStored)&&this.liveTokenInput===this.liveTokenStored}},watch:{warningConfirmation:{handler(t){this.warningConfirmation=t.toUpperCase()},deep:!0}},async created(){await this.getStoredliveToken()},methods:{async getStoredliveToken(){this.$parent.isLoading=!0;try{const{success:t,data:e,error:s}=await(0,a.wX)("maps.LiveRemoteFunctions.RetrieveLiveKeySetting",[]);t?(this.liveTokenInput=e.liveToken,this.liveTokenStored=e.liveToken):(this.liveTokenInput="",this.liveTokenStored="","Failed To Get Live Key. No Key Was Found."!==s.messages.developerMsg&&n.showError({position:"toast-top-right",message:"Error",subMessage:s.messages,timeOut:8e3}))}catch(t){n.showError({position:"toast-top-right",message:"Remoting Error",subMessage:t,timeOut:8e3}),console.error(t)}finally{this.$parent.isLoading=!1}},async saveliveToken(t){this.$parent.isLoading=!0;try{const{success:e,error:s}=await(0,a.wX)("maps.LiveRemoteFunctions.SaveLiveKey",[t]);e?(await this.getStoredliveToken(),n.showSuccess({position:"toast-top-right",message:"Success",subMessage:""!==t.trim()?"Live API Key Saved":"Live API Key Removed",timeOut:8e3})):n.showError({position:"toast-top-right",message:"Error",subMessage:s,timeOut:8e3})}catch(t){n.showError({position:"toast-top-right",message:"Remoting Error",subMessage:t,timeOut:8e3}),console.error(t)}finally{this.$parent.isLoading=!1,this.isKeyReadOnly=!0}return null},async clearSavedKey(){this.$parent.isLoading=!0;try{await this.saveliveToken("")}catch(t){n.showError({position:"toast-top-right",message:"Error",subMessage:"Could not remove saved API key.",timeOut:8e3})}},async generateNewKey(){this.$parent.isLoading=!0;try{const{code:t,data:e,error:s}=await(0,a.wX)("maps.LiveRemoteFunctions.GenerateNewLiveKey",[]);200===t||201===t?(await this.saveliveToken(e.liveToken),await this.getStoredliveToken()):n.showError({position:"toast-top-right",message:"Error",subMessage:s,timeOut:8e3})}catch(t){n.showError({position:"toast-top-right",message:"Remoting Error",subMessage:t,timeOut:8e3}),console.error(t)}finally{this.$parent.isLoading=!1}},clickEditInput(){this.liveTokenStored?this.showWarning=!0:this.editKey()},clearInput(){this.liveTokenInput="",this.$refs.keyInput.focus()},editKey(){this.warningConfirmation="",this.isKeyReadOnly=!1,this.$refs.keyInput.focus()},confirmEditModal(){"EDIT"===this.warningConfirmation?(this.isKeyReadOnly=!1,this.showWarning=!1,this.editKey()):n.showWarning({position:"toast-top-right",message:"Please complete the confirmation challenge to edit your Live API key",timeOut:8e3})},closeModal(){this.showWarning=!1,this.isKeyReadOnly=!0,this.liveTokenInput=this.liveTokenStored}}};var o=s(1900);const r=(0,o.Z)(l,(function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"live_api_key"}},[e("div",[e("div",{attrs:{id:"API-License"}},[e("div",{staticClass:"slds-section slds-is-open"},[t._m(0),t._v(" "),e("div",{staticClass:"slds-section__content section__content"},[e("div",{staticClass:"slds-m-horizontal_small slds-m-top_small",class:{"slds-card slds-card_boundary box":!t.isKeyReadOnly}},[e("div",{class:{"slds-card__body slds-card__body_inner":!t.isKeyReadOnly}},[e("div",{staticClass:"slds-col slds-size_1-of-1 slds-has-flexi-truncate slds-p-horizontal_small slds-p-vertical_medium slds-grid slds-grid_vertical-align-end"},[e("TextInput",{ref:"keyInput",staticClass:"slds-input-has-icon slds-input-has-icon_right slds-size_medium",class:{"readonly-input slds-border_bottom":t.isKeyReadOnly},attrs:{id:"text-input-key",isRequired:!0,type:"text",labels:{name:"Live API Key"}},model:{value:t.liveTokenInput,callback:function(e){t.liveTokenInput=e},expression:"liveTokenInput"}},[e("template",{slot:"extend"},[e("ButtonIcon",{directives:[{name:"show",rawName:"v-show",value:t.isKeyReadOnly,expression:"isKeyReadOnly"}],staticClass:"slds-button slds-button_icon slds-input__icon slds-input__icon_right slds-icon-text-light",attrs:{title:"Edit API Key",assistiveText:"Edit API Key",variant:"bare",iconCategory:"utility",iconName:"edit",iconSize:"medium"},on:{click:t.clickEditInput}}),t._v(" "),e("ButtonIcon",{directives:[{name:"show",rawName:"v-show",value:!t.isKeyReadOnly,expression:"!isKeyReadOnly"}],staticClass:"slds-button slds-button_icon slds-input__icon slds-input__icon_right slds-icon-text-light",attrs:{title:"Clear API Key",assistiveText:"Clear API Key",variant:"bare",iconCategory:"utility",iconName:"clear",iconSize:"medium"},on:{click:t.clearInput}})],1),t._v(" "),e("span",{attrs:{slot:"errors"},slot:"errors"},[t._v("The key is invalid")])],2),t._v(" "),e("div",{staticClass:"slds-m-left_x-small"},[t.isKeyReadOnly?t._e():e("button",{staticClass:"slds-button",attrs:{id:"keygenbtn",type:"button"},on:{click:t.generateNewKey}},[t._v("\n                                        Generate\n                                    ")])])],1),t._v(" "),t.isKeyReadOnly?t._e():e("div",{staticClass:"slds-grid slds-grid_align-center slds-p-top_large"},[e("button",{staticClass:"slds-button slds-button_neutral",attrs:{id:"cancelbtn",type:"button"},on:{click:t.closeModal}},[t._v("\n                                    Cancel\n                                ")]),t._v(" "),e("button",{staticClass:"slds-button slds-button_brand",attrs:{id:"keysavebtn",type:"button"},on:{click:function(e){return t.saveliveToken(t.liveTokenInput)}}},[t._v("\n                                    Save\n                                ")])])])])])])])]),t._v(" "),t.showWarning?e("Modal",{attrs:{isSmall:"",title:"Confirm Key Edit"},on:{close:t.closeModal}},[e("div",{attrs:{slot:"content"},slot:"content"},[e("div",{staticClass:"slds-grid slds-grid_align-center"},[e("Icon",{staticClass:"slds-icon_container",attrs:{src:s(5981),iconClass:["slds-icon","slds-icon-text-warning","slds-icon_large"],assistiveText:"Warning Icon"}})],1),t._v(" "),e("div",{staticClass:"slds-text-align_center slds-p-around_small"},[e("div",{staticClass:"slds-text-heading_small slds-p-around_x-small"},[t._v("\n                    Maps Live Tracking will require a full re-implementation of any devices associated with the current API key.\n                ")]),t._v(" "),e("div",{staticClass:"slds-text-heading_small slds-p-around_x-small slds-m-bottom_small"},[t._v("\n                    We strongly suggest you "),e("strong",[t._v("DO NOT")]),t._v(" make any changes to your API key.\n                ")]),t._v(" "),e("div",{staticClass:"slds-m-bottom_small"},[e("abbr",{staticClass:"slds-required",attrs:{title:"Required"}},[t._v("*")]),t._v(" "),e("span",[t._v('\n                        Type "'),e("strong",[t._v("EDIT")]),t._v('" below to confirm you want to modify your API key.\n                    ')])]),t._v(" "),e("div",{staticClass:"slds-align_absolute-center slds-col slds-size_1-of-3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.warningConfirmation,expression:"warningConfirmation"}],staticClass:"slds-input",style:{"text-align":"center"},attrs:{id:"text-input-confirm",autocomplete:"off",type:"text"},domProps:{value:t.warningConfirmation},on:{input:[function(e){e.target.composing||(t.warningConfirmation=e.target.value)},function(e){return t.warningConfirmation.toUpperCase()}]}})])])]),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.closeModal}},[t._v("\n                Cancel\n            ")]),t._v(" "),e("button",{staticClass:"slds-button slds-button_brand",on:{click:t.confirmEditModal}},[t._v("\n                Edit\n            ")])])]):t._e()],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"slds-section__title slds-theme_shade"},[t("span",{staticClass:"section-header-title slds-p-horizontal_small slds-truncate"},[this._v("Licensing")])])}],!1,null,"e3a2a0a2",null).exports,{MAToastMessages:d}=window,c={components:{DatePicker:i.Mt},data(){return{tableRows:[],tableColumns:["DEVICE VENDOR","DEVICE ID"],sortTableBy:null,sortDirection:null,startingDate:this.getCurrentDate(),endingDate:this.getCurrentDate(),lastValidStartingDate:null,lastValidEndingDate:null}},methods:{returnCapitalized:t=>(t&&"gm"===t.toLowerCase()&&(t="GM"),t&&"mapanything"===t.toLowerCase()&&(t="MapAnything"),t?t.charAt(0).toUpperCase()+t.slice(1):null),async createDevicesTable(){const t={from:this.startingDate.startOf("day").valueOf(),to:this.endingDate.endOf("day").valueOf()};if(!this.validateDateSelected(this.startingDate,"start"))return!1;if(!this.validateDateSelected(this.endingDate,"end"))return!1;try{this.$parent.isLoading=!0;const{success:e,devices:s,error:i}=await(0,a.wX)("maps.LiveRemoteFunctions.GetLiveDeviceBillingStatus",[JSON.stringify(t)]);e?s.length>0?this.tableRows=s:d.showMessage({position:"toast-top-right",message:"No devices reporting in the date range you requested",timeOut:8e3}):d.showError({position:"toast-top-right",message:"Error",subMessage:i,timeOut:8e3})}catch(t){d.showError({position:"toast-top-right",message:"Remoting Error",subMessage:t.message.toString(),timeOut:8e3}),console.error(t.message)}finally{this.$parent.isLoading=!1}return null},validateDateSelected(t,e){t=t.startOf("day");const s=this.getCurrentDate().startOf("day"),i=this.getCurrentDate().subtract(60,"days").startOf("day");return t>s?(d.showError({position:"toast-top-right",message:this.$Labels.MA_Validation_Error,subMessage:"Cannot select a date in the future. Please adjust your starting and ending dates.",timeOut:8e3}),e&&"start"===e&&(null!=this.lastValidStartingDate?this.startingDate=this.lastValidStartingDate:this.startingDate=this.getCurrentDate()),e&&"end"===e&&(null!=this.lastValidEndingDate?this.endingDate=this.lastValidEndingDate:this.endingDate=this.getCurrentDate()),!1):i>t?(d.showError({position:"toast-top-right",message:this.$Labels.MA_Validation_Error,subMessage:"Cannot select a date older than 60 days in the past. Please adjust your starting and ending dates.",timeOut:8e3}),e&&"start"===e&&(null!=this.lastValidStartingDate?this.startingDate=this.lastValidStartingDate:this.startingDate=this.getCurrentDate()),e&&"end"===e&&(null!=this.lastValidEndingDate?this.endingDate=this.lastValidEndingDate:this.endingDate=this.getCurrentDate()),!1):("start"===e&&(this.lastValidStartingDate=t),"end"===e&&(this.lastValidEndingDate=t),!(null!=this.lastValidStartingDate&&null!=this.lastValidEndingDate&&this.lastValidStartingDate.valueOf()>this.lastValidEndingDate.valueOf()&&(d.showError({position:"toast-top-right",message:this.$Labels.MA_Validation_Error,subMessage:"Your end date cannot be before your start date. Please adjust your starting and ending dates.",timeOut:8e3}),1)))},getCurrentDate(){return this.$moment.tz(this.$User.timezoneId).locale(this.$User.UserLocale)}}},u=(0,o.Z)(c,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"slds-m-top_x-large",attrs:{id:"live_billing_status"}},[e("div",[e("div",{attrs:{id:"Billing-Status"}},[e("div",{staticClass:"slds-section slds-m-bottom_large slds-is-open"},[t._m(0),t._v(" "),e("div",{staticClass:"slds-form slds-form_compound"},[e("div",{staticClass:"slds-form-element__row slds-p-around_large slds-grid_vertical-align-end"},[e("div",{staticClass:"slds-form-element slds-m-right_large slds-m-top_medium"},[e("DatePicker",{attrs:{dateFormat:t.$User.dateFormat.toUpperCase(),showInputField:!0,locale:t.$User.UserLocale,timezone:t.$User.timezoneId,labels:{name:"Starting Date"}},on:{changed:function(e){return t.validateDateSelected(e,"start")}},model:{value:t.startingDate,callback:function(e){t.startingDate=e},expression:"startingDate"}})],1),t._v(" "),e("div",{staticClass:"slds-form-element"},[e("DatePicker",{attrs:{dateFormat:t.$User.dateFormat.toUpperCase(),numYearsInFuture:0,showInputField:!0,locale:t.$User.UserLocale,timezone:t.$User.timezoneId,labels:{name:"Ending Date"}},on:{changed:function(e){return t.validateDateSelected(e,"end")}},model:{value:t.endingDate,callback:function(e){t.endingDate=e},expression:"endingDate"}})],1),t._v(" "),e("div",{staticClass:"slds-form-element"},[e("div",{staticClass:"slds-p-left_x-small slds-p-top_x-small"},[e("button",{staticClass:"slds-button",attrs:{id:"getbillingbtn",type:"button"},on:{click:t.createDevicesTable}},[t._v("\n                                    Generate Report\n                                ")])])])])]),t._v(" "),t.tableRows.length>0?e("div",{staticClass:"slds-table_header-fixed_container",staticStyle:{"border-top":"1px solid rgb(221, 219, 218)",height:"100%"}},[e("div",{staticClass:"slds-table_header-fixed_scroller",staticStyle:{height:"100%",overflow:"auto"}},[e("table",{staticClass:"slds-table slds-table_fixed-layout slds-table_header-fixed slds-table_resizable-cols slds-table_bordered slds-table_striped",attrs:{id:"TABLEHEADER","aria-multiselectable":"true",role:"grid"}},[e("thead",[e("tr",{staticClass:"slds-line-height_reset"},t._l(t.tableColumns,(function(s,i){return e("th",{key:i,staticStyle:{height:"0px","line-height":"0"},attrs:{"aria-label":s,scope:"col"}},[e("div",{staticClass:"slds-cell-fixed",staticStyle:{display:"flex","flex-flow":"row nowrap"}},[e("a",{staticClass:"slds-th__action slds-text-link_reset",staticStyle:{"align-items":"center",display:"flex",flex:"1 1 auto","line-height":"1.25",width:"100%"}},[e("span",{staticClass:"slds-truncate",attrs:{title:s}},[t._v("\n                                                    "+t._s(s)+"\n                                                ")])])])])})),0)]),t._v(" "),e("tbody",t._l(t.tableRows,(function(s,i){return e("tr",{key:i,staticClass:"slds-hint-parent"},[e("td",{attrs:{role:"gridcell"}},[e("div",{staticClass:"slds-truncate"},[t._v("\n                                            "+t._s(s.vendor?`${t.returnCapitalized(s.vendor)} (${s.count})`:"")+"\n                                        ")])]),t._v(" "),e("td",{attrs:{role:"gridcell"}},[e("div",{staticClass:"slds-truncate"},[t._v("\n                                            "+t._s(s.deviceid)+"\n                                        ")])])])})),0)])])]):t._e()])])])])}),[function(){var t=this._self._c;return t("div",{staticClass:"slds-section__title slds-theme_shade"},[t("span",{staticClass:"section-header-title slds-p-horizontal_small slds-truncate"},[this._v("Live Usage Statistics")])])}],!1,null,null,null).exports,g={components:{Spinner:i.$j,BillingStatus:u,KeySettings:r},data:()=>({isLoading:!1})},h=(0,o.Z)(g,(function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[t.isLoading?e("Spinner"):t._e(),t._v(" "),e("div",{staticClass:"slds-p-around_medium"},[e("KeySettings"),t._v(" "),e("BillingStatus")],1)],1)}),[],!1,null,null,null).exports}}]);