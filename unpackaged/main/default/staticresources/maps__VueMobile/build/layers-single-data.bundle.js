"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[4236],{2927:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var a=s(7813);const{$:i,MA:l}=window,o={props:{layerData:{type:Object,required:!0},isLoading:{type:Boolean,default:!1}},data:()=>({totalMarkers:0,visibleMarkers:0,legendRowSelections:{},legendRowTimeout:null,showAllLegendData:!1,legendHeader:"",legendSubText:""}),computed:{computedTotalRecords(){return(0,a.N4)(this.$Labels.MA_Total_Records,[this.totalMarkers])},computedRecordsCreatedVisible(){return(0,a.N4)(this.$Labels.MA_Records_Created_Visible,[this.totalMarkers,this.visibleMarkers])},layerType(){return this.layerData.type},layerQID(){return this.layerData.qid},plottedLayer(){return i(`#PlottedQueriesTable .DataLayer[qid="${this.layerQID}"]`)},plottedInfo(){return this.plottedLayer.data()||{}},isPolygonLayer(){let e=!1;return this.plottedInfo.censusLayer&&(e=!0),e},legendInfo:{get(){return this.plottedInfo.legend||{}},set(e){this.plottedInfo.legend=e}},legendRows(){return this.legendInfo.rows},legendShowText(){let e=this.$Labels.MA_Show_All;return this.showAllLegendData&&(e=this.$Labels.Layers_On_The_Map_Plotted_Marker_Layer_Button_Show_Less),e}},mounted(){this.build()},methods:{formatLabel:(e,t)=>(0,a.N4)(e,t),build(){this.updateLegend()},toggleVisibleLegend(){this.showAllLegendData=!this.showAllLegendData},updateLegend(){let e=0,t=0;const s=Object.keys(this.legendRows)||[];if(this.isPolygonLayer)this.showAllLegendData=!0,this.legendHeader=this.legendInfo.title||"",this.legendSubText=this.legendInfo.subTitle||"";else{for(let a=0;a<s.length;a++){const i=s[a],l=this.legendRows[i];e+=l.totalmarkers,t+=l.count}this.visibleMarkers=t,this.totalMarkers=e}},toggleRow(e){clearTimeout(this.legendRowTimeout),this.legendRowTimeout=null,this.legendRowSelections[e.legendId]=e.active,this.legendRowTimeout=setTimeout((()=>{this.toggleRows().then((()=>{this.build()}))}),250)},toggleRows(){return new Promise((e=>{this.updateDomInfo(),this.resetLegendCounts();const t=window.MADemographicLayer.getRenderModes(i(".DataLayer")),s=this.plottedInfo,{plottedLayer:a,legendRowSelections:o}=this;let r=1e3;l.Map.hitTestShapeMgr.hasShapes()&&l.Util.isIE()?r=20:l.Map.hitTestShapeMgr.hasShapes()&&(r=500);const n=s.records||{},d=Object.keys(n),c=d.length,h=[],g=this.legendRows,u=t.filter((e=>"Cluster"===e)).length>0,p=window.getProperty(window.userSettings||{},"InvertProximity",!1)||!1;setTimeout((function t(){if(d.length>0){a.find(".status").text(`Processing... ${d.length} remaining`);let e=0;for(;e<r&&d.length>0;){e++;const t=d.pop(),s=n[t],a=s.data.rowid;let i;try{i=g[a],i.totalmarkers++}catch(e){i={count:0,totalmarkers:0}}if(void 0===o[a]&&i.active)s.isVisible&&(i.count++,h.push(s.clusterMarker));else if(o[a])if(u){if(l.Map.hitTestShapeMgr.hasShapes()){const e=l.Map.hitTestShapeMgr.containsLatLng(s.markerCoordinate);p&&e||!p&&!e?s.isVisible=!1:(s.isVisible=!0,h.push(s.clusterMarker))}else s.isVisible=!0,h.push(s.clusterMarker);i.count++}else s.isVisible=!1}setTimeout(t,1)}else s.clusterGroup.setMap(l.map),s.clusterGroup.clearMarkers(),s.clusterGroup.addMarkers(h),s.clusterGroup.repaint(),a.find(".status").html(`Records: ${l.Util.formatNumberString(c)}`),e()}),1)}))},updateDomInfo(){const e=this.legendRowSelections,t=Object.keys(e);for(let s=0;s<t.length;s++){const a=t[s],i=e[a];this.legendInfo.rows[a].active=i}this.plottedLayer.data("legend",this.legendInfo)},resetLegendCounts(){const e=this.legendRows,t=Object.keys(e);for(let s=0;s<t.length;s++){const a=e[t[s]];a.totalmarkers=0,a.count=0}}}},r=(0,s(1900).Z)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"layers-individual-filter-wrap"},[t("div",{staticClass:"ma-section-title ma-section-title",staticStyle:{padding:"18px 16px 16px"}},[t("span",{staticClass:"legend-title"},[e._v(e._s(e._f("decode")(e.$Labels.MA_MARKER_LEGEND)))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.isPolygonLayer,expression:"!isPolygonLayer"}],staticClass:"legend-moreless-text",staticStyle:{position:"absolute",right:"0px",top:"2px",height:"45px","line-height":"45px",padding:"0 15px"},on:{click:e.toggleVisibleLegend}},[t("span",{staticClass:"moreless-text"},[e._v(e._s(e._f("decode")(e.legendShowText)))])])]),e._v(" "),t("div",{staticClass:"pad-16-16-8 background--white"},[t("div",{staticClass:"margin-0 text--dark-blue legendField"},[t("div",{staticClass:"ma-item-name-subtitle plottinginfo-wrapper",staticStyle:{"font-size":"16px"}},[e.isPolygonLayer?t("div",[t("div",{staticClass:"margin-0 text--dark-blue legendField"},[t("strong",[e._v(e._s(e._f("decode")(e.legendHeader)))]),e._v(" "),t("div",{staticClass:"ma-item-name-subtitle plottinginfo-wrapper"},[e._v("\n                            "+e._s(e._f("decode")(e.legendSubText))+"\n                        ")])])]):t("div",[t("div",{staticClass:"status"},[e._v(e._s(e._f("decode")(e.computedTotalRecords)))]),e._v(" "),t("div",{staticClass:"status"},[e._v(e._s(e._f("decode")(e.computedRecordsCreatedVisible)))])])])])]),e._v(" "),t("div",{staticClass:"legend-wrap background--white"},e._l(e.legendRows,(function(s,a,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:s.totalmarkers>0||e.showAllLegendData,expression:"row.totalmarkers > 0 || showAllLegendData"}],key:a,staticClass:"legend-item legend-row ma-form-control-wrap ma-checkbox-wrap flex-horizontal",attrs:{"data-id":a,uid:i}},[t("div",{staticClass:"flex-grow-1"},[e.isPolygonLayer?t("div",{staticClass:"ma-checkbox-label"},[e._v("\n                    "+e._s(e._f("decode")(s.label))+"\n                ")]):t("label",{staticClass:"ma-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.active,expression:"row.active"}],staticClass:"legend-checkbox",attrs:{id:"legend-checkbox13","data-rule":i,uid:i,checked:"checked",name:"checkbox",type:"checkbox"},domProps:{checked:Array.isArray(s.active)?e._i(s.active,null)>-1:s.active},on:{change:[function(t){var a=s.active,i=t.target,l=!!i.checked;if(Array.isArray(a)){var o=e._i(a,null);i.checked?o<0&&e.$set(s,"active",a.concat([null])):o>-1&&e.$set(s,"active",a.slice(0,o).concat(a.slice(o+1)))}else e.$set(s,"active",l)},function(t){return e.toggleRow(s)}]}}),e._v(" "),t("span",{staticClass:"ma-checkbox-faux"}),e._v(" "),t("span",{staticClass:"ma-checkbox-label"},[e._v(e._s(e._f("decode")(s.label)))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isPolygonLayer,expression:"!isPolygonLayer"}],staticClass:"legend-count"},[t("span",[e._v(e._s(e.formatLabel(e.$Labels.Mobile_Legend_Count,[s.count,s.totalmarkers])))])]),e._v(" "),t("div",{staticClass:"legend-marker"},[e.isPolygonLayer?t("div",{staticStyle:{border:"1px solid silver",width:"20px",height:"20px"},style:{background:`#${s.markerValue}`}}):t("img",{staticClass:"legend-image",staticStyle:{height:"20px","max-width":"30px"},attrs:{src:s.icon,"data-id":s.markerValue}})])])})),0)])}),[],!1,null,null,null).exports}}]);