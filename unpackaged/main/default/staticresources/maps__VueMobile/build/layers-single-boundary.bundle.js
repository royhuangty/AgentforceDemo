"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[3929],{9036:(t,e,a)=>{a.r(e),a.d(e,{default:()=>u});var s=a(7813),i=a(2423),r=a(3057),o=a(5908);const{$:l,google:n,MA:d,moment:p}=window,c={components:{MASpinner:r.Z},props:{layerData:{type:Object,required:!0}},data:()=>({proximityType:"Circle",address:"",radius:50,unit:"MILES",colorOptions:{},hours:"",minutes:"",opacity:"0.6",latitude:"",longitude:"",kmlOptions:[],kmlLayer:"",loading:!1}),computed:{...(0,o.mapGetters)("layers",{layers__getPlottedLayerByQID:"getPlottedLayerByQID"}),qid(){return this.layerData.qid},layerInfo(){return this.layers__getPlottedLayerByQID(this.qid)},plottedLayer(){return l(`.layer.proximity[qid="${this.qid}"]`)}},async created(){const{shapeType:t="Circle"}=this.layerInfo;this.proximityType=t,await this.getKMLOptions(),await this.setShapeSettings()},methods:{...(0,o.mapMutations)("layers",{layers__updateLayerInfo:"updateLayerInfo"}),setShapeSettings(){const{defaultProximitySettings:t={}}=window.userSettings,{colorOptions:e}=this.layerInfo;this.colorOptions=e||{fillOpacity:"0.6",fillColor:"#3083d3",borderColor:"#16325C"},this.radius=this.layerInfo.radius||t.radius||50,this.latitude=this.layerInfo.latitude||"",this.longitude=this.layerInfo.longitude||"",this.minutes=this.layerInfo.minutes||t.travelTimeRadiusMinutes||"",this.hours=this.layerInfo.hours||t.travelTimeRadiusHours||"1",this.unit=this.layerInfo.unit||t.unit||"MILES",this.address=this.layerInfo.address||`Lat: ${this.layerInfo.latitude}\nLong: ${this.layerInfo.longitude}`,this.loading=!1},submitChanges(){this.removeProxLayer(),this.loading=!0,this.getAddressString().then((()=>{switch(this.updateLayerSettings(),this.proximityType){case"Circle":this.renderCircle();break;case"Polygon":this.renderPolygon();break;case"KML":this.renderKML();break;case"travelTime":case"travelDistance":this.renderTravelData();break;default:console.warn("unknown type")}})).catch((t=>{this.showBoundaryErrorMsg(t),this.loading=!1}))},updateLayerSettings(){const t={...this.layerInfo,colorOptions:this.colorOptions,latitude:this.latitude,longitude:this.longitude,proximityType:this.proximityType,radius:this.radius,minutes:this.minutes,hours:this.hours,address:this.address,unit:this.unit};this.layers__updateLayerInfo(t)},renderCircle(){let t;const e=this.radius*window.unitFactors[this.unit].METERS;if(this.plottedLayer.find(".js-radiusDistance").removeClass("error"),0===e)return this.plottedLayer.find(".js-radiusDistance").addClass("error"),void(this.loading=!1);this.plottedLayer.data("proxObject",t=new n.maps.Circle({map:d.map,center:new n.maps.LatLng(this.latitude,this.longitude),radius:e,layerType:"prox",strokeColor:this.layerInfo.borderColor,strokeWeight:3,strokeOpacity:1,fillColor:this.layerInfo.fillColor,fillOpacity:this.colorOptions.fillOpacity,qid:this.qid}));const a=new n.maps.Marker({map:d.map,position:new n.maps.LatLng(this.latitude,this.longitude),title:this.address,icon:{path:n.maps.SymbolPath.CIRCLE,fillColor:"#ffffff",fillOpacity:1,strokeColor:"#000000",strokeWeight:1,scale:4}});t.centerPoint=a,n.maps.event.addListener(this.plottedLayer.data("proxObject"),"click",(t=>{window.proximityLayer_Click({position:t.latLng,type:"circle",shape:this.plottedLayer.data("proxObject")})})),n.maps.event.addListener(this.plottedLayer.data("proxObject"),"rightclick",(t=>{window.Shape_Context.call(this,t)})),this.loading=!1,window.ChangeVisibilityWhenCircleIsAdded()},getKMLOptions(){(new i.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler(((t,e)=>{console.warn(t),this.kmlOptions=[],d.isUserLoggedIn(t,e,!0)})).invoke([{action:"getKMLOptions",ajaxResource:"QueryBuilderAPI"}],(t=>{if(t.success){const{data:e}=t;this.kmlOptions=e}}),{escape:!1,buffer:!1})},handleTravelData(t,e){const a=[],s=new n.maps.LatLngBounds,i=60*this.hours+this.minutes,r=new n.maps.Marker({position:new n.maps.LatLng({lat:this.latitude,lng:this.longitude}),title:this.address||"",icon:{path:n.maps.SymbolPath.CIRCLE,fillColor:"#ffffff",fillOpacity:1,strokeColor:"#000000",strokeWeight:1,scale:4}});s.extend(r.getPosition()),e.shapes.forEach((e=>{const o=e.coordinates,l=new n.maps.Polygon({path:o,geodesic:!0,isTravelGeom:!0,shapeType:"travelTime",fillColor:this.layerInfo.fillColor,fillOpacity:this.colorOptions.fillOpacity,layer:this.plottedLayer,strokeColor:this.layerInfo.borderColor,saveData:{isCustom:!0,proximityType:"travelTime",travelTime:i,travelLatitude:this.latitude,travelLongitude:this.longitude,travelDistance:"",travelMode:"car",travelPreference:"fastest",trafficEnabled:"disabled",departure:t}});n.maps.event.addListener(l,"click",(t=>{window.proximityLayer_Click({position:t.latLng,type:"Polygon",shape:l})})),n.maps.event.addListener(l,"rightclick",(t=>{window.Shape_Context.call(this,t)})),l.centerPoint=r,a.push(l),s.union(e.bounds),l.setMap(d.map)})),r.setMap(d.map),d.map.fitBounds(s),this.plottedLayer.data("proxObjects",a)},validateTravelDistance(){let t=!0,e="";const a=Number(this.radius*window.unitFactors[this.unit].METERS*window.unitFactors.METERS.MILES),i=Math.round(1609.34*a);if(Number.isNaN(i)||""===this.address)t=!1,e=this.$Labels.Layers_Complete_All_Fields;else if(i<=0)t=!1,e=this.$Labels.Layers_Distance_Greater_Than_Zero;else if(i>5e5){let t=Math.round(5e5*window.unitFactors.METERS[this.unit]);t=t>1?t-1:t,e=(0,s.N4)(this.$Labels.Layers_Max_Travel_Distance,[t,this.unit])}return t||this.showBoundaryErrorMsg(e),t},validateTravelTime(){let t=!0,e="";const a=Number(this.hours),s=Number(this.minutes),i=3600*a+60*s;return Number.isNaN(a)&&Number.isNaN(s)||""===this.address?(t=!1,e=this.$Labels.Layers_Complete_All_Fields):i<=0?(t=!1,e=this.$Labels.Layers_Time_Greater_Than_Zero):i>19800&&(t=!1,e=this.$Labels.Layers_Travel_Five_Thirty),t||this.showBoundaryErrorMsg(e),t},renderTravelData(){this.hasError=!1;let t=!0;if(t="travelTime"===this.proximityType?this.validateTravelTime():this.validateTravelDistance(),!t)return;const e=p().get("day"),a=p().day(e).add(-1,"weeks"),i=`${this.latitude},${this.longitude}`;let r=a;const o={mode:"fastest;car;traffic:disabled",start:`geo!${i}`};if("travelTime"===this.proximityType){const t=60*(60*this.hours+this.minutes);a.hour(this.hours).minutes(this.minutes),o.range=t,o.rangetype="time",r=a.format("YYYY-MM-DDTHH:mm:ss"),o.departure=r}else{const t=Number(this.radius*window.unitFactors[this.unit].METERS*window.unitFactors.METERS.MILES),e=Math.round(1609.34*t);o.range=e,o.rangetype="distance",r=a.format("YYYY-MM-DDTHH:mm:ss")}window.Plotting.getServiceArea({subType:"core",action:"isoline",version:"2",method:"get"},o).then((t=>{this.handleTravelData(r,t),this.loading=!1})).fail((t=>{let e=t.message||this.$Labels.Common_Refresh_And_Try_Again_Contact_Admin;e.indexOf("endpoint")>-1&&(e=(0,s.N4)(this.$Labels.Layers_Cant_Get_Travel_Data_Unauthorized,[window.MASystem.Organization.MAIO_URL])),e=(0,s.N4)(this.$Labels.Layers_Cant_Get_Service_Area,[e]),this.showBoundaryErrorMsg(e),this.loading=!1}))},showBoundaryErrorMsg(t){window.MAToastMessages.showError({message:this.$Labels.Layers_Boundary_Error,subMessage:t,timeOut:0,closeButton:!0})},renderKML(){const t=`${d.resources.XMLDoc}?docId=${this.kmlLayer}`;new window.ZipFile(t,(e=>{const a=e.status.length>0?"KML":"KMZ",s=new window.geoXML3.parser({map:d.map,forceType:a,processStyles:!0,singleInfoWindow:!0,afterParse:()=>{window.ChangeVisibilityWhenCircleIsAdded(),this.loading=!1,this.plottedLayer.data("kmlLayer",s)},failedParse:()=>{console.warn(`Unable to parse: ${d.resources.XMLDoc}?docId=${this.kmlLayer}`);const t=this.$Labels.Layers_Error_Parsing_KML;window.MAToastMessages.showError({message:t,timeOut:6e3}),this.loading=!1}});s.parse(t)}))},renderPolygon(){this.plottedLayer.data("proxObject")?this.proxLayer.data("proxObject").setOptions({fillOpacity:this.colorOptions.fillOpacity}):this.plottedLayer.find(".options-polygon").text(this.$Labels.Layers_Draw_A_Polygon),this.loading=!1},getAddressString(){return new Promise(((t,e)=>{let a=this.address;if("string"==typeof a){a=a.trim(),a=a.replace(/\n\s*\n/g,"\n");const s=a.toLowerCase(),i=/^lat: ([^\n]*)\nlong: ([^\n]*)$/;if(i.test(s)){const a=i.exec(s);if(Array.isArray(a)){const e=d.Util.parseNumberString(a[1]),s=d.Util.parseNumberString(a[2]);this.latitude=Number(e),this.longitude=Number(s),t({latitude:this.latitude,longitude:this.longitude})}else e(new Error(this.$Labels.Layers_Cant_Create_Boundary))}else""===a?e(new Error(this.$Labels.Error_Enter_Address)):d.Geocoding.geocode({address:a},(a=>{const{success:s=!1,result:i={}}=a;if(s){const{Latitude:a,Longitude:s}=i;this.latitude=Number(a),this.longitude=Number(s),Number.isNaN(this.latitude)||Number.isNaN(this.longitude)?e(new Error(this.$Labels.Error_Enter_Geocode)):t({latitude:this.latitude,longitude:this.longitude})}else e(new Error(this.$Labels.MA_Something_Went_Wrong))}))}else e(new Error(this.$Labels.Error_Enter_Address))}))},removeProxLayer(){try{this.plottedLayer.data("proxObject").centerPoint.setMap(null)}catch(t){}try{l.each(this.plottedLayer.data("proxObjects"),((t,e)=>{try{e.centerPoint.setMap(null)}catch(t){}e.setMap(null)}))}catch(t){}if(this.plottedLayer.data("proxObject")&&"Polygon"!==this.plottedLayer.find(".proximitytype").val()){if(this.plottedLayer.data("proxObject").popupHandle)try{this.plottedLayer.data("proxObject").popupHandle.setMap(null)}catch(t){}try{this.plottedLayer.data("proxObject").setMap(null)}catch(t){d.log(t)}this.plottedLayer.removeData("proxObject")}this.plottedLayer.data("dataLayer")&&this.plottedLayer.data("dataLayer").setMap(null),this.plottedLayer.data("kmlLayer")&&this.plottedLayer.data("kmlLayer").hideDocument()}}},u=(0,a(1900).Z)(c,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"proximity layer"},[e("div",{staticClass:"slds-scope"},[e("MASpinner",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]})],1),t._v(" "),e("div",{staticClass:"singleViewInfo pad-16"},[e("div",{staticClass:"options-wrapper"},[e("div",{staticClass:"select-info"},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t.$Labels.Layers_On_The_Map_OverFlow_Boundary_Type))]),t._v(" "),e("div",{staticClass:"ma-form-control has-inset-icon--right"},[e("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.proximityType,expression:"proximityType"}],staticClass:"ma-input proximitytype",attrs:{disabled:"Polygon"===t.proximityType},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.proximityType=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"Circle"}},[t._v(t._s(t.$Labels.MA_Circle))]),t._v(" "),e("option",{staticStyle:{display:"none"},attrs:{value:"Polygon"}},[t._v("\n                            "+t._s(t.$Labels.MA_Polygon)+"\n                        ")]),t._v(" "),e("option",{attrs:{value:"KML"}},[t._v(t._s(t.$Labels.MA_KML))]),t._v(" "),e("option",{attrs:{value:"travelTime"}},[t._v(t._s(t.$Labels.MA_Travel_Time))]),t._v(" "),e("option",{attrs:{value:"travelDistance"}},[t._v(t._s(t.$Labels.MA_Travel_Distance))])])])]),t._v(" "),e("div",{staticClass:"prox-option-select"},[e("div",{staticClass:"prox-option"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"KML"!==t.proximityType&&"Polygon"!==t.proximityType,expression:"proximityType !== 'KML' && proximityType !== 'Polygon'"}],staticClass:"ma-form-control-wrap js-toggleKML",attrs:{id:"boundary-address"}},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_Address)))]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.address,expression:"address"}],staticClass:"ma-input",attrs:{placeholder:t.$Labels.MA_Address_Ellipsis,type:"text"},domProps:{value:t.address},on:{input:function(e){e.target.composing||(t.address=e.target.value)}}})]),t._v(" "),"Circle"===t.proximityType||"travelDistance"===t.proximityType?e("div",[e("div",{staticClass:"ma-form-control-wrap js-rowToggle",attrs:{"data-id":"travelDistance::Circle"}},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_Radius)))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.radius,expression:"radius"}],staticClass:"numberVal ma-input js-radiusDistance prox-style",attrs:{placeholder:"0",type:"text"},domProps:{value:t.radius},on:{input:function(e){e.target.composing||(t.radius=e.target.value)}}})]),t._v(" "),e("div",{staticClass:"ma-form-control-wrap js-rowToggle",attrs:{"data-id":"travelDistance::Circle"}},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_UNITS)))]),t._v(" "),e("div",{staticClass:"ma-form-control has-inset-icon--right"},[e("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.unit,expression:"unit"}],staticClass:"ma-input js-radiusUnit",attrs:{disabled:!t.$store.state.defaultSettings.defaultProximityType.overridable},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.unit=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"MILES"}},[t._v(t._s(t._f("decode")(t.$Labels.Routes_Miles)))]),t._v(" "),e("option",{attrs:{value:"KM"}},[t._v(t._s(t._f("decode")(t.$Labels.Routes_Kilometers)))]),t._v(" "),e("option",{attrs:{value:"METERS"}},[t._v(t._s(t._f("decode")(t.$Labels.MA_Meters)))]),t._v(" "),e("option",{attrs:{value:"YARDS"}},[t._v(t._s(t._f("decode")(t.$Labels.MA_Yards)))]),t._v(" "),e("option",{attrs:{value:"FEET"}},[t._v(t._s(t._f("decode")(t.$Labels.MA_Feet)))])])])])]):t._e(),t._v(" "),"travelTime"===t.proximityType?e("div",[e("div",{staticClass:"ma-form-control-wrap js-rowToggle",attrs:{"data-id":"travelTime"}},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_hours)))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.hours,expression:"hours"}],staticClass:"numberVal ma-input radius-hours prox-style",attrs:{placeholder:"0",type:"text"},domProps:{value:t.hours},on:{input:function(e){e.target.composing||(t.hours=e.target.value)}}})]),t._v(" "),e("div",{staticClass:"ma-form-control-wrap js-rowToggle",attrs:{"data-id":"travelTime"}},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_minutes)))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.minutes,expression:"minutes"}],staticClass:"numberVal ma-input radius-minutes prox-style",attrs:{placeholder:"0",type:"text"},domProps:{value:t.minutes},on:{input:function(e){e.target.composing||(t.minutes=e.target.value)}}})])]):t._e(),t._v(" "),"KML"===t.proximityType?e("div",[e("div",{staticClass:"ma-form-control-wrap js-rowToggle",attrs:{"data-id":"KML"}},[e("div",{staticClass:"ma-form-control has-inset-icon--right"},[e("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.kmlLayer,expression:"kmlLayer"}],staticClass:"ma-input options-kml-document",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.kmlLayer=e.target.multiple?a:a[0]}}},t._l(t.kmlOptions,(function(a,s){return e("option",{key:s,domProps:{value:a.Id}},[t._v("\n                                        "+t._s(t._f("decode")(a.Name))+"\n                                    ")])})),0)])])]):t._e()])])]),t._v(" "),e("div",{staticClass:"color-wrapper js-colorOptions"},[e("div",{staticClass:"ma-form-control-wrap color-select hidden"},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t.$Labels.MA_FILL))]),t._v(" "),e("input",{staticClass:"color fillcolor prox-style ma-input",staticStyle:{"background-image":"none","background-color":"rgb(48, 131, 211)",color:"rgb(255, 255, 255)"},attrs:{type:"text",autocomplete:"off",value:"#3083d3"}})]),t._v(" "),e("div",{staticClass:"ma-form-control-wrap color-select hidden"},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t.$Labels.MA_BORDER))]),t._v(" "),e("input",{staticClass:"color bordercolor prox-style ma-input",staticStyle:{"background-image":"none","background-color":"rgb(22, 50, 92)",color:"rgb(255, 255, 255)"},attrs:{type:"text",autocomplete:"off",value:"#16325C"}})]),t._v(" "),"KML"!==t.proximityType&&"Polygon"!==t.proximityType?e("div",{staticClass:"ma-form-control-wrap opac-wrapper"},[e("label",{staticClass:"ma-input-label"},[t._v(t._s(t.$Labels.MA_OPACITY))]),t._v(" "),e("div",{staticClass:"ma-form-control has-inset-icon--right"},[e("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.colorOptions.fillOpacity,expression:"colorOptions.fillOpacity"}],staticClass:"ma-input js-proxOpacity",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.colorOptions,"fillOpacity",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"0.1"}},[t._v("10%")]),t._v(" "),e("option",{attrs:{value:"0.2"}},[t._v("20%")]),t._v(" "),e("option",{attrs:{value:"0.3"}},[t._v("30%")]),t._v(" "),e("option",{attrs:{value:"0.4"}},[t._v("40%")]),t._v(" "),e("option",{attrs:{value:"0.5"}},[t._v("50%")]),t._v(" "),e("option",{attrs:{value:"0.6"}},[t._v("60%")]),t._v(" "),e("option",{attrs:{value:"0.7"}},[t._v("70%")]),t._v(" "),e("option",{attrs:{value:"0.8"}},[t._v("80%")]),t._v(" "),e("option",{attrs:{value:"0.9"}},[t._v("90%")]),t._v(" "),e("option",{attrs:{value:"1"}},[t._v("100%")])])])]):t._e()]),t._v(" "),e("div",{staticClass:"ma-form-control-wrap",staticStyle:{"margin-top":"28px"}},[e("div",[e("button",{staticClass:"full-width button-update ma-button ma-button--blue",staticStyle:{"line-height":"30px"},on:{click:t.submitChanges}},[t._v("\n                    "+t._s(t.$Labels.MA_Submit)+"\n                ")])])])])])}),[],!1,null,null,null).exports}}]);