import{F as g,i as M}from"./index.2826ab44.js";import{i as k}from"./index.a18e5735.js";import{_ as f,S as D,l as C,P as A,aO as L,f as E,aR as O,r as o,o as m,b as p,w as r,e as R,h,i as l,j as _,t as b}from"../bundle.js";import{M as $}from"./Modal.76578f76.js";const V={name:"RouteCalendar",components:{FullCalendar:g,Modal:$,Spinner:D,SLDSButton:C,Picklist:A},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],setup(){const e=L(),t=E();return{routesStore:e,mainStore:t}},data(){return{loading:!1,month:"",year:"",selectedDate:"",calendarOptions:{plugins:[k,M],headerToolbar:{start:"",center:"",end:""},contentHeight:400,initialView:"dayGridMonth",selectable:!0,select:this.handleDateSelect},currentEvents:[]}},computed:{currentRoute(){return this.routesStore.currentRoute},months(){return[{key:"0",value:this.$Labels.MA_January},{key:"1",value:this.$Labels.MA_February},{key:"2",value:this.$Labels.MA_March},{key:"3",value:this.$Labels.MA_April},{key:"4",value:this.$Labels.MA_May},{key:"5",value:this.$Labels.MA_June},{key:"6",value:this.$Labels.MA_July},{key:"7",value:this.$Labels.MA_August},{key:"8",value:this.$Labels.MA_September},{key:"9",value:this.$Labels.MA_October},{key:"10",value:this.$Labels.MA_November},{key:"11",value:this.$Labels.MA_December}]},years(){return this.getYears()}},created(){const{date:e}=this.modalOptions;let t;e?t=new Date(e):t=new Date,this.month=String(t.getMonth()),this.year=t.getFullYear()},mounted(){this.updateCalendarDate()},methods:{async handleDateSelect(e){this.selectedDate=e.startStr},updateCalendarDate(){const e=this.$refs.fullCalendar.getApi(),t=new Date(Date.UTC(this.year,Number(this.month),15));e.gotoDate(t)},getYears(){const e=[],t=new Date,i=t.getFullYear()-5,u=t.getFullYear()+5;for(let s=i;s<=u;s++)e.push(s);return e},importEvents(){this.loading=!0,O.getEvents(this.selectedDate).then((e=[])=>{e.length===0?this.mainStore.toast({message:this.$Labels.Routes_No_Events_On_This_Day,state:"warning"}):(this.currentRoute.timeBasedOptions.Enabled||(this.currentRoute.timeBasedOptions.Enabled=!0),this.modalOptions.callback({success:!0,events:e})),this.$emit("close-modal")}).catch(()=>{this.mainStore.toast({message:this.$Labels.Routes_Cant_Import_Events,state:"error"})}).finally(()=>{this.loading=!1})}}},w={class:"slds-grid slds-gutters"},B={style:{"min-height":"400px"}};function F(e,t,i,u,s,a){const v=o("Spinner"),d=o("Picklist"),y=o("FullCalendar"),c=o("SLDSButton"),S=o("Modal");return m(),p(S,{title:e.$Labels.MA_IMPORT_EVENTS,size:"small",onClose:t[3]||(t[3]=n=>e.$emit("close-modal"))},{content:r(()=>[s.loading?(m(),p(v,{key:0})):R("",!0),h("div",w,[l(d,{modelValue:s.month,"onUpdate:modelValue":t[0]||(t[0]=n=>s.month=n),inputAttrs:{id:"routeImportEventsMonthPicklistResource"},options:a.months,idKey:"key",class:"slds-col slds-grow-none",titleKey:"value",onSelectedOption:a.updateCalendarDate},null,8,["modelValue","options","onSelectedOption"]),l(d,{modelValue:s.year,"onUpdate:modelValue":t[1]||(t[1]=n=>s.year=n),inputAttrs:{id:"routeImportEventsYearPicklistResource"},options:a.years,class:"slds-col slds-grow-none",onSelectedOption:a.updateCalendarDate},null,8,["modelValue","options","onSelectedOption"])]),h("div",B,[l(y,{ref:"fullCalendar",options:s.calendarOptions},null,8,["options"])])]),footer:r(()=>[l(c,{id:"routeImportEventsCancelBtnResource",class:"slds-button",variant:"neutral",onClick:t[2]||(t[2]=n=>e.$emit("close-modal"))},{default:r(()=>[_(b(e.$Labels.MA_Cancel),1)]),_:1}),l(c,{id:"routeImportEventsImportEventsBtnResource",class:"slds-button",variant:"brand",disabled:!s.selectedDate,onClick:a.importEvents},{default:r(()=>[_(b(e.$Labels.MA_IMPORT_EVENTS),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["title"])}const T=f(V,[["render",F]]);export{T as default};
