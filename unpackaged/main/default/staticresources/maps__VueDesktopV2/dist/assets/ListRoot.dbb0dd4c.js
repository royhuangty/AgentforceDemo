import{_ as q,B as j,I as z,T as ie,u as N,f as O,g as B,r as S,o as g,c as k,F as x,h as b,i as _,t as I,j as P,b as v,e as T,n as oe,w as C,p as Y,k as X,D as w,E as le,l as U,P as re,m as Z,q as F,s as ne,v as ae,x as J,y as de,z as ce,A as Q,M as G,C as ue,G as me,L as E,H as pe,J as he,K as fe,N as ge,O as ye,Q as D,R as W,U as ee,V as K,W as be,a as _e,X as Se,Y as we,S as ve,Z as Ce,$ as Le,a0 as Me,a1 as Ae}from"../bundle.js";import{P as ke}from"./papaparse.min.347d385d.js";import{D as Te}from"./DataTable.354d08d2.js";import{M as H}from"./Modal.76578f76.js";import{C as Ie}from"./ConditionValue.f4982441.js";import Re from"./ListSettings.cd859c35.js";import"./Group.7e0cb254.js";import"./Radio.2202254f.js";import"./index.d251dbc7.js";import"./DatePicker.899772b4.js";import"./TimePicker.bfa4e2f9.js";import"./index.0172543b.js";import"./vuedraggable.umd.c7e4adc2.js";const xe=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/open-road.b9e1c1c4.svg"});const Ve={name:"ListPanelControls",components:{ButtonIcon:j,Icon:z,Tooltip:ie},emits:["close","toggle-height","open-list-settings"],data(){return{listStore:N(),store:O(),layersStore:B()}},methods:{openListSettings(){this.$bus.emit("open-modal",{name:"settings",config:{activeTabId:"listTab"}})},toggleHeight(){this.listStore.fullScreen=!this.listStore.fullScreen},onClose(){this.store.activeTab="layers"}}},te=t=>(Y("data-v-5ae7f5ed"),t=t(),X(),t),$e={class:"slds-grid slds-grid_align-end slds-gutters slds-gutters_x-small",style:{width:"100%",margin:"auto",height:"39px"}},De=te(()=>b("div",{class:"vertical-divider",style:{"margin-right":"0"}},null,-1)),Pe={class:"slds-col",style:{display:"flex","align-items":"center",width:"30px"}},Oe={class:"slds-col slds-grid slds-grid_vertical slds-col_bump-right"},Ee={for:"refPoint",class:"slds-text-title",style:{"font-size":"0.7rem"}},Fe={class:"slds-grid slds-grid_vertical-align-center"},Be=["title"],qe={key:0},Ne=te(()=>b("div",{class:"vertical-divider",style:{"margin-left":"0"}},null,-1)),Ue={class:"slds-col",style:{display:"flex","align-items":"center","margin-top":"-0.25rem"}},je={class:"slds-col",style:{display:"flex","align-items":"center","margin-top":"-0.25rem"}},ze={class:"slds-col",style:{display:"flex","align-items":"center","margin-top":"-0.25rem"}};function He(t,e,i,r,o,s){const l=S("Icon"),a=S("ButtonIcon"),n=S("Tooltip");return g(),k("div",$e,[o.listStore.layers.length>0?(g(),k(x,{key:0},[De,b("div",{class:"slds-grid",style:oe([{width:"200px","padding-top":"0.2rem","padding-right":"0.1rem"},{"background-color":o.listStore.referencePoint===null?"initial":"#e4f3ff"}])},[b("div",Pe,[_(l,{name:"checkin",class:"force-fill",category:"utility",size:"small",style:{fill:"#0176d3","margin-top":"-5px"},inheritFillFromParent:""})]),b("div",Oe,[b("label",Ee,I(t.$Labels.MA_Reference_Point),1),b("div",Fe,[b("div",{id:"refPoint",tabindex:"0",class:"slds-truncate",style:{"max-width":"134px"},title:o.listStore.referencePointAddressString},[o.listStore.referencePoint===null?(g(),k("em",qe,I(t.$Labels.MA_None),1)):(g(),k(x,{key:1},[P(I(o.listStore.referencePointAddressString),1)],64))],8,Be)])]),o.listStore.referencePoint!==null?(g(),v(a,{key:0,"data-q3-id":"lvClearRefPointListViewBtnResource",iconName:"close",iconCategory:"utility",assistiveText:t.$Labels.MA_Clear_Reference_Point,title:t.$Labels.MA_Clear_Reference_Point,style:{"margin-right":"2px",height:"1rem",width:"1rem"},onClick:o.listStore.clearReferencePoint},null,8,["assistiveText","title","onClick"])):T("",!0)],4),Ne],64)):T("",!0),b("div",Ue,[_(n,{text:t.$Labels.ListView_Settings,alignment:"bottom"},{source:C(()=>[_(a,{"data-q3-id":"lvSettingsListViewBtnResource",iconCategory:"utility",iconName:"settings",title:t.$Labels.ListView_Settings,assistiveText:t.$Labels.ListView_Settings,onClick:s.openListSettings},null,8,["title","assistiveText","onClick"])]),_:1},8,["text"])]),b("div",je,[_(n,{text:o.listStore.fullScreen?t.$Labels.ListView_CollapseList:t.$Labels.ListView_ExpandList,alignment:"bottom"},{source:C(()=>[_(a,{"data-q3-id":"lvFullscreenListViewBtnResource",iconCategory:"utility",iconName:o.listStore.fullScreen?"contract_alt":"expand_alt",title:o.listStore.fullScreen?t.$Labels.ListView_CollapseList:t.$Labels.ListView_ExpandList,assistiveText:t.$Labels.MA_Toggle_Fullscreen,onClick:s.toggleHeight},null,8,["iconName","title","assistiveText","onClick"])]),_:1},8,["text"])]),b("div",ze,[_(n,{text:t.$Labels.ListView_CloseList,alignment:"bottom"},{source:C(()=>[_(a,{"data-q3-id":"lvCloseListViewBtnResource",iconCategory:"utility",iconName:"close",title:t.$Labels.ListView_CloseList,assistiveText:t.$Labels.ListView_CloseList,onClick:s.onClose},null,8,["title","assistiveText","onClick"])]),_:1},8,["text"])])])}const Qe=q(Ve,[["render",He],["__scopeId","data-v-5ae7f5ed"]]),M={};M[w.STRING]=M[w.PHONE]=M[w.TEXTAREA]=M[w.URL]=M[w.EMAIL]=M[w.COMBOBOX]=[{id:"equals",title:MASystem.Labels.MA_Equals},{id:"not equal to",title:MASystem.Labels.MA_NOT_EQUAL_TO},{id:"starts with",title:MASystem.Labels.MA_Starts_With},{id:"contains",title:MASystem.Labels.MA_Contains},{id:"does not contain",title:MASystem.Labels.MA_Does_Not_Contain}];M[w.NUMBER]=M[w.DATE]=M[w.DATETIME]=M[w.CURRENCY]=M[w.INTEGER]=M[w.DOUBLE]=M[w.DURATION]=M[w.DISTANCE]=M[w.PERCENT]=[{id:"equals",title:MASystem.Labels.MA_Equals},{id:"not equal to",title:MASystem.Labels.MA_NOT_EQUAL_TO},{id:"less than",title:MASystem.Labels.MA_Less_Than},{id:"greater than",title:MASystem.Labels.MA_Greater_Than},{id:"less or equal",title:MASystem.Labels.MA_Less_Than_Equal},{id:"greater or equal",title:MASystem.Labels.MA_Greater_Than_Equal},{id:"range",title:MASystem.Labels.MA_Range}];M[w.MULTIPICKLIST]=[{id:"includes",title:MASystem.Labels.MA_Includes},{id:"excludes",title:MASystem.Labels.MA_Excludes}];M[w.ID]=M[w.PICKLIST]=M[w.REFERENCE]=[{id:"equals",title:MASystem.Labels.MA_Equals},{id:"not equal to",title:MASystem.Labels.MA_NOT_EQUAL_TO}];M[w.BOOLEAN]=[{id:"equals",title:MASystem.Labels.MA_Equals}];const Ge={name:"AdvancedFiltersModal",components:{ButtonIcon:j,ConditionValue:Ie,ExpandableSection:le,Modal:H,SLDSButton:U,Picklist:re},props:{lid:{type:String,required:!0}},emits:["apply","close"],data(){return{store:O(),listStore:N(),unsupportedFieldTypes:new Set(["time"]),filters:{tooltip:{name:"Tooltips",fields:[]},address:{name:"Address",fields:[]},position:{name:"Position",fields:[]},travel:{name:"Travel",fields:[]}}}},created(){this.init()},methods:{init(){if(this.$props.lid!=="selectedMarkers"||this.listStore.uniqueSelectedLayerCount===1){const l=this.$props.lid==="selectedMarkers"?this.listStore.selectedRecordMap.keys().next().value:this.$props.lid,{tooltips:a}=B().plottedLayers.find(h=>h.qid===l).queryData,n=new Set(["13","14","15","16","17","18","19","20","30","31","32","33","34","35","36"]),u=h=>h.describe.picklistValues?.reduce((d,m)=>(m.active&&d.push({id:m.value,title:m.label}),d),[]);this.filters.tooltip.fields=Object.entries(this.store.settings.listView?.columns?.selected).filter(([,{id:h}])=>{const{sortColumn:d}=this.store.settings.listView.columns.availableMap.get(h),m=String(a[d]?.DisplayType||"").toLocaleLowerCase(),y=!this.unsupportedFieldTypes.has(m),p=["ToolTip","Color","Shape"].indexOf(a[d]?.TooltipType)>-1;return n.has(h)&&Object.hasOwn(a,d)&&p&&y}).map(([,{id:h}])=>{const d=this.store.settings.listView.columns.availableMap.get(h),{soapType:m,DisplayType:y}=a[d.sortColumn],f=Z(y),p={name:this.getColumnLabel(d,l),column:d,soapType:m,displayType:f,tooltip:a[d.sortColumn],multiselect:f===w.MULTIPICKLIST,picklistOptions:u(a[d.sortColumn]),value:"",value2:"",operator:"",operators:M[f]};if(this.listStore.fieldFilterMap.get(this.$props.lid)?.has(d.id)){const c=this.listStore.fieldFilterMap.get(this.$props.lid).get(d.id);p.value=c.value,p.value2=c.value2,p.operator=c.operator}return p})}const t=new Set(["6","7","8","9","10"]),e=Object.entries(this.store.settings.listView?.columns?.selected).some(([,{id:l}])=>l==="21");let i;e?i=Array.from(t).map(l=>this.buildColumn(l,"21")):i=Object.entries(this.store.settings.listView?.columns?.selected).filter(([,{id:l}])=>t.has(l)).map(([,{id:l}])=>this.buildColumn(l)),this.filters.address.fields=i;const r=new Set(["12","11"]),o=Object.entries(this.store.settings.listView?.columns?.selected).some(([,{id:l}])=>l==="22");let s;if(o?s=Array.from(r).map(l=>this.buildColumn(l,"22")):s=Object.entries(this.store.settings.listView?.columns?.selected).filter(([,{id:l}])=>r.has(l)).map(([,{id:l}])=>this.buildColumn(l)),this.filters.position.fields=s,this.$props.lid==="selectedMarkers"){const l=new Set(["4","5","23"]);Object.entries(this.store.settings.listView?.columns?.selected).some(([,{id:n}])=>l.has(n))&&(this.filters.travel.fields=Object.entries(this.store.settings.listView?.columns?.selected).filter(([,{id:n}])=>l.has(n)).map(([,{id:n}])=>this.buildColumn(n)))}},getColumnLabel(t,e){if(e&&typeof t.sortColumn=="number"){const{tooltips:i}=B().plottedLayers.find(r=>r.qid===e).queryData;return i[t.sortColumn]?.FieldLabel||""}return t.label},clear(){Object.entries(this.filters).forEach(([,t])=>{t.fields.forEach(e=>{e.value="",e.value2="",e.operator=""})})},onSave(){const t=new Map;Object.entries(this.filters).forEach(([,e])=>{e.fields.forEach(i=>{i.operator&&t.set(i.column.id,{id:i.column.id,column:i.column,compoundId:i.compoundId,operator:i.operator,value:i.value,value2:i.value2,displayType:i.displayType,soapType:i.soapType})})}),this.listStore.fieldFilterMap.set(this.$props.lid,t),this.$emit("apply")},onClearFilter(t){t.operator="",t.value="",t.value2=""},buildColumn(t,e){const i=this.store.settings.listView.columns.availableMap.get(t);let r=w.STRING;["verifiedLatitude","verifiedLongitude"].includes(i.sortColumn)?r=w.DOUBLE:["driveDistanceValue","straightDistanceValue"].includes(i.sortColumn)?r=w.DISTANCE:i.sortColumn==="driveDurationValue"&&(r=w.DURATION);const o={name:this.getColumnLabel(i),column:i,soapType:r.name,compoundId:e,displayType:r,value:"",value2:"",operators:M[r],operator:""};if(this.listStore.fieldFilterMap.get(this.$props.lid)?.has(t)){const s=this.listStore.fieldFilterMap.get(this.$props.lid).get(t);o.value=s.value,o.value2=s.value2,o.operator=s.operator}return o}}},We=t=>(Y("data-v-f57777a7"),t=t(),X(),t),Ke={style:{padding:"0.25rem 1rem"}},Ye={class:"slds-col slds-grow-none",style:{width:"15rem"}},Xe={class:"slds-col slds-grow-none margin-top-auto"},Ze={class:"slds-grid"},Je={class:"slds-col",style:{"min-width":"13rem"}},et={class:"slds-col slds-grow-none"},tt={class:"slds-form-element"},st=We(()=>b("span",{class:"slds-form-element__label"},"\xA0",-1)),it={class:"slds-form-element__control"};function ot(t,e,i,r,o,s){const l=S("Picklist"),a=S("ConditionValue"),n=S("ButtonIcon"),u=S("ExpandableSection"),h=S("SLDSButton"),d=S("Modal");return g(),v(d,{id:"listViewFilterModal",title:"Filters",labels:{close:t.$Labels.MA_Close},style:{width:"fit-content"},onClose:e[1]||(e[1]=m=>t.$emit("close"))},{content:C(()=>[(g(!0),k(x,null,F(o.filters,(m,y)=>ne((g(),v(u,{key:y,disabled:"",title:m.name},{default:C(()=>[b("div",Ke,[(g(!0),k(x,null,F(m.fields,(f,p)=>(g(),k("div",{key:p,class:"slds-grid slds-gutters_xx-small slds-m-bottom_large"},[b("div",Ye,[_(l,{modelValue:f.name,"onUpdate:modelValue":c=>f.name=c,inputAttrs:{"data-q3-id":`lvNameField-${m.name}-${p}-PicklistResource`},labels:{name:t.$Labels.MA_Field},options:[f.name],disabled:""},null,8,["modelValue","onUpdate:modelValue","inputAttrs","labels","options"])]),b("div",Xe,[_(l,{modelValue:f.operator,"onUpdate:modelValue":c=>f.operator=c,inputAttrs:{"data-q3-id":`lvOperator-${m.name}-${p}-PicklistResource`},labels:{name:"Operator"},options:f.operators,resizeToFitContent:""},null,8,["modelValue","onUpdate:modelValue","inputAttrs","options"])]),b("div",Ze,[b("div",Je,[_(a,{value:f.value,"onUpdate:value":c=>f.value=c,value2:f.value2,"onUpdate:value2":c=>f.value2=c,"data-q3-id":`lvValue-${m.name}-${p}-InputResource`,displayType:f.displayType,multiselectDialog:f.multiselect,picklistOptions:f.picklistOptions,range:f.operator==="range"},null,8,["value","onUpdate:value","value2","onUpdate:value2","data-q3-id","displayType","multiselectDialog","picklistOptions","range"])])]),b("div",et,[b("div",tt,[st,b("div",it,[_(n,{"data-q3-id":`lvClose-${m.name}-${p}-BtnResource`,iconCategory:"utility",iconName:"clear",variant:"border-filled",assistiveText:"Clear Filter",title:"Clear Filter",disabled:!f.operator&&f.value===""&&!f.value2,onClick:c=>s.onClearFilter(f)},null,8,["data-q3-id","disabled","onClick"])])])])]))),128))])]),_:2},1032,["title"])),[[ae,o.filters[y]?.fields?.length]])),128))]),footer:C(()=>[_(h,{"data-q3-id":"lvClearBtnResource",variant:"neutral",label:t.$Labels.MA_Clear,onClick:s.clear},null,8,["label","onClick"]),_(h,{"data-q3-id":"lvCancelBtnResource",variant:"neutral",label:t.$Labels.MA_Cancel,onClick:e[0]||(e[0]=m=>t.$emit("close"))},null,8,["label"]),_(h,{"data-q3-id":"lvSaveBtnResource",variant:"brand",label:t.$Labels.MA_Save,onClick:s.onSave},null,8,["label","onClick"])]),_:1},8,["labels"])}const lt=q(Ge,[["render",ot],["__scopeId","data-v-f57777a7"]]);const rt={name:"ColumnConfigModal",components:{Modal:H,SLDSButton:U,ListSettings:Re,ScopedNotification:J},props:{options:{type:Object,required:!0}},emits:["calculate","close"],computed:{maxRowsMessage(){return`A maximum of 10,000 records can be included in this operation. Select ${this.$props.options.showColumns?'"Save & Calculate"':'"OK"'} to proceed with the first 10,000 records.`}},methods:{async onContinue(){const t=this.$props.options.listView.selected.reduce((e,i,r)=>(e[r]={id:i.id},e),{});try{if((await de.save({listViewColumns:t})).success)O().settings.listView.columns.selected=t,this.$emit("calculate");else throw new Error("Save Setting Error")}catch(e){console.error(e)}}}};function nt(t,e,i,r,o,s){const l=S("ScopedNotification"),a=S("ListSettings"),n=S("SLDSButton"),u=S("Modal");return g(),v(u,{id:"listViewColumnConfigModal",title:t.$props.options.showColumns&&!t.$props.options.limitRows?t.$Labels.MA_COLUMN_VISIBILITY_AND_ORDER:t.$Labels.ListView_Modal_Columns_Header,labels:{close:t.$Labels.MA_Close},style:{width:"fit-content"},onClose:e[1]||(e[1]=h=>t.$emit("close"))},{content:C(()=>[t.$props.options.limitRows&&!t.$props.options.showColumns?(g(),v(l,{key:0,theme:"warning",style:{"max-width":"600px"},class:"slds-m-bottom_large"},{content:C(()=>[P(I(t.$Labels.ListView_Modal_Columns_Text),1)]),_:1})):T("",!0),t.$props.options.showColumns?(g(),v(l,{key:1,style:{"max-width":"600px"},class:"slds-m-bottom_large"},ce({_:2},[t.$props.options.limitRows?{name:"content",fn:C(()=>[P(I(t.$Labels.ListView_Modal_ComboText),1)]),key:"1"}:{name:"content",fn:C(()=>[P(I(t.$Labels.ListView_Modal_Drag_Columns),1)]),key:"0"}]),1024)):T("",!0),t.$props.options.showColumns?(g(),v(a,{key:2,listView:t.$props.options.listView,bare:""},null,8,["listView"])):T("",!0)]),footer:C(()=>[_(n,{variant:"neutral",label:t.$Labels.MA_Cancel,onClick:e[0]||(e[0]=h=>t.$emit("close"))},null,8,["label"]),_(n,{variant:"brand",label:t.$Labels.MA_Ok,onClick:s.onContinue},null,8,["label","onClick"])]),_:1},8,["title","labels"])}const at=q(rt,[["render",nt],["__scopeId","data-v-d22374eb"]]),R=Object.freeze({ASC:"asc",DESC:"desc"}),dt=new Set(["Remove Marker","Street View","Set Verified Location","Clear Coordinates","Create Favorite"]);class se{dynamicFieldColumnIds=new Set(["13","14","15","16","17","18","19","20","30","31","32","33","34","35","36"]);sortDir=R.ASC;sortBy;lid;listStore=N();layersStore=B();store=O();constructor(e){this.lid=e,this.columns=Q([]),this.rows=Q([])}build({searchTerm:e=""}={}){return this.columns.value=this.buildColumns(),this.rows.value=this.buildRows(),this.rows.value=this.filterByAdvancedSearch(),this.rows.value=this.filterByGlobalTextSearch(e),this.sortRows(),this}buildData({record:e,lid:i,queryData:r}){const{addressFields:o,tooltips:s,legendData:l,isPolymorphic:a,polymorphicObject:n,isDynamicOrder:u}=r,h=this.columns.value.map(d=>{let{sortColumn:m}=d;const y=e.Id?.raw||e.Id;m==="verifiedLongitude"?m="longitude":m==="verifiedLatitude"&&(m="latitude");let f="";if(m in o){const p=MAPS.Utils.Obj.get(a?e[n]:e,o[m]);if(m==="latitude"||m==="longitude"){const{geometry:c={}}=e;f=c[m]}else f=p?.formatted??p}else if(m===null||m==="")if(d.name==="Marker"){const{legendId:p,orderLabel:c}=e.attributes,L=l.find(A=>A.legendId===p);f={type:"custom",columnType:"marker",lid:i,rid:y,orderLabel:c,svg:u?G.createOrderNumberDiv(c):G.createSVG({color:L.markerValue})}}else if(d.name==="Position"){const{geometry:p={}}=e;f={type:"custom",formatted:`${p.latitude}, ${p.longitude}`,raw:{verifiedLatitude:p.latitude,verifiedLongitude:p.longitude}}}else d.name==="Query"?f=r.savedQueryName:d.name==="Layer Type"&&(r.layerType==="Markers"?f=MASystem.Labels.MA_Marker:r.layerType==="Live"?f=MASystem.Labels.MA_LIVE:r.layerType==="polyline"?f=MASystem.Labels.MA_Polyline:f=MASystem.Labels.MA_NA);else if(m==="FormattedAddress_MA"){const p=a?e[n]:e;let c=p[o.street]??"";c=typeof c=="object"?c?.formatted:c;let L=p[o.country]??"";L=typeof L=="object"?L?.formatted:L;let A=p[o.city]??"";A=typeof A=="object"?A?.formatted:A;let V=p[o.state]??"";V=typeof V=="object"?V?.formatted:V;let $=p[o.zip]??"";$=typeof $=="object"?$?.formatted:$,f={type:"custom",formatted:ue({address:c,country:L,city:A,state:V,zipCode:$,locale:MAPS.currentUser.Locale}),raw:{street:c,city:A,state:V,zip:$,country:L}}}else if(s[m]){const p=s[m],c=p.polymorphicField?e[n]:e;if(m===0)f={type:"custom",needsLink:!0,linkId:c.Id?.raw||c.Id,...MAPS.Utils.Obj.get(c,p.FieldName)};else if(p.describe.extraTypeInfo==="richtextarea"||p.describe.extraTypeInfo==="plaintextarea"){const{raw:L}=MAPS.Utils.Obj.get(c,p.FieldName),A=new DOMParser().parseFromString(L,"text/html");f={type:"custom",attrs:{style:{"max-width":"500px"}},raw:L,formatted:A.body.textContent||""}}else{const L=Z(p.DisplayType);let A=MAPS.Utils.Obj.get(c,p.FieldName);typeof A!="object"&&(A={raw:A,formatted:A}),f={type:"custom",htmlFormatted:p.describe.htmlFormatted&&A.formatted.indexOf("<a href=")===0,isCheckbox:L===w.BOOLEAN,isURL:L===w.URL,isPhone:L===w.PHONE,needsLink:p.needsLink,linkId:p.needsLink?MAPS.Utils.Obj.get(c,p.linkId):null,...A}}}else if(m==="driveDistanceValue"){if(this.listStore.calculatedValueMap.has(y)){const p=this.listStore.calculatedValueMap.get(y);Object.hasOwn(p,"driveDistanceValue")&&(f={type:"custom",...p.driveDistanceValue})}}else if(m==="driveDurationValue"){if(this.listStore.calculatedValueMap.has(y)){const p=this.listStore.calculatedValueMap.get(y);Object.hasOwn(p,"driveDurationValue")&&(f={type:"custom",...p.driveDurationValue})}}else if(m==="straightDistanceValue"){if(this.listStore.calculatedValueMap.has(y)){const p=this.listStore.calculatedValueMap.get(y);Object.hasOwn(p,"straightDistanceValue")&&(f={type:"custom",...p.straightDistanceValue})}}else if(typeof m=="string"&&m.indexOf("device.")===0){const p=m.split(".")[1];f=(e?.device?.metadata||{})[p],p==="lastEventDate"?f={type:"custom",formatted:f,raw:new Date(f).getTime()}:p==="lastEventTime"&&(f={type:"custom",formatted:f,raw:Date.parse(`1970-01-01 ${f}`)})}return f});return h.push({type:"custom",columnType:"actions"}),h}filterByAdvancedSearch(){if(!this.listStore.fieldFilterMap.has(this.lid)||this.listStore.fieldFilterMap.get(this.lid).size===0)return this.rows.value;const e=new Map;this.listStore.fieldFilterMap.get(this.lid).forEach((o,s)=>{const l=this.columns.value.findIndex(a=>a.id===s||a.id===o.compoundId);e.has(l)||e.set(l,[]),e.get(l).push(o)});const i=me(MAPS.currentUser.TimeZone),r=({date:o,time:s},l=0)=>{const a=new Date(o);a.setHours(...Object.values(s||{hours:0,minutes:0,seconds:0,milliseconds:0}));const n=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()+l,a.getHours()-i,a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return Math.floor(n.getTime()/(1e3*60))};return this.rows.value.filter(o=>Array.from(e).every(([l,a])=>a.every(n=>{const u=o.data[l]||"",h=u?.value||u;let{raw:d=h}=h;if(typeof d=="object"&&(n.compoundId?d=d[n.column.sortColumn]:n.soapType==="ADDRESS"&&(d=h.formatted)),n.soapType==="STRING"||n.soapType==="ADDRESS")switch(n.displayType.equals(w.MULTIPICKLIST)&&(d=d.split(";")),n.operator){case"equals":return d.toLowerCase()===n.value.toLowerCase();case"not equal to":return d.toLowerCase()!==n.value.toLowerCase();case"starts with":return d.toLowerCase().startsWith(n.value.toLowerCase());case"contains":return d.toLowerCase().includes(n.value.toLowerCase());case"does not contain":return!d.toLowerCase().includes(n.value.toLowerCase());case"includes":return n.value.some(m=>d.includes(m));case"excludes":return n.value.some(m=>!d.includes(m));default:return!1}if(["DOUBLE","INTEGER","DATETIME","DATE","DURATION","DISTANCE"].includes(n.soapType)){let m,y;const f=["DATE","DATETIME"];if(typeof d!="number")return!1;switch(f.includes(n.soapType)&&typeof n.value=="object"?(m=r(n.value),n.soapType==="DATE"?d=r({date:d},i<0?1:0):d=Math.floor(d/6e4)):m=parseFloat(n.value||0),n.operator){case"equals":return d===m;case"not equal to":return d!==m;case"less than":return d<m;case"greater than":return d>m;case"less or equal":return d<=m;case"greater or equal":return d>=m;case"range":return f.includes(n.soapType)&&typeof n.value2=="object"?y=r(n.value2):y=parseFloat(n.value2||0),m<=d&&d<=y;default:return!1}}return n.soapType==="BOOLEAN"?h===(n.value==="true"):!1}))?!0:(this.lid==="selectedMarkers"&&(this.listStore.selectedRecordMap.get(o.lid).get(o.rid).selected=!1),!1))}filterByGlobalTextSearch(e){return e?this.rows.value.filter(i=>i.data.some(o=>{const s=o?.value??o;let l=s;return s?.raw!==void 0&&(l=s.raw,typeof l=="object"&&(l=s.formatted)),typeof l=="string"?l.toLowerCase().includes(e.toLowerCase()):!1})?!0:(this.lid==="selectedMarkers"&&(this.listStore.selectedRecordMap.get(i.lid).get(i.rid).selected=!1),!1)):this.rows.value}getSortByColumnIndex(){return this.columns.value.findIndex(e=>e.sortDir)}sortRows(){let e=!1;if(this.lid!=="selectedMarkers"||this.listStore.uniqueSelectedLayerCount===1){let r=this.lid;this.lid==="selectedMarkers"&&(r=this.listStore.selectedRecordMap.keys().next().value),e=this.getQueryData(r).isDynamicOrder}const i=this.getSortByColumnIndex();this.rows.value.length===0||i===-1||this.rows.value.sort((r,o)=>{const s=r.data?.at(i),l=o.data?.at(i);let a=s?.value?s.value:s,n=l?.value?l.value:l;s?.raw!==void 0&&(a=s.raw),l?.raw!==void 0&&(n=l.raw),typeof a=="object"&&(a=s.formatted),typeof n=="object"&&(n=l.formatted),typeof a=="string"&&(a=a.toLowerCase()),typeof n=="string"&&(n=n.toLowerCase());const u=a===n;if(u&&e){const h=r.data[0].orderLabel,d=o.data[0].orderLabel;if(h>d)return this.sortDir===R.ASC?-1:1;if(h<d)return this.sortDir===R.ASC?1:-1}return u?0:a===null||a===""?this.sortDir===R.ASC?-1:1:n===null||n===""?this.sortDir===R.ASC?1:-1:a<n?this.sortDir===R.ASC?-1:1:a>n?this.sortDir===R.ASC?1:-1:0})}onColumnSort(e){this.sortBy===e.sortColumn?this.sortDir=this.sortDir===R.ASC?R.DESC:R.ASC:(this.sortBy=e.sortColumn,this.sortDir=R.ASC),this.columns.value=this.buildColumns(),this.sortRows()}deselectAllRows(){this.rows.value.forEach(e=>{e.selected=!1})}buildColumn(e){return{id:e.id,name:this.getColumnLabel(e),sortColumn:e.sortColumn,sortDir:e.sortColumn===this.sortBy?this.sortDir:null,sortable:e.sortColumn!==""&&e.sortColumn!==null}}getQueryData(e){return this.layersStore.plottedLayers.find(i=>i.qid===(e||this.lid)).queryData}getRowActions(){let e=this.store.settings.buttons.tooltipLayout.reduce((s,l)=>(l.columns.forEach(a=>s.push(...a)),s),[]);e=e.filter(s=>s.action!=="Set Reference Point");let i=!1;this.lid!=="selectedMarkers"&&(i=!!this.getQueryData(this.lid).isPolyline,i&&(e=e.filter(l=>!dt.has(l.action)))),this.lid==="selectedMarkers"&&e.unshift({action:"Clear Marker",label:MAPS.app.config.globalProperties.$Labels.ActionFramework_Clear_Marker,type:"Standard Action"}),i||e.unshift({action:"Set Reference Point",label:MAPS.app.config.globalProperties.$Labels.ActionFramework_Set_Reference_Point,type:"Standard Action"});const r=e.findIndex(s=>s.action==="Create Favorite");r!==-1&&e.splice(r,1);const o=e.find(s=>s.action==="Check In");return o&&(o.disabled=!0),e}getMassActions(){const e=this.store.settings.buttons.massActionLayout.reduce((r,o)=>(o.buttons.forEach(s=>r.push(s)),r),[]),i=e.findIndex(r=>r.action==="Create Record");return i!==-1&&e.splice(i,1),this.lid==="selectedMarkers"&&e.unshift({action:"Clear Markers",label:MAPS.app.config.globalProperties.$Labels.Listview_Button_ClearMarkers,type:"Standard Action"}),this.store.settings.export.enabled&&e.unshift({action:"Export",label:MAPS.app.config.globalProperties.$Labels.MA_Export,type:"Standard Action"}),e}}class ct extends se{store=O();constructor(){super(...arguments),this.sortBy=0}buildRows(){const e=[],i=this.getQueryData();if(!i)return e;for(const r of this.listStore.listMap.get(this.lid).recordMap.values())if(r.isListViewVisible){const o=r.Id?.raw||r.Id,s=this.buildData({lid:this.lid,queryData:i,record:r});e.push({id:o,lid:this.lid,rid:o,data:s,class:this.listStore.referencePoint?.Id===o?["reference-point"]:[],selected:!1})}return e}getColumnLabel(e){return typeof e.sortColumn=="number"?this.getQueryData().tooltips[e.sortColumn]?.FieldLabel||"":e.label}buildColumns(){const e=this.getQueryData();return e?Object.entries(this.store.settings.listView?.columns?.selected||{}).filter(([,{id:i}])=>{const{sortColumn:r}=this.store.settings.listView.columns.availableMap.get(i),o=["1","4","5","23","24"],s=["25","26","28"],l=["ToolTip","Color","Shape"],a=e.layerType?.toLowerCase()!=="live"?[...o,...s]:o,n=l.indexOf(e.tooltips[r]?.TooltipType)>-1;return!a.includes(i)&&(!this.dynamicFieldColumnIds.has(i)||r<=e.tooltips.length-1&&n)}).map(([,{id:i}])=>{const r=this.store.settings.listView.columns.availableMap.get(i);return this.buildColumn(r)}):[]}}class ut extends se{store=O();constructor(){super(...arguments),this.sortBy="order"}buildRows(){const e=[];return this.listStore.selectedRecordMap.forEach((i,r)=>{const o=this.getQueryData(r);i.forEach(({order:s,selected:l},a)=>{const n=this.listStore.listMap.get(r).recordMap.get(a);if(n.isListViewVisible){const u=this.buildData({lid:r,record:n,queryData:o});e.push({id:a,data:u,lid:r,order:s,rid:a,selected:l,class:this.listStore.referencePoint?.Id===a?["reference-point"]:[],geometry:n.geometry})}})}),E.trackFeature({logPayload:{featureName:"selected_markers_tab_created"}}),e}sortRows(){this.getSortByColumnIndex()===-1?this.rows.value.sort((i,r)=>i.order<r.order?-1:i.order>r.order?1:0):super.sortRows()}getColumnLabel(e){if(typeof e.sortColumn=="number"&&this.listStore.uniqueSelectedLayerCount===1){const i=this.listStore.selectedRecordMap.keys().next().value,{tooltips:r}=this.getQueryData(i);return r[e.sortColumn]?.FieldLabel||""}return e.label}buildColumns(){if(this.listStore.uniqueSelectedLayerCount===0)return[];const e=["25","26","28"],i=["ToolTip","Color","Shape"];if(this.listStore.uniqueSelectedLayerCount===1){const s=this.listStore.selectedRecordMap.keys().next().value,{tooltips:l,layerType:a}=this.getQueryData(s);return Object.entries(this.store.settings.listView?.columns?.selected).filter(([,{id:n}])=>{const{sortColumn:u}=this.store.settings.listView.columns.availableMap.get(n),h=["1","24"];return!(a?.toLowerCase()!=="live"?[...h,...e]:h).includes(n)&&(!this.dynamicFieldColumnIds.has(n)||u<=l.length-1&&i.indexOf(l[u]?.TooltipType)>-1)}).map(([,{id:n}])=>{const u=this.store.settings.listView.columns.availableMap.get(n);return this.buildColumn(u)})}const r=Array.from(this.listStore.selectedRecordMap.keys()).map(s=>this.getQueryData(s));return Object.entries(this.store.settings.listView?.columns?.selected).filter(([,{id:s}])=>{const{sortColumn:l}=this.store.settings.listView.columns.availableMap.get(s),a=["1"];return!(r.some(({layerType:h})=>h?.toLowerCase()==="live")?a:[...a,...e]).includes(s)&&(!this.dynamicFieldColumnIds.has(s)||r.some(({tooltips:h})=>l<=h.length-1&&i.indexOf(h[l]?.TooltipType)>-1))}).map(([,{id:s}])=>{const l=this.store.settings.listView.columns.availableMap.get(s);return{...this.buildColumn(l),sortable:l.sortColumn===0||l.sortColumn!==""&&l.sortColumn!==null&&typeof l.sortColumn!="number"}})}}const{Polyline:mt,geometryEngine:pt}=await pe(["esri/geometry/Polyline","esri/geometry/geometryEngine"]),ht={components:{ActionMenu:he,ActionMenuItem:fe,DataTable:Te,FieldRenderer:ge,CalculatePrompt:at,AdvancedFilters:lt,SLDSButton:U,ButtonIcon:j,Icon:z,TextInput:ye},props:{lid:{type:String,required:!0},layerType:{type:String,default:"marker"}},emits:["export"],data(){return{bindTo:null,rowContext:null,rowMenuShowSync:!1,rowActions:[],filteredRowActions:[],store:O(),listStore:N(),layersStore:B(),maxSelectedRows:1e4,layer:null,searchTerm:"",columns:[],rows:[],modals:{filter:{render:!1},config:{render:!1,options:{},callback:null}}}},computed:{isSelectedMarkersTab(){return this.$props.lid==="selectedMarkers"},computedOnSelectRowHandler(){return this.isSelectedMarkersTab?this.onSelectRow:null},computedOnSelectAllHandler(){return this.isSelectedMarkersTab?this.onSelectAll:null},computedSelectedCount(){return this.rows.filter(t=>t.selected).length},computedInfoString(){let t=D(this.$Labels.ListView_Info_MarkersTotalCount,[0]);const e=Intl.NumberFormat(MAPS.currentUser.Locale.replace("_","-")).format(this.rows?.length||0);let i=[D(this.$Labels.ListView_Info_MarkersTotalCount,[e])];if(this.computedSelectedCount>0){const r=Intl.NumberFormat(MAPS.currentUser.Locale.replace("_","-")).format(this.computedSelectedCount);i=[D(this.$Labels.ListView_Info_MarkersSelectedCount,[r])]}else if(this.listStore.fieldFilterMap.get(this.$props.lid)?.size){const r=Array.from(this.listStore.fieldFilterMap.get(this.$props.lid).keys()),o=r.map((a,n)=>this.manager.getColumnLabel(this.listStore.fieldFilterMap.get(this.$props.lid).get(r[n]).column)),s=this.manager.getColumnLabel(this.listStore.fieldFilterMap.get(this.$props.lid).get(r[0]).column);t=D(this.$Labels.ListView_FilteredBy_Single,[s]);const l=o.length-1;l&&(t=l===1?D(this.$Labels.ListView_FilteredBy_Two,[o[0]]):D(this.$Labels.ListView_FilteredBy_Multiple,[o[0],l])),i.push(t)}return i.join(" &bull; ")},computedNumFieldFilters(){return this.listStore.fieldFilterMap.get(this.$props.lid)?.size||0},computedMassActionButtons(){return this.manager.getMassActions().splice(0,3)},computedMassActionDrawerItems(){return this.manager.getMassActions().splice(3)},computedListViewSelectedColumns(){return this.store.settings.listView?.columns?.selected},computedHasCheckboxColumn(){return Object.entries(this.store.settings.listView?.columns?.selected).some(([,{id:t}])=>t==="1")}},watch:{computedListViewSelectedColumns(){this.listStore.cullFieldFilterMapByLayerId(this.$props.lid),this.build()},"listStore.listStoreUpdated":{handler(){this.build()}}},async created(){this.manager=new(this.isSelectedMarkersTab?ut:ct)(this.$props.lid),this.columns=this.manager.columns,this.rows=this.manager.rows,this.rowActions=this.manager.getRowActions(),this.filteredRowActions=[...this.rowActions],this.$bus.on("refresh-list-view",t=>{this.$props.lid===t&&this.build()}),this.unsubscribe=this.listStore.$onAction(({name:t,store:e,after:i})=>{if(t==="clearReferencePoint"){const r=e.referencePoint?.id;i(()=>{const o=this.rows.find(s=>s.rid===r);o&&(o.class=[])})}else t==="setReferencePoint"&&(this.referencePointRow&&(this.referencePointRow.class=[]),i(this.setReferencePointRow));e.calculatedValueMap.size>0&&this.isSelectedMarkersTab&&(t==="clearReferencePoint"||t==="setReferencePoint"&&e.referencePoint!==null)&&i(this.build)}),this.isSelectedMarkersTab?(W(()=>this.listStore.selectedRecordCount,this.build),this.listStore.selectedRecordCount>0&&await this.build()):await this.build(),this.listStore.referencePoint&&this.setReferencePointRow()},unmounted(){this.$bus.off("refresh-list-view")},methods:{setReferencePointRow(){const t=this.listStore.referencePoint.id,e=this.rows.find(i=>i.rid===t);e&&(e.class=["reference-point"],this.referencePointRow=e)},onSelect(){this.$refs.dataTable?.onActivate()},apply(){this.modals.filter.render=!1,this.build()},clear(){!this.searchTerm||(this.searchTerm="",this.build())},async build(){await this.loader({fn:this.manager.build.bind(this.manager,{searchTerm:this.searchTerm}),message:this.$Labels.MA_Building})},async loader(t){const e={fn:()=>{},leading:{active:!0,duration:100},trailing:{active:!0,duration:100},message:"",...t};this.listStore.loader.show=!0,this.listStore.loader.message=e.message,e.leading.active&&e.leading.duration&&await new Promise(i=>{setTimeout(()=>i(),e.leading.duration)}),await e.fn(),e.trailing.active&&e.trailing.duration&&await new Promise(i=>{setTimeout(()=>i(),e.trailing.duration)}),this.listStore.loader.show=!1,this.listStore.loader.message=""},async onColumnSort(t){await this.loader({fn:()=>this.manager.onColumnSort(t),message:"Sorting"})},onMarkerClick(t){this.listStore.fullScreen=!1;const i=MAPS.view.map.findLayerById(t.lid).findLayerById(`records-${t.lid}`);i.queryFeatures({where:`objectId = '${t.rid}'`,returnGeometry:!0}).then(async r=>{const{features:o=[]}=r;if(o.length===1||i.isPolyline){const[s]=o;s&&(await MAPS.view.openPopup({features:[s],location:s.geometry,shouldFocus:!0}),await MAPS.view.goTo(s))}})},debouncedBuild:ee.debounce(function(){this.build()},400),onSelectedMarkerAction(t){const e=[];this.rows.filter(i=>i.selected).forEach(i=>{e.push(i.rid),i.selected=!1}),this.listStore[`${t}SelectedRecordIds`](this.$props.lid,e),this.$refs.dataTable.updateSelectAllState()},async onExport(){!await new Promise(i=>{this.$emit("export",{options:{selected:this.computedSelectedCount,maximum:this.store.settings.export.size},callback:r=>i(r)})})||(await this.loader({fn:()=>{const i=[],r=Math.min(this.store.settings.export.size,this.computedSelectedCount),o=this.rows.filter(u=>{const{selected:h}=u;return u.selected=!1,h});for(let u=0;u<r;u++){const h=o[u];i.push(h.data.filter(d=>!["marker","actions"].includes(d?.columnType)).map(d=>d?.formatted??d))}const s=ke.unparse({data:[this.columns.filter(u=>u.id!=="2").map(u=>u.name),...i]}),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=window.URL.createObjectURL(l),n=document.createElement("a");n.href=a,n.setAttribute("download","Maps_Export.csv"),n.click(),this.$refs.dataTable.updateSelectAllState()},leading:{active:!0,duration:1e3},trailing:{active:!1},message:"Exporting"}),E.trackFeature({logPayload:{featureName:"list_view_exported"}}))},deselectAllRows(){this.manager.deselectAllRows(),this.$refs.dataTable.updateSelectAllState()},async onMassAction({action:t}){if(E.trackFeature({logPayload:{featureName:"list_view_mass_action",action:String(t).toLowerCase().replaceAll(" ","_")}}),t==="Clear Markers")this.clearMarkers();else if(t==="Export")this.onExport();else{this.listStore.loader.show=!0;const e=this.rows.length,i={};for(let r=0;r<e;r++){const o=this.rows[r],{selected:s,lid:l,rid:a}=o;s&&(i[l]||(i[l]={oids:[]}),i[l].oids.push(a))}await K({action:t,layerMap:i}),this.deselectAllRows(),this.listStore.loader.show=!1}},onRowMenuActivation(t,e){const i=this.manager.getQueryData(e.lid),{layerType:r}=i,o=["Remove Marker","Set Verified Location","Clear Coordinates","Set Reference Point"];if(r==="polyline"?this.filteredRowActions=this.rowActions.filter(l=>!o.includes(l.label)):r==="Live"?this.filteredRowActions=this.rowActions.filter(l=>l.label!=="Set Verified Location"):this.filteredRowActions=this.rowActions,this.rowContext=e,this.bindTo===t.target)return;this.bindTo=t.target,this.rowMenuShowSync=!1,this.$nextTick(()=>{this.rowMenuShowSync=!0});const s=this.filteredRowActions.findIndex(l=>l.action==="Check In"||l.action==="Check Out");if(s>-1){const l=this.filteredRowActions[s];l.disabled=!0,this.processCheckInOutStatus(l,s)}},onRowActionMenuHide(){this.bindTo=null,this.unwatch&&this.unwatch()},async processCheckInOutStatus(t,e){const{lid:i,rid:r}=this.rowContext,o=this.listStore.listMap.get(i).recordMap.get(r);if(o.checkInOutProcessing.value){this.unwatch=W(()=>o.checkInOutProcessing.value,()=>{this.rowMenuShowSync&&this.processCheckInOutStatus(t,e)});return}const{supportsActivities:s,tasks:l,events:a}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.GetCheckinInformation",[this.rowContext.rid]);if(s){const n=l.at(0)||a.at(0);n?(t.action="Check Out",t.label=this.$Labels.ActionFramework_Check_Out,t.checkInData={id:n.Id}):t.action==="Check Out"&&(t.action="Check In",t.label=this.$Labels.ActionFramework_Check_In),t.disabled=!1}else this.filteredRowActions.splice(e,1),this.rowActions.findIndex(u=>u.action==="Check In"||u.action==="Check Out")>-1&&this.rowActions.splice(e,1)},async onRowAction({action:t,checkInData:e}){const i=t==="Check Out"||t==="Check In",{lid:r,rid:o}=this.rowContext,s=this.listStore.listMap.get(r).recordMap.get(o);E.trackFeature({logPayload:{featureName:"list_view_row_action",action:String(t).toLowerCase().replaceAll(" ","_")}});try{if(t==="Clear Marker")this.clearMarker({lid:r,rid:o});else{this.listStore.loader.show=!0;const l={};l[r]={oids:[o]},i&&(s.checkInOutProcessing.value=!0,await this.$nextTick()),t==="Check Out"&&(s.checkInData=e),await K({action:t,layerMap:l})}}catch(l){this.store.toast({message:l.message,state:"error",duration:0})}finally{this.listStore.loader.show=!1,i&&(s.checkInOutProcessing.value=!1)}},onSelectRow({row:t}){this.listStore.selectedRecordMap.get(t.lid).get(t.rid).selected=t.selected},onSelectAll(t){this.listStore.selectedRecordMap.forEach(e=>{e.forEach(i=>{i.selected=t})})},clearMarker({lid:t,rid:e}){this.listStore.removeSelectedRecordsByIds(t,[e])},clearMarkers(){this.rows.filter(t=>t.selected).forEach(({lid:t,rid:e})=>this.clearMarker({lid:t,rid:e}))},async onCalculate(t){if(!this.listStore.referencePoint){this.store.toast({message:this.$Labels.Listview_Toast_RefPoint_Header,subMessage:this.$Labels.Listview_Toast_RefPoint_Text,state:"warning",duration:0});return}const e=new Map([["drive",["4","5"]],["straight-line",["23"]]]),i=new Set(Object.values(this.store.settings.listView.columns.selected||{}).reduce((a,{id:n})=>(a.push(n),a),[])),r=t==="drive"&&e.get("drive").every(a=>!i.has(a)),o=t==="straight-line"&&e.get("straight-line").every(a=>!i.has(a)),s=r||o;if(s||this.computedSelectedCount>this.maxSelectedRows){if(s&&!this.store.settings.listView.columns.unlocked){this.store.toast({message:this.$Labels.Listview_Toast_ReqColumns_Header,subMessage:this.$Labels.Listview_Toast_ReqColumns_Text,state:"warning",duration:0});return}await new Promise(n=>{this.modals.config.render=!0;const u=be(this.store.settings.listView.columns.selected);this.modals.config.options={showColumns:s,limitRows:this.computedSelectedCount>this.maxSelectedRows,listView:{unlocked:!0,selected:u.selected,available:u.available.filter(({id:h})=>e.get(t).includes(h))}},this.modals.config.callback=async()=>{this.modals.config.render=!1,n()}})}await this.loader({fn:t==="drive"?this.calculateDrive:this.calculateStraightLine,message:this.$Labels.MA_Calculating});const l=t==="drive"?"drive_time_calculated":"drive_distance_calculated";E.trackFeature({logPayload:{featureName:l}}),this.build()},calculateStraightLine(){const t={id:this.listStore.referencePoint.id,latitude:this.listStore.referencePoint.latitude,longitude:this.listStore.referencePoint.longitude},e=this.rows.filter(i=>i.selected&&i.rid!==t.id);for(let i=0;i<Math.min(this.maxSelectedRows,e.length);i++){const r=e[i],o=[[t.latitude,t.longitude],[r.geometry.latitude,r.geometry.longitude]],s=new mt({paths:[o]}),l=this.store.settings.routes.units.value,a=Number(pt.geodesicLength(s,l==="mi"?"miles":"kilometers").toFixed(2)),n={raw:a,formatted:`${MAPS.app.config.globalProperties.$F("Numeric",a)} ${l==="mi"?"mi":"km"}`},u=this.listStore.calculatedValueMap.get(r.rid)||{};this.listStore.calculatedValueMap.set(r.rid,{...u,straightDistanceValue:n,lid:r.lid})}},async calculateDrive(){if(!window.google?.maps?.DistanceMatrixService){const{Loader:u}=await _e(()=>import("./index.esm.7bf8a516.js"),[],import.meta.url);await new u({version:"3.52",client:"gme-cloudbiltinc"}).load(),await window.google.maps.importLibrary("geometry")}const t=this.listStore.referencePoint.id,e=[[]],i=this.rows.filter(u=>u.selected&&u.rid!==t);for(let u=0;u<Math.min(this.maxSelectedRows,i.length);u++){const h=i[u],d=e[e.length-1];d.push({rid:h.rid,lid:h.lid,destination:new window.google.maps.LatLng(h.geometry.latitude,h.geometry.longitude)}),d.length===25&&e.push([])}const r=new window.google.maps.LatLng(this.listStore.referencePoint.latitude,this.listStore.referencePoint.longitude),o=this.store.settings.routes.units.value;let s=0,l=0;const a=async u=>{const h=new window.google.maps.DistanceMatrixService;try{const d=await h.getDistanceMatrix({origins:[r],destinations:u.map(({destination:y})=>y),travelMode:"DRIVING",unitSystem:o==="mi"?window.google.maps.UnitSystem.IMPERIAL:window.google.maps.UnitSystem.METRIC}),{elements:m}=d.rows[0];m.forEach((y,f)=>{if(s++,y.status==="OK"){const{rid:p,lid:c}=u[f],L=Number(MAPS.Utils.Measure.convertMeasurement(y.distance.value,"meters",o).toFixed(2)),A={raw:L,formatted:`${MAPS.app.config.globalProperties.$F("Numeric",L)} ${o==="mi"?"mi":"km"}`},V={raw:Math.round(y.duration.value/60),formatted:y.duration.text},$=this.listStore.calculatedValueMap.get(p)||{};this.listStore.calculatedValueMap.set(p,{...$,driveDistanceValue:A,driveDurationValue:V,lid:c})}else l++})}catch(d){console.error(d)}};await new Se({maxConcurrency:6,workers:e.map(u=>a.bind(this,u))}).start(),l&&this.store.toast({message:this.$Labels.Listview_Toast_Calc_Header,subMessage:this.$Labels.Listview_Toast_Calc_Body,state:"warning",duration:0})}}},ft={key:0,class:"slds-grid slds-grid_align-center slds-grid_vertical-align-center",style:{height:"100%"}},gt={class:"slds-text-longform",style:{"text-align":"center"}},yt={class:"slds-text-heading_medium slds-m-top_medium"},bt={class:"slds-grid",style:{margin:"0 10px"}},_t={key:0,class:"dot"},St=["innerHTML"],wt={class:"slds-col_bump-left"},vt={key:2,class:"slds-button-group",role:"group"},Ct=["onClick","innerHTML"],Lt={key:1,class:"slds-align_absolute-center"},Mt={key:1,class:"slds-grid slds-grid_align-center slds-grid_vertical-align-center",style:{height:"100%"}},At={class:"slds-text-longform"},kt={class:"slds-text-heading_medium slds-m-top_medium"};function Tt(t,e,i,r,o,s){const l=S("Icon"),a=S("ButtonIcon"),n=S("TextInput"),u=S("SLDSButton"),h=S("ActionMenuItem"),d=S("ActionMenu"),m=S("FieldRenderer"),y=S("DataTable"),f=S("AdvancedFilters"),p=S("CalculatePrompt");return s.isSelectedMarkersTab&&o.listStore.selectedRecordCount===0?(g(),k("div",ft,[b("div",gt,[b("h3",yt,I(t.$Labels.Listview_Selected_Empty_Header),1),P(" "+I(t.$Labels.Listview_Selected_Empty_Text),1)])])):(g(),k(x,{key:1},[b("div",bt,[_(n,{modelValue:o.searchTerm,"onUpdate:modelValue":e[0]||(e[0]=c=>o.searchTerm=c),inputAttrs:{"data-q3-id":"lvSearchInputResource"},class:"slds-input-has-icon slds-input-has-icon_left-right",labels:{placeholder:t.$Labels.SLDS.Picklist.search},onInput:s.debouncedBuild},{extend:C(()=>[_(l,{category:"utility",name:"search",iconClass:["slds-input__icon","slds-input__icon_left"]}),_(a,{"data-q3-id":"lvCloseSearchBtnResource",iconCategory:"utility",iconName:"clear",assistiveText:t.$Labels.MA_Clear,iconClass:"slds-icon-text-light",class:"slds-input__icon slds-input__icon_right",title:t.$Labels.MA_Clear,onClick:s.clear},null,8,["assistiveText","title","onClick"])]),_:1},8,["modelValue","labels","onInput"]),_(a,{"data-q3-id":"lvFilterListBtnResource",class:"slds-m-left_x-small",iconCategory:"utility",iconName:"filterList",variant:"border",assistiveText:t.$Labels.MA_Filters,title:t.$Labels.MA_Filters,onClick:e[1]||(e[1]=c=>o.modals.filter.render=!0)},null,8,["assistiveText","title"]),s.computedNumFieldFilters>0?(g(),k("span",_t,I(s.computedNumFieldFilters),1)):T("",!0),b("div",{"data-q3-id":"lvSelectedMarkersFiltered",style:{display:"flex","flex-wrap":"wrap","align-content":"center","margin-left":"1rem"},class:"slds-truncate",innerHTML:s.computedInfoString},null,8,St),b("div",wt,[!s.isSelectedMarkersTab&&s.computedSelectedCount>0?(g(),v(d,{key:0,style:{display:"inline-block"}},{button:C(()=>[_(u,{"data-q3-id":"lvSelectedMarkersBtnResource",label:t.$Labels.Listview_Button_AddToSelected,iconCategory:"utility",iconName:"down",iconPosition:"right",class:"slds-m-right_small"},null,8,["label"])]),default:C(()=>[_(h,{"data-q3-id":"lvAddSelectedMarkersTab",label:t.$Labels.Listview_Button_AddToList,onClick:e[2]||(e[2]=c=>s.onSelectedMarkerAction("add"))},null,8,["label"]),_(h,{"data-q3-id":"lvReplaceSelectedMarkersTab",label:t.$Labels.Listview_Button_ReplaceSelected,disabled:o.listStore.selectedRecordCount===0,onClick:e[3]||(e[3]=c=>o.listStore.selectedRecordCount===0?null:s.onSelectedMarkerAction("replace"))},null,8,["label","disabled"])]),_:1})):T("",!0),s.isSelectedMarkersTab&&s.computedSelectedCount>0?(g(),v(d,{key:1,style:{display:"inline-block"}},{button:C(()=>[_(u,{"data-q3-id":"lvCalculateBtnResource",label:t.$Labels.Listview_Button_Calculate,iconCategory:"utility",iconName:"down",iconPosition:"right",class:"slds-m-right_small"},null,8,["label"])]),default:C(()=>[_(h,{"data-q3-id":"lvDriveDistanceTimeBtnResource",label:t.$Labels.MA_Drive_Distance_And_Time,onClick:e[4]||(e[4]=c=>s.onCalculate("drive"))},null,8,["label"]),_(h,{"data-q3-id":"lvStraightLineDistanceBtnResource",label:t.$Labels.MA_Straight_Line_Distance,onClick:e[5]||(e[5]=c=>s.onCalculate("straight-line"))},null,8,["label"])]),_:1})):T("",!0),s.computedMassActionButtons.length?(g(),k("div",vt,[(g(!0),k(x,null,F(s.computedMassActionButtons,(c,L)=>(g(),v(u,{key:c.action,"data-q3-id":`lvMassActionBtn-${L}`,disabled:s.computedSelectedCount===0,label:c.label,onClick:A=>s.onMassAction(c)},null,8,["data-q3-id","disabled","label","onClick"]))),128)),s.computedMassActionDrawerItems.length?(g(),v(d,{key:0,disabled:s.computedSelectedCount===0,class:"slds-button_last",maxHeight:"180px"},{default:C(()=>[(g(!0),k(x,null,F(s.computedMassActionDrawerItems,(c,L)=>(g(),v(h,{key:c.action,"data-q3-id":`lvActionMenuItem-${L}`,disabled:s.computedSelectedCount===0,label:c.label,onClick:A=>s.computedSelectedCount===0?null:s.onMassAction(c)},null,8,["data-q3-id","disabled","label","onClick"]))),128))]),_:1},8,["disabled"])):T("",!0)])):T("",!0)])]),o.columns.length?(g(),v(y,{key:0,ref:"dataTable",class:"slds-m-top_small",rows:o.rows,columns:o.columns,multiselectable:s.isSelectedMarkersTab||s.computedHasCheckboxColumn,actions:"",fixed:o.listStore.fixed,virtual:"",onColumnSort:s.onColumnSort,onSelectRow:s.computedOnSelectRowHandler,onSelectAll:s.computedOnSelectAllHandler},{cell:C(c=>[c.column?.name==="Marker"?(g(),k("a",{key:0,style:{"text-align":"center",display:"block"},class:"list-view-svg-wrapper",onClick:L=>s.onMarkerClick(c.data),innerHTML:c.data.svg},null,8,Ct)):c.data.columnType==="actions"?(g(),k("div",Lt,[_(a,{iconCategory:"utility",iconName:"down",title:"Row Actions",size:"x-small",variant:"border-filled",assistiveText:"Row Actions",onClick:L=>s.onRowMenuActivation(L,c.row)},null,8,["onClick"])])):(g(),v(m,we({key:2,class:"slds-truncate"},c.data?.attrs||{},{field:c.data,recordId:c.data.linkId}),null,16,["field","recordId"]))]),_:1},8,["rows","columns","multiselectable","fixed","onColumnSort","onSelectRow","onSelectAll"])):T("",!0),o.rows?.length===0&&!o.listStore.loader.show?(g(),k("div",Mt,[b("div",At,[b("h3",kt,I(t.$Labels.Listview_No_Results),1)])])):T("",!0),o.bindTo?(g(),v(d,{key:2,doShowSync:o.rowMenuShowSync,"onUpdate:doShowSync":e[6]||(e[6]=c=>o.rowMenuShowSync=c),class:"row-menu",bindTo:o.bindTo,maxHeight:"180px",onHide:s.onRowActionMenuHide},{default:C(()=>[(g(!0),k(x,null,F(o.filteredRowActions,c=>(g(),v(h,{key:c.action,label:c.label,disabled:c.disabled,onClick:L=>c.disabled?null:s.onRowAction(c)},null,8,["label","disabled","onClick"]))),128))]),_:1},8,["doShowSync","bindTo","onHide"])):T("",!0),o.modals.filter.render?(g(),v(f,{key:3,lid:t.$props.lid,onApply:s.apply,onClose:e[7]||(e[7]=()=>{o.modals.filter.render=!1})},null,8,["lid","onApply"])):T("",!0),o.modals.config.render?(g(),v(p,{key:4,options:o.modals.config.options,onClose:e[8]||(e[8]=()=>{o.modals.config.render=!1}),onCalculate:o.modals.config.callback},null,8,["options","onCalculate"])):T("",!0)],64))}const It=q(ht,[["render",Tt],["__scopeId","data-v-02fe56e1"]]),Rt={name:"ExportModal",components:{Modal:H,ScopedNotification:J,SLDSButton:U},props:{options:{type:Object,required:!0}},emits:["close","ok"],computed:{showWarning(){return this.$props.options.selected>this.$props.options.maximum},maximum(){return Intl.NumberFormat(MAPS.currentUser.Locale.replace("_","-")).format(this.$props.options.maximum)},selected(){return Intl.NumberFormat(MAPS.currentUser.Locale.replace("_","-")).format(this.$props.options.selected)},computedVerifyLabel(){return D(this.$Labels.ListView_Export_Verify,[Math.min(this.$props.options.selected,this.$props.options.maximum)])}}},xt={class:"slds-text-align_center"},Vt={class:"slds-m-bottom_x-small slds-text-heading_small"},$t={class:"slds-text-color_weak"},Dt={class:"slds-text-color_weak"};function Pt(t,e,i,r,o,s){const l=S("ScopedNotification"),a=S("SLDSButton"),n=S("Modal");return g(),v(n,{title:"Export",size:"small",onClose:e[2]||(e[2]=u=>t.$emit("close"))},{content:C(()=>[s.showWarning?(g(),v(l,{key:0,class:"slds-m-bottom_large",theme:"warning"},{content:C(()=>[P(" Based on your Maps permissions, we are exporting the first "),b("strong",null,I(s.maximum),1),P(" rows of the "),b("strong",null,I(s.selected),1),P(" you selected. If needed, ask your Maps administrator about making an adjustment to your permissions. ")]),_:1})):T("",!0),b("div",xt,[b("div",Vt,I(s.computedVerifyLabel),1),b("div",$t,I(t.$Labels.ListView_Export_Slow_Down),1),b("div",Dt,I(t.$Labels.ListView_Export_Popup_Warning),1)])]),footer:C(()=>[_(a,{variant:"neutral",label:t.$Labels.MA_Cancel,onClick:e[0]||(e[0]=u=>t.$emit("close"))},null,8,["label"]),_(a,{variant:"brand",label:t.$Labels.MA_Ok,onClick:e[1]||(e[1]=u=>t.$emit("ok"))},null,8,["label"])]),_:1})}const Ot=q(Rt,[["render",Pt]]);const Et={components:{ExportModal:Ot,ListPanelControls:Qe,ListView:It,Icon:z,Spinner:ve,Tab:Ce,Tabs:Le},data(){return{layersStore:B(),listStore:N(),mounted:!1,EmptyStateSVG:xe,tabs:{renderedLimit:1/0,overflowMap:[]},modals:{export:{render:!1,options:{},callback:null}}}},computed:{computedSelectedMarkersTitle(){return D(this.$Labels.ListView_Tab_SelectedMarkers,[Intl.NumberFormat(MAPS.currentUser.Locale.replace("_","-")).format(this.listStore.selectedRecordCount)])},orderedLayers(){return this.tabs.renderedLimit===1/0?this.listStore.layers:this.listStore.layers.map((t,e)=>({...t,order:this.tabs.renderedLimit-1>e?e:e+1}))},selectedMarkersOrder(){return this.tabs.renderedLimit===1/0?this.orderedLayers.length:this.tabs.renderedLimit-1}},watch:{"listStore.layers.length":{handler(t,e){e===0&&this.initializeResizeObserver()},immediate:!0}},mounted(){if(this.listStore.layers.length===0){this.mounted=!0,document.body.focus();return}setTimeout(()=>{this.mounted=!0,this.initializeResizeObserver()},500)},created(){this.listStoreUnsubscribe=this.listStore.$onAction(({name:t,after:e})=>{(t==="addSelectedRecordIds"||t==="removeSelectedRecordsByIds")&&e(this.debouncedOnResize)}),this.layersStoreUnsubscribe=this.layersStore.$onAction(({name:t,after:e,args:i})=>{t==="removePlottedLayer"&&e(()=>{this.listStore.removeListByLayerId(i[0]),this.listStore.layers.length&&this.listStore.activeTabId===i[0]?this.listStore.activeTabId=this.listStore.layers[0].qid:this.listStore.layers.length===0&&this.listStore.reset()})}),E.trackFeature({logPayload:{featureName:"list_view_opened"}})},unmounted(){this.listStoreUnsubscribe(),this.layersStoreUnsubscribe(),this.resizeObserver.disconnect()},methods:{async initializeResizeObserver(){await this.$nextTick(),this.debouncedOnResize(),this.resizeObserver=new ResizeObserver(this.debouncedOnResize),this.resizeObserver.observe(this.$refs.tabs?.$el?.childNodes[0])},debouncedOnResize:ee.debounce(async function(){const e=this.$refs.tabs?.$el?.childNodes[0];if(!!e)if(e.scrollWidth>e.offsetWidth){const i=Math.min(this.tabs.renderedLimit,this.listStore.layers.length+1);for(this.tabs.renderedLimit=i,await this.$nextTick();e.scrollWidth>e.offsetWidth&&i>0;)--this.tabs.renderedLimit,await this.$nextTick()}else{for(;this.tabs.renderedLimit<this.listStore.layers.length+1&&e.scrollWidth<=e.offsetWidth;)this.tabs.renderedLimit++,await this.$nextTick();e.scrollWidth>e.offsetWidth&&(this.tabs.renderedLimit--,await this.$nextTick())}},250),async onTabChange(t){await this.$nextTick();const e=setInterval(()=>{let i=this.$refs[t];i&&(i=Array.isArray(i)?i[0]:i,clearInterval(e),i.onSelect())},100)},onRequestExport(t){this.modals.export={render:!0,...t}},onExportDecision(t){this.modals.export.render=!1,this.modals.export.callback(t)}}},Ft={id:"listview",class:"slds-border_top slds-is-relative",style:{"background-color":"#fff"}},Bt={class:"slds-text-title_caps",style:{"font-size":".85rem"}},qt={key:2,style:{height:"100%"}},Nt={class:"slds-grid slds-grid_align-center slds-grid_vertical-align-center",style:{height:"100%"}},Ut={class:"slds-text-longform"},jt={class:"slds-text-heading_medium slds-m-top_medium"};function zt(t,e,i,r,o,s){const l=S("Spinner"),a=S("ListView"),n=S("Tab"),u=S("ListPanelControls"),h=S("Tabs"),d=S("Icon"),m=S("ExportModal");return g(),v(Ae,null,[b("div",Ft,[!o.mounted||o.listStore.loader.show?(g(),v(l,{key:0,immediate:""},{description:C(()=>[b("div",Bt,I(o.listStore.loader.message),1)]),_:1})):T("",!0),o.mounted&&o.listStore.layers.length>0?(g(),v(h,{key:1,id:"list-tabset",ref:"tabs",modelValue:o.listStore.activeTabId,"onUpdate:modelValue":e[0]||(e[0]=y=>o.listStore.activeTabId=y),renderedTabLimit:o.tabs.renderedLimit,class:"slds-grid slds-grid_vertical",style:{height:"100%"},onChanged:s.onTabChange},{default:C(()=>[(g(!0),k(x,null,F(s.orderedLayers,y=>(g(),v(n,{id:y.qid,key:y.qid,order:y.order,title:y.name,class:"slds-grid slds-grid_vertical",style:{display:"flex",flex:"1",overflow:"hidden","padding-bottom":"0"}},{default:C(()=>[y.isLoading?(g(),v(l,{key:0})):(g(),v(a,{key:1,ref_for:!0,ref:y.qid,lid:y.qid,layerType:y.type,onExport:s.onRequestExport},null,8,["lid","layerType","onExport"]))]),_:2},1032,["id","order","title"]))),128)),_(n,{id:"selectedMarkers",title:s.computedSelectedMarkersTitle,order:s.selectedMarkersOrder,class:"slds-grid slds-grid_vertical",style:{display:"flex",flex:"1",overflow:"hidden","padding-bottom":"0"}},{default:C(()=>[_(a,{ref:"selectedMarkers",lid:"selectedMarkers",onExport:s.onRequestExport},null,8,["onExport"])]),_:1},8,["title","order"])]),content:C(()=>[_(u)]),_:1},8,["modelValue","renderedTabLimit","onChanged"])):o.mounted?(g(),k("div",qt,[_(u),b("div",Nt,[b("div",{class:Me(["slds-illustration",o.listStore.fullScreen?"list-view-empty-state-large":"list-view-empty-state"])},[_(d,{src:o.EmptyStateSVG},null,8,["src"]),b("div",Ut,[b("h3",jt,I(t.$Labels.Listview_Empty_Header),1),b("p",null,I(t.$Labels.Listview_Empty_Text),1)])],2)])])):T("",!0),o.modals.export.render?(g(),v(m,{key:3,options:o.modals.export.options,onClose:e[1]||(e[1]=y=>s.onExportDecision(!1)),onOk:e[2]||(e[2]=y=>s.onExportDecision(!0))},null,8,["options"])):T("",!0)])],1024)}const os=q(Et,[["render",zt],["__scopeId","data-v-6f3e2a45"]]);export{os as default};
