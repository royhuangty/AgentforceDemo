import{_ as T,O as B,bk as V,r as h,o as _,c as y,i as c,h as a,t as d,s as R,ao as O,H as q,P as j,l as U,a5 as D,B as W,S as k,ac as x,b as $,w as f,j as A,e as g,F as w,q as E,$ as K,Z as H,f as J,g as z,L as X}from"../bundle.js";import{M as Q}from"./Modal.76578f76.js";import{u as C}from"./index.d251dbc7.js";import{c as L,r as S,m as Z,b as Y}from"./index.0172543b.js";import{a as ee}from"./salesforce-object-utils.cdd4a0a9.js";const te=e=>()=>!e,se={name:"ArcGISDetails",components:{TextInput:B},props:{layer:{type:Object,required:!0},isPlotted:{type:Boolean,default:!1}},emits:["validate-esri-url"],data(){return{v$:C(),refreshTimeout:null,debounceURLValidation:null,urlIsInvalid:!1}},validations(){const e={layer:{Name:{required:L.withMessage(this.$Labels.MA_Field_Req,S),maxLength:L.withMessage(this.$Labels.MA_Max_Length_80_Name,Z(80))},maps__Options__c:{baseURL:{required:L.withMessage(this.$Labels.MA_Field_Req,S)}}}};return this.urlIsInvalid&&(e.layer.maps__Options__c.baseURL={required:L.withMessage(this.$Labels.MA_Field_Req,S),urlIsValid:L.withMessage(this.$Labels.AGISLB_Modal_ArcGIS_Validation_Unsupported,te(this.urlIsInvalid))}),e},watch:{"layer.maps__Options__c.baseURL":{handler(e){this.debounceURLValidation&&clearTimeout(this.debounceURLValidation),this.debounceURLValidation=setTimeout(()=>{this.validateURL(e)},300)}}},methods:{validateLayer(){this.$emit("validate-esri-url")},validateURL(){const e=V.validateESRIURL({esriUrl:this.layer.maps__Options__c.baseURL});this.urlIsInvalid=!e.valid}}};function ae(e,t,l,r,s,i){const o=h("TextInput");return _(),y("div",null,[c(o,{modelValue:s.v$.layer.Name.$model,"onUpdate:modelValue":t[0]||(t[0]=p=>s.v$.layer.Name.$model=p),inputAttrs:{id:"arc-layer-name-input"},labels:{name:e.$Labels.AGISLB_Modal_Field_Name},errors:e.$getErrorsByField(s.v$.layer.Name),required:""},null,8,["modelValue","labels","errors"]),c(o,{modelValue:l.layer.maps__Description__c,"onUpdate:modelValue":t[1]||(t[1]=p=>l.layer.maps__Description__c=p),inputAttrs:{id:"arc-description-input"},labels:{name:e.$Labels.AGISLB_Modal_Field_Description},useTextArea:""},null,8,["modelValue","labels"]),c(o,{modelValue:s.v$.layer.maps__Options__c.baseURL.$model,"onUpdate:modelValue":t[2]||(t[2]=p=>s.v$.layer.maps__Options__c.baseURL.$model=p),inputAttrs:{id:"arc-layer-base-url-input"},labels:{name:e.$Labels.AGISLB_Modal_Field_ArcGIS_Layer_URL},errors:e.$getErrorsByField(s.v$.layer.maps__Options__c.baseURL),disabled:l.isPlotted,required:"",useTextArea:"",onBlur:i.validateURL},null,8,["modelValue","labels","errors","disabled","onBlur"])])}const le=T(se,[["render",ae]]),ie={name:"ArcAdvTab",components:{TextInput:B},props:{layer:{type:Object,required:!0}},data(){return{v$:C(),refresh:""}},validations(){const e={layer:{maps__Options__c:{refreshInterval:{}}}};return this.layer.maps__Options__c.automaticRefresh==="ForceRefresh"&&(e.layer={maps__Options__c:{refreshInterval:{minValue:L.withMessage(this.$Labels.AGISLB_Modal_ArcGIS_Validation_Greater_Zero,Y(.1))}}}),e}},oe={id:"arcgisAdvancedTab",class:"slds-navigation-content-area"},re={class:"slds-form slds-form--stacked max-width--320"},ne={class:"slds-form-element"},de={class:"slds-form-element__label"},pe={class:"slds-form-element__control"},ce={class:"slds-radio--button__label"},_e={class:"slds-p-left_xx-small slds-form-element__label slds-radio--faux"},me={class:"slds-form-element__control"},ue={class:"slds-radio--button__label"},he={class:"slds-p-left_xx-small slds-form-element__label slds-radio--faux"},be={class:"slds-form-element__control"},ye={class:"slds-radio--button__label"},fe={class:"slds-p-left_xx-small slds-form-element__label slds-radio--faux"};function Le(e,t,l,r,s,i){const o=h("TextInput");return _(),y("div",oe,[a("div",re,[a("div",ne,[a("label",de,d(e.$Labels.AGISLB_Modal_Header_Automatic_Refresh),1),a("div",pe,[a("label",ce,[R(a("input",{id:"arc-refresh-layer-setting-radio","onUpdate:modelValue":t[0]||(t[0]=p=>l.layer.maps__Options__c.automaticRefresh=p),type:"radio",name:"AutomaticRefresh",value:"UseLayerSetting",checked:""},null,512),[[O,l.layer.maps__Options__c.automaticRefresh]]),a("span",_e,d(e.$Labels.AGISLB_Modal_Radio_Option_Refresh),1)])]),a("div",me,[a("label",ue,[R(a("input",{id:"arc-force-refresh-interval-radio","onUpdate:modelValue":t[1]||(t[1]=p=>l.layer.maps__Options__c.automaticRefresh=p),type:"radio",name:"AutomaticRefresh",value:"ForceRefresh"},null,512),[[O,l.layer.maps__Options__c.automaticRefresh]]),a("span",he,d(e.$Labels.AGISLB_Modal_Radio_Option_Force_Refresh),1),c(o,{modelValue:s.v$.layer.maps__Options__c.refreshInterval.$model,"onUpdate:modelValue":t[2]||(t[2]=p=>s.v$.layer.maps__Options__c.refreshInterval.$model=p),inputAttrs:{id:"arc-refresh-interval-input"},labels:{placeholder:e.$Labels.AGISLB_Modal_Radio_Option_Force_Refresh_Description},errors:e.$getErrorsByField(s.v$.layer.maps__Options__c.refreshInterval),disabled:l.layer.maps__Options__c.automaticRefresh!=="ForceRefresh"},null,8,["modelValue","labels","errors","disabled"])])]),a("div",be,[a("label",ye,[R(a("input",{id:"arc-no-refresh-interval-radio","onUpdate:modelValue":t[3]||(t[3]=p=>l.layer.maps__Options__c.automaticRefresh=p),type:"radio",name:"AutomaticRefresh",value:"NoRefresh"},null,512),[[O,l.layer.maps__Options__c.automaticRefresh]]),a("span",fe,d(e.$Labels.AGISLB_Modal_Radio_Option_No_Refresh),1)])])])])])}const ge=T(ie,[["render",Le]]),{PortalItem:P,Layer:N}=await q(["esri/portal/PortalItem","esri/layers/Layer"]),Me=async({layerList:e,status:t=()=>MAPS.app.config.globalProperties.$Labels.MA_Loading})=>{const l=new Set(e),r=[];l.forEach(o=>{const p=new Promise(async(m,I)=>{t("Validating portal id...");const M=new P({id:o});await M.load(),t("Portal item found...");const{isLayer:v}=M;if(v){t("Loading layer from portal...");const b=await(await N.fromPortalItem(M)).loadAll(),u={};(b?.layers?.items||[]).forEach(F=>{u[F.id]=F.geometryType});const G=await b.toJSON();G.renderIdMap=u,m(G)}else I(new Error("invalid"))});r.push(p)});const s=[];return(await Promise.allSettled(r)).forEach(o=>{const{status:p,value:m}=o;if(p==="fulfilled"){const{renderIdMap:I={},layers:M=[]}=m;M.forEach(v=>{I[v.id]==="point"&&s.push(v)})}}),s},Se=async({layerList:e=[]})=>{const[t]=e;let l=[];if(t){const r=new P({id:t});try{await r.load(),l=(await r.fetchData("json"))?.operationalLayers||[]}catch(s){throw console.error(s),new Error(globalThis.$Labels.AGISLB_No_Web_Map_Found)}}return l},ve=async({esriUrl:e=""})=>{const t=await N.fromArcGISServerUrl(e,{spatialReference:{wkid:4326}}),l=[];if(t.loadAll?await t.loadAll():await t.load(),t.fields&&Array.isArray(t.fields)&&t.geometryType==="point"){const{fields:s}=t,i=[];s.forEach(p=>{i.push({label:p.alias||p.name,fieldName:p.name})});const o={id:t.id,title:t.title,popupInfo:{fieldInfos:i}};l.push(o)}const r=t.allLayers||t.allSublayers||[];return r.length>0&&r.forEach(s=>{if(s.geometryType==="point"){const{fields:i}=s,o=[];i.forEach(m=>{o.push({label:m.alias||m.name,fieldName:m.name})});const p={id:s.id,title:s.title,popupInfo:{fieldInfos:o}};l.push(p)}}),l},Ae=async({esriUrl:e="",status:t=()=>MAPS.app.config.globalProperties.$Labels.MA_Loading})=>{const l=V.validateESRIURL({esriUrl:e});if(!l.valid)throw new Error(MAPS.app.config.globalProperties.$Labels.AGISLB_Error_Use_Web_Map_Url);const{layers:r=[],type:s=""}=l;let i=[];if(s==="layers")i=await Me({layerList:r,status:t});else if(s==="webmap")i=await Se({layerList:r});else if(s==="rest")i=await ve({esriUrl:e});else throw new Error(MAPS.app.config.globalProperties.$Labels.AGISLB_Error_Use_Web_Map_Url);return i},Ie={name:"ArcC2C",components:{TextInput:B,Picklist:j,SLDSButton:U,Checkbox:D,ButtonIcon:W,Spinner:k},props:{layer:{type:Object,required:!0},isLoading:{type:Boolean,default:!1}},emits:["error-message","update:isLoading","show-message"],data(){return{v$:C(),layerIsWebMap:!1,isEdit:!1,loadingMsg:"",salesforceObjects:[],fieldMappings:[],operationalLayers:[],recordTypes:[],fieldSets:[],geoFields:[],arcFields:[],template:{active:!1,fieldMappings:[],templateName:"",salesforceObject:{path:"",label:""},latlng:{lat:"",lng:""},fieldSet:{path:"",label:""},recordType:{path:"",label:""},webMapLayer:{path:"",label:""}},mapping:{isEdit:!1,index:null}}},validations(){const e={template:{templateName:{},webMapLayer:{path:{}},salesforceObject:{path:{}},recordType:{path:{}},fieldSet:{path:{}},latlng:{lat:{},lng:{}}}};return this.layerIsWebMap&&this.isEdit&&(e.template={templateName:{required:L.withMessage(this.$Labels.MA_Field_Req,S)},webMapLayer:{path:{required:L.withMessage(this.$Labels.MA_Field_Req,S)}},salesforceObject:{path:{required:L.withMessage(this.$Labels.MA_Field_Req,S)}},recordType:{path:{required:L.withMessage(this.$Labels.MA_Field_Req,S)}},fieldSet:{path:{required:L.withMessage(this.$Labels.MA_Field_Req,S)}},latlng:{lat:{required:L.withMessage(this.$Labels.MA_Field_Req,S)},lng:{required:L.withMessage(this.$Labels.MA_Field_Req,S)}}}),e},computed:{AGISLB_Modal_Click2Create_Text(){return this.decodeHTML(this.$Labels.AGISLB_Modal_Click2Create_Text)},AGISLB_Modal_Description_Text(){return this.decodeHTML(this.$Labels.AGISLB_Modal_Description_Text)},showFieldMapping(){return this.template.salesforceObject.path!==""&&this.template.webMapLayer.path!==""&&this.template.recordType.path!==""&&this.template.fieldSet.path!==""},mappingButtonText(){return this.mapping.isEdit?this.$Labels.AGISLB_Modal_Btn_Update_Template:this.$Labels.AGISLB_Modal_Btn_Create_Template}},async created(){(this.layer?.maps__ArcGISWebMapC2C__c||[]).length===0&&(this.isEdit=!0),this.$emit("update:isLoading",!0);try{await this.getURLData(e=>{this.loadingMsg=e})}catch(e){this.showMessage({message:e.message,state:"error"})}finally{this.$emit("update:isLoading",!1)}this.layerIsWebMap&&await this.getSalesforceObjects()},methods:{showMessage(e,t){this.$emit("show-message",e,t)},async getURLData(e){if(this.loadingMsg=this.$Labels.AGISLB_Connecting_Message,this.operationalLayers=await Ae({esriUrl:this.layer.maps__Options__c.baseURL,status:e}),this.operationalLayers.length===0)throw new Error(this.$Labels.AGISLB_Error_Web_Map_Url_No_Layers);this.layerIsWebMap=!0,this.showMessage({message:this.$Labels.AGISLB_Connected,state:"success"})},extractHostURL(e){return e.replace(/^((?:https?:\/\/)?[^/?]+).*$/,"$1")},decodeHTML(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value},setWebMapItem(e){if(this.template.webMapLayer.label=e.title,this.arcFields=e?.popupInfo?.fieldInfos||[],this.template.fieldSet.path){const t=this.fieldSets.find(l=>l.getName===this.template.fieldSet.path);this.updateFieldSetMappingTable(t)}},async getSalesforceObjects(){this.$emit("update:isLoading",!0);try{this.loadingMsg=this.$Labels.Layers_ArcGIS_Retrieving_Salesforce_Objects,this.salesforceObjects=await ee({hasFieldSets:!0})}catch(e){console.error(e)}finally{this.loadingMsg=""}this.$emit("update:isLoading",!1)},updateObjectOptions(e){this.template.salesforceObject.label=e.name,this.template.latlng={lat:"",lng:""},this.template.fieldSet={path:"",label:""},this.template.recordType={path:"",label:""},this.v$.$reset(),this.getObjectRecordTypes()},async getObjectRecordTypes(){this.$emit("update:isLoading",!0);const e={action:"getFieldSet",ajaxResource:"ArcGISAPI",objectName:this.template.salesforceObject.path},{success:t,fieldSetInfo:l}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[e]);if(t){const{geoFieldsInfo:r=[],fieldSetInfo:s={},recordTypeInfo:i={}}=l;if(this.recordTypes=Object.keys(i).map(o=>i[o]),this.fieldSets=Object.keys(s).map(o=>s[o]),this.geoFields=r,this.recordTypes.length===1){const[o]=this.recordTypes;this.template.recordType={path:o.getId,label:o.getName}}if(this.fieldSets.length===1){const[o]=this.fieldSets;this.template.fieldSet={path:o.getName,label:o.getLabel},this.updateFieldSetMappingTable(o)}}this.$emit("update:isLoading",!1)},updateFieldSetMappingTable(e){if(this.mapping.isEdit){const t=[];e.fieldSetMemberInfo.forEach(l=>{const r=this.template.fieldMappings.findIndex(i=>i.staticFieldPath===l.fieldPath),s=this.template.fieldMappings[r];t.push({staticFieldLabel:l.fieldLabel,staticFieldPath:l.fieldPath,locked:s.locked,webMapPath:s.webMapPath,editable:!s.locked})}),this.template.fieldMappings=t}else this.template.fieldMappings=[],e.fieldSetMemberInfo.forEach(t=>{this.template.fieldMappings.push({staticFieldLabel:t.fieldLabel,staticFieldPath:t.fieldPath,locked:!1,webMapPath:"",editable:!0})})},resetTemplate(){this.template={active:!1,fieldMappings:[],templateName:"",salesforceObject:{path:"",label:""},latlng:{lat:"",lng:""},fieldSet:{path:"",label:""},recordType:{path:"",label:""},webMapLayer:{path:"",label:""}},this.mapping.isEdit=!1,this.mapping.index=null,this.v$.$reset()},createTemplate(){if(this.v$.$touch(),this.v$.$invalid){this.$emit("error-message",this.$Labels.AGISLB_Modal_ArcGIS_Validation_Fix);return}this.template.fieldMappings.forEach(e=>{e.locked=!e.editable,delete e.editable}),this.isEdit=!1,this.mapping.isEdit?this.layer.maps__ArcGISWebMapC2C__c.splice(this.mapping.index,1,this.template):(this.template.uid=x(),this.layer.maps__ArcGISWebMapC2C__c.push(this.template)),this.resetTemplate()},async editMapping(e){this.mapping.isEdit=!0,this.mapping.index=e;const t=this.layer.maps__ArcGISWebMapC2C__c[e];this.template={...this.template,...t},this.isEdit=!0,await this.getObjectRecordTypes()},removeMapping(e){this.isEdit=!1,this.layer.maps__ArcGISWebMapC2C__c.splice(e,1),this.layer.maps__ArcGISWebMapC2C__c.length===0&&(this.isEdit=!0,this.v$.$reset())},newTemplate(){this.resetTemplate(),this.isEdit=!0},cancelTemplate(){this.resetTemplate(),this.isEdit=!1}}},$e={class:"slds-text-heading_medium"},we={class:"slds-badge"},Te={class:"slds-text-body_regular slds-m-top_small"},Ce={key:0,class:"new-arc-template-setup-container slds-grid slds-grid_vertical","data-test-id":"new-arc-template-setup"},Re={class:"arc-config-input-wrapper slds-col slds-size_1-of-2"},Oe={key:0,id:"fieldMappingsWrapper",class:"slds-col slds-size_1-of-1"},Be={class:"slds-form-element"},Ge={class:"slds-form-element__label",for:""},Fe=a("abbr",{class:"slds-required",title:"required"},"*",-1),Ee={key:1,class:"arc-field-mapping-input slds-col slds-size_1-of-1 slds-p-top_x-small"},Ve={class:"slds-table slds-table_cell-buffer slds-table_bordered","aria-label":"Example default base table of Opportunities"},Ue={class:"slds-line-height_reset"},ke={class:"",scope:"col"},Pe=["title"],Ne={class:"",scope:"col"},qe=["title"],je={class:"",scope:"col"},De=["title"],We={id:"webMapTemplateTable"},xe={key:1,class:"slds-table slds-table_bordered slds-table_resizable-cols slds-table_cell-buffer","data-test-id":"arc-saved-template-table","aria-describedby":"Click 2 Create templates"},Ke={class:"slds-text-title_caps"},He={scope:"col"},Je={class:"slds-truncate",title:"Active/Inactive"},ze={scope:"col"},Xe={class:"slds-truncate",title:"Template Name"},Qe={scope:"col"},Ze={class:"slds-truncate",title:"Web Map Layers"},Ye={scope:"col"},et={class:"slds-truncate",title:"Salesforce Object"},tt={scope:"col"},st={class:"slds-truncate",title:"Record Type"},at={scope:"col"},lt={class:"slds-truncate",title:"Field Set"},it={scope:"col",style:{width:"3.25rem"}},ot={class:"slds-th__action"},rt={class:"slds-assistive-text"},nt={scope:"col",style:{width:"3.25rem"}},dt={class:"slds-th__action"},pt={class:"slds-assistive-text"},ct={class:"WebMapC2CTemplateRows"};function _t(e,t,l,r,s,i){const o=h("Spinner"),p=h("TextInput"),m=h("Picklist"),I=h("Checkbox"),M=h("SLDSButton"),v=h("ButtonIcon");return _(),y("div",null,[l.isLoading?(_(),$(o,{key:0},{description:f(()=>[A(d(s.loadingMsg),1)]),_:1})):g("",!0),a("div",$e,[A(d(i.AGISLB_Modal_Click2Create_Text)+" ",1),a("span",we,d(e.$Labels.AGISLB_Modal_HelperText_Optional),1)]),a("div",Te,d(i.AGISLB_Modal_Description_Text),1),s.layerIsWebMap?(_(),y(w,{key:1},[s.operationalLayers.length>0&&s.isEdit?(_(),y("div",Ce,[a("div",Re,[c(p,{modelValue:s.v$.template.templateName.$model,"onUpdate:modelValue":t[0]||(t[0]=n=>s.v$.template.templateName.$model=n),inputAttrs:{id:"arc-template-name-input"},labels:{name:e.$Labels.AGISLB_Modal_Field_Name},errors:e.$getErrorsByField(s.v$.template.templateName),required:""},null,8,["modelValue","labels","errors"]),c(m,{modelValue:s.v$.template.webMapLayer.path.$model,"onUpdate:modelValue":t[1]||(t[1]=n=>s.v$.template.webMapLayer.path.$model=n),inputAttrs:{id:"arc-template-web-map-layer-input"},required:"",errors:e.$getErrorsByField(s.v$.template.webMapLayer.path),options:s.operationalLayers,titleKey:"title",idKey:"id",filterable:"",class:"slds-p-top_x-small",labels:{name:e.$Labels.AGISLB_Modal_Col_Label_Web_Map_Layers},onSelectedOption:i.setWebMapItem},null,8,["modelValue","errors","options","labels","onSelectedOption"]),c(m,{modelValue:s.v$.template.salesforceObject.path.$model,"onUpdate:modelValue":t[2]||(t[2]=n=>s.v$.template.salesforceObject.path.$model=n),inputAttrs:{id:"arc-template-sf-object-input"},required:"",errors:e.$getErrorsByField(s.v$.template.salesforceObject.path),options:s.salesforceObjects,titleKey:"name",idKey:"label",filterable:"",class:"slds-p-top_x-small slds-p-bottom_x-small",labels:{name:e.$Labels.AGISLB_Modal_Col_Label_Salesforce_Object},onSelectedOption:i.updateObjectOptions},null,8,["modelValue","errors","options","labels","onSelectedOption"]),s.template.salesforceObject.path?(_(),y(w,{key:0},[c(m,{modelValue:s.v$.template.recordType.path.$model,"onUpdate:modelValue":t[3]||(t[3]=n=>s.v$.template.recordType.path.$model=n),inputAttrs:{id:"arc-template-record-type-input"},required:"",errors:e.$getErrorsByField(s.v$.template.recordType.path),options:s.recordTypes,titleKey:"getName",idKey:"getId",filterable:"",labels:{name:e.$Labels.AGISLB_Modal_Col_Label_Record_Type}},null,8,["modelValue","errors","options","labels"]),c(m,{modelValue:s.v$.template.fieldSet.path.$model,"onUpdate:modelValue":t[4]||(t[4]=n=>s.v$.template.fieldSet.path.$model=n),inputAttrs:{id:"arc-template-field-set-input"},required:"",errors:e.$getErrorsByField(s.v$.template.fieldSet.path),options:s.fieldSets,titleKey:"getLabel",idKey:"getName",filterable:"",class:"slds-p-top_x-small",labels:{name:e.$Labels.AGISLB_Modal_Col_Label_Field_Set},onSelectedOption:i.updateFieldSetMappingTable},null,8,["modelValue","errors","options","labels","onSelectedOption"]),c(m,{modelValue:s.v$.template.latlng.lat.$model,"onUpdate:modelValue":t[5]||(t[5]=n=>s.v$.template.latlng.lat.$model=n),inputAttrs:{id:"arc-template-latlng-lat-input"},required:"",errors:e.$getErrorsByField(s.v$.template.latlng.lat),options:s.geoFields,titleKey:"label",idKey:"value",filterable:"",class:"slds-p-top_x-small",labels:{name:e.$Labels.MA_Latitude}},null,8,["modelValue","errors","options","labels"]),c(m,{modelValue:s.v$.template.latlng.lng.$model,"onUpdate:modelValue":t[6]||(t[6]=n=>s.v$.template.latlng.lng.$model=n),inputAttrs:{id:"arc-template-latlng-lng-input"},required:"",errors:e.$getErrorsByField(s.v$.template.latlng.lng),options:s.geoFields,titleKey:"label",idKey:"value",filterable:"",class:"slds-p-top_x-small",labels:{name:e.$Labels.MA_Longitude}},null,8,["modelValue","errors","options","labels"])],64)):g("",!0)]),i.showFieldMapping?(_(),y("div",Oe,[a("div",Be,[a("label",Ge,[Fe,A(" "+d(e.$Labels.MapsSetting_Field_Mappings),1)])])])):g("",!0),i.showFieldMapping?(_(),y("div",Ee,[a("table",Ve,[a("thead",null,[a("tr",Ue,[a("th",ke,[a("div",{class:"slds-truncate",title:e.$Labels.AGISLB_Modal_Col_Salesforce_Fields},d(e.$Labels.AGISLB_Modal_Col_Salesforce_Fields),9,Pe)]),a("th",Ne,[a("div",{class:"slds-truncate",title:e.$Labels.AGISLB_Modal_Col_Editable},d(e.$Labels.AGISLB_Modal_Col_Editable),9,qe)]),a("th",je,[a("div",{class:"slds-truncate",title:e.$Labels.AGISLB_Modal_Col_ArcGIS_Fields},d(e.$Labels.AGISLB_Modal_Col_ArcGIS_Fields),9,De)])])]),a("tbody",null,[(_(!0),y(w,null,E(s.template.fieldMappings,(n,b)=>(_(),y("tr",{key:`row_${b}`},[a("td",null,d(n.staticFieldLabel),1),a("td",null,[c(I,{modelValue:n.editable,"onUpdate:modelValue":u=>n.editable=u,inputAttrs:{id:`arcgis-field-editable-${b}`},slide:"",hideLabel:""},null,8,["modelValue","onUpdate:modelValue","inputAttrs"])]),a("td",null,[c(m,{modelValue:n.webMapPath,"onUpdate:modelValue":u=>n.webMapPath=u,inputAttrs:{id:`arcgis-web-map-path-${b}`},options:s.arcFields,titleKey:"label",idKey:"fieldName",class:"slds-p-top_x-small"},null,8,["modelValue","onUpdate:modelValue","inputAttrs","options"])])]))),128))])])])):g("",!0)])):g("",!0),i.showFieldMapping?(_(),$(M,{key:1,id:"createArcTemplate",class:"slds-button slds-button_success slds-m-top_medium slds-m-bottom_medium",onClick:i.createTemplate},{default:f(()=>[A(d(i.mappingButtonText),1)]),_:1},8,["onClick"])):g("",!0),s.isEdit&&!s.mapping.isEdit?(_(),$(M,{key:2,id:"isEditArcTemplate",onClick:i.cancelTemplate},{default:f(()=>[A(" Cancel ")]),_:1},8,["onClick"])):g("",!0),a("div",We,[s.isEdit?g("",!0):(_(),$(M,{key:0,id:"newWebMapTemplate",variant:"brand",class:"slds-button slds-m-top_medium slds-m-bottom_medium",onClick:i.newTemplate},{default:f(()=>[A(d(e.$Labels.AGISLB_Modal_Btn_Create_Template),1)]),_:1},8,["onClick"])),l.layer.maps__ArcGISWebMapC2C__c.length>0&&!s.isEdit?(_(),y("table",xe,[a("thead",null,[a("tr",Ke,[a("th",He,[a("div",Je,d(e.$Labels.AGISLB_Modal_Col_Label_Active),1)]),a("th",ze,[a("div",Xe,d(e.$Labels.AGISLB_Modal_Col_Label_Template_Name),1)]),a("th",Qe,[a("div",Ze,d(e.$Labels.AGISLB_Modal_Col_Label_Web_Map_Layers),1)]),a("th",Ye,[a("div",et,d(e.$Labels.AGISLB_Modal_Col_Label_Salesforce_Object),1)]),a("th",tt,[a("div",st,d(e.$Labels.AGISLB_Modal_Col_Label_Record_Type),1)]),a("th",at,[a("div",lt,d(e.$Labels.AGISLB_Modal_Col_Label_Field_Set),1)]),a("th",it,[a("div",ot,[a("span",rt,d(e.$Labels.MA_Edit),1)])]),a("th",nt,[a("div",dt,[a("span",pt,d(e.$Labels.MA_Delete),1)])])])]),a("tbody",ct,[(_(!0),y(w,null,E(l.layer.maps__ArcGISWebMapC2C__c,(n,b)=>(_(),y("tr",{key:`fieldMapping_${b}`},[a("td",null,[c(I,{modelValue:n.active,"onUpdate:modelValue":u=>n.active=u,inputAttrs:{id:`arcgis-web-map-c2c-${b}`},slide:"",hideLabel:""},null,8,["modelValue","onUpdate:modelValue","inputAttrs"])]),a("td",null,d(n.templateName),1),a("td",null,d(n.webMapLayer.label),1),a("td",null,d(n.salesforceObject.label),1),a("td",null,d(n.recordType.label),1),a("td",null,d(n.fieldSet.label),1),a("td",null,[c(v,{id:"arcgis-web-map-c2c-edit-button",iconCategory:"utility",iconName:"edit",size:"small",title:"Edit Field Mapping",assistiveText:"Edit Field Mapping",onClick:u=>i.editMapping(b)},null,8,["onClick"])]),a("td",null,[c(v,{id:"arcgis-web-map-c2c-delete-button",iconCategory:"utility",iconName:"close",size:"small",title:"Close",assistiveText:"Close",onClick:u=>i.removeMapping(b)},null,8,["onClick"])])]))),128))])])):g("",!0)])],64)):g("",!0)])}const mt=T(Ie,[["render",_t]]),ut={name:"SaveArcGISLayer",components:{Modal:Q,Spinner:k,Tabs:K,Tab:H,SLDSButton:U,ArcDetails:le,ArcC2C:mt,ArcAdvanced:ge},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],setup(){const e=J(),t=z(),l=C();return{mainStore:e,layersStore:t,v$:l}},data(){return{activeTabId:"arcgisDetailsTab",isLoading:!1,layer:{Name:"",maps__Description__c:"",maps__Options__c:{},maps__ArcGISWebMapC2C__c:[],maps__Folder__c:"",maps__User__c:""}}},computed:{c2cDisabled(){return!this.layer?.Name||!this.layer?.maps__Options__c?.baseURL},isNewLayer(){return!this.modalOptions.layerId}},async created(){if(this.modalOptions.layerId){this.isLoading=!0;try{await this.getLayer()}catch(e){console.error(e)}this.isLoading=!1}},methods:{async getLayer(){const e={action:"editArcGISWebMapLayer",ajaxResource:"QueryBuilderAPI",recId:this.modalOptions.layerId},{success:t,data:l}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[e]);if(t){const[r]=l,s=r.maps__Options__c||"{}",i=r.maps__ArcGISWebMapC2C__c||"[]";try{const o=JSON.parse(s);o.refreshInterval==="--None--"&&(o.refreshInterval=""),r.maps__Options__c=o}catch(o){console.error(o),r.maps__Options__c=[],this.showError("The selected layer is invalid, some options may be missing.")}try{r.maps__ArcGISWebMapC2C__c=JSON.parse(i)}catch(o){console.error(o),r.maps__ArcGISWebMapC2C__c=[],this.showError("The selected layer has invalid Click2Create templates, some data may be missing.")}this.modalOptions.action==="clone-data-layer"&&(r.Name=`Copy of ${r.Name}`,delete r.Id),this.layer={...this.layer,...r}}},showMessage({message:e,state:t}){this.mainStore.toast({message:e,state:t})},showError(e){this.mainStore.toast({message:e,state:"error"})},isCurrentPanelValid(){let e=!0;return this.v$.$touch(),this.v$.$invalid&&(e=!1),e},async saveRefresh(){await this.save(!0)},async save(e){if(this.v$.$touch(),this.v$.$error){this.showError(this.$Labels.AGISLB_Modal_ArcGIS_Validation_Fix);return}this.isLoading=!0;let t=this.isNewLayer?this.layersStore.currentFolder.id:this.layer.maps__Folder__c,l="";t||(t=this.layer.maps__User__c?"PersonalRoot":"CorporateRoot"),t==="Home"||t==="PersonalRoot"?(t="PersonalRoot",l="PersonalRoot"):t==="CorporateRoot"&&(t="CorporateRoot",l="CorporateRoot");const r={action:"saveArcGISWebMapLayer",folder:t,folderType:l,layerName:this.layer.Name,layerDescription:this.layer.maps__Description__c||"",layerWebMapURL:this.layer.maps__Options__c.baseURL,automaticRefresh:this.layer.maps__Options__c.automaticRefresh||"",refreshInterval:this.layer.maps__Options__c.refreshInterval||"",click2createTemplates:JSON.stringify(this.layer.maps__ArcGISWebMapC2C__c),ajaxResource:"QueryBuilderAPI"};this.layer.Id&&(r.recId=this.layer.Id);try{const{success:s,message:i}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[r]);s?(this.modalOptions.callback({plotOnSave:e===!0}),X.trackFeature({logPayload:{featureName:"arcgis_layer_created"}}),this.$emit("close-modal")):this.showError(i)}catch(s){console.error(s)}finally{this.isLoading=!1}}}},ht={id:"sketch-tabs",style:{height:"100%"}};function bt(e,t,l,r,s,i){const o=h("Spinner"),p=h("ArcDetails"),m=h("Tab"),I=h("ArcC2C"),M=h("ArcAdvanced"),v=h("Tabs"),n=h("SLDSButton"),b=h("Modal");return _(),$(b,{id:"CustomShapePopup",title:e.$Labels.Layers_Saved_New_OverFLow_Layer_Type_Button_ArcGIS_Layer,labels:{close:e.$Labels.MA_Close},isLoading:s.isLoading,onClose:t[3]||(t[3]=u=>e.$emit("close-modal"))},{content:f(()=>[s.isLoading?(_(),$(o,{key:0})):g("",!0),a("div",ht,[c(v,{activeTabId:s.activeTabId,"onUpdate:activeTabId":t[1]||(t[1]=u=>s.activeTabId=u),vertical:"",class:"content",onRequestTabChange:i.isCurrentPanelValid},{default:f(()=>[c(m,{id:"arcgisDetailsTab",title:e.$Labels.AGISLB_Modal_Tab_Details},{default:f(()=>[c(p,{layer:s.layer,isPlotted:l.modalOptions.isPlotted},null,8,["layer","isPlotted"])]),_:1},8,["title"]),c(m,{id:"arcgisC2CSetupTab",title:e.$Labels.AGISLB_Modal_Click2Create_Text},{default:f(()=>[c(I,{isLoading:s.isLoading,"onUpdate:isLoading":t[0]||(t[0]=u=>s.isLoading=u),layer:s.layer,onErrorMessage:i.showError,onShowMessage:i.showMessage},null,8,["isLoading","layer","onErrorMessage","onShowMessage"])]),_:1},8,["title"]),c(m,{id:"arcgisAdvancedTab",title:e.$Labels.AGISLB_Modal_Tab_Advanced},{default:f(()=>[c(M,{layer:s.layer},null,8,["layer"])]),_:1},8,["title"])]),_:1},8,["activeTabId","onRequestTabChange"])])]),footer:f(()=>[l.modalOptions.isPlotted?(_(),$(n,{key:0,id:"arcIsPlottedBtn",variant:"brand",class:"slds-text-body_small",disabled:s.isLoading,onClick:i.saveRefresh},{default:f(()=>[A(d(e.$Labels.ShapeLayer_Save_Refresh_Button),1)]),_:1},8,["disabled","onClick"])):g("",!0),c(n,{id:"arcSaveBtn",variant:"brand",class:"slds-text-body_small",disabled:s.isLoading,onClick:i.save},{default:f(()=>[A(d(e.$Labels.AGISLB_Modal_Btn_Save),1)]),_:1},8,["disabled","onClick"]),c(n,{id:"arcCancelBtn",variant:"neutral",class:"slds-text-body_small",disabled:s.isLoading,onClick:t[2]||(t[2]=u=>e.$emit("close-modal"))},{default:f(()=>[A(d(e.$Labels.AGISLB_Modal_Btn_Cancel),1)]),_:1},8,["disabled"])]),_:1},8,["title","labels","isLoading"])}const St=T(ut,[["render",bt]]);export{St as default};
