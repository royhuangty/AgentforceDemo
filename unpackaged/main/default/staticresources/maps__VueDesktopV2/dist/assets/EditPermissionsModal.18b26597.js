import{_ as R,P as k,B as N,a5 as U,l as I,f as D,r as l,o as r,c as p,F as b,q as A,n as q,b as f,e as S,j as g,t as _,w as h,S as B,J as F,K as O,O as z,Q as C,ac as J,h as m,i as c,a0 as X}from"../bundle.js";import{M as j}from"./Modal.76578f76.js";const E={components:{Picklist:k,ButtonIcon:N,Checkbox:U,SLDSButton:I},props:{permission:{type:Object,required:!0}},emits:["cancel-new-permission","save-permission","delete-permission","update-permission"],setup(){return{mainStore:D()}},data(){return{permSearch:{label:"",value:null},searches:[{options:e=>this.searchUserProfile(e)}]}},computed:{tableColumns(){const e=[{label:this.$Labels.MA_Permission_Type,id:"type",type:"string"},{label:this.$Labels.MA_Permission_For,id:"name",type:this.$props.permission.isNew?"search":"string"},{label:this.$Labels.MA_Read,id:"maps__Read__c",type:"boolean"},{label:this.$Labels.MA_Create,id:"maps__Create__c",type:"boolean"},{label:this.$Labels.MA_Modify,id:"maps__Modify__c",type:"boolean"},{label:this.$Labels.MA_Delete,id:"maps__Delete__c",type:"boolean"},{label:this.$Labels.MA_Set_Perm,id:"maps__SetPermissions__c",type:"boolean"}];return this.$props.permission.isNew?e.push({label:this.$Labels.MA_Save,id:"save",type:"button"}):e.push({label:this.$Labels.MA_Delete,id:"delete",type:"button"}),e}},methods:{updatePermission(e=""){if(this.$props.permission.isNew)return;const s=this.$props.permission[e],i={id:this.$props.permission.id,value:s,field:e};this.$emit("update-permission",i)},handleButton(e){e==="save"?this.saveRow():e==="delete"&&this.deleteRow()},deleteRow(){this.$emit("delete-permission",this.$props.permission.id)},saveRow(){if(!this.$data.permSearch.value)this.mainStore.toast({message:this.$Labels.folderPermissions_Warning,subMessage:this.$Labels.folderPermissions_User_Profile_Required,position:"bottom-right",state:"warning"});else{const e={maps__Read__c:this.$props.permission.maps__Read__c,maps__Create__c:this.$props.permission.maps__Create__c,maps__Modify__c:this.$props.permission.maps__Modify__c,maps__Delete__c:this.$props.permission.maps__Delete__c,maps__SetPermissions__c:this.$props.permission.maps__SetPermissions__c};this.$props.permission.type==="profile"?e.maps__ProfileId__c=this.$data.permSearch.value:e.maps__User__c=this.$data.permSearch.value,this.$emit("save-permission",e)}},clearResults(){this.$data.permSearch={label:"",value:null}},async searchUserProfile(e){return new Promise(async s=>{const i={ajaxResource:"TooltipAJAXResources",action:"get_lookup_optionsv2",baseObject:this.$props.permission.type==="user"?"User":"Profile",fieldApiName:"Id",fieldName:"Id",grandparentField:"--none--",term:e,keepSearch:!1},a=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[i]);a.success?s(a.lookupOptions):s([])})},selectItem(e){this.$data.permSearch=e},removeRow(){this.$emit("cancel-new-permission",this.$props.permission.id)}}};function W(e,s,i,a,d,t){const $=l("ButtonIcon"),w=l("Picklist"),L=l("Checkbox"),M=l("SLDSButton");return r(),p("tr",null,[(r(!0),p(b,null,A(t.tableColumns,(o,P)=>(r(),p("td",{key:`table-data_${P}`,style:q(P===0&&e.$props.permission.isNew?"padding-left: .25rem":""),class:"slds-cell-buffer_left slds-cell-wrap"},[P===0&&e.$props.permission.isNew?(r(),f($,{key:0,"data-q3-id":"permission-close-row-button-for",style:{"padding-right":".25rem"},iconCategory:"utility",iconName:"close",variant:"bare",title:"close",assistiveText:"close",onClick:t.removeRow},null,8,["onClick"])):S("",!0),o.type==="string"?(r(),p(b,{key:1},[o.id==="type"&&e.$props.permission[o.id]==="user"?(r(),p(b,{key:0},[g(_(e.$Labels.MA_User),1)],64)):o.id==="type"&&e.$props.permission[o.id]==="profile"?(r(),p(b,{key:1},[g(_(e.$Labels.MA_Profile),1)],64)):(r(),p(b,{key:2},[g(_(e.$props.permission[o.id]),1)],64))],64)):o.type==="search"?(r(),f(w,{key:2,modelValue:e.$data.permSearch.label,"onUpdate:modelValue":s[0]||(s[0]=u=>e.$data.permSearch.label=u),inputAttrs:{"data-q3-id":"permission-search-for"},filterable:"",options:e.$data.searches,titleKey:"label",idKey:"value",onClear:t.clearResults,onSelectedOption:t.selectItem},null,8,["modelValue","options","onClear","onSelectedOption"])):o.type==="boolean"?(r(),f(L,{key:3,modelValue:e.$props.permission[o.id],"onUpdate:modelValue":u=>e.$props.permission[o.id]=u,inputAttrs:{"data-q3-id":`permission-check-for-${o.label}`},labels:{name:"check"},hideLabel:"",onChange:u=>t.updatePermission(o.id)},null,8,["modelValue","onUpdate:modelValue","inputAttrs","onChange"])):o.type==="button"?(r(),f(M,{key:4,"data-q3-id":`permission-button-for-${o.id}`,variant:"base",onClick:u=>t.handleButton(o.id)},{default:h(()=>[g(_(o.label),1)]),_:2},1032,["data-q3-id","onClick"])):S("",!0)],4))),128))])}const K=R(E,[["render",W]]),x={name:"EditPermissionsModal",components:{Modal:j,SLDSButton:I,Spinner:B,ActionMenu:F,ActionMenuItem:O,Picklist:k,TextInput:z,ButtonIcon:N,PermissionRow:K},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],setup(){return{mainStore:D()}},data(){return{isLoading:!1,folderName:"",folderPermissions:[],page:1,nodeId:"",totalPermissions:0,permissionsPerPage:10,searchTimeout:null,filterCriteria:"both",permissionSearch:"",normalizedData:[],filterCriteriaOptions:[{label:this.$Labels.MA_Both,value:"both"},{label:this.$Labels.MA_User,value:"user"},{label:this.$Labels.MA_Profile,value:"profile"}],tableColumns:[{label:this.$Labels.MA_Permission_Type,type:"string"},{label:this.$Labels.MA_Permission_For,type:"string"},{label:this.$Labels.MA_Read,type:"boolean"},{label:this.$Labels.MA_Create,type:"boolean"},{label:this.$Labels.MA_Modify,type:"boolean"},{label:this.$Labels.MA_Delete,type:"boolean"},{label:this.$Labels.MA_Set_Perm,type:"boolean"},{label:"",type:"button"}]}},computed:{currentPagePermissions(){let e=[];return this.$data.folderPermissions[this.$data.page-1]&&(e=this.$data.folderPermissions[this.$data.page-1]),e},totalPages(){return this.$data.folderPermissions.length},startingRecord(){let e=0;return this.$data.totalPermissions!==0&&(e=(this.$data.page-1)*this.$data.permissionsPerPage+1),e},endingRecord(){let e=0;if(Array.isArray(this.currentPagePermissions)&&this.currentPagePermissions.length>0){const s=this.currentPagePermissions.length;e=this.startingRecord+s-1}return e},computedModalTitle(){return C(this.$Labels.folderPermissions_Header_Title,[this.$data.folderName])},computedDisplayingNumOfUsers(){return C(this.$Labels.folderPermissions_Displaying_Users,[this.startingRecord,this.endingRecord,this.$data.totalPermissions])}},created(){this.$data.folderName=this.modalOptions.folderName,this.$data.nodeId=this.modalOptions.nodeId,this.getPermissions()},methods:{close(){this.$emit("close-modal")},reloadPermissionData(){this.resetPermTable(),this.getPermissions()},resetPermTable(){this.$data.page=1,this.$data.filterCriteria="both",this.$data.permissionSearch=""},async getPermissions(){this.$data.isLoading=!0,this.$data.normalizedData=[];const e={ajaxResource:"TreeAJAXResources",action:"get_folder_permissions",id:this.modalOptions.nodeId||""},s=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[e]),{success:i=!1,FolderPermissions:a=[],profileList:d=[]}=s;this.$data.isLoading=!1;const t=a.length;i&&t?(this.normalizePermissionData(a,d),this.buildPermissionPages(this.$data.normalizedData)):i&&!t?(this.$data.folderPermissions=[[]],this.buildPermissionPages([])):(console.warn(s),this.mainStore.toast({message:this.$Labels.folderPermissions_Warning,subMessage:this.$Labels.folderPermissions_Unable_To_Load,position:"bottom-right",state:"warning"}),this.close())},normalizePermissionData(e=[],s=[]){const i=[];e.forEach(a=>{const d={maps__Read__c:a.maps__Read__c||!1,maps__Create__c:a.maps__Create__c||!1,maps__Modify__c:a.maps__Modify__c||!1,maps__Delete__c:a.maps__Delete__c||!1,maps__SetPermissions__c:a.maps__SetPermissions__c||!1,id:a.Id};if(a.maps__ProfileId__c){d.type="profile";for(let t=0;t<s.length;t++){const $=s[t];if($.Id===a.maps__ProfileId__c){d.name=$.Name||this.$Labels.MA_NA;break}}}else{d.type="user";const t=a.maps__User__r||{};d.name=t.Name||this.$Labels.MA_NA}i.push(d)}),this.$data.normalizedData=i},buildPermissionPages(e=[]){const s=[];let i=[];this.$data.totalPermissions=e.length,e.forEach(a=>{i.push(a),i.length===this.$data.permissionsPerPage&&(s.push(i),i=[])}),i.length>0&&(s.push(i),i=[]),s.length===0&&s.push([]),this.$data.folderPermissions=s,this.$data.isLoading=!1},nextPage(){if(this.checkIfNewVisible())return;const s=this.$data.folderPermissions.length;this.$data.page<s&&(this.$data.page+=1)},previousPage(){if(this.checkIfNewVisible())return;this.$data.page>1&&(this.$data.page-=1)},checkIfNewVisible(){let e=!1;return(this.currentPagePermissions!==void 0?this.currentPagePermissions.find(i=>i.isNew):!1)&&(e=!0,this.mainStore.toast({message:this.$Labels.folderPermissions_Warning,subMessage:this.$Labels.folderPermissions_Finish_Creation,position:"bottom-right",state:"warning"})),e},setPage(e){this.checkIfNewVisible()||(this.$data.page=e)},debounceSearch(){this.$data.searchTimeout!==null&&clearTimeout(this.$data.searchTimeout),this.$data.searchTimeout=setTimeout(()=>{this.$data.searchTimeout=null,this.filterPermissions()},500)},filterPermissions(){this.$data.isLoading=!0;const e=this.$data.normalizedData,s=[],i=this.$data.permissionSearch.toLowerCase();e.forEach(a=>{if(this.$data.filterCriteria==="user"&&a.type!=="user"||this.$data.filterCriteria==="profile"&&a.type!=="profile")return;a.name.toLowerCase().indexOf(i)>-1&&s.push(a)}),this.buildPermissionPages(s)},async updatePermission(e,s){this.$data.isLoading=!0;const i={ajaxResource:"TreeAJAXResources",action:"update_permission_field",Id:e.id,Field:e.field,Value:e.value},{success:a=!1}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[i]);a||(this.currentPagePermissions[s][e.field]=!this.currentPagePermissions[s][e.field],this.mainStore.toast({message:this.$Labels.folderPermissions_Warning,subMessage:this.$Labels.folderPermissions_Unable_To_Update,position:"bottom-right",state:"warning"})),this.$data.isLoading=!1},createRow(e){this.checkIfNewVisible()||this.currentPagePermissions.push({maps__Read__c:!1,maps__Create__c:!1,maps__Modify__c:!1,maps__Delete__c:!1,maps__SetPermissions__c:!1,id:J(),type:e,isNew:!0})},cancelNewPermission(e){const s=this.currentPagePermissions.findIndex(i=>i.id===e);this.currentPagePermissions.splice(s,1)},async savePermission(e){this.$data.isLoading=!0,e.maps__Folder__c=this.$data.nodeId;const s={ajaxResource:"TreeAJAXResources",action:"save_new_permission",NewPermission:JSON.stringify(e)},i=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[s]);this.$data.isLoading=!1,i.success?this.reloadPermissionData():this.mainStore.toast({message:this.$Labels.folderPermissions_Warning,subMessage:this.$Labels.folderPermissions_Unable_To_Save,position:"bottom-right",state:"warning"})},async deletePermission(e){this.$data.isLoading=!0;const s={ajaxResource:"TreeAJAXResources",action:"delete_folder_permission",id:e},i=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[s]);this.$data.isLoading=!1,i.success?this.reloadPermissionData():this.mainStore.toast({message:this.$Labels.folderPermissions_Warning,subMessage:this.$Labels.folderPermissions_Unable_To_Delete,position:"bottom-right",state:"warning"})}}},G={class:"slds-grid slds-wrap"},H={class:"slds-scrollable slds-m-top_large"},Q={class:"slds-table slds-table_bordered slds-table_striped"},Y={class:"slds-line-height_reset"},Z={class:"slds-grid slds-p-vertical_small slds-grid_vertical-align-center"},ee={id:"permissions-buttons",style:{overflow:"auto","max-width":"70%"},class:"slds-button-group",role:"group"},se={class:"slds-p-left_small"},te={id:"permissions-pageinfo"},ie={class:"slds-grid"};function ae(e,s,i,a,d,t){const $=l("Spinner"),w=l("Picklist"),L=l("TextInput"),M=l("PermissionRow"),o=l("ButtonIcon"),P=l("SLDSButton"),u=l("ActionMenuItem"),V=l("ActionMenu"),T=l("Modal");return r(),f(T,{id:"EditPermissionFolderModal",title:t.computedModalTitle,labels:{close:e.$Labels.MA_Close},onClose:t.close},{content:h(()=>[e.$data.isLoading?(r(),f($,{key:0})):S("",!0),m("div",G,[c(w,{modelValue:e.$data.filterCriteria,"onUpdate:modelValue":[s[0]||(s[0]=n=>e.$data.filterCriteria=n),t.debounceSearch],inputAttrs:{"data-q3-id":"permission-resource-selection"},class:"slds-size_3-of-12",options:e.$data.filterCriteriaOptions,labels:{name:e.$Labels.MA_Search_for},idKey:"value",titleKey:"label"},null,8,["modelValue","options","labels","onUpdate:modelValue"]),c(L,{modelValue:e.$data.permissionSearch,"onUpdate:modelValue":[s[1]||(s[1]=n=>e.$data.permissionSearch=n),t.debounceSearch],inputAttrs:{"data-q3-id":"permission-filter-search"},class:"slds-size_6-of-12 slds-m-left_large",labels:{name:e.$Labels.MA_FILTER,placeholder:e.$Labels.MA_Filter_Placeholder}},null,8,["modelValue","labels","onUpdate:modelValue"])]),m("div",H,[m("table",Q,[m("thead",null,[m("tr",Y,[(r(!0),p(b,null,A(e.$data.tableColumns,(n,y)=>(r(),p("th",{key:`header_${y}`,class:"slds-cell-buffer_left slds-cell-wrap"},_(n.label),1))),128))])]),m("tbody",null,[(r(!0),p(b,null,A(t.currentPagePermissions,(n,y)=>(r(),f(M,{key:`permission-row_${y}`,permission:n,nodeId:d.nodeId,onUpdatePermission:v=>t.updatePermission(v,y),onSavePermission:t.savePermission,onDeletePermission:t.deletePermission,onCancelNewPermission:t.cancelNewPermission},null,8,["permission","nodeId","onUpdatePermission","onSavePermission","onDeletePermission","onCancelNewPermission"]))),128))])])]),m("div",Z,[m("div",ee,[c(o,{"data-q3-id":"permission-left-arrow-button",iconCategory:"utility",iconName:"left",variant:"border-filled",title:"Left",assistiveText:"Left",onClick:t.previousPage},null,8,["onClick"]),(r(!0),p(b,null,A(t.totalPages,(n,y)=>(r(),f(P,{key:`page-number_${y}`,variant:"neutral",class:X(["slds-text-body_small",{"slds-is-selected":n===d.page}]),onClick:v=>t.setPage(n)},{default:h(()=>[g(_(n),1)]),_:2},1032,["class","onClick"]))),128)),c(o,{iconCategory:"utility",iconName:"right",variant:"border-filled",title:"Right",assistiveText:"Right",onClick:t.nextPage},null,8,["onClick"])]),m("div",se,[m("div",te,_(t.computedDisplayingNumOfUsers),1)])])]),footer:h(()=>[m("div",ie,[c(V,{"data-q3-id":"permission-action-dropdown",class:"slds-col_bump-right"},{button:h(()=>[c(P,{"data-q3-id":"permission-create-new-button",iconPosition:"right",variant:"success",class:"slds-text-body_small",iconCategory:"utility",iconName:"down",disabled:e.$data.isLoading},{default:h(()=>[g(_(e.$Labels.MA_Create_New),1)]),_:1},8,["disabled"])]),default:h(()=>[c(u,{"data-q3-id":"permission-create-user-menu",label:e.$Labels.MA_User,onClick:s[2]||(s[2]=n=>t.createRow("user"))},null,8,["label"]),c(u,{"data-q3-id":"permission-create-profile-menu",label:e.$Labels.MA_Profile,onClick:s[3]||(s[3]=n=>t.createRow("profile"))},null,8,["label"])]),_:1}),c(P,{"data-q3-id":"permission-close-modal-button",variant:"brand",class:"slds-text-body_small",onClick:t.close},{default:h(()=>[g(_(e.$Labels.MA_Close),1)]),_:1},8,["onClick"])])]),_:1},8,["title","labels","onClose"])}const ne=R(x,[["render",ae]]);export{ne as default};
