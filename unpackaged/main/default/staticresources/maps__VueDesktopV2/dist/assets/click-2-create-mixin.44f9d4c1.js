import{b1 as w,_ as F,aj as q,l as L,r as T,o as h,b as g,w as x,h as y,a0 as v,e as S,c as _,F as A,s as D,aE as k,i as C,bx as E,a3 as M,by as P}from"../bundle.js";import{D as O}from"./DatePicker.899772b4.js";import{T as N}from"./TimePicker.bfa4e2f9.js";const X=(t,l=!1)=>{const[a]=document.querySelectorAll(`#${t}`),e=document.querySelectorAll(`#${t} div[class^="field::"]`),i={},o=[];if(!a)return console.warn("table not found"),{fields:i,FieldsFoundArray:o};const f=a.querySelectorAll(".ClickToCreateFormTable").length>0;return e.forEach(n=>{const r=String(n.getAttribute("data-type")||"").toLocaleLowerCase(),p=n.getAttribute("data-field");o.push(p);let s="",c=n.querySelector(".get-input");if(!c&&r==="picklist"&&(c=n.querySelector(".fieldInput select")),c)if(c.nodeName==="IMG"&&r!=="multipicklist")s=void 0;else if(f&&r==="datetime"){const u=n.querySelector(".datepicker").value,d=n.querySelector(".hr").value,m=n.querySelector(".min").value;if(!u||!d||!m)return;const b=new Date(u);s=w({dateObject:b,timeObject:{hours:d,minutes:m}})}else if(r==="time"){const u=n.querySelector(".hr").value,d=n.querySelector(".min").value;if(!u||!d)return;s=Number(u)*3600+Number(d)*60}else if(r==="picklist")s=c.value;else if(r==="reference")n.querySelector("input")&&n.querySelector("input").value!=="000000000000000"?s=n.querySelector("input").value:n.querySelector("span.lookupInput")?s=n.querySelector("input").value==="000000000000000"?void 0:n.querySelector("input").value:s=c.value?c.value:void 0;else if(r==="boolean")s=c.checked;else if(r==="multipicklist"){const u=[],{selectedOptions:d=[]}=c;for(let m=0;m<d.length;m++){const b=d[m];u.push(b.value)}s="";for(let m=0;m<u.length;m++)s+=`${u[m]};`}else if(r==="textarea")try{console.warn("Test text area with click 2 create");const u=c.getAttribute("id"),d=window?.CKEDITOR?.instances||{};d.hasOwnProperty(u)?s=d[u].getData():s=c.value}catch{s=c.value}else s=c.value;s&&(l?i[p]={field:p,value:s,fieldType:r}:i[p]=s)}),{fields:i,FieldsFoundArray:o}},I=t=>new Promise((l,a)=>{const e=document.createElement("script");e.src=t,e.async=!1,e.addEventListener("load",()=>{l()}),e.addEventListener("error",a),document.body.append(e)}),V=t=>{const l=[];return t.querySelectorAll("script").forEach(e=>{e.innerHTML&&l.push(e.innerHTML)}),{scriptsToEval:l}},B=async t=>{const l=t.querySelectorAll("script"),a=[];return l.forEach(e=>{(!window?.CKEDITOR&&e.src.indexOf("ckeditor")>-1||!window?.picklist&&e.src.indexOf("picklist4")>-1)&&a.push(I(e.src))}),{scriptsToLoad:a}};const j={name:"InjectDateTimePicker",components:{IconSettings:q,DatePicker:O,SLDSButton:L,TimePicker:N},props:{inputClasses:{type:String,required:!0},renderTime:{type:Boolean,default:!0},renderDate:{type:Boolean,default:!0},dataField:{type:String,required:!0},dataType:{type:String,required:!0}},data(){return{localDate:null,localTime:null,dateNow:new Date,locale:MAPS.currentUser.LocaleFormatted,firstDayOfWeek:MAPS.currentUser.StartOfWeekIndex,localResourceURL:MAPS.app.config.globalProperties.resourceURL}},computed:{saveDateFormatted(){return this.localDate?this.localDate.toISOString().split("T")[0]:""},saveTimeFormatted(){return this.localTime?{hours:this.localTime.hours,minutes:this.localTime.minutes}:{}},showDateInput(){const t=String(this.$props.dataType).toLowerCase();return t==="datetime"||t==="date"},showTimeInput(){const t=String(this.$props.dataType).toLowerCase();return t==="datetime"||t==="time"},currentTimeString(){const t={};return this.showDateInput&&(t.dateStyle="short"),this.showTimeInput&&(t.timeStyle="short"),`[ ${MAPS.app.config.globalProperties.$F("DateTime",new Date,t)} ]`}},methods:{setDateTimeNow(){this.localDate=this.dateNow,this.localTime={hours:this.dateNow.getHours(),minutes:this.dateNow.getMinutes()}}}},R=["data-type","data-field"],U={class:"slds-grid"},H={style:{display:"none"}};function K(t,l,a,e,i,o){const f=T("DatePicker"),n=T("TimePicker"),r=T("SLDSButton"),p=T("IconSettings");return h(),g(p,{iconPath:`${i.localResourceURL}/maps__MapsIcons/icons`},{default:x(()=>[y("div",{class:v(a.inputClasses),"data-type":a.dataType,"data-field":a.dataField},[y("div",U,[o.showDateInput&&a.renderDate?(h(),g(f,{key:0,modelValue:i.localDate,"onUpdate:modelValue":l[0]||(l[0]=s=>i.localDate=s),inputAttrs:{class:"get-input"},class:"style-width-fix slds-col",firstDayOfWeek:i.firstDayOfWeek,locale:i.locale,detach:""},null,8,["modelValue","firstDayOfWeek","locale"])):S("",!0),o.showTimeInput&&a.renderTime?(h(),g(n,{key:1,modelValue:i.localTime,"onUpdate:modelValue":l[1]||(l[1]=s=>i.localTime=s),class:v(["get-input",{"slds-p-left_medium":o.showDateInput,"slds-col":!0}]),inputAttrs:{class:"timepicker"},combobox:"",filterable:"",labelForId:"",interval:{hours:0,minutes:15},locale:i.locale},null,8,["modelValue","class","locale"])):S("",!0),y("div",H,[o.showTimeInput?(h(),_(A,{key:0},[D(y("input",{"onUpdate:modelValue":l[2]||(l[2]=s=>o.saveTimeFormatted.hours=s),class:"hr"},null,512),[[k,o.saveTimeFormatted.hours]]),D(y("input",{"onUpdate:modelValue":l[3]||(l[3]=s=>o.saveTimeFormatted.minutes=s),class:"min"},null,512),[[k,o.saveTimeFormatted.minutes]])],64)):S("",!0),o.showDateInput?D((h(),_("input",{key:1,"onUpdate:modelValue":l[4]||(l[4]=s=>o.saveDateFormatted=s),class:"datepicker"},null,512)),[[k,o.saveDateFormatted]]):S("",!0)])]),C(r,{variant:"base",label:o.currentTimeString,onClick:o.setDateTimeNow},null,8,["label","onClick"])],10,R)]),_:1},8,["iconPath"])}const W=F(j,[["render",K],["__scopeId","data-v-101a2d42"]]),Y={methods:{async base_buildFieldSetHTML({fieldSet:t,sObject:l,recordTypeId:a,htmlElementId:e,visualForcePage:i}){const{success:o,data:f,error:n}=await E({fieldSet:t,sObject:l,recordTypeId:a,visualForcePage:i});if(!o){console.warn(n),this.isLoading=!1,this.mainStore.toast({message:this.$Labels.Click2Create_ArcGIS_InvalidFieldSet,state:"error"}),this.$emit("close-modal");return}const p=new DOMParser().parseFromString(f,"text/html"),s=p.querySelector(".fieldSetTable").parentElement;document.getElementById(e).innerHTML=s.outerHTML,await this.base_injectScripts(p),await this.base_injectScripts(s,!0),document.getElementById(s.id).addEventListener("submit",c=>{c.preventDefault()}),this.base_attachVueTemplates({htmlElementId:e})},base_attachVueTemplates({htmlElementId:t}){new Set(["DATETIME","DATE","TIME"]).forEach(a=>{document.querySelectorAll(`#${t} .fieldInput[data-type="${a}"]`).forEach(i=>{const o=i.getAttribute("data-field"),f=i.getAttribute("class");let n=!0,r=!0;a==="DATETIME"&&(n=i.querySelectorAll(".dateInput").length>0,r=i.querySelectorAll(".updateFields-datetime-template").length>0),i.replaceWith(this.base_buildVueDateTime({inputClasses:f,renderDate:n,renderTime:r,dataField:o,dataType:a}))})})},base_buildVueDateTime({inputClasses:t,renderDate:l,renderTime:a,dataField:e,dataType:i}){const o=M(W,{inputClasses:t,renderDate:l,renderTime:a,dataField:e,dataType:i});return P(o,document.createElement("div")),o.el},async base_injectScripts(t,l=!1){if(l){const{scriptsToEval:a}=V(t);a.forEach(e=>{const i=document.createElement("script");i.textContent=e,i.type="text/javascript",document.body.appendChild(i)})}else{const{scriptsToLoad:a}=await B(t);await Promise.allSettled(a)}},base_attachCssIcons({htmlElementId:t}){document.querySelectorAll(`#${t} .comboboxIcon, #${t} .comboboxIconOn`).forEach(e=>{e.style["background-image"]="url(/img/func_icons/util/combobox20.gif)",e.style["background-position"]="0 0",e.style.width="20px",e.style.height="20px"}),document.querySelectorAll(`#${t} .lookupIcon, #${t} .lookupIconOn`).forEach(e=>{e.style["background-image"]="url(/img/func_icons/util/lookup20.gif)",e.style["background-position"]="0 0",e.style.width="20px",e.style.height="20px"})}}};export{X as b,Y as c};
