import{u as j}from"./index.d251dbc7.js";import{c as S,r as D}from"./index.0172543b.js";import{_ as $,o as p,c as m,h as a,t as _,S as G,aQ as q,r as f,b as C,F as O,q as w,H as K,ac as Z,a3 as V,by as z,G as H,cj as Y,ck as Q,cl as J,B as X,P as ee,a5 as te,J as se,K as ie,g as oe,u as ae,Q as le,b3 as re,s as ne,v as de,i as h,w as M,a0 as U,e as P,j as ce,p as pe,k as _e}from"../bundle.js";import{D as me}from"./DatePicker.899772b4.js";import{P as ye}from"./Popover.93a0feed.js";import{T as ue}from"./TimePicker.bfa4e2f9.js";const he=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/waypointEnd.d2ec2224.svg"}),ge=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/waypointStart.a6119a86.svg"}),ve=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/event_hard_braking.2f16416b.svg"}),be=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/event_quick_acceleration.554926a8.svg"}),fe=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/event_speeding_begin_small.2163486c.svg"}),Me=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/event_speeding_begin.2c337997.svg"}),Le=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/event_touch.5be2f4c6.svg"}),Te=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/stop_association.dabc9457.svg"}),k=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/tracking_dot.ec9e11fd.svg"}),Se="CIMSymbolReference",Pe=[],ke={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Z",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:14,ymax:15},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,1.25],[8.22,1.37],[9.39,1.73],[10.47,2.3],[11.42,3.08],[12.2,4.03],[12.77,5.11],[13.13,6.28],[13.25,7.5],[13.13,8.72],[12.77,9.89],[12.2,10.97],[11.42,11.92],[10.47,12.7],[9.39,13.27],[8.22,13.63],[7,13.75],[5.78,13.63],[4.61,13.27],[3.53,12.7],[2.58,11.92],[1.8,10.97],[1.23,9.89],[.87,8.72],[.75,7.5],[.87,6.28],[1.23,5.11],[1.8,4.03],[2.58,3.08],[3.53,2.3],[4.61,1.73],[5.78,1.37],[7,1.25]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[6,28,63,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[7,1.5],[5.83,1.61],[4.71,1.95],[3.67,2.51],[2.76,3.26],[2.01,4.17],[1.45,5.21],[1.11,6.33],[1,7.5],[1.11,8.67],[1.45,9.79],[2.01,10.83],[2.76,11.74],[3.67,12.49],[4.71,13.05],[5.83,13.39],[7,13.5],[8.17,13.39],[9.29,13.05],[10.33,12.49],[11.24,11.74],[11.99,10.83],[12.55,9.79],[12.89,8.67],[13,7.5],[12.89,6.33],[12.55,5.21],[11.99,4.17],[11.24,3.26],[10.33,2.51],[9.29,1.95],[8.17,1.61],[7,1.5]],[[7,.5],[8.37,.63],[9.68,1.03],[10.89,1.68],[11.95,2.55],[12.82,3.61],[13.47,4.82],[13.87,6.13],[14,7.5],[13.87,8.87],[13.47,10.18],[12.82,11.39],[11.95,12.45],[10.89,13.32],[9.68,13.97],[8.37,14.37],[7,14.5],[5.63,14.37],[4.32,13.97],[3.11,13.32],[2.05,12.45],[1.18,11.39],[.53,10.18],[.13,8.87],[0,7.5],[.13,6.13],[.53,4.82],[1.18,3.61],[2.05,2.55],[3.11,1.68],[4.32,1.03],[5.63,.63],[7,.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,0,0,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[7,6],[7.29,6.03],[7.57,6.11],[7.83,6.25],[8.06,6.44],[8.25,6.67],[8.39,6.93],[8.47,7.21],[8.5,7.5],[8.47,7.79],[8.39,8.07],[8.25,8.33],[8.06,8.56],[7.83,8.75],[7.57,8.89],[7.29,8.97],[7,9],[6.71,8.97],[6.43,8.89],[6.17,8.75],[5.94,8.56],[5.75,8.33],[5.61,8.07],[5.53,7.79],[5.5,7.5],[5.53,7.21],[5.61,6.93],[5.75,6.67],[5.94,6.44],[6.17,6.25],[6.43,6.11],[6.71,6.03],[7,6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}],angleAlignment:"Map"}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[14,0],[14,15],[0,15],[0,0]]]}},colorLocked:!0}]},E={type:Se,primitiveOverrides:Pe,symbol:ke},Ee="CIMSymbolReference",Oe=[],we={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Z",size:20,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:38,ymax:38},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[6,28,63,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[13.5,8.7],[8.1,8.7],[6.9,8.9],[5.8,9.6],[5.1,10.7],[4.9,11.9],[4.9,33.7],[5.1,34.9],[5.8,36],[6.9,36.7],[8.1,36.9],[29.9,36.9],[31,36.7],[32.1,36.1],[32.8,35.1],[33.1,33.9],[33.1,33.7],[33.1,11.9],[32.9,10.7],[32.2,9.6],[31.1,8.9],[29.9,8.7],[24.5,8.7],[19,2.4],[13.5,8.7]],[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,0,0,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[16.51,18.79],[16.75,18.43],[17.05,18.12],[17.39,17.86],[17.78,17.67],[18.19,17.54],[18.62,17.48],[19.05,17.5],[19.47,17.6],[19.87,17.76],[20.18,17.95],[20.46,18.18],[20.71,18.46],[20.91,18.77],[21.05,19.1],[21.15,19.45],[21.19,19.82],[21.17,20.18],[25.19,22.62],[25.43,21.86],[25.58,21.08],[25.62,20.28],[25.62,19.62],[27.79,19.62],[27.79,20.28],[27.7,21.46],[27.43,22.62],[26.99,23.72],[28.23,24.47],[27.79,25.13],[26.52,24.57],[25.86,25.54],[25.09,26.42],[24.21,27.2],[23.24,27.87],[22.2,28.41],[21.1,28.81],[19.95,29.08],[18.78,29.21],[17.07,28.96],[15.43,28.41],[13.92,27.57],[12.58,26.46],[11.47,25.14],[10.62,23.63],[10.06,21.99],[9.8,20.28],[9.8,20],[9.8,19.62],[11.98,19.62],[11.98,20],[11.98,20.28],[11.98,20.54],[12.11,21.61],[12.4,22.65],[12.86,23.63],[13.46,24.53],[14.2,25.31],[15.05,25.98],[15.99,26.5],[17.01,26.86],[18.1,27.06],[19.22,27.08],[20.32,26.93],[21.38,26.59],[22.37,26.09],[23.26,25.43],[24.04,24.63],[24.68,23.72],[20.34,21.82],[19.99,22.06],[19.61,22.24],[19.2,22.35],[18.78,22.39],[18.37,22.37],[17.96,22.28],[17.57,22.12],[17.24,21.92],[16.94,21.67],[16.7,21.38],[16.5,21.05],[16.36,20.69],[16.24,19.73],[16.51,18.79]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}],angleAlignment:"Map"}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[38,0],[38,38],[0,38],[0,0]]]}},colorLocked:!0}]},Ce={type:Ee,primitiveOverrides:Oe,symbol:we},Ae="CIMSymbolReference",Ie=[],De={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Z",size:20,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:38,ymax:38},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[6,28,63,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[13.5,8.7],[8.1,8.7],[6.9,8.9],[5.8,9.6],[5.1,10.7],[4.9,11.9],[4.9,33.7],[5.1,34.9],[5.8,36],[6.9,36.7],[8.1,36.9],[29.9,36.9],[31,36.7],[32.1,36.1],[32.8,35.1],[33.1,33.9],[33.1,33.7],[33.1,11.9],[32.9,10.7],[32.2,9.6],[31.1,8.9],[29.9,8.7],[24.5,8.7],[19,2.4],[13.5,8.7]],[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,0,0,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[21.58,24.16],[21.88,24.21],[22.37,24.85],[22.73,25.57],[22.95,26.34],[23.03,27.14],[22.94,27.91],[22.72,28.65],[22.36,29.34],[21.89,29.95],[21.31,30.46],[20.64,30.86],[19.92,31.13],[19.16,31.26],[18.43,31.26],[17.71,31.14],[17.03,30.89],[16.4,30.53],[15.84,30.06],[15.37,29.51],[15,28.88],[14.74,28.2],[14.66,27.85],[14.61,26.87],[14.78,25.91],[15.17,25],[15.74,24.21],[15.78,24.19],[15.82,24.18],[15.86,24.18],[15.9,24.18],[15.94,24.19],[15.98,24.2],[16.02,24.22],[16.05,24.25],[16.08,24.28],[16.1,24.31],[16.12,24.35],[16.13,24.41],[16.13,24.41],[16.13,27.34],[16.35,28.3],[16.89,29.11],[17.69,29.68],[18.64,29.92],[18.9,29.92],[19.34,29.86],[19.75,29.73],[20.14,29.53],[20.5,29.26],[20.8,28.95],[21.05,28.59],[21.24,28.19],[21.36,27.77],[21.41,27.34],[21.41,24.41],[21.46,24.26],[21.52,24.2],[21.58,24.16]],[[22.57,15.22],[22.67,15.23],[22.77,15.26],[22.87,15.3],[22.96,15.35],[23.03,15.43],[23.09,15.51],[23.14,15.6],[23.17,15.7],[24.25,19.58],[24.31,19.92],[24.3,20.26],[24.25,20.6],[24.14,20.93],[23.98,21.23],[23.77,21.51],[23.52,21.75],[23.24,21.94],[22.93,22.09],[20.23,23.05],[19.96,23.25],[19.86,23.56],[19.86,27.27],[19.8,27.62],[19.62,27.93],[19.36,28.16],[19.02,28.28],[18.84,28.29],[18.74,28.29],[18.57,28.27],[18.4,28.22],[18.24,28.14],[18.1,28.04],[17.98,27.91],[17.87,27.77],[17.8,27.61],[17.74,27.45],[17.72,27.27],[17.72,19.96],[17.62,19.58],[17.31,19.35],[17.22,19.33],[17.12,19.33],[17.02,19.34],[16.93,19.36],[16.84,19.4],[16.76,19.46],[16.69,19.53],[16.63,19.61],[15.94,21.11],[15.83,21.27],[15.7,21.41],[15.55,21.54],[15.38,21.63],[15.19,21.69],[15,21.73],[14.81,21.73],[14.61,21.7],[14.43,21.64],[14.25,21.55],[14.16,21.49],[13.73,21.14],[16.01,15.6],[16.25,15.32],[16.6,15.22],[22.57,15.22]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}],angleAlignment:"Map"}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[38,0],[38,38],[0,38],[0,0]]]}},colorLocked:!0}]},Fe={type:Ae,primitiveOverrides:Ie,symbol:De},$e="CIMSymbolReference",xe=[],Ve={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Z",size:20,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:38,ymax:38},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[6,28,63,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[13.5,8.7],[8.1,8.7],[6.9,8.9],[5.8,9.6],[5.1,10.7],[4.9,11.9],[4.9,33.7],[5.1,34.9],[5.8,36],[6.9,36.7],[8.1,36.9],[29.9,36.9],[31,36.7],[32.1,36.1],[32.8,35.1],[33.1,33.9],[33.1,33.7],[33.1,11.9],[32.9,10.7],[32.2,9.6],[31.1,8.9],[29.9,8.7],[24.5,8.7],[19,2.4],[13.5,8.7]],[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,0,0,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[12.17,17.69],[12.38,17.65],[12.58,17.74],[18.78,23],[18.84,23.05],[18.89,23.11],[18.92,23.18],[18.95,23.25],[18.96,23.33],[18.96,23.41],[18.95,23.49],[18.92,23.56],[18.89,23.63],[18.84,23.69],[18.78,23.74],[12.58,28.92],[12.53,28.96],[12.48,28.99],[12.42,29.01],[12.36,29.03],[12.3,29.03],[12.23,29.02],[12.17,29],[12.08,28.94],[12.01,28.86],[11.94,28.65],[11.94,18.04],[12,17.83],[12.17,17.69]],[[20.31,17.64],[20.37,17.62],[20.43,17.61],[20.5,17.61],[20.56,17.61],[20.62,17.63],[20.67,17.66],[20.73,17.7],[20.77,17.74],[26.97,23],[27.04,23.07],[27.08,23.14],[27.11,23.21],[27.13,23.29],[27.14,23.38],[27.13,23.46],[27.11,23.54],[27.07,23.62],[27.03,23.68],[26.97,23.74],[20.77,28.92],[20.72,28.96],[20.67,28.99],[20.61,29.01],[20.55,29.03],[20.48,29.03],[20.42,29.02],[20.36,29],[20.27,28.94],[20.19,28.86],[20.13,28.65],[20.13,18.04],[20.09,18.04],[20.13,17.8],[20.31,17.64]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}],angleAlignment:"Map"}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[38,0],[38,38],[0,38],[0,0]]]}},colorLocked:!0}]},ze={type:$e,primitiveOverrides:xe,symbol:Ve},He="CIMSymbolReference",Ue=[],Re={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Z",size:20,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:38,ymax:38},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[6,28,63,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[13.5,8.7],[8.1,8.7],[6.9,8.9],[5.8,9.6],[5.1,10.7],[4.9,11.9],[4.9,33.7],[5.1,34.9],[5.8,36],[6.9,36.7],[8.1,36.9],[29.9,36.9],[31,36.7],[32.1,36.1],[32.8,35.1],[33.1,33.9],[33.1,33.7],[33.1,11.9],[32.9,10.7],[32.2,9.6],[31.1,8.9],[29.9,8.7],[24.5,8.7],[19,2.4],[13.5,8.7]],[[25,7.6],[29.9,7.6],[31.5,7.9],[32.9,8.9],[33.9,10.3],[34.2,11.9],[34.2,33.7],[33.9,35.3],[32.9,36.7],[31.5,37.7],[29.9,38],[8.1,38],[7.4,37.9],[6.7,37.7],[6,37.4],[5.4,37],[4.8,36.4],[4.4,35.8],[4.1,35.1],[3.9,34.4],[3.8,33.7],[3.8,11.9],[3.9,11.2],[4.1,10.5],[4.4,9.8],[4.8,9.2],[5.4,8.6],[6,8.2],[6.7,7.9],[7.4,7.7],[8.1,7.6],[13,7.6],[19,.8],[25,7.6]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,0,0,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[12.59,20.14],[12.59,25.46],[16.34,29.23],[21.66,29.23],[25.45,25.46],[25.45,20.14],[21.68,16.37],[16.36,16.37],[12.59,20.14]],[[22.15,15.2],[26.6,19.65],[26.6,25.95],[22.15,30.4],[15.85,30.4],[11.4,25.95],[11.4,19.65],[15.85,15.2],[22.15,15.2]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}],angleAlignment:"Map"}},{type:"CIMMarkerGraphic",geometry:{rings:[[[18.75,18.82],[19.03,18.71],[19.31,18.82],[22.26,21.43],[22.29,21.47],[22.32,21.51],[22.35,21.55],[22.36,21.6],[22.37,21.65],[22.37,21.7],[22.36,21.75],[22.35,21.79],[22.32,21.84],[22.29,21.88],[22.26,21.91],[21.69,22.39],[21.41,22.49],[21.13,22.39],[20.19,21.57],[20.07,21.5],[19.92,21.51],[19.8,21.6],[19.75,21.74],[19.75,26.53],[19.74,26.6],[19.72,26.66],[19.68,26.72],[19.64,26.77],[19.59,26.82],[19.54,26.85],[19.48,26.88],[19.41,26.89],[19.35,26.89],[18.54,26.89],[18.28,26.79],[18.14,26.53],[18.14,21.71],[18.13,21.67],[18.12,21.64],[18.1,21.6],[18.08,21.57],[18.05,21.54],[18.01,21.52],[17.97,21.5],[17.83,21.49],[17.71,21.55],[16.83,22.39],[16.77,22.43],[16.71,22.46],[16.65,22.48],[16.58,22.49],[16.51,22.49],[16.44,22.48],[16.38,22.46],[16.32,22.43],[16.26,22.39],[15.74,21.91],[15.71,21.88],[15.68,21.84],[15.65,21.79],[15.64,21.75],[15.63,21.7],[15.63,21.65],[15.64,21.6],[15.65,21.55],[15.68,21.51],[15.71,21.47],[15.74,21.43],[18.75,18.82]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}],angleAlignment:"Map"}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[38,0],[38,38],[0,38],[0,0]]]}},colorLocked:!0}]},Be={type:He,primitiveOverrides:Ue,symbol:Re},Ge={name:"TrackingPopupHeader",props:{trackingEvent:{type:Object,required:!0}},data(){return{labels:{LIVE_TRACKING_EVENT_HEADER:MAPS.app.config.globalProperties.$Labels.LIVE_TRACKING_EVENT_HEADER}}},computed:{eventType(){const e=this.trackingEvent.formattedEventType===MAPS.app.config.globalProperties.$Labels.Route_Start_End?MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update:this.trackingEvent.formattedEventType;return MAPS.Utils.Labels.format(MAPS.app.config.globalProperties.$Labels.Event_Type,[e])}}},qe={class:"slds-text-heading_medium"},Ne={class:"slds-text-color_weak",style:{"font-size":"12px"}},We={class:"slds-grid slds-grid_align-spread"},je={class:"slds-col"},Ke={class:"slds-text-title_bold",style:{"font-size":"1rem"}},Ze={class:"slds-col"},Ye={class:"slds-text-color_weak",style:{"font-size":"12px"}},Qe={class:"slds-p-top_xx-small slds-grid"},Je={class:"slds-text-color_weak",style:{"font-size":"12px"}};function Xe(e,t,i,l,s,r){return p(),m("div",qe,[a("div",Ne,_(s.labels.LIVE_TRACKING_EVENT_HEADER),1),a("div",We,[a("div",je,[a("span",Ke,_(r.eventType),1)]),a("div",Ze,[a("span",Ye,_(i.trackingEvent.formattedTime),1)])]),a("div",Qe,[a("span",Je,_(i.trackingEvent.position?.address?.address||""),1)])])}const et=$(Ge,[["render",Xe]]);const tt={name:"TrackingPopupBody",components:{Spinner:G},props:{sfRecord:{type:Object,required:!0},trackingEvent:{type:Object,required:!0},trackingConfig:{type:Object,required:!0}},data(){return{isLoading:!0,speedUnitsIsMiles:(q.routeDefaults.unit||"mi")==="mi",metrics:{stopStarted:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Stop_Started,value:""},stopEnded:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Stop_Ended,value:""},dateTime:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Date_Time,value:""},timezone:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Timezone,value:""},postedSpeed:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Posted_Speed,value:""},actualSpeed:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Speed,value:""},amountOverLimit:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Amount_Over_Limit,value:""},duration:{show:!1,label:MAPS.app.config.globalProperties.$Labels.Event_Duration,value:""}}}},computed:{displayedMetrics(){return Object.values(this.metrics).filter(e=>e.show)}},created(){this.trackingEvent.eventType==="stop"?(this.metrics.stopStarted={...this.metrics.stopStarted,show:!0,value:this.formatDate(this.trackingEvent.stopStartTime)},this.metrics.stopEnded={...this.metrics.stopEnded,show:!0,value:this.formatDate(this.trackingEvent.stopEndTime)}):(this.metrics.dateTime={...this.metrics.dateTime,show:!0,value:this.formatDate(this.trackingEvent.timestamp)},this.metrics.timezone={...this.metrics.timezone,show:!0,value:this.trackingConfig.selectedTimezone}),this.trackingEvent.postedSpeed&&(this.metrics.postedSpeed={...this.metrics.postedSpeed,show:!0,value:this.formatSpeed(this.trackingEvent.postedSpeed)}),this.trackingEvent.actualSpeed?this.metrics.actualSpeed={...this.metrics.actualSpeed,show:!0,value:this.formatSpeed(this.trackingEvent.actualSpeed)}:this.metrics.actualSpeed={...this.metrics.actualSpeed,show:!0,value:MAPS.app.config.globalProperties.$Labels.Not_Captured},this.trackingEvent.amountOverLimit&&(this.metrics.amountOverLimit={...this.metrics.amountOverLimit,show:!0,value:this.formatSpeed(this.trackingEvent.amountOverLimit)}),this.trackingEvent.duration&&(this.metrics.duration={...this.metrics.duration,show:!0,value:this.formatDuration(this.trackingEvent.duration)}),this.isLoading=!1},methods:{formatDate(e){return moment(e).tz(this.trackingConfig.selectedTimezone).format("MM/DD/YYYY h:mm A")},formatSpeed(e){const t=this.speedUnitsIsMiles?MAPS.app.config.globalProperties.$Labels.Speed_MPH:MAPS.app.config.globalProperties.$Labels.Speed_KPH;return MAPS.Utils.Labels.format(t,[Math.round(e)])},formatDuration(e){return MAPS.Utils.Labels.format(MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_No_Hour_Multiple_Minutes,[(e/6e4).toFixed(2)])}}},st={key:1,class:"slds-grid slds-p-vertical_medium slds-p-horizontal_xx-small"},it={class:"slds-col slds-size_1-of-2"},ot=["data-q3-id"],at={class:"slds-col slds-size_1-of-2"},lt=["data-q3-id"];function rt(e,t,i,l,s,r){const o=f("Spinner");return p(),m("div",null,[s.isLoading?(p(),C(o,{key:0})):(p(),m("div",st,[a("div",it,[(p(!0),m(O,null,w(r.displayedMetrics,d=>(p(),m("div",{key:`${d.label}-label`,"data-q3-id":`${d.label}-label`,class:"slds-p-bottom_xx-small"},_(d.label),9,ot))),128))]),a("div",at,[(p(!0),m(O,null,w(r.displayedMetrics,d=>(p(),m("div",{key:`${d.label}-value`,"data-q3-id":`${d.label}-value`,class:"slds-p-bottom_xx-small"},[a("b",null,_(d.value),1)],8,lt))),128))])]))])}const nt=$(tt,[["render",rt],["__scopeId","data-v-49613abb"]]),{GraphicsLayer:R,CustomContent:dt,GroupLayer:ct,cimSymbolUtils:B,CIMSymbol:pt,WebTileLayer:_t}=await K(["esri/layers/GraphicsLayer","esri/popup/content/CustomContent","esri/layers/GroupLayer","esri/symbols/support/cimSymbolUtils","esri/symbols/CIMSymbol","esri/layers/WebTileLayer"]),mt=({eventType:e,renderAs:t})=>{let i=null,l="#3492EB";switch(e){case"routeStart":i=J;break;case"routeEnd":i=Q;break;case"stop":t==="icon"?(l="#FF0000",i=Y):i=E;break;case"speeding":case"speedThreshold":i=t==="icon"?Ce:E;break;case"fastAcceleration":i=t==="icon"?ze:E;break;case"hardBrake":i=t==="icon"?Be:E;break;case"liveOn":case"liveOff":case"buttonPress":i=t==="icon"?Fe:E;break;default:i=E;break}return{icon:i,color:l}},I=(e,t)=>{let i=e[t];return i&&(t==="allowedDistance"&&e.allowedDistanceUnits==="meters"&&(i/=.3048),t==="allowedTime"&&e.allowedTimeUnits==="hours"&&(i*=60),t==="speedLimit"&&e.speedLimitUnits==="kph"&&(i*=.62137119),t==="speedLimitDuration"&&e.speedLimitDurationTimeUnits==="hours"&&(i*=60)),i},yt=async e=>{const{selectedAsset:t,selectedDate:i,startTime:l,endTime:s,summaryConfig:r,pathColor:o}=e;i.setHours(l.hours),i.setMinutes(l.minutes),i.setSeconds(0),i.setMilliseconds(0);const d=new Date(i);d.setHours(l.hours),d.setMinutes(l.minutes);const y=Math.floor(new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()-H(MAPS.currentUser.TimeZone),d.getMinutes(),d.getSeconds(),d.getMilliseconds())).getTime()),c=new Date(i);c.setHours(s.hours),c.setMinutes(s.minutes);const g=Math.floor(new Date(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours()-H(MAPS.currentUser.TimeZone),c.getMinutes(),c.getSeconds(),c.getMilliseconds())).getTime());return{deviceid:t.deviceId,from:y,to:g,stoppriority:"distance",speedlimitduration:I(r,"speedLimitDuration"),speedlimitabove:I(r,"speedLimit"),allowedmins:I(r,"allowedTime"),allowedfeet:I(r,"allowedDistance"),history:!0,color:o.split("#")[1],opacity:1,snap:!0}},F=e=>q.routeDefaults.unit==="mi"?Number(e)*.621371:e,ut=async({trackingConfig:e,positions:t,summary:i})=>{const l=[],s=[];t.forEach(o=>{const d=o.eventType!=="routeStart"&&o.eventType!=="routeEnd"?MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update:o.formattedEventType;(o.eventType==="Location Update"||o.eventType==="routeStart"||o.eventType==="routeEnd")&&s.push({timestamp:new Date(o.timestamp).getTime(),formattedTime:MAPS.app.config.globalProperties.$F("DateTime",new Date(o.timestamp),{timeZone:e.selectedTimezone,hour:"numeric",minute:"numeric",hour12:!MAPS.currentUser?.is24Hour}),eventType:o.eventType,formattedEventType:d,actualSpeed:o.speed,position:{address:{address:o.position?.address?.address||"",city:o.position?.address?.city||"",state:o.position?.address?.state||"",street:o.position?.address?.street||""},lat:o.position.lat,lng:o.position.lng}}),l.findIndex(c=>o.eventType===c.value)<=-1&&l.push({value:o.eventType,formattedEventType:d})});let r=1;return i.events.forEach(o=>{const y={stop:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Stop,speeding:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Speeding,fastAcceleration:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Hard_Acceleration,hardBrake:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Hard_Brake,buttonPress:o.translation||MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Button_Press,routeStart:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update,routeEnd:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update,liveOn:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Live_On,liveOff:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Live_Off,speedThreshold:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Speed_Threshold,trip:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Trip}[o.eventType]||MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update;s.push({timestamp:new Date(o.start).getTime(),formattedTime:MAPS.app.config.globalProperties.$F("DateTime",new Date(o.start),{timeZone:e.selectedTimezone,hour:"numeric",minute:"numeric",hour12:!MAPS.currentUser?.is24Hour}),eventType:o.eventType||"Location Update",formattedEventType:y,duration:o.duration,postedSpeed:F(o.speedLimit),actualSpeed:F(o.speed),amountOverLimit:F(o.speed-o.speedLimit),position:{address:{address:o.position?.address?.address||"",city:o.position?.address?.city||"",state:o.position?.address?.state||"",street:o.position?.address?.street||""},lat:o.position.lat,lng:o.position.lng},stopOrder:o.eventType==="stop"?r:null,stopStartTime:o.eventType==="stop"?o.start:null,stopEndTime:o.eventType==="stop"?o.end:null}),o.eventType==="stop"&&r++,l.findIndex(g=>o.eventType===g.value)<=-1&&l.push({value:o.eventType,formattedEventType:y})}),{eventTypes:l,summaryEvents:s}},ht=async e=>{const{summaryConfig:t}=e,i=await yt(e),l=async d=>{const y=t.driveTripOptim||"Vehicle Tracking",c=i.deviceid.toLowerCase().indexOf("mapanything")>-1&&y.toLowerCase().indexOf("mobile")>-1?{method:"get",action:"summary",subType:"liveapp",version:"v1",useLiveEndpoint:"true"}:{method:"get",action:"devices/summary",subType:"live/client",version:"v5"};return await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.MapAnythingIORequest",[c,d])};let s=[],r={};i.history=!1;const o=await l(i);if(o.data&&!o.data.message){const d=i.to,y=216e5;for(i.history=!0,i.to=i.from+y;i.from<=d;)r=await l(i),r.data&&r.data.positions&&(s=s.concat(r.data.positions)),i.from+=y,i.to=i.from+y,i.to>d&&(i.to=d);let c={},g=null;return o.data.positions=s.splice(0),o.data.positions.length>0&&(o.data.positions[0].eventType="routeStart",o.data.positions[0].formattedEventType=MAPS.app.config.globalProperties.$Labels.Route_Start_End,o.data.positions[o.data.positions.length-1].eventType="routeEnd",o.data.positions[o.data.positions.length-1].formattedEventType=MAPS.app.config.globalProperties.$Labels.Route_Start_End,g=o.data.key,c=await ut({trackingConfig:e,positions:o.data.positions,summary:o.data.summary})),{eventData:c,tileKey:g,error:null}}return{eventData:{},tileKey:null,error:o.data?.message||MAPS.app.config.globalProperties.$Labels.Unable_To_Retrieve_Tracking_History}},gt=({groupLayerId:e,trackingConfig:t,trackingEvent:i})=>{const{sfRecord:l}=t,{eventType:s,formattedEventType:r,formattedTime:o,position:d,stopOrder:y}=i;i.markerIds={},["dot","icon"].forEach(c=>{const{icon:g,color:u}=mt({eventType:s,renderAs:c}),b=new pt({data:g});s==="stop"&&(B.applyCIMSymbolColor(b,u,{layersToColor:"fill"}),B.applyCIMSymbolColor(b,MAPS.Utils.Color.adjustColorLuminance(u,-.25),{layersToColor:"outline"}));const L={id:Z(),type:"graphic",geometry:{type:"point",latitude:d.lat,longitude:d.lng},symbol:b,attributes:{...l.attributes,type:"navigation",index:y||0,tooltip1:`${r} ${o}`,eventType:s,formattedEventType:r},titleFn:v=>{const T=V(et,{trackingEvent:i});z(T,document.createElement("div")),v.innerHTML=T.el.innerHTML},popupTemplate:{title:'<div class="maps-esri-list-title">{tooltip1}</div><div class="maps-popup-header" id="tooltip-content" />',content:[new dt({outFields:["*"],creator:v=>{const{graphic:T}=v,W={latitude:T?.geometry?.latitude,longitude:T?.geometry?.longitude},x=V(nt,{graphic:T,location:W,trackingEvent:i,sfRecord:l,trackingConfig:t});return z(x,document.createElement("div")),x.el}})]}},A=MAPS.view.map.findLayerById(e),n=c==="icon"?A.layers.find(v=>v.id===`${r}-routeIcons`):A.layers.find(v=>v.id===`${r}-routeDots`);n.title=MAPS.Utils.Labels.format(MAPS.app.config.globalProperties.$Labels.Live_Events_History_Plus_Record_Name,[l.attributes.title]),n.add(L),i.markerIds[c]=L.id})},vt=async({trackingConfig:e})=>{const{eventData:t,tileKey:i,error:l}=await ht(e);if(!l){const{eventTypes:s=[],summaryEvents:r=[]}=t,o=new ct({id:`${e.selectedAsset.deviceId}-${e.groupLayerIndex}`,SF_MAPS_TYPE:"navigationLayer"}),d=[];s.reduce((u,b)=>(u.includes(b.formattedEventType)||u.push(b.formattedEventType),u),[]).forEach(u=>{const b=new R({id:`${u}-routeIcons`,SF_MAPS_TYPE:"navigationWaypoints",graphics:[],visible:!1});d.push(b);const L=new R({id:`${u}-routeDots`,SF_MAPS_TYPE:"navigationWaypoints",graphics:[],visible:u!==MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update});d.push(L)});const c=`${MAPS.maioDomain}/live/client/devices/history/tile/1/{x}/{y}/{z}/${i}`,g=new _t({id:"routePath",urlTemplate:c,opacity:1});return o.addMany([g,...d]),MAPS.view.map.add(o),r.forEach(u=>{gt({groupLayerId:o.id,trackingConfig:e,trackingEvent:u})}),{success:!0,data:t}}return{success:!1,error:l||MAPS.app.config.globalProperties.$Labels.Unable_To_Plot_Tracking_Layer}},bt=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/tracking_history_icon.21aff2c8.svg"});const ft={components:{ButtonIcon:X,DatePicker:me,Popover:ye,Picklist:ee,Checkbox:te,Spinner:G,ActionMenu:se,ActionMenuItem:ie,TimePicker:ue},props:{layer:{type:Object,default:()=>{},required:!0}},setup(){return{v$:j(),layersStore:oe(),listStore:ae()}},data(){return{loading:!0,error:null,showOptions:!1,showEventList:!1,showFilterPopover:!1,activeMode:{},isLayerVisible:!1,firstDayOfWeek:MAPS.currentUser.StartOfWeekIndex,dateFormat:{dateStyle:"short"},userLocale:MAPS.currentUser.Locale.replace("sh_ME_USD","sh-ME").replace("_","-").slice(0,5),formattedDate:null,date:null,startTime:null,endTime:null,asset:{selected:null,options:[]},timezone:{selected:null,options:MAPS.availableTimezones.map(e=>({tzLabel:e.label,tzValue:e.value}))},summaryConfig:{selected:null,options:[]},eventTypes:{},labels:{Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update,Route_Start_End:MAPS.app.config.globalProperties.$Labels.Route_Start_End}}},computed:{displayTypes(){return[{value:"dot",label:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Display_Button_Dot,icon:k},{value:"icon",label:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Display_Button_Icon,icon:fe}]},layerOptions(){return[{label:MAPS.app.config.globalProperties.$Labels.MA_Zoom_To_Fit,action:"zoom",types:[]}]},eventsDescending(){return this.sortByProperty(Object.values(this.eventTypes).reduce((t,i)=>(i.show&&t.push(...i.events),t),[]),"timestamp").reverse()},numberOfEventsLabel(){const e=Object.values(this.eventTypes).reduce((t,i)=>(i.show&&(t+=i.events.length),t),0);return le(MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Events,[e])},layerPathColor(){return{"#73B8F5":"color-route-line-blue","#FFC894":"color-route-line-orange","#DA8885":"color-route-line-red","#93DFB3":"color-route-line-green","#98A5BB":"color-route-line-blue-gray"}[this.layer.trackingConfig.pathColor||"#73B8F5"]},record(){return this.layer.trackingConfig.sfRecord||{}}},validations(){return{asset:{selected:{required:S.withMessage(MAPS.app.config.globalProperties.$Labels.MA_Field_Req,D)}},timezone:{selected:{required:S.withMessage(MAPS.app.config.globalProperties.$Labels.MA_Field_Req,D)}},date:{required:S.withMessage(MAPS.app.config.globalProperties.$Labels.MA_Field_Req,D),maxStartDate:S.withMessage(MAPS.app.config.globalProperties.$Labels.modal_MLB_Live_Last_Report_Date_StartDate_not_greater_than_today,e=>this.checkDateLessOrEqual(e,new Date)),daysBeforeCurrentDate:S.withMessage(MAPS.app.config.globalProperties.$Labels.Layers_Start_Date_No_More_Than_90_Days,e=>this.checkDateDiffWithinRange(new Date,e,90))},startTime:{greaterThanEnd:S.withMessage(MAPS.app.config.globalProperties.$Labels.Start_Time_Greater_Than_End_Time,e=>this.checkTimeLessOrEqual(e,this.endTime))},endTime:{lessThanStart:S.withMessage(MAPS.app.config.globalProperties.$Labels.End_Time_Less_Than_Start_Time,e=>this.checkTimeLessOrEqual(this.startTime,e))}}},async created(){await this.prepareSummaryOptions(),await this.loadLayer(),this.changeRenderType(this.displayTypes[0]),this.showEventList=!0,this.loading=!1},unmounted(){this.removeGraphics()},methods:{formatDate(){this.date.setHours(Math.floor(this.date.getTimezoneOffset()/60)),this.date.setMinutes(this.date.getTimezoneOffset()%60),this.formattedDate=this.$F("DateTime",this.date,{timeZone:this.timezone.selected,dateStyle:"long"})},async loadLayer(){try{this.removeGraphics();const{success:e,error:t,data:i}=await vt({trackingConfig:this.layer.trackingConfig});if(e){const{eventTypes:l,summaryEvents:s}=i,r=l.reduce((o,d)=>(o[d.formattedEventType]={...d,show:d.formattedEventType!==this.labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update,filterable:d.formattedEventType!==this.labels.Route_Start_End,events:[]},o),{});s.forEach(o=>{r[o.formattedEventType].events.push(o)}),this.eventTypes=r,await this.zoomToFit(),this.isLayerVisible=!0,this.loading=!1}else this.showError(t)}catch(e){this.showError(e)}},async applyChanges(){this.loading=!0,this.isLayerVisible=!1,this.eventTypes={},this.error=null,this.formatDate();const e=this.asset.options.find(t=>t.realDeviceId===this.asset.selected);Object.assign(this.layer.trackingConfig,{...this.layer.trackingConfig,startTime:this.startTime,endTime:this.endTime,selectedDate:this.date,selectedTimezone:this.timezone.selected,summaryConfig:this.summaryConfig.options.find(t=>t.configId===this.summaryConfig.selected),selectedAsset:e.device,sfRecord:e}),await this.loadLayer(),this.filterDisplayedEvents()},checkDateDiffWithinRange(e,t,i){if(e==null||t==null)return!0;const l=864e5;return Math.floor((e.getTime()-t.getTime())/l)<i},checkDateLessOrEqual(e,t){return e==null||t==null?!0:e.getTime()<=t.getTime()||re(e,t)},checkTimeLessOrEqual(e,t){return e==null||t==null?!0:e.hours<=t.hours||e.hours===t.hours&&e.minutes<=t.minutes},$getErrorsByField(e){return e.$touch(),e.$errors.length?[e.$errors[0].$message]:[]},getIcon(e){const t=this.activeMode.value||"dot";let i=null;switch(e){case"routeStart":i=ge;break;case"routeEnd":i=he;break;case"stop":i=t==="icon"?Te:k;break;case"speeding":case"speedThreshold":i=t==="icon"?Me:k;break;case"fastAcceleration":i=t==="icon"?be:k;break;case"hardBrake":i=t==="icon"?ve:k;break;case"liveOn":case"liveOff":case"buttonPress":i=t==="icon"?Le:k;break;default:i=k;break}return i},filterDisplayedEvents(){const e=Object.entries(this.eventTypes).reduce((s,[r,o])=>(o.show&&s.push(r),s),[]),t=MAPS.view.map.findLayerById(this.layer.id),i=t?.layers?.filter(s=>s.id.endsWith("routeIcons"))||[],l=t?.layers?.filter(s=>s.id.endsWith("routeDots"))||[];this.activeMode.value==="icon"?(l.forEach(s=>{s.visible=!1}),i.forEach(s=>{s.visible=e.includes(s.id.split("-")[0])})):(i.forEach(s=>{s.visible=!1}),l.forEach(s=>{s.visible=e.includes(s.id.split("-")[0])}))},changeRenderType(e){if(this.activeMode.value===e.value){this.activeMode={},this.toggleVisibility(!this.isLayerVisible);return}this.activeMode=e,this.filterDisplayedEvents(),this.isLayerVisible||this.toggleVisibility()},showEventTooltip(e){const t=MAPS.view.map.findLayerById(this.layer.id);let i=null;this.activeMode.value==="icon"?i=(t.layers.find(s=>s.id===`${e.formattedEventType}-routeIcons`)?.graphics?.items||[]).find(s=>s.id===e.markerIds?.icon):i=(t.layers.find(s=>s.id===`${e.formattedEventType}-routeDots`)?.graphics?.items||[]).find(s=>s.id===e.markerIds?.dot),i&&(this.zoomToFit(i),MAPS.view.popup.open({location:i.geometry,features:[i]}))},showError(e){let t;e==="Invalid duration for summary"?t=MAPS.app.config.globalProperties.$Labels.Start_Time_Greater_Than_End_Time:e==="No data found for the device Id"?t=MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_No_Events_Found:t=MAPS.app.config.globalProperties.$Labels.Error_Plotting_History,this.loading=!1,this.error=t},async removeGraphics(){const e=MAPS.view.map.findLayerById(this.layer.id);MAPS.view.map.remove(e)},removeLayer(){this.layersStore.removePlottedLayer(this.layer.qid)},async toggleVisibility(e){const t=MAPS.view.map.findLayerById(this.layer.id);if(!t){this.isLayerVisible=!1;return}const i=e===!0||!this.isLayerVisible&&!this.activeMode.value;this.isLayerVisible=i?this.isLayerVisible:!this.isLayerVisible,t.visible=this.isLayerVisible},async zoomToFit(e){let t=e?[e]:[];e||(t=MAPS.view.map.findLayerById(this.layer.id).layers.filter(l=>l.id.endsWith("routeIcons")).map(l=>l.graphics)),await MAPS.view.goTo([...t],{animate:!0}),MAPS.view.zoom-=1},async handleAction(e){e==="zoom"&&await this.zoomToFit()},sortByProperty(e,t){return e.sort((i,l)=>i[t]<l[t]?-1:i[t]>l[t]?1:0),e},async prepareSummaryOptions(){this.timezone.selected=this.layer.trackingConfig.selectedTimezone,this.startTime=this.layer.trackingConfig.startTime,this.endTime=this.layer.trackingConfig.endTime,this.date=this.layer.trackingConfig.selectedDate,this.showOptions=this.layer.trackingConfig.showOptions,this.formatDate(),await this.getSummaryConfigs(),this.getAssets(),this.summaryConfig.selected=this.layer.trackingConfig.summaryConfig.configId,this.asset.selected=this.layer.trackingConfig.selectedAsset.deviceId,this.timezone.selected=this.timezone.options.find(e=>e.tzValue===MAPS.currentUser.TimeZone).tzValue},async getSummaryConfigs(){const e={speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:null,speedLimit:250,configName:MAPS.app.config.globalProperties.$Labels.Default_Configuration,configId:"ma_defaultConfig",allowedTimeUnits:"Minutes",allowedTime:6e4,allowedDistanceUnits:"feet",allowedDistance:7e5},t=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.getLiveConfigs",[this.record.attributes.layerId]),{success:i,data:l}=t,s=i?JSON.parse(l):[];this.summaryConfig.options=s.length>0?s:[e]},getAssets(){let e=Array.from((this.listStore.listMap.get(this.layer.trackingConfig.liveLayerQid)?.recordMap||new Map).values());e.length===0&&(e=[this.layer.trackingConfig.sfRecord]),this.asset.options=e,this.asset.options.forEach(t=>{t.optionLabel=t.Name?.raw||t.deviceId})}}},N=e=>(pe("data-v-d6c0482f"),e=e(),_e(),e),Mt={class:"PlottedRowUnit-TrackingHistoryLayer"},Lt={class:"layer-header"},Tt={class:"slds-grid"},St=N(()=>a("div",{class:"slds-m-right_small"},[a("img",{src:bt})],-1)),Pt={class:"slds-col"},kt={class:"layer-header_name"},Et={class:"layer-header_base-object"},Ot={key:1,class:"slds-button slds-button_icon slds-button_icon-small slds-button_icon-bare slds-button_icon-container live-tracking-display-dropdown-button"},wt=["title"],Ct=["src"],At={class:"slds-assistive-text"},It=N(()=>a("div",{class:"live-tracking-route-line-color"},null,-1)),Dt={class:"slds-p-around_x-small slds-border_bottom"},Ft={class:"slds-grid slds-grid_vertical-align-center"},$t={class:"slds-p-right_x-small"},xt=["src"],Vt={style:{color:"black"}},zt={class:"slds-p-around_x-small slds-border_bottom"},Ht={class:"slds-hint-parent slds-p-vertical_small slds-grid slds-grid_align-spread slds-grid_vertical-align-center slds-p-horizontal_small"},Ut={class:"slds-text-title_caps"},Rt={class:"slds-grid slds-grid_vertical-align-center"},Bt={class:"slds-text-title_caps slds-p-right_x-small"},Gt={class:"slds-p-horizontal_small slds-p-bottom_small"},qt={key:0,class:"slds-p-bottom_small"},Nt={class:"slds-grid slds-gutters_x-small slds-m-bottom_x-small"},Wt={class:"slds-col slds-size_1-of-2"},jt={class:"slds-form-element"},Kt={class:"slds-col slds-size_1-of-2"},Zt={class:"slds-form-element"},Yt={class:"slds-grid slds-m-bottom_x-small"},Qt={class:"slds-col slds-size_1-of-1"},Jt={class:"slds-form-element"},Xt={class:"slds-grid slds-gutters_x-small slds-m-bottom_x-small"},es={class:"slds-col slds-size_1-of-2"},ts={class:"slds-form-element"},ss={class:"slds-col slds-size_1-of-2"},is={class:"slds-form-element"},os=["disabled"],as={id:"liveTrackingHistoryEventList",class:"list-is-expanded"},ls={id:"liveTrackingHistoryEventListHeader",class:"slds-p-left_small slds-p-right_xx-small slds-p-vertical_xx-small"},rs={class:"slds-grid slds-grid_vertical-align-center"},ns={class:"slds-col"},ds={key:0,class:"slds-is-relative has-popover"},cs={style:{top:"44px",left:"0"}},ps={key:0,class:"slds-form-element__control"},_s={class:"slds-checkbox"},ms={class:"slds-hint-parent slds-m-left_small"},ys={key:0,id:"liveTrackingHistoryEventListBody"},us={key:0},hs={class:"events-list-error"},gs=["onClick"],vs={class:"live-tracking-history-list-item_icon"},bs=["src"],fs={key:0,class:"live-tracking-history-list-item_icon-stop-association-number"},Ms={class:"slds-col slds-p-right_medium"},Ls={class:"slds-text-body_small slds-text-color_weak"};function Ts(e,t,i,l,s,r){const o=f("Spinner"),d=f("ButtonIcon"),y=f("Checkbox"),c=f("ActionMenuItem"),g=f("ActionMenu"),u=f("Picklist"),b=f("DatePicker"),L=f("TimePicker"),A=f("Popover");return p(),m("div",Mt,[a("div",{class:U([r.layerPathColor,"live-tracking-wrapper"])},[ne(h(o,{loadingLabel:e.$Labels.Layers_On_The_Map_Loading},null,8,["loadingLabel"]),[[de,s.loading]]),a("div",Lt,[a("div",Tt,[St,a("div",Pt,[a("div",kt,_(r.record?.Name?.raw||r.record?.deviceId),1),a("div",Et,_(e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Text),1)]),h(g,{disabled:s.loading},{button:M(()=>[s.isLayerVisible?(p(),m("button",Ot,[a("button",{class:"slds-button slds-button_icon slds-button_icon-bare slds-button_icon-small",title:s.activeMode.label},[a("img",{src:s.activeMode.icon,style:{height:"18px"}},null,8,Ct),a("span",At,_(e.$Labels.MA_Options),1)],8,wt),It])):(p(),C(d,{key:0,"data-q3-id":"mapSidebarLayerRenderModeButton",iconCategory:"utility",iconName:"hide",size:"small",style:{"margin-left":"0.25rem"},title:e.$Labels.Layers_On_The_Map_OverFlow_Header_Options,assistiveText:e.$Labels.Layers_On_The_Map_OverFlow_Header_Options},null,8,["title","assistiveText"]))]),default:M(()=>[a("div",Dt,_(e.$Labels.Layers_On_The_Map_OverFlow_Header_Query_Display),1),h(c,{role:"menuitemcheckbox",label:e.$Labels.Layers_On_The_Map_OverFlow_Checkbox_Markers_Are_Visible,onClick:r.toggleVisibility},{default:M(()=>[h(y,{modelValue:s.isLayerVisible,"onUpdate:modelValue":t[0]||(t[0]=n=>s.isLayerVisible=n),"data-q3-id":"mapSidebarLayerVisibilityCheckbox",labels:{name:e.$Labels.Layers_On_The_Map_OverFlow_Checkbox_Markers_Are_Visible},class:"slds-p-horizontal_xxx-small layer-action-item"},null,8,["modelValue","labels"])]),_:1},8,["label","onClick"]),(p(!0),m(O,null,w(r.displayTypes,n=>(p(),C(c,{key:n.value,"data-q3-id":`mapSidebarLayerDisplayTypeMenuItem-${n.value}`,label:n.label,class:U(["maps-render-mode",{"mode-active":s.activeMode.value===n.value}]),onClick:v=>r.changeRenderType(n)},{default:M(()=>[a("div",Ft,[a("div",$t,[a("img",{src:n.icon},null,8,xt)]),a("div",Vt,_(n.label),1)])]),_:2},1032,["data-q3-id","label","class","onClick"]))),128))]),_:1},8,["disabled"]),h(g,{disabled:s.loading},{button:M(()=>[h(d,{"data-q3-id":"mapSidebarLayerOverflowMenuButton",iconCategory:"utility",iconName:"threedots_vertical",size:"small",title:e.$Labels.Layer_Options,assistiveText:e.$Labels.Layer_Options},null,8,["title","assistiveText"])]),default:M(()=>[a("div",zt,_(e.$Labels.MA_Options),1),(p(!0),m(O,null,w(r.layerOptions,n=>(p(),C(c,{key:n.action,"data-q3-id":`mapSidebarLayerOverflowMenuItem-${n.action}`,label:n.label,onClick:v=>r.handleAction(n.action)},null,8,["data-q3-id","label","onClick"]))),128))]),_:1},8,["disabled"]),h(d,{"data-q3-id":"mapSidebarLayerRemoveButton",iconCategory:"utility",disabled:s.loading,iconName:"close",size:"small",title:e.$Labels.Layers_On_The_Map_Remove_Layer,assistiveText:e.$Labels.Layers_On_The_Map_Remove_Layer,onClick:r.removeLayer},null,8,["disabled","title","assistiveText","onClick"])])]),a("div",Ht,[a("div",Ut,_(s.formattedDate),1),a("div",Rt,[a("span",Bt,_(e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Options),1),h(d,{iconCategory:"utility",disabled:s.loading,iconName:s.showOptions?"expand_alt":"contract_alt",title:s.showOptions?e.$Labels.Expand_Options:e.$Labels.Collapse_Options,assistiveText:s.showOptions?e.$Labels.Expand_Options:e.$Labels.Collapse_Options,onClick:t[1]||(t[1]=n=>s.showOptions=!s.showOptions)},null,8,["disabled","iconName","title","assistiveText"])])]),a("div",Gt,[s.showOptions?(p(),m("div",qt,[h(u,{modelValue:s.summaryConfig.selected,"onUpdate:modelValue":t[2]||(t[2]=n=>s.summaryConfig.selected=n),inputAttrs:{id:"layer-summary-config-picklist"},options:s.summaryConfig.options,labels:{name:e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Summary_Configuration},idKey:"configId",titleKey:"configName",class:"selected-config slds-m-bottom_x-small"},null,8,["modelValue","options","labels"]),a("div",Nt,[a("div",Wt,[a("div",jt,[h(u,{modelValue:l.v$.asset.selected.$model,"onUpdate:modelValue":t[3]||(t[3]=n=>l.v$.asset.selected.$model=n),errors:r.$getErrorsByField(l.v$.asset.selected),filterable:"",idKey:"realDeviceId",titleKey:"optionLabel",resizeToFitContent:"",inputAttrs:{id:"assetPicker"},options:s.asset.options,labels:{name:e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Asset,search:e.$Labels.Layers_On_The_Map_Live_Search_Assets}},null,8,["modelValue","errors","options","labels"])])]),a("div",Kt,[a("div",Zt,[h(b,{modelValue:l.v$.date.$model,"onUpdate:modelValue":t[4]||(t[4]=n=>l.v$.date.$model=n),errors:r.$getErrorsByField(l.v$.date),inputAttrs:{id:"datePicker"},labels:{name:e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Date},locale:s.userLocale,dateFormat:s.dateFormat,firstDayOfWeek:s.firstDayOfWeek,numYearsInPast:1,numYearsInFuture:0,alignRight:"",class:"live-date-input"},null,8,["modelValue","errors","labels","locale","dateFormat","firstDayOfWeek"])])])]),a("div",Yt,[a("div",Qt,[a("div",Jt,[h(u,{modelValue:l.v$.timezone.selected.$model,"onUpdate:modelValue":t[5]||(t[5]=n=>l.v$.timezone.selected.$model=n),inputAttrs:{id:"timezonePicker"},options:s.timezone.options,labels:{name:e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Timezone},errors:r.$getErrorsByField(l.v$.timezone.selected),filterable:"",idKey:"tzValue",titleKey:"tzLabel",resizeToFitContent:""},null,8,["modelValue","options","labels","errors"])])])]),a("div",Xt,[a("div",es,[a("div",ts,[h(L,{modelValue:l.v$.startTime.$model,"onUpdate:modelValue":t[6]||(t[6]=n=>l.v$.startTime.$model=n),inputAttrs:{id:"layer-start-time-picker"},errors:r.$getErrorsByField(l.v$.startTime),combobox:"",labels:{name:e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Start_Time},interval:{hours:0,minutes:15},locale:s.userLocale},null,8,["modelValue","errors","labels","locale"])])]),a("div",ss,[a("div",is,[h(L,{modelValue:l.v$.endTime.$model,"onUpdate:modelValue":t[7]||(t[7]=n=>l.v$.endTime.$model=n),inputAttrs:{id:"layer-end-time-picker"},errors:r.$getErrorsByField(l.v$.endTime),combobox:"",labels:{name:e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_End_Time},interval:{hours:0,minutes:15},locale:s.userLocale},null,8,["modelValue","errors","labels","locale"])])])]),a("div",null,[a("button",{"data-q3-id":"live-tracking-history-apply-btn",class:"slds-button_stretch slds-m-top_small slds-button slds-button_brand",disabled:l.v$.$invalid,onClick:t[8]||(t[8]=(...n)=>r.applyChanges&&r.applyChanges(...n))},_(e.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Button_Apply_Changes),9,os)])])):P("",!0),a("div",null,[a("div",as,[a("div",ls,[a("div",rs,[a("div",ns,_(r.numberOfEventsLabel),1),Object.keys(s.eventTypes).length>0?(p(),m("div",ds,[h(d,{"data-q3-id":"trackingLayerToggleFilter",class:"slds-button slds-button_subtle popover-trigger",iconCategory:"utility",iconName:"filter",title:e.$Labels.Layers_On_The_Map_Filter_Button_Filter,assistiveText:e.$Labels.Layers_On_The_Map_Filter_Button_Filter,onClick:t[9]||(t[9]=n=>s.showFilterPopover=!s.showFilterPopover)},null,8,["title","assistiveText"]),s.showFilterPopover?(p(),C(A,{key:0,id:"filterPopover",closeOnClickOutside:"",onClose:t[10]||(t[10]=n=>s.showFilterPopover=!s.showFilterPopover)},{header:M(()=>[ce(_(e.$Labels.Layers_On_The_Map_Filter_Event_Types),1)]),content:M(()=>[a("div",cs,[(p(!0),m(O,null,w(Object.values(s.eventTypes),n=>(p(),m("div",{key:n.value,class:"slds-form-element slds-m-bottom_x-small"},[n.filterable?(p(),m("div",ps,[a("span",_s,[h(y,{modelValue:n.show,"onUpdate:modelValue":v=>n.show=v,labels:{name:`${n.formattedEventType} (${n.events.length})`},onChange:r.filterDisplayedEvents},null,8,["modelValue","onUpdate:modelValue","labels","onChange"])])])):P("",!0)]))),128))])]),_:1})):P("",!0)])):P("",!0),a("div",ms,[h(d,{iconCategory:"utility",disabled:s.loading,iconName:s.showEventList?"expand_alt":"contract_alt",title:s.showEventList?e.$Labels.Expand_Events:e.$Labels.Collapse_Events,assistiveText:s.showEventList?e.$Labels.Expand_Events:e.$Labels.Collapse_Events,onClick:t[11]||(t[11]=n=>s.showEventList=!s.showEventList)},null,8,["disabled","iconName","title","assistiveText"])])])]),s.showEventList?(p(),m("div",ys,[s.error?(p(),m("div",us,[a("div",hs,[a("div",null,_(s.error),1)])])):P("",!0),(p(!0),m(O,null,w(r.eventsDescending,(n,v)=>(p(),m("div",{key:v,class:"live-tracking-history-list-item slds-grid slds-grid_vertical-align-center",onClick:T=>r.showEventTooltip(n)},[a("div",vs,[a("img",{src:r.getIcon(n.eventType)},null,8,bs),s.activeMode.value==="icon"&&n.stopOrder?(p(),m("span",fs,_(n.stopOrder),1)):P("",!0)]),a("div",Ms,[a("div",null,_(`${n.formattedEventType===s.labels.Route_Start_End?s.labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Location_Update:n.formattedEventType}`||n.stopAssociationTitle),1)]),a("div",Ls,_(n.formattedTime),1)],8,gs))),128))])):P("",!0)])])])],2)])}const Cs=$(ft,[["render",Ts],["__scopeId","data-v-d6c0482f"]]);export{Cs as default};
