import{_,x as b,S as M,l as A,f as L,g as C,r as i,o as y,b as u,w as a,h as F,i as n,j as c,t as p,e as O}from"../bundle.js";import{M as g}from"./Modal.76578f76.js";import{F as N}from"./FolderTree.c659e978.js";const T={name:"CopyMoveModal",components:{ScopedNotification:b,Spinner:M,FolderTree:N,Modal:g,SLDSButton:A},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],setup(){const e=L(),o=C();return{mainStore:e,layersStore:o}},data(){return{selectedFolders:[],isLoading:!1,moveTypes:{marker:"sqry",folder:"folders",shape:"territories",favorite:"favorites",datalayer:"datalayers",territory:"territory-layer",arcgisonline:"sqry",polyline:"sqry",live:"sqry"}}},computed:{title(){let e=`${this.$Labels.MA_Move}: ${this.modalOptions.layer.name}`;return this.modalOptions.isCopy&&(e=`${this.$Labels.MA_Copy}: ${this.modalOptions.layer.name}`),e}},methods:{async save(){this.isLoading=!0;const e=this.modalOptions.isCopy?this.copy():this.move(),o=await Promise.allSettled(e);let s=!1;o.forEach(l=>{const{value:t}=l;t.success||(s=!0)}),s||this.mainStore.toast({message:this.$Labels.MA_Success}),this.layersStore.updateFolderData({folderId:this.layersStore.currentFolder.id}),this.layersStore.getRecentAndPlotOnLoadLayers(),this.$emit("close-modal"),this.isLoading=!1},copy(){const e=[];return this.selectedFolders.forEach(o=>{const s={ajaxResource:"TreeAJAXResources",action:"copy_node",copyid:this.modalOptions.layer.id,copynodetype:this.modalOptions.layer.nodetype,folderid:o.id,foldernodetype:o.attributes.NodeType};e.push(MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[s]))}),e},move(){const e=[];return this.selectedFolders.forEach(o=>{const s={ajaxResource:"TreeAJAXResources",action:"move_node",npid:o.id,npnt:o.attributes.NodeType},l=this.modalOptions.layer.type,t=`${this.modalOptions.layer.id} ${this.modalOptions.layer.nodetype}`,r=this.moveTypes[l];s[r]=t,e.push(MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[s]))}),e}}},q={id:"SaveShapeTree"};function R(e,o,s,l,t,r){const f=i("ScopedNotification"),h=i("Spinner"),v=i("FolderTree"),m=i("SLDSButton"),S=i("Modal");return y(),u(S,{id:"CopyToPopup",title:r.title,onClose:o[2]||(o[2]=d=>e.$emit("close-modal"))},{content:a(()=>[F("div",q,[n(f,{class:"slds-m-bottom_small"},{content:a(()=>[c(p(e.$Labels.folderPermissions_Action_Info_Message),1)]),_:1}),t.isLoading?(y(),u(h,{key:0})):O("",!0),n(v,{selectedNodes:t.selectedFolders,"onUpdate:selectedNodes":o[0]||(o[0]=d=>t.selectedFolders=d),isMultiSelect:s.modalOptions.isCopy,folderId:s.modalOptions.layer.id,isFolderMove:s.modalOptions.layer.type==="folder"&&!s.modalOptions.isCopy},null,8,["selectedNodes","isMultiSelect","folderId","isFolderMove"])])]),footer:a(()=>[n(m,{"data-q3-id":"cancel-copy-button",class:"slds-text-body_small",disabled:t.isLoading,onClick:o[1]||(o[1]=d=>e.$emit("close-modal"))},{default:a(()=>[c(p(e.$Labels.MA_Cancel),1)]),_:1},8,["disabled"]),n(m,{"data-q3-id":"cancel-copy-submit-button",variant:"brand",class:"slds-text-body_small",disabled:t.isLoading||!t.selectedFolders.length,onClick:r.save},{default:a(()=>[c(p(e.$Labels.MA_Submit),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["title"])}const x=_(T,[["render",R]]);export{x as default};
