import{_ as v,O as T,r as n,o as h,c as O,h as b,i as a,S as x,b as C,e as F,P as V,a5 as A,t as y,F as k,$ as D,Z as N,l as B,f as $,w as m,j as L}from"../bundle.js";import{M as E}from"./Modal.76578f76.js";import{c as I,r as U}from"./index.0172543b.js";import{u as M}from"./index.d251dbc7.js";import{F as P}from"./FolderTree.c659e978.js";import{C as w}from"./ColorPicker.e47e828c.js";const G={components:{TextInput:T},props:["territory"],data(){return{v$:M()}},validations(){return{territory:{Name:{required:I.withMessage(this.$Labels.MA_Field_Req,U)}}}}},R={id:"info"},J={class:"slds-grid slds-wrap slds-grid--vertical"},q={class:"slds-size_1-of-1 slds-medium-size_3-of-4 slds-large-size_7-of-12"};function z(e,o,l,c,s,t){const r=n("TextInput");return h(),O("div",R,[b("div",J,[b("div",q,[a(r,{modelValue:s.v$.territory.Name.$model,"onUpdate:modelValue":o[0]||(o[0]=d=>s.v$.territory.Name.$model=d),labels:{name:e.$Labels.MA_Name},errors:e.$getErrorsByField(s.v$.territory.Name),required:""},null,8,["modelValue","labels","errors"]),a(r,{modelValue:l.territory.maps__Description__c,"onUpdate:modelValue":o[1]||(o[1]=d=>l.territory.maps__Description__c=d),labels:{name:e.$Labels.MA_Description},useTextArea:""},null,8,["modelValue","labels"])])])])}const K=v(G,[["render",z]]);const j={components:{Spinner:x,FolderTree:P},props:["selectedFolder","territory"],emits:["update:selectedFolder"],data(){return{isLoading:!1,selectedNode:""}},methods:{nodeSelected(e){this.territory.maps__Folder__c=e.id,this.$emit("update:selectedFolder",e)},removeSelected(){this.territory.maps__Folder__c=null,this.$emit("update:selectedFolder",null)}}},X={id:"SaveShapeTree"};function Y(e,o,l,c,s,t){const r=n("Spinner"),d=n("FolderTree");return h(),O("div",X,[s.isLoading?(h(),C(r,{key:0})):F("",!0),a(d,{hideUserFolders:"",onNodeSelected:t.nodeSelected,onNodeRemoved:t.removeSelected},null,8,["onNodeSelected","onNodeRemoved"])])}const H=v(j,[["render",Y],["__scopeId","data-v-da3ce49d"]]),Z={name:"SketchOptions",components:{TextInput:T,ColorPicker:w,Picklist:V,Checkbox:A},props:["shapeOptions"],data(){return{opacityOptions:[{label:"10%",value:"0.1"},{label:"20%",value:"0.2"},{label:"30%",value:"0.3"},{label:"40%",value:"0.4"},{label:"50%",value:"0.5"},{label:"60%",value:"0.6"},{label:"70%",value:"0.7"},{label:"80%",value:"0.8"},{label:"90%",value:"0.9"},{label:"100%",value:"1"}],justificationOptions:[{label:this.$Labels.ShapeLayer_Left,value:"left"},{label:this.$Labels.ShapeLayer_Center,value:"center"},{label:this.$Labels.ShapeLayer_Right,value:"right"}],fontOptions:[{label:"8px",value:"8px"},{label:"9px",value:"9px"},{label:"10px",value:"10px"},{label:"11px",value:"11px"},{label:"12px",value:"12px"},{label:"13px",value:"13px"},{label:"14px",value:"14px"},{label:"15px",value:"15px"},{label:"16px",value:"16px"},{label:"17px",value:"17px"},{label:"18px",value:"18px"}]}}},Q={class:"slds-text-heading_small"},W={class:"slds-grid slds-p-top_x-small"},ee={class:"slds-text-heading_small"},oe={class:"slds-grid slds-p-top_x-small"};function le(e,o,l,c,s,t){const r=n("ColorPicker"),d=n("Picklist"),u=n("Checkbox"),f=n("TextInput");return h(),O("div",null,[b("h2",Q,y(e.$Labels.TerritoryBuilder_Color_Selection),1),b("div",W,[a(r,{modelValue:l.shapeOptions.colorOptions.fillColor,"onUpdate:modelValue":o[0]||(o[0]=i=>l.shapeOptions.colorOptions.fillColor=i),labels:{chooseColor:e.$Labels.TerritoryBuilder_Fill_Color}},null,8,["modelValue","labels"]),a(r,{modelValue:l.shapeOptions.colorOptions.borderColor,"onUpdate:modelValue":o[1]||(o[1]=i=>l.shapeOptions.colorOptions.borderColor=i),labels:{chooseColor:e.$Labels.TerritoryBuilder_Border_Color},class:"slds-p-left_x-small"},null,8,["modelValue","labels"])]),a(d,{modelValue:l.shapeOptions.colorOptions.fillOpacity,"onUpdate:modelValue":o[2]||(o[2]=i=>l.shapeOptions.colorOptions.fillOpacity=i),options:s.opacityOptions,labels:{name:e.$Labels.MA_OPACITY},idKey:"value",titleKey:"label",class:"slds-m-bottom_small"},null,8,["modelValue","options","labels"]),b("h2",ee,y(e.$Labels.TerritoryBuilder_Label_Options),1),a(u,{modelValue:l.shapeOptions.colorOptions.labelEnabled,"onUpdate:modelValue":o[3]||(o[3]=i=>l.shapeOptions.colorOptions.labelEnabled=i),labels:{name:e.$Labels.TerritoryBuilder_Label_Enable},class:"flex-row slds-form-element slds-p-top_x-small"},null,8,["modelValue","labels"]),l.shapeOptions.colorOptions.labelEnabled?(h(),O(k,{key:0},[a(f,{modelValue:l.shapeOptions.colorOptions.labelOverride,"onUpdate:modelValue":o[4]||(o[4]=i=>l.shapeOptions.colorOptions.labelOverride=i),labels:{name:e.$Labels.TerritoryBuilder_Label_TextOverride},class:"slds-p-top_x-small"},null,8,["modelValue","labels"]),a(d,{modelValue:l.shapeOptions.colorOptions.labelJustification,"onUpdate:modelValue":o[5]||(o[5]=i=>l.shapeOptions.colorOptions.labelJustification=i),options:s.justificationOptions,labels:{name:e.$Labels.TerritoryBuilder_Label_Justification},idKey:"value",titleKey:"label",class:"slds-p-top_x-small"},null,8,["modelValue","options","labels"]),a(d,{modelValue:l.shapeOptions.colorOptions.labelFontSize,"onUpdate:modelValue":o[6]||(o[6]=i=>l.shapeOptions.colorOptions.labelFontSize=i),options:s.fontOptions,labels:{name:e.$Labels.TerritoryBuilder_Label_FontSize},idKey:"value",titleKey:"label",class:"slds-p-top_x-small"},null,8,["modelValue","options","labels"]),b("div",oe,[a(r,{modelValue:l.shapeOptions.colorOptions.labelFontColor,"onUpdate:modelValue":o[7]||(o[7]=i=>l.shapeOptions.colorOptions.labelFontColor=i),labels:{chooseColor:e.$Labels.TerritoryBuilder_Label_FontColor}},null,8,["modelValue","labels"]),a(r,{modelValue:l.shapeOptions.colorOptions.labelBGColor,"onUpdate:modelValue":o[8]||(o[8]=i=>l.shapeOptions.colorOptions.labelBGColor=i),labels:{chooseColor:e.$Labels.TerritoryBuilder_Label_BGColor},class:"slds-p-left_x-small"},null,8,["modelValue","labels"])])],64)):F("",!0)])}const se=v(Z,[["render",le]]),te={name:"SaveSketch",components:{Modal:E,Tabs:D,Tab:N,SLDSButton:B,Info:K,Folder:H,Options:se,Spinner:x},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],setup(){return{mainStore:$()}},data(){return{activeTabId:"sketch-folder-tree",isLoading:!1,infoDisabled:!1,folderDisabled:!1,optionsDisabled:!1,selectedFolder:null,territory:{Id:null,Name:"",maps__Description__c:"",maps__User__c:null,maps__Folder__c:null},shapeOptions:{advancedOptions:{calculateTerritoryAggregates:!1,dissolveGeometry:!0},colorOptions:{fillColor:"#3083D3",borderColor:"#16325C",fillOpacity:"0.2",labelEnabled:!1,labelOverride:"",labelJustification:"center",labelFontSize:"10px",labelFontColor:"#FFFFFF",labelBGColor:"#000000",labelBGOpacity:"0.3"},country:"USA"},isClone:!1,isSavedLayer:!1,isPlotted:!1,shapeData:[],isKML:!1}},computed:{saveText(){return this.isPlotted?this.$Labels.MA_SAVE_AND_REFRESH:this.$Labels.MA_SAVE_AND_PLOT}},async created(){this.isPlotted=this.modalOptions.isPlotted||!1,this.folderDisabled=this.modalOptions.folderDisabled,this.optionsDisabled=this.modalOptions.optionsDisabled,this.modalOptions?.territory?.Id&&(this.modalOptions.isClone||(this.folderDisabled=!0),this.isSavedLayer=!0,await this.getSavedShapeData(this.modalOptions.territory.Id)),this.modalOptions.kml&&(this.isKML=!0,this.optionsDisabled=!0,this.shapeData.push({isCustom:!0,id:this.modalOptions.kml,proximityType:"KML"})),this.modalOptions.isClone&&(this.territory.Name=`Copy of ${this.modalOptions.territory.Name}`,this.territory.maps__Folder__c=null),this.modalOptions.shapeData&&(this.shapeData=[],this.modalOptions.shapeData.forEach(e=>{this.shapeData.push(e)}))},methods:{saveAndPlot(){this.save(!0)},async getSavedShapeData(e){this.isLoading=!0;const o={ajaxResource:"TerritoryAJAXResources",action:"getTerritory",id:e};try{const{success:l,data:c}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[o]);if(!l){console.error(c),this.showError("Unable to retrieve saved shape data"),this.isLoading=!1;return}const{territory:s={}}=c;try{s.maps__Options__c=JSON.parse(s.maps__Options__c),this.shapeOptions.colorOptions={...this.shapeOptions.colorOptions,...s?.maps__Options__c?.colorOptions||{}}}catch{this.showError("Unable to load some options from this shape.  Some information will need to updated")}this.territory={...s},Array.isArray(s.maps__ShapeLayerGeometries__r?.records)&&s.maps__ShapeLayerGeometries__r?.records.forEach(t=>{try{const r=JSON.parse(t.maps__Geometry__c);this.shapeData.push(r)}catch{this.showError("Unable to build saved shapes data.  Some information may be lost")}})}catch(l){console.error(l),this.showError("Unable to retrieve saved shape data")}this.isLoading=!1},async save(e){let o,l,c;this.isLoading=!0;const s=this.$refs.infoTabContent.v$;if(await s.$touch(),s.$invalid){document.querySelector("#sketch-info__item").click(),this.isLoading=!1;return}if(this.isSavedLayer&&!this.modalOptions.isClone)c=this.territory.Id,l=this.territory.maps__Folder__c;else{if(!this.territory.maps__Folder__c){document.querySelector("#sketch-folder-tree__item").click(),this.showError("Please select a folder."),this.isLoading=!1;return}const p=this.selectedFolder.attributes.NodeType;if(p==="PersonalRoot")o=MAPS.currentUser.Id,l="";else if(p==="CorporateRoot"){if(!this.mainStore?.settings?.folders?.admin){document.querySelector("#sketch-folder-tree__item").click(),this.showError("You do not have permissions to save to this folder"),this.isLoading=!1;return}o="",l=""}else if(p==="CorporateFolder"){const _=this.selectedFolder.attributes.create==="true";if(!this.mainStore?.settings?.folders?.admin&&!_){this.showError("You do not have permissions to save to this folder"),this.isLoading=!1;return}l=this.selectedFolder.id}else l=this.selectedFolder.id}const{colorOptions:t}=this.shapeOptions,r={advancedOptions:{calculateTerritoryAggregates:!1,dissolveGeometry:!0},colorOptions:{fillColor:t.fillColor,borderColor:t.borderColor,fillOpacity:t.fillOpacity,labelEnabled:t.labelEnabled,labelOverride:t.labelOverride,labelJustification:t.labelJustification,labelFontSize:t.labelFontSize,labelFontColor:t.labelFontColor,labelBGColor:t.labelBGColor,labelBGOpacity:t.labelBGOpacity},country:"USA"},d=[];for(let p=0;p<this.shapeData.length;p++){const _=this.shapeData[p];d.push({Name:`${this.territory.Name}-geometry${p}`,maps__Geometry__c:JSON.stringify(_)})}const u={ajaxResource:"TerritoryAJAXResources",action:"saveBoundaryInfoV2",serializedTerritory:JSON.stringify({Id:c,Name:this.territory.Name,maps__Description__c:this.territory.maps__Description__c||"",maps__User__c:o,maps__Folder__c:l,maps__Options__c:JSON.stringify(r),maps__CustomGeometry__c:!0}),serializedGeometry:JSON.stringify(d)},{success:f,data:i}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[u]);f?(this.modalOptions.callback({plotOnSave:e===!0,name:this.territory.Name,description:this.territory.maps__Description__c,layerId:i.Id}),this.$emit("close-modal")):this.showError("Unable to save shape layer."),this.isLoading=!1},showError(e){this.mainStore.toast({message:e,state:"error"})}}},ae={id:"sketch-tabs",style:{height:"100%"}};function ie(e,o,l,c,s,t){const r=n("Spinner"),d=n("Info"),u=n("Tab"),f=n("Folder"),i=n("Options"),p=n("Tabs"),_=n("SLDSButton"),g=n("Modal");return h(),C(g,{id:"CustomShapePopup",title:"Create/Edit Custom Shape Layer",labels:{close:e.$Labels.MA_Close},isLoading:s.isLoading,onClose:o[2]||(o[2]=S=>e.$emit("close-modal"))},{content:m(()=>[s.isLoading?(h(),C(r,{key:0})):F("",!0),b("div",ae,[a(p,{vertical:"",class:"content"},{default:m(()=>[a(u,{id:"sketch-info",ref:"infoTab",renderImmediately:"",title:e.$Labels.MA_Info},{default:m(()=>[a(d,{ref:"infoTabContent",territory:s.territory},null,8,["territory"])]),_:1},8,["title"]),a(u,{id:"sketch-folder-tree",disabled:s.folderDisabled,title:e.$Labels.MA_Folder},{default:m(()=>[a(f,{selectedFolder:s.selectedFolder,"onUpdate:selectedFolder":o[0]||(o[0]=S=>s.selectedFolder=S),territory:s.territory},null,8,["selectedFolder","territory"])]),_:1},8,["disabled","title"]),a(u,{id:"sketch-options",disabled:s.optionsDisabled,title:e.$Labels.MA_Options},{default:m(()=>[a(i,{shapeOptions:s.shapeOptions},null,8,["shapeOptions"])]),_:1},8,["disabled","title"])]),_:1})])]),footer:m(()=>[a(_,{variant:"brand",class:"slds-text-body_small",disabled:s.isLoading,onClick:t.save},{default:m(()=>[L(y(e.$Labels.MA_Save),1)]),_:1},8,["disabled","onClick"]),a(_,{variant:"brand",class:"slds-text-body_small",disabled:s.isLoading,onClick:t.saveAndPlot},{default:m(()=>[L(y(t.saveText),1)]),_:1},8,["disabled","onClick"]),a(_,{variant:"neutral",class:"slds-text-body_small",disabled:s.isLoading,onClick:o[1]||(o[1]=S=>e.$emit("close-modal"))},{default:m(()=>[L(y(e.$Labels.MA_Cancel),1)]),_:1},8,["disabled"])]),_:1},8,["labels","isLoading"])}const ue=v(te,[["render",ie]]);export{ue as default};
