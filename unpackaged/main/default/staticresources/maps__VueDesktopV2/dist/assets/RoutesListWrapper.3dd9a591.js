import{_ as v,l as f,B as b,P as L,aO as S,aT as k,r as m,o as c,c as h,h as s,i as l,b as w,w as M,e as g,F as D,q as A,s as P,v as x,t as p,j as C,p as N,k as $}from"../bundle.js";import{P as I}from"./Popover.93a0feed.js";const B={name:"RouteListHeader",components:{SLDSButton:f,ButtonIcon:b,Popover:I,Picklist:L},emits:["open-new-route"],setup(){const e=S(),t=k();return{routeStore:e,scheduleStore:t}},data(){return{date:{},monthString:"",showDateWidget:!1,selectedMonth:String(this.routeStore.month),searchTerm:MAPS.currentUser.Name,dateChanged:!1,assetSearch:[{options:e=>new Promise(async t=>{const r=await this.getAssets({searchTerm:e});t(r)})}]}},computed:{togglePastRoutesLabel(){return this.routeStore.showPastRoutes?this.$Labels.MA_Hide_Past_Routes:this.$Labels.MA_Show_Past_Routes},monthAndYear(){const e=new Date(this.routeStore.year,this.routeStore.month);return this.$F("DateTime",e,{year:"numeric",month:"long",calendar:"gregory"})},months(){return[{key:"0",value:this.$Labels.MA_January},{key:"1",value:this.$Labels.MA_February},{key:"2",value:this.$Labels.MA_March},{key:"3",value:this.$Labels.MA_April},{key:"4",value:this.$Labels.MA_May},{key:"5",value:this.$Labels.MA_June},{key:"6",value:this.$Labels.MA_July},{key:"7",value:this.$Labels.MA_August},{key:"8",value:this.$Labels.MA_September},{key:"9",value:this.$Labels.MA_October},{key:"10",value:this.$Labels.MA_November},{key:"11",value:this.$Labels.MA_December}]},years(){return this.getYears()}},methods:{openNewRoute(){this.$emit("open-new-route")},async previousMonth(){let e=Number(this.routeStore.month)-1;if(e<0){e=11;const t=Number(this.routeStore.year)-1;this.updateYear({id:t})}this.updateMonth({key:e}),await this.routeStore.getRoutes()},async nextMonth(){let e=Number(this.routeStore.month)+1;if(e>11){e=0;const t=Number(this.routeStore.year)+1;this.updateYear({id:t})}this.updateMonth({key:e}),await this.routeStore.getRoutes()},getYears(){const e=[],t=new Date,r=t.getFullYear()-5,a=t.getFullYear()+5;for(let i=r;i<=a;i++)e.push(i);return e},updateMonth(e){this.routeStore.month=e.key,this.selectedMonth=String(e.key)},updateYear(e){this.routeStore.year=e.id},async todayClick(){const e=new Date;this.updateMonth({key:e.getMonth()}),this.updateYear({id:e.getFullYear()}),this.showDateWidget=!1,await this.routeStore.getRoutes()},async updateRouteList(){this.showDateWidget=!1,await this.routeStore.getRoutes()},async getAssets({searchTerm:e}){const t={ajaxResource:"WaypointAJAXResources",action:"getRouteUserOptions",roleIds:JSON.stringify(this.scheduleStore.subRoleIdsList),term:e,usersOnly:!1};try{const{success:r,data:a}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[t]);return r?a:(console.error(a),[])}catch(r){return console.error(r),[]}},async setAsset(e){const t=e?.fields||[],[r]=t;this.routeStore.asset={Id:e.id,Name:e.label,field:r.apiName,type:r.label},await this.routeStore.getRoutes()}}},H={id:"routesIndexHeader",class:"slds-border_bottom"},Y={class:"slds-p-top_small slds-p-bottom_small slds-p-horizontal_medium slds-grid"},O={class:"slds-col_bump-left"},F={class:"slds-p-horizontal_medium slds-p-bottom_x-small slds-grid"},T={class:"slds-button-group slds-p-right_xx-small prev-next-button-group"},V={class:"slds-p-top_large slds-grid slds-gutters"},z={class:"slds-grid slds-p-horizontal_large slds-gutters slds-p-top_small"},W={class:"slds-col_bump-left"};function U(e,t,r,a,i,o){const _=m("Picklist"),d=m("SLDSButton"),n=m("ButtonIcon"),y=m("Popover");return c(),h("div",H,[s("div",Y,[l(_,{modelValue:i.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=u=>i.searchTerm=u),inputAttrs:{id:"routeListHeaderSearchPicklistResource"},class:"slds-text-color_default slds-col slds-size_2-of-3",filterable:"",idKey:"id",labelForId:"",titleKey:"label",options:i.assetSearch,onSelectedOption:o.setAsset},null,8,["modelValue","options","onSelectedOption"]),s("div",O,[l(d,{id:"routeListHeaderNewBtnResource",label:e.$Labels.MA_New,iconCategory:"utility",iconName:"new",variant:"brand",onClick:o.openNewRoute},null,8,["label","onClick"])])]),s("div",F,[s("div",T,[l(n,{id:"routeListHeaderBackDateNavBtnResource",assistiveText:"Previous Month",iconCategory:"utility",iconName:"chevronleft",title:"Previous Month",onClick:o.previousMonth},null,8,["onClick"]),l(n,{id:"routeListHeaderForwardDateNavBtnResource",assistiveText:"Next Month",iconCategory:"utility",iconName:"chevronright",title:"Next Month",onClick:o.nextMonth},null,8,["onClick"])]),s("div",null,[l(d,{id:"routeListHeaderDatePickerResource",variant:"base",label:o.monthAndYear,onClick:t[1]||(t[1]=u=>i.showDateWidget=!0)},null,8,["label"]),i.showDateWidget?(c(),w(y,{key:0,id:"routeListHeaderPopoverDialogResource",width:"medium",closeOnClickOutside:"",alignment:"top",onClose:t[4]||(t[4]=u=>i.showDateWidget=!1)},{content:M(()=>[s("div",V,[l(_,{modelValue:i.selectedMonth,"onUpdate:modelValue":t[2]||(t[2]=u=>i.selectedMonth=u),inputAttrs:{id:"routeListHeaderPopoverMonthPicklistResource"},class:"slds-col slds-size_1-of-2",options:o.months,idKey:"key",resizeToFitContent:"",titleKey:"value",labelForId:"",onSelectedOption:o.updateMonth},null,8,["modelValue","options","onSelectedOption"]),l(_,{modelValue:a.routeStore.year,"onUpdate:modelValue":t[3]||(t[3]=u=>a.routeStore.year=u),inputAttrs:{id:"routeListHeaderPopoverYearPicklistResource"},options:o.years,class:"slds-col slds-size_1-of-2",resizeToFitContent:"",labelForId:"",onSelectedOption:o.updateYear},null,8,["modelValue","options","onSelectedOption"])]),s("div",z,[l(d,{id:"routeListHeaderPopoverThisMonthBtnResource",label:e.$Labels.MA_This_Month,class:"slds-col slds-size_1-of-2",onClick:o.todayClick},null,8,["label","onClick"]),l(d,{id:"routeListHeaderPopoverDoneBtnResource",label:e.$Labels.MA_Done,class:"slds-col slds-size_1-of-2",variant:"brand",onClick:o.updateRouteList},null,8,["label","onClick"])])]),_:1})):g("",!0)]),s("div",W,[l(d,{id:"routeListHeaderPastRoutesResource",label:o.togglePastRoutesLabel,variant:"base",onClick:t[5]||(t[5]=u=>a.routeStore.showPastRoutes=!a.routeStore.showPastRoutes)},null,8,["label"])])])])}const J=v(B,[["render",U],["__scopeId","data-v-bba2d811"]]),E=""+MAPS.getURLPath({base:"/resource/1730379547462/maps__VueDesktopV2/dist/",path:"assets/routes-empty-state.c78cd3ee.svg"});const K={name:"RouteList",components:{RouteListHeader:J,ButtonIcon:b},emits:["open-new-route","load-panel"],setup(){return{routesStore:S()}},computed:{currentDate(){const e=new Date;return{date:e.getDate(),month:e.getMonth(),year:e.getFullYear()}}},created(){this.$emit("load-panel")},async mounted(){await this.routesStore.getRoutes()},methods:{confirmDeleteRoute(e){this.$bus.emit("open-modal",{name:"generic-confirm",config:{title:this.$Labels.MA_Delete_Route,textContent:this.$Labels.MA_Delete_Route_Confirm,noLabel:this.$Labels.MA_Cancel,yesLabel:this.$Labels.MA_Delete,callback:()=>{this.deleteRoute(e)}}})},formatLabel(e,t={}){return Object.keys(t).forEach(r=>e=e.replace(new RegExp(`\\{${r}\\}`,"g"),t[r])),e},async deleteRoute(e){try{this.routesStore.callouts++,await this.routesStore.deleteRoute(e)}catch(t){console.warn(t)}finally{this.routesStore.callouts--}},showRoute(e){return this.routesStore.showPastRoutes?!0:this.routesStore.year===this.currentDate.year&&this.routesStore.month===this.currentDate.month&&e<this.currentDate.date?!1:this.routesStore.year>=this.currentDate.year&&this.routesStore.month>this.currentDate.month?!0:!(this.routesStore.month<this.currentDate.month)},async displayRoute(e){await this.routesStore.getRoute(e),this.routesStore.showRouteList=!1}}},R=e=>(N("data-v-c6f92f23"),e=e(),$(),e),j={id:"routesIndexWrapper"},q={id:"routesIndexBody"},X={id:"routesIndexList"},G=["onClick"],Q={class:"routes-index-list-item-date slds-col slds-grow-none slds-p-horizontal_large slds-size_1-of-12"},Z=R(()=>s("div",{class:"routes-index-list-item-date-image"},null,-1)),ee={class:"routes-index-list-item-date-number"},te={class:"slds-p-left_medium",style:{"min-width":"0"}},se={class:"routes-index-list-item-title"},oe={class:"routes-index-list-item-description"},re={key:0},ie={class:"routes-index-list-item-overflow-actions slds-col slds-col_bump-left",style:{"text-align":"center"}},le={key:0,class:"no-routes routesIndexEmptyState"},ae={class:"slds-notify_container--inline slds-p-around--large slds-text-align--center"},ne=R(()=>s("figure",{class:"slds-m-bottom--large"},[s("img",{src:E})],-1));function ue(e,t,r,a,i,o){const _=m("RouteListHeader"),d=m("ButtonIcon");return c(),h("div",j,[l(_,{id:"routeListHeaderResource",onOpenNewRoute:t[0]||(t[0]=n=>e.$emit("open-new-route"))}),s("div",q,[s("div",X,[(c(!0),h(D,null,A(a.routesStore.routes,(n,y)=>P((c(),h("div",{key:n.routeId,class:"routes-index-list-item slds-grid slds-grid_vertical-align-center"},[s("div",{class:"routes-index-list-item-click-area slds-grid slds-grid_vertical-align-center slds-col slds-col_bump-right slds-p-vertical_small",onClick:u=>o.displayRoute(n.routeId)},[s("div",Q,[Z,s("div",ee,p(n.day),1)]),s("div",te,[s("div",se,p(n.route.Name),1),s("div",oe,[C(p(o.formatLabel(e.$Labels.MA_NumOfStops,{0:n.waypoints.length}))+" ",1),n.guideGeneratedRoute?(c(),h("span",re," - "+p(e.$Labels.routes_Maps_Advanced),1)):g("",!0)])]),l(d,{id:`routesPanelDisplay-${y}-RouteBtnResource`,assistiveText:"Display Route",iconCategory:"utility",class:"slds-col_bump-left slds-p-horizontal_large",iconName:"chevronright",title:"Display Route"},null,8,["id"])],8,G),s("div",ie,[l(d,{id:"routesPanelDeleteRouteBtnResource",assistiveText:"Delete Route",iconCategory:"utility",iconName:"delete",title:"Delete",onClick:u=>o.confirmDeleteRoute(n.routeId)},null,8,["onClick"])])])),[[x,o.showRoute(n.day)]])),128)),a.routesStore.routes.length===0?(c(),h("div",le,[s("div",ae,[ne,s("h4",null,p(e.$Labels.routes_Nothing_Planned),1)])])):g("",!0)])])])}const he=v(K,[["render",ue],["__scopeId","data-v-c6f92f23"]]);export{he as default};
