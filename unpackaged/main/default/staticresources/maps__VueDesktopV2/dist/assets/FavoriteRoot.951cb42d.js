import{_ as F,l as R,S,O as C,P,f as B,g as V,be as y,L as $,bl as N,r as d,o as h,b as g,w as v,e as O,i as _,h as U,j as L,t as A}from"../bundle.js";import{C as w}from"./ColorPicker.e47e828c.js";import{M as I}from"./Modal.76578f76.js";import{R as q}from"./ButtonGroup.2e921f3c.js";import{c as k,r as b,m as x,e as D}from"./index.0172543b.js";import{u as T}from"./index.d251dbc7.js";import"./Radio.2202254f.js";const E={name:"SaveFavorite",components:{Modal:I,SLDSButton:R,Spinner:S,TextInput:C,ColorPicker:w,RadioButtonGroup:q,Picklist:P},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],setup(){const e=B(),t=V();return{mainStore:e,layersStore:t}},data(){return{isSavedFavorite:!1,favorite:{Id:"",maps__Address__c:"",maps__Description__c:"",maps__FavoriteMarker__c:"",maps__Latitude__c:"",maps__AddressFields__c:"",maps__Longitude__c:"",maps__User__c:"",Name:"",maps__MapsFolder__c:""},markerTypeOptions:[{label:this.$Labels.markerStylePicker_RadioButtonGroup_MLB_Preset,value:"preset"},{label:this.$Labels.markerStylePicker_RadioButtonGroup_MLB_Custom,value:"custom"}],v$:T(),isLoading:!1,location:{lat:"",lng:""},googleResults:[],marker:{type:"preset",hex:"#46E71B",img:""},customMarkers:[],picklistVisible:!1,title:"",searchOptions:[{options:e=>y({term:e,excludeType:"query"})}]}},computed:{isCustom:{get(){return this.marker.type==="custom"}}},validations(){const e={favorite:{Name:{required:k.withMessage(this.$Labels.MA_Field_Req,b),maxLength:k.withMessage(this.$Labels.MA_Max_Length_80_Name,x(80))},maps__Address__c:{required:k.withMessage(this.$Labels.Error_Enter_Address,b)}}};return this.isCustom?e.marker={img:{required:k.withMessage(this.$Labels.MA_Field_Req,b)}}:e.marker={hex:{required:b,minLength:D(7)}},e},async created(){if(this.isLoading=!0,this.modalOptions.favoriteId)try{this.isSavedFavorite=!0,await this.getFavorite()}catch(e){console.error(e)}else this.title=this.$Labels.modal_Favorite_Create_Favorite;await this.getCustomMarker(),this.isLoading=!1},methods:{async getFavorite(){this.title=this.$Labels.modal_Favorite_Edit_Favorite;const e={action:"getLocationInfo",ajaxResource:"FavoriteLocationsAJAXResources",folderId:this.modalOptions.favoriteId},{success:t,data:o}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[e]);if(t){const{locations:a=[]}=o,[s]=a;if(s){const{maps__Address__c:l="",maps__Description__c:c="",maps__FavoriteMarker__c:i="",maps__Latitude__c:m="",maps__Longitude__c:p="",maps__User__c:u="",Name:n="",Id:f="",maps__MapsFolder__c:r="",maps__AddressFields__c:M="{}"}=s;this.favorite.maps__Address__c=l,this.favorite.maps__Description__c=c,this.favorite.maps__FavoriteMarker__c=i,this.favorite.maps__Latitude__c=m,this.favorite.maps__Longitude__c=p,this.favorite.maps__User__c=u,this.favorite.Name=n,this.favorite.Id=f,this.favorite.maps__MapsFolder__c=r,this.favorite.maps__AddressFields__c=M,i.indexOf("#")>-1?(this.marker.type="preset",this.marker.hex=i):(this.marker.type="custom",this.marker.img=i.replace("image:",""))}else this.showError("Unable to get this favorite location.")}},async getCustomMarker(){const e={action:"getImageOptions",ajaxResource:"FavoriteLocationsAJAXResources"},{success:t,data:o}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[e]);t&&(o.length>0?this.customMarkers=o.map(a=>({label:a.itemLabel,id:a.itemValue})):this.customMarkers=[{label:this.$Labels.modal_Favorite_No_Marker_Available,id:null}])},async save(e){if(this.v$.$touch(),this.v$.$invalid){this.showError(`${this.$Labels.Almost_There} ${this.$Labels.modal_Favorite_All_Validation}`);return}if(this.isLoading=!0,!this.isSavedFavorite){const o=this.layersStore?.currentFolder?.id;o==="home"||(o==="PersonalRoot"||o==="RoleUserFolder")?(this.favorite.maps__User__c=MAPS.currentUser.Id,this.favorite.maps__MapsFolder__c=""):o==="CorporateRoot"?(this.favorite.maps__User__c="",this.favorite.maps__MapsFolder__c=""):this.favorite.maps__MapsFolder__c=o}this.marker.type==="custom"?this.favorite.maps__FavoriteMarker__c=`image:${this.marker.img}`:this.favorite.maps__FavoriteMarker__c=this.marker.hex,this.favorite.Id===""&&delete this.favorite.Id;const t={action:"createFavoriteLocationMainTree",ajaxResource:"FavoriteLocationsAJAXResources",serializedLocation:JSON.stringify(this.favorite)};try{const{success:o,data:a}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[t]);o?(this.mainStore.toast({message:this.$Labels.MA_Success}),this.$emit("close-modal"),this.modalOptions.callback({plot:e,favorite:{id:a.Id,name:this.favorite.Name,description:this.favorite.maps__Description__c}}),$.trackFeature({logPayload:{featureName:"favorite_layer_created"}})):(console.error(a),this.showError("Unable to save favorite"))}catch(o){console.error(o),this.showError("Unable to save favorite")}this.isLoading=!1},saveAndPlot(){this.save(!0)},showError(e){this.mainStore.toast({message:e,state:"error"})},async updateSearch(e){const{id:t,href:o}=e,[a]=await y({id:t,href:o}),{poi:s}=a,{address:l,addressFields:c}=N({items:[s]}),{street:i="",city:m="",state:p="",zipCode:u="",countryCode:n=""}=c;this.isLoading=!0,this.favorite.maps__Address__c=l;try{this.favorite.maps__AddressFields__c=JSON.stringify({BillingStreet:i,BillingCity:m,BillingState:p,BillingPostalCode:u,Billingcountry:n}),this.favorite.maps__Latitude__c=s.position.lat,this.favorite.maps__Longitude__c=s.position.lng}catch{this.showError("Unabled to get address information")}this.isLoading=!1}}},J={class:"slds-grid"};function G(e,t,o,a,s,l){const c=d("Spinner"),i=d("TextInput"),m=d("Picklist"),p=d("RadioButtonGroup"),u=d("ColorPicker"),n=d("SLDSButton"),f=d("Modal");return h(),g(f,{id:"FavoriteModal",title:s.title,labels:{close:e.$Labels.MA_Close},onClose:t[8]||(t[8]=r=>e.$emit("close-modal"))},{content:v(()=>[s.isLoading?(h(),g(c,{key:0})):O("",!0),_(i,{modelValue:s.v$.favorite.Name.$model,"onUpdate:modelValue":t[0]||(t[0]=r=>s.v$.favorite.Name.$model=r),inputAttrs:{id:"flNameResource","data-test-id":"flNameResource"},labels:{name:e.$Labels.modal_Favorite_Name},errors:e.$getErrorsByField(s.v$.favorite.Name),required:""},null,8,["modelValue","labels","errors"]),_(m,{modelValue:s.v$.favorite.maps__Address__c.$model,"onUpdate:modelValue":t[1]||(t[1]=r=>s.v$.favorite.maps__Address__c.$model=r),inputAttrs:{id:"flAddressPicklistResource","data-test-id":"flAddressPicklistResource"},required:"","data-test-id":"flAddressPicklistResource",errors:e.$getErrorsByField(s.v$.favorite.maps__Address__c),filterable:"",titleKey:"longTitle",idKey:"id",options:s.searchOptions,labels:{name:e.$Labels.modal_Favorite_Address},onSelectedOption:l.updateSearch},null,8,["modelValue","errors","options","labels","onSelectedOption"]),_(i,{modelValue:s.favorite.maps__Description__c,"onUpdate:modelValue":t[2]||(t[2]=r=>s.favorite.maps__Description__c=r),inputAttrs:{id:"flDescriptionResource","data-test-id":"flDescriptionResource"},labels:{name:e.$Labels.modal_Favorite_Description},useTextArea:""},null,8,["modelValue","labels"]),U("div",J,[_(p,{id:"flMarkerTypeResource",modelValue:s.marker.type,"onUpdate:modelValue":t[3]||(t[3]=r=>s.marker.type=r),inputAttrs:{"data-test-id":"flMarkerTypeResource"},options:s.markerTypeOptions,labels:{name:e.$Labels.markerStylePicker_RadioButtonGroup_MLB_MarkerType},class:"slds-grow-none slds-p-right_small"},null,8,["modelValue","options","labels"]),s.marker.type==="preset"?(h(),g(u,{key:0,modelValue:s.marker.hex,"onUpdate:modelValue":t[4]||(t[4]=r=>s.marker.hex=r),"data-test-id":"flColorInputResource",required:"",labels:{chooseColor:"Marker Color"}},null,8,["modelValue"])):(h(),g(m,{key:1,modelValue:s.marker.img,"onUpdate:modelValue":t[5]||(t[5]=r=>s.marker.img=r),"data-test-id":"flImagePicklistResource",labels:{name:e.$Labels.modal_MLB_option_DO_section_Markers_modal_Custom_Marker_Image_Picklist_Label},options:s.customMarkers,errors:e.$getErrorsByField(s.v$.marker.img),required:"",titleKey:"label",idKey:"id"},null,8,["modelValue","labels","options","errors"]))])]),footer:v(()=>[_(n,{id:"flCancelBtnResource",variant:"neutral",class:"slds-text-body_small",disabled:s.isLoading,onClick:t[6]||(t[6]=r=>e.$emit("close-modal"))},{default:v(()=>[L(A(e.$Labels.MA_Cancel),1)]),_:1},8,["disabled"]),_(n,{id:"flSaveBtnResource",variant:"brand",class:"slds-text-body_small",disabled:s.isLoading,onClick:t[7]||(t[7]=r=>l.save(!1))},{default:v(()=>[L(A(e.$Labels.MA_Save),1)]),_:1},8,["disabled"]),_(n,{id:"flSaveAndPlotBtnResource",variant:"brand",class:"slds-text-body_small",disabled:s.isLoading,onClick:l.saveAndPlot},{default:v(()=>[L(A(e.$Labels.MA_SAVE_AND_PLOT),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["title","labels"])}const Y=F(E,[["render",G]]);export{Y as default};
