(function(){"use strict";const I=(e,s)=>{const{queryData:r={}}=s,{options:t={},addressFields:a={}}=r;return e.baseObjectId=t.baseObjectId,e.baseObjectLabel=t.baseObjectLabel,e.supportsActivities=t.supportsActivities,e.addressObject=t.addressObject,e.addressFields=a,e.prioritySettings={priorityField:t.priorityField||"",priorityValue:0,priorityFieldType:t.priorityFieldType||"",priorityLabel:t.priorityLabel||"",priorityType:t.priorityType||""},e},k=({layerId:e,layerType:s,feature:r={},oidField:t,plottedLayer:a={},translations:p={}})=>{const c={...{MA_NA:"N/A"},...p},{attributes:i={}}=r;let d=r?.geometry?.y||r?.geometry?.latitude,u=r?.geometry?.x||r?.geometry?.longitude;a?.type==="polyline"&&(d=i.anchorLat,u=i.anchorLng);let o={title:i?.title??c.MA_NA,layerType:s,layerId:e,uniqueMarkerIdentifier:i?.[t]||"",lat:d,lng:u,attributes:i,linkId:"",savedQueryId:i?.sfLayerId||"",address:i?.address??`Lat: ${Number(d).toFixed(5)}, Lng: ${Number(u).toFixed(5)}`};return s==="sfMarkerLayer"||s==="navigationLayer"?(o=I(o,a),o.linkId=i?.objectId):s==="favorite"?(o.layerId=i?.layerId??"",o.linkId=i?.linkId??"",o.uniqueMarkerIdentifier=i?.layerId):s==="esriLayer"?o.title=`${t} ${i[t]}`||c.MA_NA:s==="myPosition"?o.title=r?.title||c?.MA_NA:s==="poiLayer"&&(o.placeId=i?.id),o},L=()=>{function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`},A=({layerMap:e,shapeData:s,proximityType:r,isMapIt:t=!1})=>{const a=[];let l=[];const c=Object.keys(e);for(let i=0;i<c.length;i++){const d=c[i],u=e[d],{features:o}=u;for(let y=0;y<o.length;y++){const n=o[y],{lat:h,lng:m}=n,f=L(),g={...s};g.proximityType=r,g.center={lat:h,lng:m};const M={id:f,qid:f,type:r,name:"",description:"",component:"BoundaryLayer",automaticRefresh:0,refreshInterval:0,shapeData:g,isSketch:!0,isMapIt:t,isEditMode:!1};l.push(M),l.length===50&&(a.push(l),l=[])}}return l.length>0&&(a.push(l),l=[]),a},b=(e,...s)=>{if(!e)throw new TypeError("reply - takes at least one argument");postMessage({queryMethodListener:e,queryMethodArguments:s})},$={loadScripts:({scripts:e})=>{Object.values(e).forEach(s=>{self.importScripts(s)}),b("scripts done")},processFeatures:({layerArray:e=[],translations:s})=>{const r={};for(let t=0;t<e.length;t++){const a=e[t],p=JSON.parse(a?.plottedLayer||"{}"),{features:l,layerId:c,layerType:i,oidField:d}=a;r[a.layerId]={features:[],type:i};const u=p?.type==="polyline",o=new Set;for(let y=0;y<l.length;y++){const n=l[y],h=k({layerId:c,layerType:i,feature:n,oidField:d,plottedLayer:p,translations:s});if(u){const{attributes:m}=n,{objectId:f}=m;o.has(f)||(r[a.layerId].features.push(h),o.add(f))}else r[a.layerId].features.push(h)}}b("processedFeatures",r)},formatFeautesForEdits:({layerMap:e})=>{const s=Object.keys(e),r=[];for(let t=0;t<s.length;t++){const a=s[t],p=new Map,l=e[a],{features:c,type:i}=l,d=[];for(let u=0;u<c.length;u++){const o=c[u],{uniqueMarkerIdentifier:y,linkId:n}=o;d.push({objectId:y,linkId:n}),p.set(n||y,y)}r.push({type:i,editsArray:d,layerUID:a,featureMap:p})}b("processedFeatureEdits",{featureEdits:r})},buildProximityCenterArray:({layerMap:e,shapeData:s,proximityType:r,isMapIt:t=!1})=>{const a=A({layerMap:e,shapeData:s,proximityType:r,isMapIt:t});b("proximityCenterArray",a)},processEmailRecords:({layerMap:e,personAccountData:s})=>{const r=new Set,t=Object.keys(e),a=new Map;let p=0;for(let l=0;l<t.length;l++){const c=t[l],i=e[c],{features:d,type:u}=i;if(u==="sfMarkerLayer")for(let o=0;o<d.length;o++){const y=d[o],{linkId:n}=y;if(r.has(n))p++;else{r.add(n);const h=n.substring(0,3),m="";let f=`/_ui/core/email/author/EmailAuthor?p2_lkid=${n}&rtype=${h}&retURL=%2F${n}`;["003","00Q"].includes(h)||(s.enabled&&h==="001"&&m===s.recordTypeId?f=`/_ui/core/email/author/EmailAuthor?p2_lkid=${n}&p3_lkid=${n}&retURL=%2F${n}`:f=`/_ui/core/email/author/EmailAuthor?p3_lkid=${n}&retURL=%2F${n}`),a.set(n,f)}}}b("finishedEmailRecords",{totalDuplicates:p,recordEmailMap:a})}},F=e=>{console.log("direct",e)};onmessage=e=>{e.data instanceof Object&&Object.hasOwn(e.data,"queryMethod")&&Object.hasOwn(e.data,"queryMethodArguments")?$[e.data.queryMethod].apply(self,e.data.queryMethodArguments):F(e.data)}})();
