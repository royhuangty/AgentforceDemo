import{_ as D,P as C,g as O,bJ as F,r as c,o as r,c as f,i as p,h as o,s as A,v as k,t as u,F as E,q as U,d as L,a as I,l as $,$ as B,Z as j,S as q,bK as P,b6 as w,bL as R,bM as z,b as m,w as d,e as y,j as _}from"../bundle.js";import{M as K}from"./Modal.76578f76.js";import{u as S}from"./index.d251dbc7.js";import{R as G}from"./ButtonGroup.2e921f3c.js";import{c as x,r as H}from"./index.0172543b.js";import"./Radio.2202254f.js";const J={name:"NewActivityAssignTo",components:{RadioButtonGroup:G,Picklist:C},props:{activityType:{type:String,default:"task"},assignType:{type:String,required:!0},layers:{type:Array,required:!0}},emits:["user-selected","update:assignType"],setup(){return{layersStore:O()}},validations(){const e={assignToId:{}};return this.localType==="static"&&(e.assignToId={required:x.withMessage(this.$Labels.MA_Field_Req,H)}),e},data(){return{v$:S({$registerAs:"assignTo"}),localType:"static",typeOptions:[{label:this.$Labels.MA_Static,value:"static"},{label:this.$Labels.MA_DYNAMIC,value:"dynamic"}],searchOptions:[{options:e=>new Promise(async s=>{const i=await F(e);s(i)})}],assignToId:"",dynamicField:""}},computed:{activityLabel(){return this.activityType==="task"?this.$Labels.MA_Task_Owner:this.$Labels.MA_Event_Owner}},watch:{assignType(e){e==="dynamic"&&this.emitAssignedData()},localType(e){this.$emit("update:assignType",e)}},methods:{setUserIdSelection(e){const s=e?e.Id:"";this.layers.forEach(i=>{i.ownerId=s}),this.emitAssignedData()},emitAssignedData(){this.$emit("user-selected",{type:this.assignType})}}},W={class:"slds-p-horizontal_small"},Y={class:"slds-border_top slds-m-top_small slds-p-top_small"},Z={class:"slds-grid slds-grid_vertical"},Q={class:"slds-grid slds-gutters slds-table slds-table_cell-buffer slds-table_bordered",style:{"background-color":"#f3f3f3"}},X={class:"slds-col slds-size_2-of-6"},ee={class:"slds-col slds-size_2-of-6"},se={class:"slds-col slds-size_2-of-6"},te={class:"slds-col slds-size_2-of-6"},ie={class:"slds-col slds-size_2-of-6"},ae={class:"slds-col slds-size_2-of-6"};function le(e,s,i,h,t,a){const T=c("RadioButtonGroup"),v=c("Picklist");return r(),f("div",W,[p(T,{modelValue:t.localType,"onUpdate:modelValue":s[0]||(s[0]=l=>t.localType=l),labels:{name:""},options:t.typeOptions},null,8,["modelValue","options"]),o("div",Y,[A(o("div",null,[p(v,{modelValue:t.v$.assignToId.$model,"onUpdate:modelValue":s[1]||(s[1]=l=>t.v$.assignToId.$model=l),required:"",filterable:"",options:t.searchOptions,titleKey:"Name",idKey:"Id",labels:{name:"Assign To"},errors:e.$getErrorsByField(t.v$.assignToId),onSelectedOption:a.setUserIdSelection,onClear:a.setUserIdSelection},null,8,["modelValue","options","errors","onSelectedOption","onClear"])],512),[[k,i.assignType==="static"]]),A(o("div",null,[o("div",Z,[o("div",Q,[o("div",X,u(e.$Labels.MA_Name),1),o("div",ee,u(e.$Labels.MA_Base_Object),1),o("div",se,u(a.activityLabel),1)]),(r(!0),f(E,null,U(i.layers,l=>(r(),f("div",{key:l.uid,class:"slds-grid slds-grid_vertical-align-center slds-border_bottom slds-gutters slds-p-vertical_xx-small"},[o("div",te,u(l.name),1),o("div",ie,u(l.baseObject),1),o("div",ae,[p(v,{modelValue:l.ownerField,"onUpdate:modelValue":g=>l.ownerField=g,required:"",options:l.fields,titleKey:"label",labelForId:"noId",idKey:"value",onSelectedOption:a.emitAssignedData},null,8,["modelValue","onUpdate:modelValue","options","onSelectedOption"])])]))),128))])],512),[[k,i.assignType==="dynamic"]])])])}const oe=D(J,[["render",le]]),ne=L(()=>I(()=>import("./TaskDetails.c62e9854.js"),[MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/TaskDetails.c62e9854.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "bundle.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/main.feeda730.css" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/DatePicker.899772b4.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/index.0172543b.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/index.d251dbc7.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/TaskDetails.c4406029.css" })],import.meta.url)),de=L(()=>I(()=>import("./EventDetails.297b5ecb.js"),[MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/EventDetails.297b5ecb.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "bundle.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/main.feeda730.css" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/DatePicker.899772b4.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/TimePicker.bfa4e2f9.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/index.0172543b.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/index.d251dbc7.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/EventDetails.98f8da31.css" })],import.meta.url)),re={name:"NewActivityModal",components:{Modal:K,SLDSButton:$,Tabs:B,Tab:j,Spinner:q,AssignTo:oe,TaskDetails:ne,EventDetails:de},props:{modalOptions:{type:Object,default:()=>{}}},emits:["close-modal"],setup(){return{v$:S()}},data(){return{isLoading:!1,activeTabId:"NewActivityAssignTo",assignType:"static",details:{subject:"",date:null,time:null,endDate:null,endTime:null,comments:""},layers:[],activityType:"",totalFeatures:0}},computed:{activityTitle(){return this.activityType==="task"?this.$Labels.MA_New_Task:this.$Labels.MA_New_Event}},async created(){this.isLoading=!0;const{activityType:e,totalFeatures:s}=this.modalOptions;if(this.activityType=e,this.totalFeatures=s,this.activityType==="event"){const i=new Date;this.details.date=new Date,this.details.time={hours:i.getHours(),minutes:i.getMinutes()},this.details.endDate=new Date,this.details.endTime={hours:i.getHours()+1,minutes:i.getMinutes()}}await this.processUserFields(),this.isLoading=!1},methods:{async processUserFields(){const{baseObjects:e=[],layers:s={}}=this.modalOptions,i=await P({baseObjects:e,layers:s});this.layers=i},save(){if(this.v$.$touch(),this.v$.$invalid)return;const e={layers:this.layers,assignType:this.assignType,activityType:this.activityType};if(this.activityType==="event"){const s=w({hour:this.details.time.hours,minute:this.details.time.minutes,hour12:!0}),i=w({hour:this.details.endTime.hours,minute:this.details.endTime.minutes,hour12:!0});e.details={subject:this.details.subject,startDate:`${this.$F("DateTime",this.details.date)}, ${s}`,endDate:`${this.$F("DateTime",this.details.endDate)}, ${i}`,description:this.details.comments}}else e.details={subject:this.details.subject,dueDate:this.$F("DateTime",this.details.date),description:this.details.comments};R(e),this.$emit("close-modal")},step1Valid(){let e=!0;try{this.v$.assignTo.$touch(),this.v$.assignTo.$invalid&&(e=!1)}catch{}return e},moveToStep2(){this.step1Valid()&&(this.activeTabId=this.activityType==="task"?"NewTaskDeatils":"NewEventDeatils")},validateTab(){let e=!0;return this.activeTabId==="NewActivityAssignTo"&&(e=this.step1Valid()),e},openInClassic(){const{layers:e}=this.modalOptions;let s;for(let i=0;i<e.length&&!s;i++){const h=e[i],{features:t=[]}=h;for(let a=0;a<t.length;a++){const T=t[a],{linkId:v}=T;if(s=v,s)break}}s&&(z(s,this.activityType),this.$emit("close-modal"))}}},ce={class:"slds-grid"},ue={class:"slds-col_bump-left"};function pe(e,s,i,h,t,a){const T=c("Spinner"),v=c("AssignTo"),l=c("Tab"),g=c("TaskDetails"),N=c("EventDetails"),M=c("Tabs"),b=c("SLDSButton"),V=c("Modal");return r(),m(V,{id:"CustomShapePopup",title:a.activityTitle,labels:{close:e.$Labels.MA_Close},isLoading:t.isLoading,size:"small",onClose:s[7]||(s[7]=n=>e.$emit("close-modal"))},{content:d(()=>[t.isLoading?(r(),m(T,{key:0})):y("",!0),p(M,{modelValue:t.activeTabId,"onUpdate:modelValue":s[4]||(s[4]=n=>t.activeTabId=n),vertical:"",onRequestTabChange:a.validateTab},{default:d(()=>[p(l,{id:"NewActivityAssignTo",title:"Assign To"},{default:d(()=>[p(v,{assignType:t.assignType,"onUpdate:assignType":s[0]||(s[0]=n=>t.assignType=n),layers:t.layers,"onUpdate:layers":s[1]||(s[1]=n=>t.layers=n),activityType:t.activityType},null,8,["assignType","layers","activityType"])]),_:1}),t.activityType==="task"?(r(),m(l,{key:0,id:"NewTaskDeatils",title:"Task Details"},{default:d(()=>[p(g,{details:t.details,"onUpdate:details":s[2]||(s[2]=n=>t.details=n)},null,8,["details"])]),_:1})):y("",!0),t.activityType==="event"?(r(),m(l,{key:1,id:"NewEventDeatils",title:"Event Details"},{default:d(()=>[p(N,{details:t.details,"onUpdate:details":s[3]||(s[3]=n=>t.details=n)},null,8,["details"])]),_:1})):y("",!0)]),_:1},8,["modelValue","onRequestTabChange"])]),footer:d(()=>[o("div",ce,[t.totalFeatures===1?(r(),m(b,{key:0,disabled:t.isLoading,variant:"neutral",title:"Open in Salesforce",iconCategory:"utility",iconName:"new_window",iconPosition:"right",onClick:a.openInClassic},{default:d(()=>[_(u(e.$Labels.MA_ViewInSalesforce),1)]),_:1},8,["disabled","onClick"])):y("",!0),o("div",ue,[p(b,{variant:"neutral",class:"slds-text-body_small",disabled:t.isLoading,onClick:s[5]||(s[5]=n=>e.$emit("close-modal"))},{default:d(()=>[_(u(e.$Labels.MA_Close),1)]),_:1},8,["disabled"]),t.activeTabId==="NewActivityAssignTo"?(r(),m(b,{key:0,variant:"brand",class:"slds-text-body_small",disabled:t.isLoading,onClick:a.moveToStep2},{default:d(()=>[_(u(e.$Labels.MA_Next),1)]),_:1},8,["disabled","onClick"])):y("",!0),t.activeTabId==="NewTaskDeatils"||t.activeTabId==="NewEventDeatils"?(r(),m(b,{key:1,variant:"brand",class:"slds-text-body_small",disabled:t.isLoading,onClick:s[6]||(s[6]=n=>t.activeTabId="NewActivityAssignTo")},{default:d(()=>[_(u(e.$Labels.MA_Back),1)]),_:1},8,["disabled"])):y("",!0),t.activeTabId==="NewTaskDeatils"||t.activeTabId==="NewEventDeatils"?(r(),m(b,{key:2,variant:"brand",class:"slds-text-body_small",disabled:t.isLoading,onClick:a.save},{default:d(()=>[_(u(e.$Labels.MA_Add_Close),1)]),_:1},8,["disabled","onClick"])):y("",!0)])])]),_:1},8,["title","labels","isLoading"])}const he=D(re,[["render",pe]]);export{he as default};
