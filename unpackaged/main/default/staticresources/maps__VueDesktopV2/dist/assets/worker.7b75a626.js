(function(){"use strict";const h=()=>{function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`},D=({eventData:e,locale:o,timeZone:i="UTC",defaultSettings:c})=>{if(!e||!e.StartDateTime||!e.EndDateTime)return c;const _=new Intl.DateTimeFormat(o,{timeZone:i,hour:"numeric",minute:"numeric"}),s=e.StartDateTime,t=e.EndDateTime,a=new Date(s),r=new Date(t);let n;if(e.IsAllDayEvent)n="12:00 am";else try{n=_.format(a)}catch{n="12:00 am"}const d=e.DurationInMinutes||(r-a)/6e4,f=d%60,u=Math.floor(d/60);return{TimeBasedOptions:{Start:n,Duration:`${u} hr, ${f} min`}}},I=({item:e,defaultSettings:o={},eventData:i=[],locale:c,timeZone:_})=>{if(e.id=h(),e.Name=e.title,e.maps__Address__c=e.address||"",e.maps__Options__c=o,e.linkId&&(e.maps__LinkId__c=e.linkId,e.linkId.indexOf("00U")===0))for(let s=0;s<i.length;s++){const t=i[s];if(e.linkId===t.Id){e.StartDateTime=t.StartDateTime,e.EndDateTime=t.EndDateTime,e.DurationInMinutes=t.DurationInMinutes||(t.EndDateTime-t.StartDateTime)/1e3/60,e.maps__Options__c=D({eventData:e,locale:c,timeZone:_,defaultSettings:o});break}}return e.savedQueryId&&(e.maps__MarkerLayer__c=e.savedQueryId),e},m=(e,...o)=>{if(!e)throw new TypeError("reply - takes at least one argument");postMessage({queryMethodListener:e,queryMethodArguments:o})},y={processRecords:({defaultSettings:e={},startIndex:o,layerMap:i,eventData:c,locale:_,timeZone:s})=>{const t=[],a=Object.values(i);let r=!1,n=o;for(let d=0;d<a.length;d++){const f=a[d],{features:u}=f;for(let p=0;p<u.length;p++){const l=u[p];l.index=n,I({item:l,defaultSettings:e,eventData:c,locale:_,timeZone:s}),l.StartDateTime&&l.EndDateTime&&(r=!0),t.push(l),n++}}m("processedFeatures",{waypoints:t,isTimeBased:r})},removeDuplicates({waypoints:e=[],currentWaypoints:o=[]}){const i=[];let c=!1;const _=[];for(let s=0;s<e.length;s++){const t=e[s];let a=!1;for(let r=0;r<i.length;r++){const n=i[r];(t.maps__LinkId__c&&t.maps__LinkId__c===n.maps__LinkId__c||t.Name===n.Name&&t.maps__Address__c===n.maps__Address__c)&&(a=!0)}a?c=!0:_.push(t)}for(let s=0;s<_.length;s++){const t=_[s];let a=!1;for(let r=0;r<o.length;r++){const n=o[r];(t.maps__LinkId__c&&t.maps__LinkId__c===n.maps__LinkId__c||t.Name===n.Name&&t.maps__Address__c===n.maps__Address__c)&&(a=!0)}a?c=!0:i.push(t)}m("uniqueWaypoints",{uniqueWaypoints:i,hasDuplicate:c})}},T=e=>{console.log("direct",e)};onmessage=e=>{e.data instanceof Object&&Object.hasOwn(e.data,"queryMethod")&&Object.hasOwn(e.data,"queryMethodArguments")?y[e.data.queryMethod].apply(self,e.data.queryMethodArguments):T(e.data)}})();
