(function(){"use strict";const m={get(t={},r){const i=r.split(".");for(;i.length&&(t=t[i.shift()]););return t},set(t={},r,i){let s=t;const o=r.split("."),n=o.length;for(let l=0;l<n-1;l++){const a=o[l];s[a]||(s[a]={}),s=s[a]}s[o[n-1]]=i},sortTitleField(t){return t.sort((r,i)=>r?.attributes?.title<i?.attributes?.title?-1:r?.attributes?.title>i?.attributes?.title?1:0)}},b=()=>{function t(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return`${t()}${t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`},_=(t,r)=>{let i=!1;return t.isMALocation?i=t.placeId===r.placeId:i=t.relationshipId===r.relationshipId,i},p=(t,...r)=>{if(!t)throw new TypeError("reply - takes at least one argument");postMessage({queryMethodListener:t,queryMethodArguments:r})},g={loadScripts:({scripts:t})=>{Object.values(t).forEach(r=>{self.importScripts(r)}),p("scripts done")},processItems:({layerMap:t,currentQueue:r=[]})=>{let i=!1;const s=[],o=[];let n=r.length;const l=Object.values(t);for(let a=0;a<l.length;a++){const L=l[a],{features:y,records:c}=L;for(let u=0;u<y.length;u++){const e=y[u];if(n===700){i=!0;break}if(n++,(e.layerType==="myPosition"||e.layerType==="poiLayer")&&(e.isMALocation=!0),typeof e.isSupported<"u"&&!e.isSupported)s.push({title:e.title,baseObjectLabel:e.baseObjectLabel});else{const d=e.lat!=null&&e.lng!=null;e.spatial=d,e.showActionMenu=!1,e.excludeFromRoute=!d,e.className=d?"eventCell":"non-spatial-cell",d||(e.className="non-spatial-cell"),e.id=b(),e.Name=e.title,e.maps__Address__c=e.address||e.maps__Address__c,e.maps__MarkerLayer__c=e.savedQueryId||e.maps__MarkerLayer__c;const{prioritySettings:k={}}=e,{priorityType:M="",priorityLabel:O="",priorityFieldType:T="",priorityField:A=""}=k;let f="";if(e.linkId&&(e.maps__LinkId__c=e.linkId,e.relationshipId=e.linkId,c&&c[e.linkId])){const S=c[e.linkId],h=m.get(S,A);h&&(f=h?.raw||"")}e.extendedProps||(e.extendedProps={id:e.id,title:e.title}),e.priorityValue=f,e.priority=0,e.priorityType=M,e.priorityLabel=O,e.priorityFieldType=T,e.renderType="calendar-event",delete e.prioritySettings,delete e.marker,delete e.supportsActivities,delete e.baseObjectLabel,r.find(_.bind(void 0,e))||o.push(e)}}}p("processedFeatures",{queueItems:o,reachedQueueItemLimit:i,unsupportedItems:s})},sortPriority:({combinedPriorityArray:t})=>{const r=[];t.forEach(s=>r.push({priority:s.priorityValue||0,id:s.id}));const i=r.sort((s,o)=>o.priority-s.priority);p("sortedPriority",{sortedArray:i})},sortQueue:({queue:t})=>{const r=t.sort((i,s)=>i.priority-s.priority);p("queue_sorted",{sortedQueue:r})}},I=t=>{console.log("direct",t)};onmessage=t=>{t.data instanceof Object&&Object.hasOwn(t.data,"queryMethod")&&Object.hasOwn(t.data,"queryMethodArguments")?g[t.data.queryMethod].apply(self,t.data.queryMethodArguments):I(t.data)}})();
