import{d as w,a as A,_ as v,ct as k,bt as x,r as d,o as c,c as m,i as p,I as P,aj as V,h as r,w as T,t as n,H as B,B as D,l as O,O as R,f as $,g as q,aH as H,a3 as g,by as b,cg as N,s as _,v as h,e as L,a0 as U,b as E,j as z,cu as I,p as j,k as G}from"../bundle.js";import{H as J}from"./HoveringTooltip.b169338c.js";const X="CIMSymbolReference",Y=[],W={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[8.5,16.58],[10.51,10.41],[17,10.41],[11.75,6.59],[13.75,.42],[8.5,4.23],[3.25,.42],[5.25,6.59],[0,10.41],[6.49,10.41],[8.5,16.58]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:1,color:[0,0,0,255],colorLocked:!0},{type:"CIMSolidFill",enable:!0,color:[255,255,255,255],colorLocked:!0}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,offsetX:0,offsetY:16,anchorPoint:{x:0,y:0},colorLocked:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-.5},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:24,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:21,ymax:21},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[17.17,14.33],[16.97,12.96],[16.38,11.37],[12.16,3.98],[11.2,1.94],[10.5,0],[9.8,1.96],[8.84,4.02],[4.61,11.41],[4.02,12.98],[3.83,14.33],[3.96,15.63],[4.34,16.88],[4.95,18.03],[5.78,19.04],[6.8,19.88],[7.95,20.49],[9.2,20.87],[10.5,21],[11.8,20.87],[13.05,20.5],[14.2,19.88],[15.22,19.05],[16.05,18.03],[16.66,16.88],[17.04,15.63],[17.17,14.33]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:1,color:[0,121,235,255],colorLocked:!1},{type:"CIMSolidFill",enable:!0,color:[69,176,242,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]},S={type:X,primitiveOverrides:Y,symbol:W},K=w(()=>A(()=>import("./ButtonActions.5cbb87a5.js"),[MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/ButtonActions.5cbb87a5.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "bundle.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/main.feeda730.css" })],import.meta.url)),Q={components:{ButtonActions:K},props:{attributes:{type:Object,required:!0}},data(){return{favoriteId:""}},methods:{handleButtonAction(e){const o=MAPS.view.map.findLayerById("favoritesLayer"),i=this.$props.attributes.layerId,a=o.graphics.items.find(l=>l.attributes.layerId===i),t=k({layerId:"favoritesLayer",layerType:"favorite",oidField:"id",feature:a.toJSON(),translations:{MA_NA:MAPS.app.config.globalProperties.$Labels.MA_NA}}),s={};s[i]={type:"favorite",features:[t]},x({action:e.action,items:s})}}},Z={id:"actionButtons",class:"slds-p-vertical_small"};function ee(e,o,i,a,t,s){const l=d("ButtonActions");return c(),m("div",Z,[p(l,{layerType:"favorite",buttonTemplate:"favoriteMarkerLayout",onHandleAction:s.handleButtonAction},null,8,["onHandleAction"])])}const te=v(Q,[["render",ee]]),oe={components:{Icon:P,IconSettings:V},props:{location:{type:Object,required:!0}},data(){return{localResourceURL:MAPS.app.config.globalProperties.resourceURL}}},se={id:"favoritePopupHeader",class:"slds-grid"},ie={class:"slds-grid slds-grid_vertical"},re={id:"favoriteTooltipFavName"},ae={id:"favoriteTooltipAddress",style:{"font-size":"0.75rem","font-weight":"normal","margin-top":"-1px"}},le={id:"favoriteTooltipDescription",style:{"font-size":"0.75rem","font-weight":"normal"},class:"slds-m-top_small"};function ne(e,o,i,a,t,s){const l=d("Icon"),u=d("IconSettings");return c(),m("div",null,[r("div",se,[r("div",null,[p(u,{iconPath:`${t.localResourceURL}/maps__MapsIcons/icons`},{default:T(()=>[p(l,{category:"standard",name:"lead",class:"slds-m-right_x-small"})]),_:1},8,["iconPath"])]),r("div",ie,[r("div",re,n(e.$props.location.name),1),r("div",ae,n(e.$props.location.address),1)])]),r("div",le,n(e.$props.location.description),1)])}const ce=v(oe,[["render",ne]]);const de=["#FFFA00","#FF7B96","#D053FF","#46E71B","#68FFD7","#ADD4F3","#FFFFFF"],pe=["#FF6E00","#D31A28","#6C2777","#6FB384","#01BFBF","#2C7ED0","#000000"],{cimSymbolUtils:M,CIMSymbol:ye,CustomContent:me}=await B(["esri/symbols/support/cimSymbolUtils","esri/symbols/CIMSymbol","esri/popup/content/CustomContent"]),ue={components:{ButtonIcon:D,SLDSButton:O,TextInput:R,HoveringTooltip:J},props:{layer:{type:Object,default:()=>{},required:!0}},emits:["remove-layer"],setup(){const e=$(),o=q();return{mainStore:e,layersStore:o}},data(){return{layerIsVisible:!1,isLoading:!0,description:"",showOptions:!1,location:{latitude:null,longitude:null,address:"",name:""},icon:null,errorMessage:"",loadingMsg:"",hoverTimeout:null,tooltipVisible:!1,renderTooltip:!1}},computed:{isPlotOnLoad(){return this.layersStore.polLayers.find(e=>e.id===this.layer.id)!==void 0},proximitySettings(){return this.mainStore.settings.proximitySettings},opacityOptions(){const e=[];for(let o=1;o<11;o++)e.push({value:o/10,label:`${o*10}%`});return e},isEditMode(){return this.layer.isEditMode},layerIcon(){return H().favorite}},async created(){await this.getFavorite(),this.layersStore.updateIsLoading(this.layer.qid)},unmounted(){this.removeGraphic()},methods:{showTooltipInfo(){this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hoverTimeout=setTimeout(async()=>{this.renderTooltip=!0,await this.$nextTick(),await this.calculateTooltipInfo(),this.tooltipVisible=!0},500)},hideTooltipInfo(){this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.tooltipVisible=!1,this.renderTooltip=!1},async calculateTooltipInfo(){const o=this.$refs.layerHeader;this.$refs.hoveringTooltip&&await this.$refs.hoveringTooltip.calculateTooltipInfo(o)},async getFavorite(){this.isLoading=!0;const e={action:"getLocationInfo",ajaxResource:"FavoriteLocationsAJAXResources",folderId:this.layer.id},{data:o,success:i}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[e]);if(i){const{locations:a=[]}=o,[t]=a;if(!t){this.showError("Could not locate this favorite");return}this.layer.name=t.Name,this.description=t.maps__Description__c,this.location.name=t.Name,this.location.id=t.Id,this.location.latitude=t.maps__Latitude__c,this.location.longitude=t.maps__Longitude__c,this.location.address=t.maps__Address__c,this.location.description=t.maps__Description__c,this.icon=(t.maps__FavoriteMarker__c||"").indexOf("image:")>-1?t.maps__FavoriteMarker__c:`${t.maps__FavoriteMarker__c}:Favorite`,this.plotFavorite()}else this.showError();this.isLoading=!1},async getFavoriteSymbol(){if(this.icon.startsWith("image:")){const a=await MAPS.Utils.Images.loadImage({icon:this.icon}),{width:t,height:s}=MAPS.Utils.Images.reduceLargeImageSize({height:a.height,width:a.width});return{type:"picture-marker",url:a.imgURL,width:t,height:s,yoffset:s/2}}const[e]=this.icon.split(":");let o;if(de.includes(e))o=I;else if(pe.includes(e))o=S;else{const a=MAPS.Utils.Color.getContrastingColor(e);o=S,a==="000000"&&(o=I)}const i=new ye({data:o});return M.applyCIMSymbolColor(i,e,{layersToColor:"fill"}),M.applyCIMSymbolColor(i,MAPS.Utils.Color.adjustColorLuminance(e,-.5),{layersToColor:"outline"}),i},async plotFavorite(){const e=await this.getFavoriteSymbol(),o={type:"graphic",id:this.layer.qid,qid:this.layer.qid,geometry:{type:"point",latitude:this.location.latitude,longitude:this.location.longitude},symbol:e,attributes:{address:this.location.address,title:this.layer.name,layerId:this.layer.qid,linkId:this.location.id},titleFn:a=>{const t=g(ce,{location:this.location});b(t,document.createElement("div")),a.innerHTML=t.el.innerHTML},popupTemplate:{title:'<div class="maps-esri-list-title">{title}</div><div class="maps-popup-header" />',content:[new me({creator:a=>{const{graphic:t}=a,{attributes:s}=t,l=g(te,{attributes:s});return b(l,document.createElement("div")),l.el}})]}};MAPS.view.map.findLayerById("favoritesLayer").add(o),this.layerIsVisible=!0},async resetVerifiedLocationLayer(){this.layersStore.verifiedLocationActiveLayers[`favorite-${this.layer.qid}`]&&await N({layersToUpdate:[`favorite-${this.layer.qid}`]})},toggleVisibility(){this.layerIsVisible=!this.layerIsVisible;const o=MAPS.view.map.findLayerById("favoritesLayer").graphics.items.find(i=>i.attributes.layerId===this.layer.qid);o.visible=this.layerIsVisible},async removeGraphic(){await this.resetVerifiedLocationLayer(),this.layerIsVisible=!1;const e=MAPS.view.map.findLayerById("favoritesLayer"),o=e.graphics.items.find(i=>i.attributes.layerId===this.layer.qid);e.remove(o)},removeLayer(){this.layersStore.removePlottedLayer(this.layer.qid)},showError(e){this.errorMessage=e}}},f=e=>(j("data-v-cfa4fe58"),e=e(),G(),e),_e={class:"proximity-layer proximity layer"},he={class:"slds-col slds-grow-none",style:{position:"relative",width:"20px","margin-left":"2px"}},ve={key:0,role:"status",class:"slds-spinner slds-spinner_x-small slds-spinner_brand"},fe={class:"slds-assistive-text"},ge=f(()=>r("div",{class:"slds-spinner__dot-a"},null,-1)),be=f(()=>r("div",{class:"slds-spinner__dot-b"},null,-1)),Le=["src"],Ie=f(()=>r("div",{class:"ftu-plotonload"},null,-1)),Se={class:"basicinfo slds-col slds-p-left_small slds-col_bump-right slds-size_9-of-12"},Me={class:"slds-text-heading_small slds-truncate"},Te={key:0,class:"slds-text-color_error"},Ce={class:"slds-grid slds-grid_vertical slds-border_top slds-p-around_small"},Fe={class:"slds-border_top slds-grid slds-grid_align-center"};function we(e,o,i,a,t,s){const l=d("ButtonIcon"),u=d("HoveringTooltip"),C=d("TextInput"),F=d("SLDSButton");return c(),m("div",_e,[r("div",{ref:"layerHeader",class:U(["slds-grid slds-grid_vertical-align-center slds-p-around_x-small",{"is-plot-on-load":s.isPlotOnLoad}]),onMouseover:o[0]||(o[0]=(...y)=>s.showTooltipInfo&&s.showTooltipInfo(...y)),onMouseleave:o[1]||(o[1]=(...y)=>s.hideTooltipInfo&&s.hideTooltipInfo(...y))},[r("div",he,[t.isLoading?(c(),m("div",ve,[r("span",fe,n(e.$Labels.Layers_On_The_Map_Loading),1),ge,be])):(c(),m("img",{key:1,src:s.layerIcon},null,8,Le)),Ie]),r("div",Se,[r("div",Me,n(i.layer.name),1),_(r("div",{class:"slds-text-color_weak"},n(t.loadingMsg),513),[[h,t.isLoading]]),!t.isLoading&&t.errorMessage?(c(),m("div",Te,n(t.errorMessage),1)):L("",!0)]),p(l,{iconCategory:"utility",iconName:t.layerIsVisible?"preview":"hide",size:"small",title:e.$Labels.Toggle_Layer_Visibility,assistiveText:e.$Labels.Toggle_Layer_Visibility,onClick:s.toggleVisibility},null,8,["iconName","title","assistiveText","onClick"]),p(l,{iconCategory:"utility",iconName:"close",size:"small",title:e.$Labels.Layers_On_The_Map_Remove_Layer,assistiveText:e.$Labels.Layers_On_The_Map_Remove_Layer,onClick:s.removeLayer},null,8,["title","assistiveText","onClick"])],34),t.renderTooltip?(c(),E(u,{key:0,ref:"hoveringTooltip",tooltipVisible:t.tooltipVisible,layer:i.layer,showBaseObject:!1},null,8,["tooltipVisible","layer"])):L("",!0),_(r("div",Ce,[p(C,{modelValue:t.description,"onUpdate:modelValue":o[2]||(o[2]=y=>t.description=y),disabled:"",readonly:"",labels:{name:e.$Labels.Layers_On_The_Map_Plotted_Favorite_Location_Description},useTextArea:""},null,8,["modelValue","labels"])],512),[[h,!t.errorMessage&&t.showOptions]]),_(r("div",Fe,[p(F,{variant:"base",onClick:o[3]||(o[3]=y=>t.showOptions=!t.showOptions)},{default:T(()=>[z(n(t.showOptions?e.$Labels.MA_Hide_Options:e.$Labels.MA_Show_Options),1)]),_:1})],512),[[h,!t.errorMessage]])])}const xe=v(ue,[["render",we],["__scopeId","data-v-cfa4fe58"]]);export{xe as default};
