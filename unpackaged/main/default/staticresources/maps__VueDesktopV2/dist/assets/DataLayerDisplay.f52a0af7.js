import{_ as F,P as T,l as R,O as A,ac as n,r as b,o as d,c as r,h as o,i as u,F as h,s as k,v as C,a0 as D,t as V,q as w,b as M,e as _}from"../bundle.js";import{R as q}from"./ButtonGroup.2e921f3c.js";import{c as g,r as y}from"./index.0172543b.js";import{u as x}from"./index.d251dbc7.js";import{D as B}from"./FilterRow.4b27cbec.js";import"./Radio.2202254f.js";import"./ColorPicker.e47e828c.js";import"./DatePicker.899772b4.js";import"./Group.7e0cb254.js";import"./valid-hex-value.729e56db.js";import"./Popover.93a0feed.js";const S={name:"DataLayerDisplay",components:{RadioButtonGroup:q,Picklist:T,DataLayerFilterRow:B,SLDSButton:R,TextInput:A},inject:["fields","sourceDetails","layerOptions"],props:{resetIndex:{type:Number,required:!0},isLoading:{type:Boolean,default:!1}},emits:["update:isLoading"],data(){return{v$:x({$registerAs:"dataLayerDisplay"}),legendReady:!1,showAddRow:!0,displayType:"uniform",topicField:"",distributionMethod:"",displayOptions:[{label:this.$Labels.MA_COLOR_CODED,value:"colorCoded"},{label:this.$Labels.MA_UNIFORM,value:"uniform"}],minValue:"",maxValue:"",buckets:""}},validations(){const e={topicField:{},filterType:{},distributionMethod:{},minValue:{},maxValue:{},buckets:{}};return this.displayType==="colorCoded"&&(e.filterType={required:g.withMessage(this.$Labels.MA_Field_Req,y)},e.topicField={required:g.withMessage(this.$Labels.MA_Field_Req,y)},e.distributionMethod={required:g.withMessage(this.$Labels.MA_Field_Req,y)},this.distributionMethod==="distribution"&&(e.minValue={required:g.withMessage(this.$Labels.MA_Field_Req,y)},e.maxValue={required:g.withMessage(this.$Labels.MA_Field_Req,y)}),(this.distributionMethod==="distribution"||this.distributionMethod==="quantiles")&&(e.buckets={required:g.withMessage(this.$Labels.MA_Field_Req,y)})),e},computed:{legend(){return this.layerOptions.legend||{}},disableCreateLegend(){let e=!1;return this.distributionMethod==="distribution"?e=!this.minValue||!this.maxValue||!this.buckets:this.distributionMethod==="quantiles"&&(e=!this.buckets),e},legendRows(){return this.legend.rows||[]},filterType(){return(this.fields.find(s=>s.id===this.topicField)||{}).filter_as||"string"},distributionTypes(){let e=[];return this.filterType==="decimal"&&(e=[{label:this.$Labels.MA_Automatic,value:"auto",id:n()},{label:this.$Labels.MA_Even_Quantiles,value:"quantiles",id:n()},{label:this.$Labels.MA_Even_Distribution,value:"distribution",id:n()}]),e.push({label:this.$Labels.MA_Manual,value:"manual",id:n()}),e},distributionTypeError(){const e=this.$getErrorsByField(this.v$.distributionMethod);return Array.isArray(e)?e[0]:""}},watch:{resetIndex(){this.resetFullLegend(),this.displayType="uniform"}},created(){if(Array.isArray(this.legend.rows)&&this.legend.rows.length>0){const[e]=this.legend.rows;e?.topic_id==="--other--"?this.displayType="uniform":(this.displayType="colorCoded",this.topicField=e.topic_id,this.distributionMethod="manual",this.legendReady=!0)}else this.displayType="uniform",this.legend.rows=[{color:"3c78d8",operator:"range",topic_id:"--other--",max:"0",min:"0"}]},methods:{updateStyle(){},addLegendRow(){const e=this.filterType==="decimal"?"range":"equals";if(this.distributionMethod==="manual"){const s={topic_id:this.topicField,operator:e,color:`${MAPS.Utils.Color.randomHexColorCode()}:Marker`,guid:n(),values:[],min:"",max:""};this.legend.rows.splice(this.legend.rows.length-1,0,s)}else this.legend.rows.push({topic_id:this.topicField,operator:e,color:`${MAPS.Utils.Color.randomHexColorCode()}:Marker`,guid:n(),values:[],min:"",max:""})},async setMethod(e){this.resetFullLegend(),await this.$nextTick(),this.distributionMethod=e,(e==="auto"||e==="manual")&&this.generateLegend(),setTimeout(()=>{this.v$.$reset()},10)},removeFilter(e){this.legend.rows=this.legend.rows.filter(s=>s.guid!==e)},async generateLegend(){this.$emit("update:isLoading",!0),this.resetLegendTable();const e=this.distributionMethod;if(e==="manual")this.addLegendRow(),this.layerOptions.type!=="polygon"&&this.legend.rows.push({topic_id:this.topicField,operator:"equals",values:["--Other--"],color:"93c47d:Circle",guid:n()}),this.legendReady=!0;else if(e==="distribution")this.generateEvenDistribution();else{const a={method:"get",action:"legend",subType:"data",version:"2"},p={source:this.sourceDetails.source.id,level:this.sourceDetails.level.id,field:this.topicField};e==="quantiles"&&(p.divisions=this.buckets);try{const{success:i,data:l}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.MapAnythingIORequest",[a,p]);if(i){const{data:v}=l;v.forEach(f=>{const{min:m,max:c,color:L}=f;m&&c&&this.legend.rows.push({color:`${L}:Marker`,min:m,max:c,operator:"range",topic_id:this.topicField,guid:n()})}),this.legendReady=!0}}catch(i){console.warn(i),this.$emit("update:isLoading",!1)}}this.legendReady=!0;const s=this.fields.find(a=>a.id===this.topicField)||{};this.legend.title=s.label,this.$emit("update:isLoading",!1)},generateEvenDistribution(){const e=Number(this.maxValue)-Number(this.minValue),s=Math.round(e/Number(this.buckets)*100)/100;let a=Number(this.minValue);for(let p=0;p<this.buckets-1;p++)this.legend.rows.push({color:`${MAPS.Utils.Color.randomHexColorCode()}:Marker`,min:a,max:a+s,operator:"range",topic_id:this.topicField,guid:n()}),a+=s;this.legend.rows.push({color:`${MAPS.Utils.Color.randomHexColorCode()}:Marker`,min:a,max:Number(this.maxValue),operator:"range",topic_id:this.topicField,guid:n()}),this.legendReady=!0},defineMethods(e){this.resetFullLegend(),e.filter_as!=="decimal"&&(this.distributionMethod="manual",this.generateLegend())},resetFullLegend(){this.distributionMethod="",this.minValue="",this.maxValue="",this.buckets="",this.resetLegendTable()},resetLegendTable(){this.legendReady=!1,this.legend.title="",this.legend.subTitle="",this.legend.rows=[]},displayTypeChange(){this.topicField="",this.resetFullLegend(),this.displayType==="uniform"&&(this.legend.subTitle="--",this.legend.title=this.sourceDetails.source.label,this.layerOptions.type==="polygon"?this.legend.rows=[{color:"3c78d8",operator:"range",topic_id:"--other--",max:"0",min:"0",guid:"default-row"}]:this.legend.rows=[{color:"93c47d:Circle",operator:"equals",topic_id:"--other--",values:"--Other--",guid:"default-row"}]),this.v$.$reset()}}},$={class:"slds-grid slds-gutters"},E={class:"slds-col slds-size_2-of-8 slds-border_right"},I={id:"dl-useFilters",class:"slds-p-bottom_medium"},O={id:"dl-addFilters",class:"slds-p-bottom_medium",style:{overflow:"hidden"}},P={id:"dl-setupLegend",style:{overflow:"hidden"}},N={class:"dl-item"},U={class:"dl-content"},z={class:"slds-form-element__label"},G={class:"slds-button-group ma-vertical-group",role:"group"},H={key:0,class:"slds-form-element__help"},K={id:"dl-legend-options",class:"slds-p-top_small"},Y={id:"dl-legend-minVal",class:"dl-legend-step2"},j={id:"dl-legend-maxVal",class:"dl-legend-step2"},Q={id:"dl-legend-buckets",class:"dl-legend-step2"},W={style:{padding:"10px 0px 6px 6px"}},J={key:0,id:"legendImagePlaceholder",class:"slds-col slds-size_6-of-8"},X=["src"],Z=["src"],ee=["src"],ie=["src"],se={key:1,id:"dl-legend-wrap",class:"slds-col slds-size_6-of-8"},le={id:"dl-legend-grid slds-grid slds-grid_vertical"},te={class:"slds-col dl-legend-header slds-grid slds-grid_vertical-align-end slds-p-bottom_x-small slds-border_bottom"},oe={class:"slds-col"},de={class:"slds-col dl-legend-body slds-p-top_medium"};function re(e,s,a,p,i,l){const v=b("RadioButtonGroup"),f=b("Picklist"),m=b("SLDSButton"),c=b("TextInput"),L=b("DataLayerFilterRow");return d(),r("div",$,[o("div",E,[o("div",I,[u(v,{id:"styleSelectWrap",modelValue:i.displayType,"onUpdate:modelValue":s[0]||(s[0]=t=>i.displayType=t),options:i.displayOptions,labels:{name:e.$Labels.MA_LAYER_STYLE},onChange:l.displayTypeChange},null,8,["modelValue","options","labels","onChange"])]),i.displayType==="colorCoded"?(d(),r(h,{key:0},[o("div",O,[u(f,{modelValue:i.v$.topicField.$model,"onUpdate:modelValue":s[1]||(s[1]=t=>i.v$.topicField.$model=t),inputAttrs:{id:"dataLayerDisplayTopicPicklistResource"},filterable:"",titleKey:"label",errors:e.$getErrorsByField(i.v$.topicField),idKey:"id",options:l.fields,labels:{name:e.$Labels.MA_TOPIC},onSelectedOption:l.defineMethods,onClear:l.resetFullLegend},null,8,["modelValue","errors","options","labels","onSelectedOption","onClear"])]),k(o("div",P,[o("div",N,[o("div",U,[o("div",{class:D(["slds-form-element",{"slds-has-error":l.distributionTypeError}])},[o("div",z,V(e.$Labels.MA_Divide_Information),1),o("div",G,[(d(!0),r(h,null,w(l.distributionTypes,t=>(d(),M(m,{key:t.id,variant:i.distributionMethod===t.value?"brand":"neutral",class:"dl-legitem",iconCategory:"utility",iconName:i.distributionMethod===t.value?"check":"",iconPosition:"left",label:t.label,onClick:ae=>l.setMethod(t.value)},null,8,["variant","iconName","label","onClick"]))),128))]),l.distributionTypeError?(d(),r("div",H,V(l.distributionTypeError),1)):_("",!0)],2)]),k(o("div",K,[o("div",null,[i.distributionMethod==="distribution"?(d(),r(h,{key:0},[o("div",Y,[u(c,{modelValue:i.v$.minValue.$model,"onUpdate:modelValue":s[2]||(s[2]=t=>i.v$.minValue.$model=t),inputAttrs:{id:"dataLayerDisplayMinValueResource"},errors:e.$getErrorsByField(i.v$.minValue),required:"",type:"number",labels:{name:e.$Labels.MA_Minimum_value}},null,8,["modelValue","errors","labels"])]),o("div",j,[u(c,{modelValue:i.v$.maxValue.$model,"onUpdate:modelValue":s[3]||(s[3]=t=>i.v$.maxValue.$model=t),inputAttrs:{id:"dataLayerDisplayMaxValueResoure"},errors:e.$getErrorsByField(i.v$.maxValue),required:"",type:"number",labels:{name:e.$Labels.MA_Maximum_value}},null,8,["modelValue","errors","labels"])])],64)):_("",!0),o("div",Q,[u(c,{modelValue:i.v$.buckets.$model,"onUpdate:modelValue":s[4]||(s[4]=t=>i.v$.buckets.$model=t),inputAttrs:{id:"dataLayerDisplayNumTicketsResource"},errors:e.$getErrorsByField(i.v$.buckets),required:"",type:"number",labels:{name:e.$Labels.MA_Number_of_buckets}},null,8,["modelValue","errors","labels"])]),o("div",W,[u(m,{id:"dataLayerDisplayEvenDistCancelBtnResource",variant:"neutral",iconCategory:"utility",iconName:"close",iconPosition:"left",label:e.$Labels.MA_Cancel,onClick:l.resetFullLegend},null,8,["label","onClick"]),u(m,{id:"dataLayerDisplayEvenDistCreateLegendBtnResource",variant:"success",iconCategory:"utility",iconName:"check",iconPosition:"left",disabled:a.isLoading||l.disableCreateLegend,label:e.$Labels.MA_Create_Legend,onClick:l.generateLegend},null,8,["disabled","label","onClick"])])])],512),[[C,i.distributionMethod==="distribution"||i.distributionMethod==="quantiles"]])])],512),[[C,i.topicField!==""]])],64)):_("",!0)]),!i.legendReady||i.displayType==="uniform"?(d(),r("div",J,[l.layerOptions.type!=="point"?(d(),r(h,{key:0},[i.displayType==="colorCoded"?(d(),r("img",{key:0,class:"legendImg legendColor","data-type":"colorPoly",src:e.$Images.dataBuilder.legend_example},null,8,X)):(d(),r("img",{key:1,class:"legendImg hidden legendStatic","data-type":"staticPoly",src:e.$Images.dataBuilder.legend_example_ncc},null,8,Z))],64)):(d(),r(h,{key:1},[i.displayType==="colorCoded"?(d(),r("img",{key:0,class:"legendImg legendColor","data-type":"colorPoint",src:e.$Images.dataBuilder.legend_marker_multiple},null,8,ee)):(d(),r("img",{key:1,class:"legendImg hidden legendStatic","data-type":"staticPoint",src:e.$Images.dataBuilder.legend_marker_single},null,8,ie))],64))])):(d(),r("div",se,[o("div",le,[o("div",te,[u(c,{modelValue:l.legend.title,"onUpdate:modelValue":s[5]||(s[5]=t=>l.legend.title=t),inputAttrs:{id:"dataLayerDisplayTitleResource"},class:"slds-col slds-size_5-of-12",labels:{name:e.$Labels.MA_Title}},null,8,["modelValue","labels"]),u(c,{modelValue:l.legend.subTitle,"onUpdate:modelValue":s[6]||(s[6]=t=>l.legend.subTitle=t),inputAttrs:{id:"dataLayerDisplaySubtitleResource"},class:"slds-col slds-size_5-of-12",labels:{name:e.$Labels.MA_Subtitle}},null,8,["modelValue","labels"]),o("div",oe,[i.distributionMethod==="manual"?(d(),M(m,{key:0,id:"dataLayerDisplayAddRowBtnResource",variant:"neutral",label:e.$Labels.MA_Add_Row,onClick:l.addLegendRow},null,8,["label","onClick"])):_("",!0)])]),o("div",de,[(d(!0),r(h,null,w(l.legendRows,t=>(d(),M(L,{key:t.guid,filter:t,source:l.sourceDetails.source.id,level:l.sourceDetails.level.id,hideTopic:"",showMarkerSelection:"",layerType:l.layerOptions.type,onRemoveFilter:l.removeFilter},null,8,["filter","source","level","layerType","onRemoveFilter"]))),128))])])]))])}const fe=F(S,[["render",re],["__scopeId","data-v-3528c90c"]]);export{fe as default};
