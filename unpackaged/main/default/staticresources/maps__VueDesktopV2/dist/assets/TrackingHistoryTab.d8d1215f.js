import{u as v}from"./index.d251dbc7.js";import{c as o,r as m}from"./index.0172543b.js";import{_ as T,aj as S,S as P,l as A,P as k,g as w,b3 as h,r as d,o as c,b as f,w as y,c as z,e as D,h as l,i as _,j as C,t as E}from"../bundle.js";import{D as F}from"./DatePicker.899772b4.js";import{T as O}from"./TimePicker.bfa4e2f9.js";import{L as B}from"./layer-actions.075222c3.js";import"./enums.445299a0.js";const V={name:"TrackingHistoryTab",components:{IconSettings:S,Spinner:P,SLDSButton:A,Picklist:k,DatePicker:F,TimePicker:O},props:{record:{type:Object,required:!0}},setup(){return{v$:v(),layersStore:w()}},data(){return{localResourceURL:MAPS.app.config.globalProperties.resourceURL,oneDayInMilliseconds:864e5,isLoading:!0,firstDayOfWeek:MAPS.currentUser.StartOfWeekIndex,dateFormat:{dateStyle:"short"},userLocale:MAPS.currentUser.Locale.replace("sh_ME_USD","sh-ME").replace("_","-").slice(0,5),startDate:new Date,endDate:new Date,startTime:{hours:0,minutes:0},endTime:{hours:23,minutes:59},timezone:{selected:null,options:MAPS.availableTimezones.map(e=>({tzLabel:e.label,tzValue:e.value}))},summaryConfig:{selected:null,options:[]},labels:{Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Summary_Configuration:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Summary_Configuration,Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Timezone:MAPS.app.config.globalProperties.$Labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Timezone,modal_MLB_DateTime_Date_Component_Start_Label:MAPS.app.config.globalProperties.$Labels.modal_MLB_DateTime_Date_Component_Start_Label,modal_MLB_DateTime_Date_Component_End_Label:MAPS.app.config.globalProperties.$Labels.modal_MLB_DateTime_Date_Component_End_Label,MA_Start_Time:MAPS.app.config.globalProperties.$Labels.MA_Start_Time,MA_End_Time:MAPS.app.config.globalProperties.$Labels.MA_End_Time,Live_View_Full_History:MAPS.app.config.globalProperties.$Labels.Live_View_Full_History}}},validations(){return{summaryConfig:{selected:{required:o.withMessage(MAPS.app.config.globalProperties.$Labels.MA_Field_Req,m)}},timezone:{selected:{required:o.withMessage(MAPS.app.config.globalProperties.$Labels.MA_Field_Req,m)}},startDate:{required:o.withMessage(MAPS.app.config.globalProperties.$Labels.MA_Field_Req,m),maxStartDate:o.withMessage(MAPS.app.config.globalProperties.$Labels.modal_MLB_Live_Last_Report_Date_StartDate_not_greater_than_today,e=>this.checkDateLessOrEqual(e,new Date)),maxFromDateBeforeEnd:o.withMessage(MAPS.app.config.globalProperties.$Labels.modal_MLB_Live_Last_Report_Date_StartDate_after_End_Date,e=>this.checkDateLessOrEqual(e,this.endDate)),daysBeforeCurrentDate:o.withMessage(MAPS.app.config.globalProperties.$Labels.Layers_Start_Date_No_More_Than_90_Days,e=>this.checkDateDiffWithinRange(new Date,e,90)),daysBetween:o.withMessage(MAPS.app.config.globalProperties.$Labels.Layers_Select_Up_To_7_Days,e=>this.checkDateDiffWithinRange(this.endDate,e,7))},endDate:{required:o.withMessage(MAPS.app.config.globalProperties.$Labels.MA_Field_Req,m),minEndDate:o.withMessage(MAPS.app.config.globalProperties.$Labels.modal_MLB_Live_Last_Report_Date_EndDate_before_Start_Date,e=>this.checkDateLessOrEqual(this.startDate,e)),maxEndDate:o.withMessage(MAPS.app.config.globalProperties.$Labels.modal_MLB_Live_Last_Report_Date_EndDate_not_greater_than_today,e=>this.checkDateLessOrEqual(e,new Date)),daysBeforeCurrentDate:o.withMessage(MAPS.app.config.globalProperties.$Labels.Layers_Start_Date_No_More_Than_90_Days,e=>this.checkDateDiffWithinRange(new Date,e,90)),daysBetween:o.withMessage(MAPS.app.config.globalProperties.$Labels.Layers_Select_Up_To_7_Days,e=>this.checkDateDiffWithinRange(e,this.startDate,7))},startTime:{greaterThanEnd:o.withMessage(MAPS.app.config.globalProperties.$Labels.Start_Time_Greater_Than_End_Time,e=>this.checkTimeLessOrEqual(e,this.endTime))},endTime:{lessThanStart:o.withMessage(MAPS.app.config.globalProperties.$Labels.End_Time_Less_Than_Start_Time,e=>this.checkTimeLessOrEqual(this.startTime,e))}}},async created(){await this.getSummaryConfigs(),this.summaryConfig.selected=this.summaryConfig.options[0].configId,this.timezone.selected=this.timezone.options.find(e=>e.tzValue===MAPS.currentUser.TimeZone).tzValue,this.isLoading=!1},methods:{checkDateLessOrEqual(e,t){return e==null||t==null?!0:e.getTime()<=t.getTime()||h(e,t)},checkTimeLessOrEqual(e,t){return e==null||t==null?!0:e.hours<=t.hours||e.hours===t.hours&&e.minutes<=t.minutes},checkDateDiffWithinRange(e,t,r){return e==null||t==null?!0:Math.floor((e.getTime()-t.getTime())/this.oneDayInMilliseconds)<r},$getErrorsByField(e){return e.$touch(),e.$errors.length?[e.$errors[0].$message]:[]},viewTrackingHistory(){let e=new Date(this.startDate),t=Math.floor((this.endDate.getTime()-this.startDate.getTime())/this.oneDayInMilliseconds);for(t<0&&(t=0);t>=0;)B.handleAction({action:"plot-live-device-layer",layerData:{id:`${this.record.device.deviceId}-${t}`,type:"live-device",component:"TrackingHistoryLayer",trackingConfig:{groupLayerIndex:t,liveLayerQid:this.record.attributes.layerId,startTime:this.startTime,endTime:this.endTime,selectedDate:e,selectedTimezone:this.timezone.selected,summaryConfig:this.summaryConfig.options.find(r=>r.configId===this.summaryConfig.selected),sfRecord:this.record,selectedAsset:this.record.device,showOptions:h(this.startDate,this.endDate),pathColor:this.layersStore.getPathColor()}}}),t--,e=new Date(e.getTime()+this.oneDayInMilliseconds);MAPS.view.popup.close()},async getSummaryConfigs(){const e={speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:null,speedLimit:250,configName:MAPS.app.config.globalProperties.$Labels.Default_Configuration,configId:"ma_defaultConfig",allowedTimeUnits:"Minutes",allowedTime:6e4,allowedDistanceUnits:"feet",allowedDistance:7e5},t=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.getLiveConfigs",[this.record.attributes.layerId]),{success:r,data:a}=t,s=r?JSON.parse(a):[];this.summaryConfig.options=s.length>0?s:[e]}}},$={key:0,style:{"min-height":"50px"}},x={class:"slds-grid"},I={class:"slds-col slds-size_1-of-2 slds-p-horizontal_x-small"},R={class:"slds-col slds-size_1-of-2 slds-p-horizontal_x-small"},U={class:"slds-grid"},q={class:"slds-col slds-size_1-of-2 slds-p-horizontal_x-small"},W={class:"slds-col slds-size_1-of-2 slds-p-horizontal_x-small"},H={class:"slds-grid"},N={class:"slds-col slds-size_1-of-2 slds-p-horizontal_x-small"},K={class:"slds-col slds-size_1-of-2 slds-p-horizontal_x-small"},Y={class:"slds-grid slds-p-horizontal_x-small"};function j(e,t,r,a,s,n){const L=d("Spinner"),p=d("Picklist"),u=d("DatePicker"),g=d("TimePicker"),b=d("SLDSButton"),M=d("IconSettings");return c(),f(M,{iconPath:`${s.localResourceURL}/maps__MapsIcons/icons`},{default:y(()=>[r.record?(c(),z("div",$,[s.isLoading?(c(),f(L,{key:0})):D("",!0),l("div",x,[l("div",I,[_(p,{modelValue:a.v$.summaryConfig.selected.$model,"onUpdate:modelValue":t[0]||(t[0]=i=>a.v$.summaryConfig.selected.$model=i),inputAttrs:{id:"layer-summary-config-tab"},options:s.summaryConfig.options,labels:{name:s.labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Summary_Configuration},errors:n.$getErrorsByField(a.v$.summaryConfig.selected),filterable:"",idKey:"configId",titleKey:"configName",resizeToFitContent:""},null,8,["modelValue","options","labels","errors"])]),l("div",R,[_(p,{modelValue:a.v$.timezone.selected.$model,"onUpdate:modelValue":t[1]||(t[1]=i=>a.v$.timezone.selected.$model=i),inputAttrs:{id:"layer-device-timezone-tab"},options:s.timezone.options,labels:{name:s.labels.Layers_On_The_Map_OverFlow_Live_Modal_Events_History_Timezone},errors:n.$getErrorsByField(a.v$.timezone.selected),filterable:"",idKey:"tzValue",titleKey:"tzLabel",resizeToFitContent:""},null,8,["modelValue","options","labels","errors"])])]),l("div",U,[l("div",q,[_(u,{modelValue:a.v$.startDate.$model,"onUpdate:modelValue":t[2]||(t[2]=i=>a.v$.startDate.$model=i),class:"normalizeWidth",errors:n.$getErrorsByField(a.v$.startDate),inputAttrs:{id:"startDatePicker"},firstDayOfWeek:s.firstDayOfWeek,dateFormat:s.dateFormat,locale:s.userLocale,numYearsInPast:1,numYearsInFuture:0,labels:{name:s.labels.modal_MLB_DateTime_Date_Component_Start_Label},detach:""},null,8,["modelValue","errors","firstDayOfWeek","dateFormat","locale","labels"])]),l("div",W,[_(u,{modelValue:a.v$.endDate.$model,"onUpdate:modelValue":t[3]||(t[3]=i=>a.v$.endDate.$model=i),class:"normalizeWidth",errors:n.$getErrorsByField(a.v$.endDate),inputAttrs:{id:"endDatePicker"},firstDayOfWeek:s.firstDayOfWeek,dateFormat:s.dateFormat,locale:s.userLocale,numYearsInPast:1,numYearsInFuture:0,labels:{name:s.labels.modal_MLB_DateTime_Date_Component_End_Label},detach:""},null,8,["modelValue","errors","firstDayOfWeek","dateFormat","locale","labels"])])]),l("div",H,[l("div",N,[_(g,{modelValue:a.v$.startTime.$model,"onUpdate:modelValue":t[4]||(t[4]=i=>a.v$.startTime.$model=i),inputAttrs:{id:"layer-start-time-picker-tab"},class:"normalizeWidth",errors:n.$getErrorsByField(a.v$.startTime),combobox:"",labels:{name:s.labels.MA_Start_Time},locale:s.userLocale,interval:{hours:0,minutes:15}},null,8,["modelValue","errors","labels","locale"])]),l("div",K,[_(g,{modelValue:a.v$.endTime.$model,"onUpdate:modelValue":t[5]||(t[5]=i=>a.v$.endTime.$model=i),inputAttrs:{id:"layer-end-time-picker-tab"},class:"normalizeWidth",errors:n.$getErrorsByField(a.v$.endTime),combobox:"",labels:{name:s.labels.MA_End_Time},locale:s.userLocale,interval:{hours:0,minutes:15}},null,8,["modelValue","errors","labels","locale"])])]),l("div",Y,[_(b,{"data-q3-id":"layer-history-apply-button",class:"slds-m-top_small",variant:"neutral",disabled:a.v$.$invalid,onClick:n.viewTrackingHistory},{default:y(()=>[C(E(s.labels.Live_View_Full_History),1)]),_:1},8,["disabled","onClick"])])])):D("",!0)]),_:1},8,["iconPath"])}const se=T(V,[["render",j],["__scopeId","data-v-fa0e73ea"]]);export{se as default};
