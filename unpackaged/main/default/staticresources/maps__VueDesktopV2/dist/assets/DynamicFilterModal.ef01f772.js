import{_ as b,bj as V,P as k,r as n,o as p,c as y,h as d,t as r,j as h,i as o,l as A,x as O,bb as P,b as S,w as c,q as D,F as w}from"../bundle.js";import{M as I}from"./Modal.76578f76.js";const M={name:"DynamicFieldRow",components:{PillList:V,Picklist:k},props:{filter:{type:Object,required:!0}},emits:["update:modelValue"],data(){return{pills:[],searchTerm:[],searchOptions:[{options:e=>new Promise(async t=>{const i=await this.searchDynamicValue(e);t(i)})}]}},created(){this.filter.UserReference?(this.searchTerm.push(MAPS.currentUser.Id),this.pills.push({title:MAPS.currentUser.Name,id:MAPS.currentUser.Id,value:MAPS.currentUser.Id,label:MAPS.currentUser.Name})):this.filter.Value&&this.filter.Value!==":Dynamic"&&(this.searchTerm.push(this.filter.Value),this.pills.push({title:this.filter.Value,id:this.filter.Value,value:this.filter.Value,label:this.filter.Value})),this.setInputValue()},methods:{setInputValue(){const e=this.searchTerm.join("~~~");this.$emit("update:modelValue",e)},updateBindings(e){this.pills.push({title:e.label,id:e.value,value:e.value,label:e.label}),this.setInputValue()},removeBindings(e){this.pills=this.pills.filter(t=>t.value!==e.value),this.searchTerm=this.searchTerm.filter(t=>t!==e.value),this.setInputValue()},searchDynamicValue(e=""){return new Promise(async t=>{try{const i={action:"get_lookup_optionsv2",ajaxResource:"TooltipAJAXResources",baseObject:this.filter.BaseObject,fieldApiName:this.filter.FieldApiName,fieldName:this.filter.fieldName,parentField:this.filter.ParentField==null||this.filter.ParentField==="Id"||this.filter.Reference!==!0&&this.filter.GrandparentField==null?"--none--":this.filter.ParentField,grandparentField:this.filter.GrandparentField==null||this.filter.GrandparentField==="Id"||this.filter.Reference!==!0?"--none--":this.filter.GrandparentField,term:e},u=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[i]),s=[];u.success&&u.lookupOptions.forEach(l=>{l.icon!=="search"&&s.push(l)}),t(s)}catch(i){console.warn("failed search",i),t([])}})}}},g={class:"dynamic-row-filter","data-test-id":"dynamic-filter-row"},x={"data-test-id":"dynamic-filter-label"};function B(e,t,i,u,s,l){const f=n("Picklist"),_=n("PillList");return p(),y("div",g,[d("label",x,[d("strong",null,r(e.$Labels.MA_Field_With_Colon),1),h(" "+r(i.filter.FormattedLabel)+" ("+r(i.filter.Operator)+")",1)]),o(f,{modelValue:s.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=a=>s.searchTerm=a),inputAttrs:{id:`enhanced-url-picklist-${i.filter.uid}`},class:"maps-pills-hide",filterable:"",idKey:"value",titleKey:"label",combobox:"",multiselect:"",options:s.searchOptions,onSelectedOption:l.updateBindings,onRemovedOption:l.removeBindings},null,8,["modelValue","inputAttrs","options","onSelectedOption","onRemovedOption"]),o(_,{id:`enhanced-url-view-record-${i.filter.uid}`,style:{height:"100%"},class:"slds-p-top_xx-small slds-p-bottom_xx-small",options:s.pills,onRemove:t[1]||(t[1]=a=>l.removeBindings(a))},null,8,["id","options"])])}const C=b(M,[["render",B],["__scopeId","data-v-7a208c10"]]);const L={name:"DynamicFilterModal",components:{SLDSButton:A,Modal:I,ScopedNotification:O,DynamicFilterItem:C},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],data(){return{dynamicFilters:[]}},computed:{title(){return this.modalOptions.title}},async created(){(this.modalOptions?.filters||[]).forEach(t=>{const i={...t,uid:P};this.dynamicFilters.push(i)})},methods:{process(){this.modalOptions.callback(this.dynamicFilters),this.$emit("close-modal")},cancel(){this.modalOptions.callback(),this.$emit("close-modal")}}},N={class:"ma-form-control-wrap","data-test-id":"dynamic-filter-wrapper"},R={class:"slds-grid"},T={class:"slds-col_bump-left"};function U(e,t,i,u,s,l){const f=n("ScopedNotification"),_=n("DynamicFilterItem"),a=n("SLDSButton"),v=n("Modal");return p(),S(v,{"data-q3-id":"enhanced-url-modal",title:l.title,size:"base",onClose:l.cancel},{content:c(()=>[o(f,{"data-q3-id":"enhanced-url-scope-notification",class:"slds-m-bottom_medium"},{content:c(()=>[h(r(e.$Labels.Dynamic_Filter_Content_Text),1)]),_:1}),d("div",N,[(p(!0),y(w,null,D(s.dynamicFilters,m=>(p(),y("div",{key:m.uid,class:"filter-row ma-form-control-wrap"},[o(_,{modelValue:m.Value,"onUpdate:modelValue":F=>m.Value=F,filter:m},null,8,["modelValue","onUpdate:modelValue","filter"])]))),128))])]),footer:c(()=>[d("div",R,[d("div",T,[o(a,{"data-q3-id":"enhanced-url-cancel","data-test-id":"dynamic-filter-cancel",class:"slds-button",variant:"neutral",onClick:l.cancel},{default:c(()=>[h(r(e.$Labels.MA_Cancel),1)]),_:1},8,["onClick"]),o(a,{"data-q3-id":"enhanced-url-continue","data-test-id":"dynamic-filter-continue",class:"slds-button",variant:"brand",onClick:l.process},{default:c(()=>[h(r(e.$Labels.MA_Continue),1)]),_:1},8,["onClick"])])])]),_:1},8,["title","onClose"])}const G=b(L,[["render",U],["__scopeId","data-v-f590ff87"]]);export{G as default};
