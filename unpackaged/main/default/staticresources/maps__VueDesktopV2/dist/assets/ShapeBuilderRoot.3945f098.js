import{_ as w,O as V,l as P,r as h,o as m,c as v,h as o,i as n,s as I,v as T,w as y,j as g,t as u,S as x,P as D,Q as $,ac as F,b as O,e as L,B as z,bj as Q,F as k,T as H,q as U,I as X,f as j,aF as G,a0 as Y,a5 as ee,d as te,a as se,$ as le,Z as ie,aB as oe,L as re,aD as ae,a1 as ne}from"../bundle.js";import{M as de}from"./Modal.76578f76.js";import{P as R}from"./Popover.93a0feed.js";import{u as E}from"./index.d251dbc7.js";import{c as B,r as N,m as ce}from"./index.0172543b.js";import{p as q,g as W,a as Z}from"./shapeBuilder-db.c992211c.js";import{C as pe}from"./ColorPicker.e47e828c.js";import{v as ue}from"./valid-hex-value.729e56db.js";const he={name:"ShapeBuilderDetails",components:{TextInput:V,SLDSButton:P},props:{territory:{type:Object,required:!0}},data(){return{v$:E({$registerAs:"shapeDetails"})}},validations(){return{territory:{Name:{required:B.withMessage(this.$Labels.MA_Field_Req,N),maxLength:B.withMessage(this.$Labels.MA_Max_Length_80_Name,ce(80))}}}},methods:{nextStep(){document.getElementById("shapeBuilderSelections__item").click()}}},_e={id:"info"},me={class:"slds-grid slds-wrap slds-grid--vertical"},fe={class:"slds-size_1-of-1 slds-p-bottom_x-small slds-medium-size_3-of-4 slds-large-size_7-of-12"};function ye(e,t,l,r,s,i){const a=h("TextInput"),p=h("SLDSButton");return m(),v("div",_e,[o("div",me,[o("div",fe,[n(a,{modelValue:s.v$.territory.Name.$model,"onUpdate:modelValue":t[0]||(t[0]=_=>s.v$.territory.Name.$model=_),inputAttrs:{id:"shapeBuilderInputNameResource"},labels:{name:e.$Labels.ShapeLayer_Name_Field},errors:e.$getErrorsByField(s.v$.territory.Name),required:""},null,8,["modelValue","labels","errors"]),n(a,{modelValue:l.territory.maps__Description__c,"onUpdate:modelValue":t[1]||(t[1]=_=>l.territory.maps__Description__c=_),inputAttrs:{id:"shapeBuilderInputDescResource"},labels:{name:e.$Labels.ShapeLayer_Description_Field},useTextArea:""},null,8,["modelValue","labels"])]),I(n(p,{id:"shapeBuilderNextBtnResource",variant:"success",onClick:i.nextStep},{default:y(()=>[g(u(e.$Labels.ShapeLayer_Next_Button),1)]),_:1},8,["onClick"]),[[T,l.territory.Name!=""]])])])}const ve=w(he,[["render",ye]]);const be={components:{Spinner:x,Picklist:D,TextInput:V,SLDSButton:P,Popover:R},props:{showZipImportScreen:{type:Boolean,required:!0},countryOptions:{type:Array,required:!0}},emits:["update-user-entry","update:showZipImportScreen","show-error","zipsProcessing"],data(){return{softLimitQuantity:2e3,isLoading:!1,isProcessing:!1,errorMessage:[],importError:!1,errorCount:0,validZipCount:0,zipEntryCount:0,zipEntry:"",selectedCountry:"",selectedCountryOptions:[{label:this.$Labels.ShapeLayer_ZipImport_Select_A_Country,id:""}]}},watch:{zipEntry(e){const t=this.formatUserEntry(e);this.zipEntryCount=t.length},isProcessing(e){this.$emit("zipsProcessing",e)},selectedCountry(e){e===""&&this.clearInputs()}},mounted(){this.getSupportedCountries()},methods:{localFormatLabel(e,t){return $(e,t)},closeImport(){this.isProcessing||(this.zipEntry="",this.$emit("update:showZipImportScreen",!1))},clearInputs(){this.zipEntry="",this.errorMessage=[],this.validZipCount=0},getErrorMessage(){this.errorMessage=[];let e=null;this.importError&&this.errorCount>0&&(e=`${$(this.$Labels.ShapeLayer_ZipImport_Errors,[this.errorCount])} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ${this.$Labels.ShapeLayer_Error_Text}`,this.errorMessage.push(e))},async processZipCodes(){this.isLoading=!0,this.isProcessing=!0;try{const e=[...new Set(this.formatUserEntry())],{success:t,data:l,errInfo:r,message:s}=await this.getZipCodeImports(e);if(!t||r||s)if(r){const{error:{message:a}}=JSON.parse(r);throw new Error(a)}else throw new Error(s);const{codes:i}=l;this.updateZipCodeData(i)}catch(e){this.$emit("show-error",e.message)}finally{this.isProcessing=!1,this.isLoading=!1}},async getSupportedCountries(){try{this.isLoading=!0;const{success:e,data:t,message:l}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.getSupportedPostalCountries",[]);e&&t?this.selectedCountryOptions=[...this.selectedCountryOptions,...t]:this.$emit("show-error",l)}catch(e){this.$emit("show-error",e)}finally{this.isLoading=!1}},async getZipCodeImports(e){const t="/boundary/postal/1",l={codes:e,country:this.selectedCountry};return await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.postJSONToHyperforceGISService",[t,JSON.stringify(l),!1])},updateZipCodeData(e=[]){const t=e.map(a=>({label:a.code,value:a.geoid})),l=t.filter(a=>a.value),r=t.filter(a=>!a.value);this.errorCount=r.length;const s=this.countryOptions.find(a=>a.id===this.selectedCountry),i=l.map(a=>({...a,active:!0,plotted:!1,guid:F(),level:s.zip_postal_levels[0]}));if(this.validZipCount=i.length,this.isProcessing=!1,this.$emit("update-user-entry",i),r.length>0){const a=[];r.forEach(p=>a.push(p.label)),this.zipEntry=a.join(`\r
`),this.importError=!0,this.getErrorMessage()}else this.importError=!1,this.closeImport()},formatUserEntry(e){return(e||this.zipEntry).split(/,|, |\n|\n /).filter(r=>r.trim()!=="").map(r=>r.trim())}}},ge={class:"popoverContainer"},Se={class:"slds-p-top--small slds-p-horizontal--small"},Le={class:"slds-p-bottom_x-small"},Oe={class:"slds-text-body_regular"},Ie={target:"_blank",href:"https://help.salesforce.com/s/articleView?id=sf.salesforce_maps_setup_postal_code_formats.htm"},Ce={class:"slds-p-horizontal--small"},Ae={class:"slds-p-top--x-small slds-p-horizontal--small slds-p-bottom_x-small"},Te={id:"shapeBuilderPasteClipboardTextAreaWrap",class:"slds-form-element"},we={class:"slds-form-element__control"},Fe={key:0,class:"slds-p-bottom--x-large slds-p-horizontal--small"},ke={class:"slds-p-horizontal--small slds-p-vertical--small"},Pe={class:"slds-grid slds-grid_vertical-align-center slds-grid_align-spread"},Me={class:"slds-col"},Be={class:"slds-col"};function Ve(e,t,l,r,s,i){const a=h("Spinner"),p=h("Picklist"),_=h("TextInput"),f=h("SLDSButton"),d=h("Popover");return m(),v("div",ge,[n(d,{id:"zipCodePopover",theme:"base",alignment:"bottom left",width:"full-width",position:"absolute",ariaLabel:e.$Labels.ShapeLayer_Paste_Zip_Codes_Button,onClose:i.closeImport},{content:y(()=>[s.isLoading?(m(),O(a,{key:0})):L("",!0),o("div",null,[o("div",Se,[o("div",Le,[o("p",Oe,[g(u(e.$Labels.ShapeLayer_ZipImport_Instructions)+" ",1),o("a",Ie,u(e.$Labels.ShapeLayer_ZipImport_Doc_Link),1)])])]),o("div",Ce,[n(p,{modelValue:s.selectedCountry,"onUpdate:modelValue":t[0]||(t[0]=S=>s.selectedCountry=S),inputAttrs:{id:"shapeBuilderCountryPicklistResource"},options:s.selectedCountryOptions,disabled:s.zipEntry!=="",required:"",filterable:"",labels:{name:e.$Labels.ShapeLayer_Country,placeholder:e.$Labels.ShapeLayer_Select_An_Option},titleKey:"label",class:"slds-m-bottom_small"},null,8,["modelValue","options","disabled","labels"])]),o("div",null,[o("div",Ae,[o("div",Te,[o("div",we,[n(_,{modelValue:s.zipEntry,"onUpdate:modelValue":t[1]||(t[1]=S=>s.zipEntry=S),inputAttrs:{id:"postalCodeInput"},useTextArea:"",required:"",disableResize:"",errors:s.errorMessage,disabled:!s.selectedCountry,labels:{name:e.$Labels.ShapeLayer_ZipImport_Postal_Codes}},null,8,["modelValue","errors","disabled","labels"])])])]),s.zipEntryCount>=s.softLimitQuantity?(m(),v("div",Fe,[o("p",null,u(e.$Labels.ShapeLayer_ZipImport_Quantity_Warning),1)])):L("",!0)])]),o("div",ke,[o("div",Pe,[o("div",Me,[s.validZipCount>0?(m(),v("p",{key:0,ref:"validStatement"},u(i.localFormatLabel(e.$Labels.ShapeLayer_ZipImport_Success,[s.validZipCount])),513)):L("",!0)]),o("div",Be,[n(f,{id:"clearZipCodesButton",variant:"neutral",title:e.$Labels.MA_Clear,onClick:i.clearInputs},{default:y(()=>[g(u(e.$Labels.MA_Clear),1)]),_:1},8,["title","onClick"]),n(f,{id:"shapeBuilderPasteClipboardProcessingButton",variant:"brand",disabled:!s.zipEntry,label:e.$Labels.MA_Add,onClick:i.processZipCodes},{default:y(()=>[g(u(e.$Labels.MA_Add),1)]),_:1},8,["disabled","label","onClick"])])])])]),_:1},8,["ariaLabel","onClose"])])}const De=w(be,[["render",Ve],["__scopeId","data-v-f08feecc"]]);const Ee={name:"ShapeFilter",components:{Popover:R,ButtonIcon:z,Picklist:D,Spinner:x,TextInput:V,PillList:Q,SLDSButton:P},props:{filter:{type:Object,required:!0},shapeInfo:{type:Object,required:!0},filterFields:{type:Array,required:!0}},emits:["remove-filter","show-error","filter-results","toggle-add-filter-button"],data(){return{editPopup:!1,operators:[],filterSearchTimeout:null,searchOptions:[{options:async e=>{let t=[];try{t=await q({overlay:this.shapeInfo.country,level:this.shapeInfo.level,field:this.filter.field,searchterm:e})}catch(l){console.warn(l)}return t}}]}},computed:{filterValid(){if(this.filter.type==="decimal")return!0;if(this.filter.type==="string"){const{pills:e=[]}=this.filter;if(e.length>0)return!0}return!1},filterValueString(){if(this.filter.type==="decimal"&&this.filter.min)return this.$F("Numeric",this.filter.min);const{pills:e=[]}=this.filter;return e.map(l=>l.label).join(", ")}},watch:{editPopup(e){this.$emit("toggle-add-filter-button",e)}},mounted(){this.updateFilterSearchCriteria(),this?.$refs?.editTrigger?.$el&&this.$refs.editTrigger.$el.click()},beforeUnmount(){this.editPopup=!1,this.$emit("toggle-add-filter-button",!1)},methods:{cancelFilterCheck(){let e=!0;this.filter.field===""&&(e=!1),this.filter.operator===""&&(e=!1),this.filter.pills.length||(e=!1),e||this.removeFilter(this.filter.guid)},closePopover(){this.cancelFilterCheck(),this.editPopup=!1},runFilter(){this.editPopup=!1,this.$emit("filter-results")},debounceFilterSearch(e){if(this.filterSearchTimeout!==null&&clearTimeout(this.filterSearchTimeout),e.searchTerm.length<2){e.results=[],e.searchLoading=!1;return}e.searchLoading=!0,this.filterSearchTimeout=setTimeout(async()=>{this.filterSearchTimeout=null,e.showResults=!0;try{const t=await q({overlay:this.shapeInfo.country,level:this.shapeInfo.level,field:e.field,searchterm:e.searchTerm});e.results=t,e.results.unshift({id:"searchTerm",value:e.searchTerm,label:e.searchTerm})}catch(t){this.$emit("show-error",t.message)}finally{e.searchLoading=!1}},500)},removeFilter(e){this.editPopup=!1,this.$emit("remove-filter",e)},openEditPopup(){this.editPopup=!0},updateFilterSearchCriteria(){const e=this.filter.field,t=this.filterFields.find(r=>r.id===e);this.filter.label=t.label;const l=t.filter_as;l==="decimal"?this.operators=[{label:this.$Labels.MA_Equals,value:"equals"},{label:this.$Labels.MA_Less_Than,value:"less than"},{label:this.$Labels.MA_Greater_Than,value:"greater than"},{label:this.$Labels.MA_Less_Than_Equal,value:"less or equal"},{label:this.$Labels.MA_Greater_Than_Equal,value:"greater or equal"},{label:this.$Labels.MA_NOT_EQUAL_TO,value:"not equal to"}]:this.operators=[{label:this.$Labels.MA_Equals,value:"equals"},{label:this.$Labels.MA_Contains,value:"contains"},{label:this.$Labels.MA_NOT_EQUAL_TO,value:"not equal to"},{label:this.$Labels.MA_Starts_With,value:"starts with"},{label:this.$Labels.MA_Does_Not_Contain,value:"does not contain"}],this.filter.operator="equals",this.filter.type=l,this.filter.isDirty=!0,this.filter.min="",this.filter.pills=[],this.filter.isValid=!1},addItemToPills(e){const t=e.value?"value":"id";this.filter.pills.findIndex(l=>l.id===e[t])===-1&&this.filter.pills.push({title:e.label,id:e[t],value:e[t],label:e.label}),this.filter.searchTerm="",this.editPopup=!0},removePill(e){this.filter.pills=this.filter.pills.filter(t=>t.value!==e.value)}}},$e={class:"filter-item slds-box slds-m-vertical_small"},Ue={class:"slds-grid slds-grid_vertical-align-center"},xe={class:"slds-col slds-col_bump-left"},ze={key:0},Re={key:1,class:"filter-content-complete"},Ne={class:"slds-text-body_small field-label"},Ge={class:"filters-from-pills"},qe={class:"slds-col slds-size_1-of-12"},Ze={class:"slds-col slds-size_1-of-12"},He={class:"slds-grid slds-grid_vertical"},je={class:"slds-grid slds-grid_align-end slds-p-top_small"};function We(e,t,l,r,s,i){const a=h("Spinner"),p=h("ButtonIcon"),_=h("Picklist"),f=h("TextInput"),d=h("PillList"),S=h("SLDSButton"),C=h("Popover");return m(),v("div",$e,[l.filter.isLoading?(m(),O(a,{key:0})):L("",!0),o("div",Ue,[o("div",xe,[l.filter.field===""||l.filter.operator===""?(m(),v("div",ze,u(e.$Labels.New_Filter),1)):(m(),v("div",Re,[o("p",Ne,u(l.filter.label),1),o("p",Ge,u(l.filter.operator)+" "+u(i.filterValueString),1)]))]),o("div",qe,[n(p,{ref:"editTrigger",iconCategory:"utility",class:"slds-p-left_small",iconName:"edit",title:e.$Labels.MA_Close,assistiveText:e.$Labels.MA_Close,onClick:i.openEditPopup},null,8,["title","assistiveText","onClick"])]),o("div",Ze,[n(p,{iconCategory:"utility",iconName:"close",title:e.$Labels.MA_Close,assistiveText:e.$Labels.MA_Close,onClick:t[0]||(t[0]=c=>i.removeFilter(l.filter.guid))},null,8,["title","assistiveText"])])]),s.editPopup?(m(),O(C,{key:1,width:"large",bindTo:e.$refs.editTrigger.$el,alignment:"top",class:"shape-filter-popover",onClose:i.closePopover},{content:y(()=>[o("div",He,[n(_,{modelValue:l.filter.field,"onUpdate:modelValue":t[1]||(t[1]=c=>l.filter.field=c),inputAttrs:{"data-q3-id":`shapeBuilderCity-${l.filter.guid}-PicklistResource`},options:l.filterFields,required:"",labels:{name:e.$Labels.MA_Field,placeholder:e.$Labels.MA_Select_an_Option},idKey:"id",titleKey:"label",class:"slds-m-bottom_small",onSelectedOption:i.updateFilterSearchCriteria},null,8,["modelValue","inputAttrs","options","labels","onSelectedOption"]),n(_,{modelValue:l.filter.operator,"onUpdate:modelValue":t[2]||(t[2]=c=>l.filter.operator=c),inputAttrs:{"data-q3-id":`shapeBuilderFilterOperator-${l.filter.guid}-PicklistResource`},options:s.operators,required:"",labels:{name:e.$Labels.MA_OPERATOR,placeholder:e.$Labels.MA_Select_an_Option},idKey:"value",titleKey:"label",class:"slds-m-bottom_small"},null,8,["modelValue","inputAttrs","options","labels"]),l.filter.type==="decimal"?(m(),O(f,{key:0,modelValue:l.filter.min,"onUpdate:modelValue":t[3]||(t[3]=c=>l.filter.min=c),inputAttrs:{"data-q3-id":`shapeBuilderEnter-${l.filter.guid}-ValueResource`},type:"number",labels:{name:e.$Labels.MA_Value}},null,8,["modelValue","inputAttrs","labels"])):(m(),v(k,{key:1},[n(_,{modelValue:l.filter.searchTerm,"onUpdate:modelValue":t[4]||(t[4]=c=>l.filter.searchTerm=c),inputAttrs:{"data-q3-id":`shapeBuilderEnter-${l.filter.guid}-ValueResource`},filterable:"",idKey:"id",combobox:"",labels:{name:e.$Labels.MA_Value},titleKey:"label",options:s.searchOptions,onSelectedOption:i.addItemToPills},null,8,["modelValue","inputAttrs","labels","options","onSelectedOption"]),o("div",null,[n(d,{style:{height:"100%"},class:"slds-p-top_small",options:l.filter.pills,onRemove:i.removePill},null,8,["options","onRemove"])])],64))]),o("div",je,[n(S,{label:e.$Labels.MA_Cancel,disabled:l.filter.pills.length>0,onClick:i.closePopover},null,8,["label","disabled","onClick"]),n(S,{disabled:!i.filterValid,variant:"brand",label:e.$Labels.MapsSetting_Update,onClick:i.runFilter},null,8,["disabled","label","onClick"])])]),_:1},8,["bindTo","onClose"])):L("",!0)])}const Je=w(Ee,[["render",We],["__scopeId","data-v-68d670fb"]]),Ke={components:{Tooltip:H,SLDSButton:P,ShapeFilter:Je},props:{shapeInfo:{type:Object,required:!0},filters:{type:Array,required:!0}},emits:["update-loading","update-selections","remove-filters","add-filter","set-filter-fields","show-error"],data(){return{filterStyleObj:{left:"0px",position:"fixed","z-index":1e4},filterSearchTimeout:null,filterFields:[],showAddFilterButton:!0}},methods:{updateFilterButton(e){this.showAddFilterButton=!e},async buildFilter(){const e={field:"",label:"",type:"string",pills:[],operator:"",guid:F(),searchTerm:"",result:[],showResults:!1,active:!1,searchLoading:!1,isValid:!1,min:"",max:"",isDirty:!0};this.filterFields.length===0&&await this.setFilterFields();const[t]=this.filterFields;e.field=t.id,this.$emit("add-filter",e)},removeFilter(e){this.$emit("remove-filters",[e]),this.$nextTick(()=>{this.$emit("update-selections")})},async setFilterFields(){this.$emit("update-loading",!0);try{const e=await W({getFields:!0,overlay:this.shapeInfo.country,level:this.shapeInfo.level}),[t]=e;if(t){const{levels:l=[]}=t,[r]=l,s=[];r&&r.fields.forEach(i=>{s.push(i)}),this.filterFields=s}}catch(e){console.error(e),this.filterFields=[],this.$emit("show-error",e.message)}finally{this.$emit("update-loading",!1)}},runFilterSearch(){this.$nextTick(()=>{this.$emit("update-selections")})},removeAllFilters(){const e=this.filters.map(t=>t.guid);this.$emit("remove-filters",e),this.$nextTick(()=>{this.$emit("update-selections")})}}},Qe={class:"slds-filters"},Xe={class:"slds-text-body_small slds-m-vertical_x-small slds-form-element__label"},Ye={class:"slds-list_vertical slds-list_vertical-space filterListItem"},et={class:"slds-grid"};function tt(e,t,l,r,s,i){const a=h("ShapeFilter"),p=h("SLDSButton"),_=h("Tooltip");return m(),v("div",null,[o("div",Qe,[o("h3",Xe,u(e.$Labels.ShapeLayer_Filters_Matching_All),1),o("div",Ye,[(m(!0),v(k,null,U(l.filters,f=>(m(),O(a,{key:f.guid,filterFields:s.filterFields,shapeInfo:l.shapeInfo,filter:f,onFilterResults:i.runFilterSearch,onRemoveFilter:i.removeFilter,onToggleAddFilterButton:i.updateFilterButton},null,8,["filterFields","shapeInfo","filter","onFilterResults","onRemoveFilter","onToggleAddFilterButton"]))),128))])]),o("div",et,[I(n(_,{text:e.$Labels.ShapeLayer_Filters_Tooltip_Text},{source:y(()=>[n(p,{id:"shapeBuilderAddFilterBtnResource",variant:"neutral",class:"slds-text-body_small",onClick:i.buildFilter},{default:y(()=>[g(u(e.$Labels.MA_Add_Filter),1)]),_:1},8,["onClick"])]),_:1},8,["text"]),[[T,s.showAddFilterButton]]),l.filters.length?(m(),O(p,{key:0,class:"slds-col_bump-left",variant:"base",label:e.$Labels.MA_REMOVE_ALL,onClick:i.removeAllFilters},null,8,["label","onClick"])):L("",!0)])])}const st=w(Ke,[["render",tt]]),lt={name:"ShapeBuilderSelection",components:{SLDSButton:P,ZipImport:De,Picklist:D,Filters:st,ButtonIcon:z,Icon:X,Tooltip:H},props:{shapeInfo:{type:Object,required:!0},territory:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},emits:["close","update:isLoading"],setup(){return{mainStore:j()}},data(){return{v$:E({$registerAs:"shapeSelection"}),availableOverlaysHolder:[],availableOverlays:[],selectedOverlaysHolder:[],countryOptions:[],iWantToSeeOptions:[],returnLimit:5e3,tooManyOverlays:!0,showZipImportScreen:!1,isModalLocked:!1,selectedCountryData:{},shapeDataIsLoading:!1,filters:[]}},validations(){return{shapeInfo:{selected:{required:B.withMessage("At least 1 shape is required to save",N)}}}},computed:{totalSelected(){return[...this.shapeInfo.selected,...this.shapeInfo.scrollContainer].length}},watch:{"mainStore.showShapeDrawMode":{handler(e){if(!e){let t=this.shapeInfo.selected.length;for(;t--;){const r=this.shapeInfo.selected[t];r.active||this.selectedOverlaysHolder.push(r.value)}let l=this.shapeInfo.scrollContainer.length;for(;l--;){const r=this.shapeInfo.scrollContainer[l];r.active||this.selectedOverlaysHolder.push(r.value)}this.removeSelectedShapes()}}}},async created(){this.shapeInfo.scrollContainer.length>0&&this.getGeoLabels(),await this.getCountryData(),this.shapeInfo.country="USA";const e=this.countryOptions.find(t=>t.id==="USA");this.updateIWantToSeePicklistOptions(e)},methods:{showError(e){this.mainStore.toast({message:e,state:"error"})},async getGeoLabels(){this.shapeDataIsLoading=!0;const e=this.shapeInfo.scrollContainer.splice(0,100),t=[];for(let l=0;l<e.length;l++){const r=e[l];r.dirty?t.push(r.value):this.shapeInfo.selected.push(r)}t.length>0&&(await Z({overlay:"*",level:"*",filters:[{field_id:"geoid",values:t}]})).forEach(s=>{const i=e.find(a=>a.value===s.value);i.label=s.label,delete i.dirty,this.shapeInfo.selected.push(i)}),this.shapeDataIsLoading=!1},async getCountryData(){this.$emit("update:isLoading",!0);try{const e=await W({getFields:!1});this.countryOptions=e}catch(e){this.showError(e.message),this.$emit("close")}finally{this.$emit("update:isLoading",!1)}},updateIWantToSeePicklistOptions(e){this.selectedCountryData=e;const{levels:t=[]}=this.selectedCountryData;this.iWantToSeeOptions=t},updateOverlaySelections(e=!1){this.$emit("update:isLoading",!0),e&&this.clearPreviousPreviousOverlaySelections(),this.getSelectedInformation().then(t=>{t.length>this.returnLimit?this.tooManyOverlays=!0:(this.tooManyOverlays=!1,this.setAvailableOverlay(t))}).catch(t=>{this.showError(t.message)}).finally(()=>{this.$emit("update:isLoading",!1)})},clearAll(){this.shapeInfo.level="",this.clearPreviousPreviousOverlaySelections()},upateSelectedWithUserImport(e){const t=this.shapeInfo.selected,l=t.length,r=e.length,s=[];for(let a=0;a<r;a++){const p=e[a],_=p.value;let f=!1;for(let d=0;d<l;d++){const C=t[d].value;if(_===C){f=!0;break}}f||s.push(p)}const i=[...this.shapeInfo.selected,...s];this.updateSelectedOverlays(i)},clearPreviousPreviousOverlaySelections(){this.availableOverlaysHolder=[],this.availableOverlays=[],this.tooManyOverlays=!0,this.filters=[]},setAvailableOverlay(e){this.availableOverlays=e},async getSelectedInformation(e){this.returnLimit=5e3,(this.filters.length===0||e)&&(e=!0,this.returnLimit=500);const t=this.formattedFilters(),{valid:l=[],invalid:r=[]}=t;r.length&&(this.removeFilters(r),this.showError(`${r.length} ${this.$Labels.ShapeLayer_Warning_Message}`));try{const s=await Z({overlay:this.shapeInfo.country,level:this.shapeInfo.level,filters:l});return s.forEach(i=>{i.level=this.shapeInfo.level,i.overlay=this.shapeInfo.country}),s}catch(s){return this.showError(s.message),[]}},removeFilters(e=[]){this.filters=this.filters.filter(t=>!e.includes(t.guid))},formattedFilters(){const e=[],t=[];if(this.filters.length===0)e.push({field_id:"label",operator:"not equal to",values:["zz"]});else{let l=this.filters.length;for(;l--;){const r=this.filters[l],{operator:s,field:i,type:a}=r;if(s===""||i==="")t.push(r.guid);else{let p=[],_=!0;a==="decimal"?(r.min===""&&(_=!1),p.push(r.min)):(r.pills.length||(_=!1),p=r.pills.map(f=>f.value)),_?e.push({field_id:r.field,operator:r.operator,values:p}):t.push(r.guid)}}}return{valid:e,invalid:t}},selectAllAvailable(){this.availableOverlays.forEach(e=>{this.availableOverlaysHolder.push(e.value)})},unselectAllAvailable(){this.availableOverlaysHolder=[]},selectAllSelected(){[...this.shapeInfo.selected,...this.shapeInfo.scrollContainer].forEach(t=>{this.selectedOverlaysHolder.push(t.value)})},unselectAllSelected(){this.selectedOverlaysHolder=[]},async removeAllSelected(){this.selectAllSelected(),await this.$nextTick(),this.removeSelectedShapes(),this.selectedOverlaysHolder=[],this.shapeInfo.scrollContainer=[]},setLoadingStatus(e){this.$emit("update:isLoading",e)},addSelectedShapes(){const e={};for(let i=0;i<this.availableOverlaysHolder.length;i++){const a=this.availableOverlaysHolder[i];e[a]=1}const t=[...this.shapeInfo.selected,...this.shapeInfo.scrollContainer],l={};for(let i=0;i<t.length;i++){const a=t[i];l[a.value]=1}const r=[];let s=this.availableOverlays.length;for(;s--;){const i=this.availableOverlays[s];e[i.value]&&(l[i.value]||r.push({value:i.value,label:i.label,level:this.shapeInfo.level,active:!0,plotted:!1,guid:F()}),this.availableOverlays.splice(s,1))}r.length>100?(this.shapeInfo.selected=[...this.shapeInfo.selected,...r.splice(0,100)],this.shapeInfo.scrollContainer=[...this.shapeInfo.scrollContainer,...r]):this.shapeInfo.selected=[...this.shapeInfo.selected,...r]},removeSelectedShapes(){const e={};for(let s=0;s<this.selectedOverlaysHolder.length;s++){const i=this.selectedOverlaysHolder[s];e[i]=1}const t=[];let l=this.shapeInfo.selected.length;for(;l--;){const s=this.shapeInfo.selected[l];s&&e[s.value]&&(!this.tooManyOverlays&&s.value.startsWith(this.shapeInfo.country)&&s.level===this.shapeInfo.level&&t.push(s),this.shapeInfo.selected.splice(l,1))}let r=this.shapeInfo.scrollContainer.length;for(;r--;){const s=this.shapeInfo.scrollContainer[r];s&&e[s.value]&&(!this.tooManyOverlays&&s.value.startsWith(this.shapeInfo.country)&&s.level===this.shapeInfo.level&&t.push(s),this.shapeInfo.scrollContainer.splice(r,1))}if(this.selectedOverlaysHolder=[],t.length>0){const s={};for(let i=0;i<this.availableOverlays.length;i++){const a=this.availableOverlays[i];s[a]=1}t.forEach(i=>{s[i.value]||this.availableOverlays.push(i)})}},updateSelectedOverlays(e){this.shapeInfo.selected=e},addFilter(e){this.filters.push(e)},scrolling(e){const{clientHeight:t,scrollHeight:l,scrollTop:r}=e.target;r+t>=l*.7&&this.shapeInfo.scrollContainer.length>0&&!this.shapeDataIsLoading&&this.getGeoLabels()},showDrawOnMap(){this.mainStore.showShapeDrawMode=!0}}},it={class:"slds-grid slds-grid_vertical"},ot={class:"slds-border_bottom"},rt={class:"slds-grid slds-p-around_x-small"},at={class:"slds-col_bump-right slds-m-top--x-small"},nt={class:"slds-text-heading_small"},dt=o("div",{style:{height:"25px"},class:"slds-button__icon slds-button__icon--left ma-icon ma-icon-lasso"},null,-1),ct={class:"slds-grid slds-gutters slds-border_top slds-p-top_x-small"},pt={class:"slds-col slds-size_1-of-3"},ut={class:"slds-form slds-form--stacked slds-m-bottom--x-small"},ht={id:"shapeBuilderFiltersDrawOnMapWrap",class:"slds-p-bottom--medium"},_t=o("div",{style:{height:"25px"},class:"slds-button__icon slds-button__icon--left ma-icon ma-icon-lasso"},null,-1),mt={class:"slds-col slds-size_1-of-3 slds-border_right",style:{position:"relative"}},ft={class:"slds-grid slds-grid_vertical"},yt={class:"slds-col"},vt={class:"slds-col"},bt={class:"slds-p-around_x-small slds-border_left slds-border_right slds-border_top"},gt={key:0,class:"slds-p-around_large slds-border_left slds-border_right slds-border_top slds-border_bottom",style:{"overflow-y":"auto",height:"calc( 100vh - 400px)"}},St={class:"slds-text-align_center"},Lt={class:"slds-p-bottom_medium"},Ot={class:"slds-text-color_weak"},It=["value"],Ct={style:{position:"absolute",right:"-17px",top:"105px"}},At={class:"flex-column"},Tt={class:"slds-p-bottom--medium"},wt={class:"slds-col slds-size_1-of-3"},Ft={class:"slds-grid slds-grid_vertical"},kt={class:"slds-col slds-grid slds-gutters-none slds-grid_vertical-align-center"},Pt={ref:"shapeSizeWarning",class:"slds-p-right_xx-small"},Mt=o("div",{class:"slds-p-top_medium"},"e.g. Selecting a state vs all the zip codes in the state.",-1),Bt={class:"slds-col"},Vt={class:"slds-p-around_x-small slds-border_left slds-border_right slds-border_top"},Dt=["value","label"],Et={key:0,disabled:""};function $t(e,t,l,r,s,i){const a=h("SLDSButton"),p=h("ZipImport"),_=h("Picklist"),f=h("Filters"),d=h("Icon"),S=h("ButtonIcon"),C=h("Tooltip");return m(),v("div",it,[o("div",ot,[o("div",rt,[o("div",at,[o("h3",nt,u(e.$Labels.ShapeLayer_Shape_Selection_Tab),1)]),I(n(a,{id:"shapeBuilderDrawMapTopBtnResource",variant:"neutral",onClick:i.showDrawOnMap},{default:y(()=>[dt,g(" "+u(e.$Labels.ShapeLayer_Draw_On_Map_Button),1)]),_:1},8,["onClick"]),[[T,l.shapeInfo.level!=""]]),n(a,{id:"addPostalCodesButton",disabled:s.isModalLocked,variant:"neutral",class:"slds-float--right",onClick:t[0]||(t[0]=c=>s.showZipImportScreen=!s.showZipImportScreen)},{default:y(()=>[g(u(e.$Labels.ShapeLayer_Paste_Zip_Codes_Button),1)]),_:1},8,["disabled"])]),s.showZipImportScreen?(m(),O(p,{key:0,showZipImportScreen:s.showZipImportScreen,"onUpdate:showZipImportScreen":t[1]||(t[1]=c=>s.showZipImportScreen=c),countryOptions:s.countryOptions,onUpdateUserEntry:i.upateSelectedWithUserImport,onShowError:i.showError,onClose:t[2]||(t[2]=c=>s.showZipImportScreen=s.isModalLocked?s.showZipImportScreen:!1)},null,8,["showZipImportScreen","countryOptions","onUpdateUserEntry","onShowError"])):L("",!0)]),o("div",ct,[o("div",pt,[o("div",ut,[n(_,{modelValue:l.shapeInfo.country,"onUpdate:modelValue":t[3]||(t[3]=c=>l.shapeInfo.country=c),inputAttrs:{id:"shapeBuilderCountryPicklistResource"},options:s.countryOptions,filterable:"",required:"",labels:{name:e.$Labels.ShapeLayer_Country,placeholder:e.$Labels.ShapeLayer_Select_An_Option},titleKey:"label",class:"slds-m-bottom_small",onSelectedOption:i.updateIWantToSeePicklistOptions,onClear:i.clearAll},null,8,["modelValue","options","labels","onSelectedOption","onClear"]),o("div",null,[n(_,{modelValue:l.shapeInfo.level,"onUpdate:modelValue":t[4]||(t[4]=c=>l.shapeInfo.level=c),inputAtrs:{id:"shapeBuilderSearchPicklistResource"},options:s.iWantToSeeOptions,helpText:`${e.$Labels.ShapeLayer_I_Want_To_See_Info}<br><br>${e.$Labels.ShapeLayer_For_Example_Info} ${e.$Labels.ShapeLayer_Zip_Codes_Info}`,filterable:"",required:"",labels:{name:e.$Labels.ShapeLayer_I_Want_To_See,placeholder:e.$Labels.ShapeLayer_Select_An_Option},titleKey:"label_plural",class:"slds-m-bottom_small",onSelectedOption:t[5]||(t[5]=c=>i.updateOverlaySelections(!0)),onClear:i.clearPreviousPreviousOverlaySelections},null,8,["modelValue","options","helpText","labels","onClear"])])]),l.shapeInfo.level!==""?(m(),v(k,{key:0},[o("div",ht,[I(n(a,{id:"shapeBuilderDrawBtnResource",variant:"neutral",onClick:i.showDrawOnMap},{default:y(()=>[_t,g(" "+u(e.$Labels.ShapeLayer_Draw_On_Map_Button),1)]),_:1},8,["onClick"]),[[T,l.shapeInfo.level!=""]])]),n(f,{filters:s.filters,"onUpdate:filters":t[6]||(t[6]=c=>s.filters=c),shapeInfo:l.shapeInfo,onAddFilter:i.addFilter,onRemoveFilters:i.removeFilters,onUpdateLoading:i.setLoadingStatus,onUpdateSelections:t[7]||(t[7]=c=>i.updateOverlaySelections(!1)),onShowError:i.showError},null,8,["filters","shapeInfo","onAddFilter","onRemoveFilters","onUpdateLoading","onShowError"])],64)):L("",!0)]),o("div",mt,[o("div",ft,[o("div",yt,u(e.$Labels.ShapeLayer_Available_Shapes),1),o("div",vt,[o("div",bt,[g(u(e.$Labels.ShapeLayer_Select)+" ",1),o("a",{href:"javascript:void(0);",onClick:t[8]||(t[8]=(...c)=>i.selectAllAvailable&&i.selectAllAvailable(...c))},u(e.$Labels.ShapeLayer_All),1),g(" / "),o("a",{href:"javascript:void(0);",onClick:t[9]||(t[9]=(...c)=>i.unselectAllAvailable&&i.unselectAllAvailable(...c))},u(e.$Labels.ShapeLayer_None),1)]),o("div",null,[s.tooManyOverlays?(m(),v("div",gt,[o("div",St,[o("div",Lt,[n(d,{category:"utility",name:"info",size:"small"})]),o("div",Ot,u(e.$Labels.ShapeLayer_TooManyOverlays_Text),1)])])):I((m(),v("select",{key:1,ref:"availableOptions","onUpdate:modelValue":t[10]||(t[10]=c=>s.availableOverlaysHolder=c),class:"slds-select",size:"50",multiple:"",style:{"overflow-y":"auto",height:"calc( 100vh - 400px)"}},[(m(!0),v(k,null,U(s.availableOverlays,(c,A)=>(m(),v("option",{key:A,class:"slds-truncate",value:c.value,"data-level":2},u(c.label),9,It))),128))],512)),[[G,s.availableOverlaysHolder]])])])]),o("div",Ct,[o("div",At,[o("div",Tt,[n(S,{iconCategory:"utility",iconName:"right",variant:"border-filled",title:"Add Selected",assistiveText:"Add Selected",onClick:i.addSelectedShapes},null,8,["onClick"])]),o("div",null,[n(S,{iconCategory:"utility",iconName:"left",variant:"border-filled",title:"Remove Selected",assistiveText:"Remove Selected",onClick:i.removeSelectedShapes},null,8,["onClick"])])])])]),o("div",wt,[o("div",Ft,[o("div",kt,[I(o("div",Pt,[n(d,{category:"utility",name:"warning",size:"xx-small",variant:"warning"}),n(C,{iconTitle:"warning",text:"data",source:e.$refs.shapeSizeWarning},{default:y(()=>[o("div",null,'Adding too many shapes can lead to a degradation in performance. It is recommended to select a larger shape if possible from the "'+u(e.$Labels.ShapeLayer_I_Want_To_See)+'" selection.',1),Mt]),_:1},8,["source"])],512),[[T,i.totalSelected>5e3]]),o("div",null,u(e.$Labels.ShapeLayer_Selected_Shapes)+" ("+u(i.totalSelected)+") ",1)])]),o("div",Bt,[o("div",Vt,[g(u(e.$Labels.ShapeLayer_Select)+" ",1),o("a",{href:"javascript:void(0);",onClick:t[11]||(t[11]=(...c)=>i.selectAllSelected&&i.selectAllSelected(...c))},u(e.$Labels.ShapeLayer_All),1),g(" / "),o("a",{href:"javascript:void(0);",onClick:t[12]||(t[12]=(...c)=>i.unselectAllSelected&&i.unselectAllSelected(...c))},u(e.$Labels.ShapeLayer_None),1),o("a",{class:"slds-float_right",href:"javascript:void(0);",onClick:t[13]||(t[13]=(...c)=>i.removeAllSelected&&i.removeAllSelected(...c))},u(e.$Labels.ShapeLayer_Clear),1)]),I(o("select",{ref:"selectedOptions","onUpdate:modelValue":t[14]||(t[14]=c=>s.selectedOverlaysHolder=c),class:Y(["slds-select",{"slds-has-error":s.v$?.shapeInfo?.selected?.$errors.length}]),size:"50",multiple:"multiple",style:{"overflow-y":"auto",height:"calc( 100vh - 400px)"},onScroll:t[15]||(t[15]=(...c)=>i.scrolling&&i.scrolling(...c))},[(m(!0),v(k,null,U(l.shapeInfo.selected,(c,A)=>(m(),v("option",{key:A,class:"slds-truncate",value:c.value,label:c.label},null,8,Dt))),128)),s.shapeDataIsLoading?(m(),v("option",Et,u(e.$Labels.MA_Loading_With_Ellipsis),1)):L("",!0)],34),[[G,s.selectedOverlaysHolder]])])])])])}const Ut=w(lt,[["render",$t]]),xt={name:"ShapeBuilderOptions",components:{TextInput:V,ColorPicker:pe,Picklist:D,Checkbox:ee},props:{territory:{type:Object,required:!0}},data(){return{v$:E({$registerAs:"shapeDisplayOptions"}),opacityOptions:[{label:"10%",value:"0.1"},{label:"20%",value:"0.2"},{label:"30%",value:"0.3"},{label:"40%",value:"0.4"},{label:"50%",value:"0.5"},{label:"60%",value:"0.6"},{label:"70%",value:"0.7"},{label:"80%",value:"0.8"},{label:"90%",value:"0.9"},{label:"100%",value:"1"}],justificationOptions:[{label:this.$Labels.ShapeLayer_Left,value:"left"},{label:this.$Labels.ShapeLayer_Center,value:"center"},{label:this.$Labels.ShapeLayer_Right,value:"right"}],fontOptions:[{label:"8px",value:"8px"},{label:"9px",value:"9px"},{label:"10px",value:"10px"},{label:"11px",value:"11px"},{label:"12px",value:"12px"},{label:"13px",value:"13px"},{label:"14px",value:"14px"},{label:"15px",value:"15px"},{label:"16px",value:"16px"},{label:"17px",value:"17px"},{label:"18px",value:"18px"}]}},validations(){const e={required:B.withMessage(this.$Labels.MLB_Required_Field_Error,N),validHexValue:B.withMessage(this.$Labels.modal_MLB_colorpicker_validation_error,ue)};return{territory:{maps__Options__c:{colorOptions:{fillColor:e,borderColor:e,labelFontColor:e,labelBGColor:e}}}}}},zt={class:"slds-text-heading_small slds-border_bottom"},Rt={class:"slds-grid slds-p-top_x-small"},Nt={class:"slds-text-heading_small slds-border_bottom"},Gt={class:"slds-grid slds-p-top_x-small"},qt={class:"slds-text-heading_small slds-m-top_small slds-border_bottom"},Zt={class:"slds-p-top_x-small"};function Ht(e,t,l,r,s,i){const a=h("ColorPicker"),p=h("Picklist"),_=h("Checkbox"),f=h("TextInput");return m(),v("div",null,[o("h2",zt,u(e.$Labels.TerritoryBuilder_Color_Selection),1),o("div",Rt,[n(a,{modelValue:l.territory.maps__Options__c.colorOptions.fillColor,"onUpdate:modelValue":t[0]||(t[0]=d=>l.territory.maps__Options__c.colorOptions.fillColor=d),labels:{chooseColor:e.$Labels.TerritoryBuilder_Fill_Color},label:"Fill Color"},null,8,["modelValue","labels"]),n(a,{modelValue:l.territory.maps__Options__c.colorOptions.borderColor,"onUpdate:modelValue":t[1]||(t[1]=d=>l.territory.maps__Options__c.colorOptions.borderColor=d),labels:{chooseColor:e.$Labels.TerritoryBuilder_Border_Color},class:"slds-p-left_x-small"},null,8,["modelValue","labels"])]),n(p,{modelValue:l.territory.maps__Options__c.colorOptions.fillOpacity,"onUpdate:modelValue":t[2]||(t[2]=d=>l.territory.maps__Options__c.colorOptions.fillOpacity=d),options:s.opacityOptions,labels:{name:e.$Labels.MA_OPACITY},idKey:"value",titleKey:"label",class:"slds-m-bottom_small"},null,8,["modelValue","options","labels"]),o("h2",Nt,u(e.$Labels.TerritoryBuilder_Label_Options),1),n(_,{modelValue:l.territory.maps__Options__c.colorOptions.labelEnabled,"onUpdate:modelValue":t[3]||(t[3]=d=>l.territory.maps__Options__c.colorOptions.labelEnabled=d),labels:{name:e.$Labels.TerritoryBuilder_Label_Enable},class:"flex-row slds-form-element slds-p-top_x-small"},null,8,["modelValue","labels"]),l.territory.maps__Options__c.colorOptions.labelEnabled?(m(),v(k,{key:0},[n(f,{modelValue:l.territory.maps__Options__c.colorOptions.labelOverride,"onUpdate:modelValue":t[4]||(t[4]=d=>l.territory.maps__Options__c.colorOptions.labelOverride=d),labels:{name:e.$Labels.TerritoryBuilder_Label_TextOverride},class:"slds-p-top_x-small"},null,8,["modelValue","labels"]),n(p,{modelValue:l.territory.maps__Options__c.colorOptions.labelJustification,"onUpdate:modelValue":t[5]||(t[5]=d=>l.territory.maps__Options__c.colorOptions.labelJustification=d),options:s.justificationOptions,labels:{name:e.$Labels.TerritoryBuilder_Label_Justification},idKey:"value",titleKey:"label",class:"slds-p-top_x-small"},null,8,["modelValue","options","labels"]),n(p,{modelValue:l.territory.maps__Options__c.colorOptions.labelFontSize,"onUpdate:modelValue":t[6]||(t[6]=d=>l.territory.maps__Options__c.colorOptions.labelFontSize=d),options:s.fontOptions,labels:{name:e.$Labels.TerritoryBuilder_Label_FontSize},idKey:"value",titleKey:"label",class:"slds-p-top_x-small"},null,8,["modelValue","options","labels"]),o("div",Gt,[n(a,{modelValue:l.territory.maps__Options__c.colorOptions.labelFontColor,"onUpdate:modelValue":t[7]||(t[7]=d=>l.territory.maps__Options__c.colorOptions.labelFontColor=d),labels:{chooseColor:e.$Labels.TerritoryBuilder_Label_FontColor}},null,8,["modelValue","labels"]),n(a,{modelValue:l.territory.maps__Options__c.colorOptions.labelBGColor,"onUpdate:modelValue":t[8]||(t[8]=d=>l.territory.maps__Options__c.colorOptions.labelBGColor=d),labels:{chooseColor:e.$Labels.TerritoryBuilder_Label_BGColor},class:"slds-p-left_x-small"},null,8,["modelValue","labels"])]),n(p,{modelValue:l.territory.maps__Options__c.colorOptions.labelBGOpacity,"onUpdate:modelValue":t[9]||(t[9]=d=>l.territory.maps__Options__c.colorOptions.labelBGOpacity=d),options:s.opacityOptions,labels:{name:e.$Labels.MA_OPACITY},idKey:"value",titleKey:"label",class:"slds-m-bottom_small"},null,8,["modelValue","options","labels"])],64)):L("",!0),o("h2",qt,u(e.$Labels.ShapeLayer_Advanced_Options),1),o("div",Zt,[n(_,{modelValue:l.territory.maps__Options__c.advancedOptions.dissolveGeometry,"onUpdate:modelValue":t[10]||(t[10]=d=>l.territory.maps__Options__c.advancedOptions.dissolveGeometry=d),labels:{name:e.$Labels.ShapeLayer_Merge_Boundaries},class:"slds-p-bottom_x-small"},null,8,["modelValue","labels"]),n(_,{modelValue:l.territory.maps__Options__c.advancedOptions.affectVisibility,"onUpdate:modelValue":t[11]||(t[11]=d=>l.territory.maps__Options__c.advancedOptions.affectVisibility=d),labels:{name:e.$Labels.ShapeLayer_Only_Show_Markers_Inside}},null,8,["modelValue","labels"])])])}const jt=w(xt,[["render",Ht]]),Wt=te(()=>se(()=>import("./DrawOnMap.4d431e3d.js"),[MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/DrawOnMap.4d431e3d.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "bundle.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/main.feeda730.css" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/shapeBuilder-db.c992211c.js" }),MAPS.getURLPath({ base: '/resource/1730379547462/maps__VueDesktopV2/dist/', path: "assets/DrawOnMap.96b29c70.css" })],import.meta.url)),Jt={name:"ShapeBuilderRoot",components:{Modal:de,Tabs:le,Tab:ie,SLDSButton:P,Spinner:x,ShapeDetails:ve,ShapeSelection:Ut,ShapeDisplayOptions:jt,DrawOnMap:Wt,Popover:R,ButtonIcon:z},directives:{"click-outside":oe},props:{modalOptions:{type:Object,required:!0}},emits:["close-modal"],setup(){const e=j(),t=E();return{mainStore:e,v$:t}},data(){return{isLoading:!1,isClone:!1,isPlotted:!1,territory:{Id:null,Name:"",maps__Description__c:"",maps__JobId__c:"",maps__Options__c:{country:"shapesV2",advancedOptions:{calculateTerritoryAggregates:!1,dissolveGeometry:!0,affectVisibility:!1},colorOptions:{fillColor:"#16325C",borderColor:"#3083D3",fillOpacity:"0.2",labelEnabled:!1,labelOverride:"",labelJustification:"center",labelFontSize:"10px",labelFontColor:"#FFFFFF",labelBGColor:"#000000",labelBGOpacity:"0.3"}},maps__ShapeLayerGeometries__r:{records:[]},maps__Folder__c:null,maps__User__c:null,maps__CustomGeometry__c:!1,CreatedBy:{Name:MAPS.currentUser.Name},CreatedDate:new Date().toISOString(),LastModifiedBy:{Name:MAPS.currentUser.Name},LastModifiedDate:new Date().toISOString()},shapeInfo:{country:"",level:"",selected:[],scrollContainer:[]},renderPopover:!1,renderErrorIcon:!1}},computed:{saveText(){return this.isPlotted?this.$Labels.MA_SAVE_AND_REFRESH:this.$Labels.MA_SAVE_AND_PLOT},createdInfo(){const e=this.$F("DateTime",new Date(this.territory.CreatedDate),{"12hour":!0,hour:"numeric",minute:"numeric",year:"numeric",month:"numeric",day:"numeric"}),t=this.$F("DateTime",new Date(this.territory.LastModifiedDate),{"12hour":!0,hour:"numeric",minute:"numeric",year:"numeric",month:"numeric",day:"numeric"});return $(this.$Labels.ShapeLayer_Created_Text,[this.territory.CreatedBy.Name,e,this.territory.LastModifiedBy.Name,t])},clickOutsideOptions(){return{active:this.renderPopover,handler:this.isCurrentPanelValid}}},watch:{"shapeInfo.country":{handler(e){this.territory.maps__Options__c.country=e}}},unmounted(){this.mainStore.showShapeDrawMode=!1},async created(){if(this.modalOptions?.territory?.Id)this.checkShapeLayer(this.modalOptions?.territory?.Id),this.isSavedLayer=!0,await this.getSavedShapeData(this.modalOptions.territory.Id),this.modalOptions.isClone&&(this.territory.Id=null,this.territory.Name=`Copy of ${this.territory.Name}`);else{const{folder:e}=this.modalOptions;e==="PersonalRoot"||e==="RoleUserFolder"?this.territory.maps__User__c=MAPS.currentUser.Id:e==="CorporateRoot"||(this.territory.maps__Folder__c=e)}this.isPlotted=this.modalOptions?.isPlotted||!1},methods:{showError(e){this.mainStore.toast({message:e,state:"error"})},async getSavedShapeData(e){this.isLoading=!0;const t={ajaxResource:"TerritoryAJAXResources",action:"getTerritory",id:e};try{const{success:l,data:r}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[t]);if(!l){console.error(r),this.showError("Unable to retrieve saved shape data"),this.isLoading=!1;return}const{territory:s={}}=r;try{s.maps__Options__c=JSON.parse(s.maps__Options__c),this.territory.maps__Options__c={...this.territory.maps__Options__c,...s?.maps__Options__c}}catch{this.showError("Unable to load some options from this shape.  Some information will need to updated")}this.territory={...this.territory,...s},this.reBuildSavedTerritoryGeometries(s.maps__ShapeLayerGeometries__r.records)}catch{this.showError("Unable to retrieve saved shape data")}this.isLoading=!1},async checkShapeLayer(e){const{success:t,data:l}=await MAPS.Utils.Apex.invoke("maps.AutoAssignmentController.isShapeUsedInPlan",[e]);t&&l&&this.mainStore.toast({message:this.$Labels.AutoAssignment_ShapeLayer_Warning,state:"warning",duration:1e4})},async reBuildSavedTerritoryGeometries(e){const[t]=e;let l={};const{country:r}=this.territory.maps__Options__c;try{const a=t.maps__Geometry__c||"{}",p=t.maps__Geometry2__c||"",_=t.maps__Geometry3__c||"",f=t.maps__Geometry4__c||"",d=t.maps__Geometry5__c||"",S=t.maps__Geometry6__c||"",C=t.maps__Geometry7__c||"",c=t.maps__Geometry8__c||"",A=t.maps__Geometry9__c||"",M=t.maps__Geometry10__c||"";l=JSON.parse(a+p+_+f+d+S+C+c+A+M)}catch(a){this.showError(this.$Labels.ShapeLayer_Cannot_Show_Data),console.warn("Unable to parse custom shape info",a),console.warn(t.maps__Geometry__c);return}const s=[],i=Object.keys(l);for(let a=0;a<i.length;a++){let p=i[a]||"";const _=l[p]||[];p==="states"?p="1":p==="counties"?p="2":p==="zips"&&(p="4");for(let f=0;f<_.length;f++){let d=_[f];r==="USA"&&p==="2"?d.indexOf("USA-2-")===0?s.push({level:p,value:d,active:!0,guid:F(),plotted:!1,label:d,dirty:!0}):s.push({level:p,value:`USA-2-${d.substring(4)}`,active:!0,guid:F(),plotted:!1,label:`USA-2-${d.substring(4)}`,dirty:!0}):(d=d.replace(/ +(?= )/g,"").replace(/ /g,"_"),s.push({level:p,value:d,active:!0,guid:F(),plotted:!1,label:d,dirty:!0}))}}this.shapeInfo.scrollContainer=s},isCurrentPanelValid(){this.v$.$touch();const e=this.v$.$invalid;return this.renderErrorIcon=e,this.renderPopover=e,!e},togglePopover(){this.renderPopover=!this.renderPopover},async save(e){if(!this.isCurrentPanelValid())return;if(this.shapeInfo.scrollContainer.length===0&&this.shapeInfo.selected.length===0){this.$nextTick(()=>{this.renderErrorIcon=!0,this.renderPopover=!0});return}this.isLoading=!0;const t=this.buildGeoIdSaveData(),r={ajaxResource:"TerritoryAJAXResources",action:"saveBoundaryInfo",serializedTerritory:this.buildTerritorySaveData(),serializedGeometry:t},{success:s=!1,data:i}=await MAPS.Utils.Apex.invoke("maps.RemoteFunctions.processAJAXRequest",[r]);s?(this.modalOptions.callback({plotOnSave:e===!0,name:this.territory.Name,description:this.territory.maps__Description__c,layerId:i.Id}),re.trackFeature({logPayload:{featureName:"shape_layer_created"}}),this.$emit("close-modal")):this.showError(this.$Labels.ShapeLayer_Try_Save_Again),this.isLoading=!1},buildGeoIdSaveData(){const e={},t=[...this.shapeInfo.selected,...this.shapeInfo.scrollContainer],l={};t.forEach(a=>{const{level:p,value:_}=a;e[p]=e[p]||[],l[_]||(l[_]=1,e[p].push(_))});const s=JSON.stringify(e).match(/.{1,100000}/g),i={Name:`${this.territory.Name}-geometry`,maps__Geometry__c:s[0]||"{}",maps__Geometry2__c:s[1]||"",maps__Geometry3__c:s[2]||"",maps__Geometry4__c:s[3]||"",maps__Geometry5__c:s[4]||"",maps__Geometry6__c:s[5]||"",maps__Geometry7__c:s[6]||"",maps__Geometry8__c:s[7]||"",maps__Geometry9__c:s[8]||"",maps__Geometry10__c:s[9]||""};return JSON.stringify(i)},buildTerritorySaveData(){const e=this.territory.maps__Options__c,{colorOptions:t={}}=e;this.validateTerritoryLabelSaveData(t);const l=JSON.stringify(e),r={Name:this.territory.Name,maps__Description__c:this.territory.maps__Description__c,maps__User__c:this.territory.maps__User__c,maps__Folder__c:this.territory.maps__Folder__c,Id:this.territory.Id,maps__Options__c:l,maps__JobId__c:""};return JSON.stringify(r)},validateTerritoryLabelSaveData(e){return e.labelEnabled||(e.labelOverride="",e.labelJustification="center",e.labelFontColor="#FFFFFF",e.labelBGColor="#000000",e.labelBGOpacity="0.3",e.labelFontSize="10px"),e},saveAndPlot(){this.save(!0)}}},Kt={id:"shapeBuilderModalWrapper"},Qt=["title"],Xt={id:"sketch-tabs",style:{height:"100%"}},Yt={class:"slds-grid"},es={class:"slds-col slds-col_bump-right slds-size_3-of-6"},ts={class:"slds-grid slds-grid_align-start"},ss={class:"slds-col"},ls={class:"slds-grid slds-grid_align-end"};function is(e,t,l,r,s,i){const a=h("DrawOnMap"),p=h("Spinner"),_=h("Popover"),f=h("ShapeDetails"),d=h("Tab"),S=h("ShapeSelection"),C=h("ShapeDisplayOptions"),c=h("Tabs"),A=h("ButtonIcon"),M=h("SLDSButton"),J=h("Modal"),K=ae("click-outside");return m(),v("div",Kt,[(m(),O(ne,null,[r.mainStore.showShapeDrawMode?(m(),O(a,{key:0,territory:s.territory,"onUpdate:territory":t[0]||(t[0]=b=>s.territory=b),isPlotted:s.isPlotted,"onUpdate:isPlotted":t[1]||(t[1]=b=>s.isPlotted=b),shapeInfo:s.shapeInfo,"onUpdate:shapeInfo":t[2]||(t[2]=b=>s.shapeInfo=b),onCancelBuilder:t[3]||(t[3]=b=>e.$emit("close-modal")),onSave:i.saveAndPlot},null,8,["territory","isPlotted","shapeInfo","onSave"])):L("",!0)],1024)),I(n(J,{id:"shapeBuilderModal",title:e.$Labels.ShapeLayer_Header,labels:{close:e.$Labels.MA_Close},isLoading:s.isLoading,size:"large",onClose:t[10]||(t[10]=b=>e.$emit("close-modal"))},{content:y(()=>[s.isLoading?(m(),O(p,{key:0})):L("",!0),s.renderPopover?I((m(),O(_,{key:1,bindTo:e.$refs.errorIcon.$el,theme:"error",width:"large",onClose:i.togglePopover},{header:y(()=>[o("span",{title:e.$Labels.modal_MLB_popover_Snag_Error_Button_Text},u(e.$Labels.modal_MLB_popover_Snag_Error_Button_Text),9,Qt)]),content:y(()=>[g(u(e.$Labels.modal_MLB_popover_Review_Fields_Button_Text),1)]),_:1},8,["bindTo","onClose"])),[[K,void 0,i.clickOutsideOptions]]):L("",!0),o("div",Xt,[n(c,{vertical:"",class:"content",onRequestTabChange:i.isCurrentPanelValid},{default:y(()=>[n(d,{id:"shapeBuilderDetails",title:e.$Labels.ShapeLayer_Details_Tab},{default:y(()=>[n(f,{ref:"shapeDetails",territory:s.territory,"onUpdate:territory":t[4]||(t[4]=b=>s.territory=b),style:{"min-height":"400px"}},null,8,["territory"])]),_:1},8,["title"]),n(d,{id:"shapeBuilderSelections",style:{"min-height":"400px"},title:e.$Labels.ShapeLayer_Shape_Selection_Tab},{default:y(()=>[n(S,{ref:"shapeSelection",isLoading:s.isLoading,"onUpdate:isLoading":t[5]||(t[5]=b=>s.isLoading=b),territory:s.territory,"onUpdate:territory":t[6]||(t[6]=b=>s.territory=b),shapeInfo:s.shapeInfo,"onUpdate:shapeInfo":t[7]||(t[7]=b=>s.shapeInfo=b)},null,8,["isLoading","territory","shapeInfo"])]),_:1},8,["title"]),n(d,{id:"shapeDisplayOptions",title:e.$Labels.ShapeLayer_Display_Tab},{default:y(()=>[n(C,{ref:"shapeDisplayOptions",territory:s.territory,"onUpdate:territory":t[8]||(t[8]=b=>s.territory=b),style:{"min-height":"400px"}},null,8,["territory"])]),_:1},8,["title"])]),_:1},8,["onRequestTabChange"])])]),footer:y(()=>[o("div",Yt,[o("div",es,[o("div",ts,u(i.createdInfo),1)]),o("div",ss,[o("div",ls,[I(n(A,{id:"shapeLayerTogglePopoverBtnResource",ref:"errorIcon",assistiveText:e.$Labels.MA_Error,title:e.$Labels.MA_Error,iconCategory:"utility",iconName:"error",iconSize:"large",class:"slds-button_icon-error",onClick:i.togglePopover},null,8,["assistiveText","title","onClick"]),[[T,s.renderErrorIcon]]),n(M,{variant:"brand",disabled:s.isLoading,onClick:i.save},{default:y(()=>[g(u(e.$Labels.ShapeLayer_Save_Close_Button),1)]),_:1},8,["disabled","onClick"]),n(M,{variant:"brand",disabled:s.isLoading,onClick:i.saveAndPlot},{default:y(()=>[g(u(i.saveText),1)]),_:1},8,["disabled","onClick"]),n(M,{variant:"neutral",disabled:s.isLoading,onClick:t[9]||(t[9]=b=>e.$emit("close-modal"))},{default:y(()=>[g(u(e.$Labels.MA_Cancel),1)]),_:1},8,["disabled"])])])])]),_:1},8,["title","labels","isLoading"]),[[T,!r.mainStore.showShapeDrawMode]])])}const hs=w(Jt,[["render",is]]);export{hs as default};
