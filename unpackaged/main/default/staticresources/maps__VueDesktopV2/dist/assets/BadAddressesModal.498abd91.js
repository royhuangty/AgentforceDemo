import{_ as B,l as P,a5 as k,J as g,K as C,bm as T,bn as R,r as u,o as a,b as M,w as n,j as A,t as i,h as t,c as d,e as r,q as S,a0 as N,F as f,i as m}from"../bundle.js";import{P as O}from"./papaparse.min.347d385d.js";import{M as E}from"./Modal.76578f76.js";const V={name:"BadAddressesModal",components:{SLDSButton:P,Checkbox:k,ActionMenu:g,ActionMenuItem:C,Modal:E},props:{modalOptions:{type:Object,required:!0},modalType:{type:String,required:!0}},emits:["close-modal"],data(){return{isBadAddresses:!0,isBadDevices:!1,isUnmetCriteria:!1,isBadPolyline:!1,badRecords:[]}},computed:{exportTypes(){return[{type:"csv",label:this.$Labels.Layers_Saved_Layer_Modal_Export_All_Button_Option_CSV},{type:"xls",label:this.$Labels.Layers_Saved_Layer_Modal_Export_All_Button_Option_Excel}]},modalTitle(){return MAPS.Utils.Labels.format(this.$Labels.Layers_Saved_Layer_Modal_Header_Text_Saved_Layer_Name,[this.modalOptions?.layer?.name||""])},badRecordsLabel(){return this.isBadAddresses?MAPS.Utils.Labels.format(this.$Labels.Layers_Saved_Layer_Modal_Text_Bad_Addresses,[this.badRecords.length]):this.isBadPolyline?MAPS.Utils.Labels.format(this.$Labels.Layers_On_The_Map_Plotted_Invalid_Polylines,[this.badRecords.length]):this.isBadDevices?MAPS.Utils.Labels.format(this.$Labels.Layers_Live_Saved_Layer_Modal_Bad_Device_ID_Total,[this.badRecords.length]):MAPS.Utils.Labels.format(this.$Labels.Layers_Live_Saved_Layer_Modal_Not_Visible_Records_Did_Not_Meet_Report_Total,[this.badRecords.length])}},created(){if(this.isBadAddresses=this.modalType==="bad-addresses",this.isBadPolyline=this.modalType==="bad-polyline-records",this.isBadDevices=this.modalType==="bad-devices",this.isUnmetCriteria=this.modalType==="unmet-criteria-devices",this.badRecords=this.modalOptions.badRecords,this.isBadAddresses){const e=this.$props.modalOptions.layer.queryData.isPolymorphic||!1,c=this.$props.modalOptions.layer.queryData.polymorphicObject||null;this.badRecords.forEach(_=>{_.attributes.address=_.attributes.address!==void 0?_.attributes.address:T({addressFields:this.$props.modalOptions.layer.queryData.addressFields,record:_,userLocale:MAPS.currentUser.Locale,isPolymorphic:e,polymorphcObject:c})||"",_.selected=!1})}},methods:{openRecord(e){MAPS.Utils.openRecordLink(e)},dropPin(e){R.dropPinForMissingAddress(e,this.$props.modalOptions.layer.qid),this.$emit("close-modal")},processExport(e,c=!0){const _=[],$=[this.$Labels.Record_Id,this.$Labels.AdvRoute_VisitPlan_DataSetWizard_Details_BaseObjectTable_ObjectType,this.$Labels.Saved_Query_Name,this.$props.modalOptions.layer.queryData?.tooltips[0]?.FieldLabel||"",this.$Labels.MA_Street,this.$Labels.MA_City,this.$Labels.MA_State,this.$Labels.MA_Zip_Code,this.$Labels.MA_Country];_.push($);const l=this.$props.modalOptions.layer.name,o=this.$props.modalOptions.layer.baseObjectLabel||this.$props.modalOptions.layer.queryData.options.baseObjectLabel;this.badRecords.forEach(s=>{let b;(c||s.selected)&&(b=[s.Id,o,l,s.attributes.title,s.addressFields?.street||"",s.addressFields?.city||"",s.addressFields?.state||"",s.addressFields?.zip||"",s.addressFields?.country||""],_.push(b))});const D=O.unparse({data:_}),p=new Blob([D],{type:"text/csv;charset=utf-8;"}),v=window.URL.createObjectURL(p);let L=this.$Labels.Maps_Bad_Addresses;this.isBadAddresses||(L=this.isBadDevices?this.$Labels.Maps_Bad_Devices:this.$Labels.Maps_Devices_with_Unmet_Criteria);const y=document.createElement("a");y.href=v,y.setAttribute("download",`${L}.${e}`),y.click(),this.$emit("close-modal")},formattedDateTime(e){if(e?.metadata?.lastEventDate&&e?.metadata?.lastEventTime){if(e.metadata.lastEventDate===MAPS.app.config.globalProperties.$Labels.Data_Not_Available||e.metadata.lastEventTime===MAPS.app.config.globalProperties.$Labels.Data_Not_Available){if(e.metadata.lastEventDate!==MAPS.app.config.globalProperties.$Labels.Data_Not_Available)return e.metadata.lastEventDate;if(e.metadata.lastEventTime!==MAPS.app.config.globalProperties.$Labels.Data_Not_Available)return e.metadata.lastEventTime}return`${e.metadata.lastEventDate} ${e.metadata.lastEventTime}`}return this.$Labels.Data_Not_Available}}},U={class:"slds-table slds-table_cell-buffer slds-table_bordered","aria-labelledby":"element-with-table-label other-element-with-table-label","data-test-id":"bad-records-table"},I={class:"slds-line-height_reset"},F={scope:"col"},j=["title"],q={key:0,scope:"col"},w=["title"],z={key:1,scope:"col"},W=["title"],Q={key:2,scope:"col"},H=["title"],J={key:3,scope:"col"},K=["title"],Z={key:4,scope:"col"},x=["title"],G=["data-label"],X={class:"slds-grid slds-grid_vertical-align-center"},Y=["title","onClick"],ee=["data-label"],se=["title"],te=["data-label"],ae=["title"],le=["onClick"],ie=["data-label"],de=["title"],oe=["data-label"],re=["title"],_e=["data-label"],ne=["title"],ce={class:"slds-grid slds-grid_align-end"},be={class:"slds-col slds-p-right_small"},pe={class:"slds-col slds-p-right_small"},Le={class:"slds-col"};function ye(e,c,_,$,l,o){const D=u("Checkbox"),p=u("SLDSButton"),v=u("ActionMenuItem"),L=u("ActionMenu"),y=u("Modal");return a(),M(y,{title:o.modalTitle,size:"base",onClose:c[1]||(c[1]=s=>e.$emit("close-modal"))},{tagline:n(()=>[A(i(o.badRecordsLabel),1)]),content:n(()=>[t("table",U,[t("thead",null,[t("tr",I,[t("th",F,[t("div",{class:"slds-truncate",title:e.$Labels.Layers_Live_Saved_Layer_Modal_Record},i(e.$Labels.Layers_Live_Saved_Layer_Modal_Record),9,j)]),l.isBadAddresses?(a(),d("th",q,[t("div",{class:"slds-truncate",title:e.$Labels.MA_Address},i(e.$Labels.MA_Address),9,w)])):r("",!0),l.isBadAddresses?(a(),d("th",z,[t("div",{class:"slds-truncate",title:e.$Labels.Layers_Saved_Layer_Modal_Button_Drop_Pin},i(e.$Labels.Layers_Saved_Layer_Modal_Button_Drop_Pin),9,W)])):r("",!0),l.isBadDevices?(a(),d("th",Q,[t("div",{class:"slds-truncate",title:e.$Labels.Layers_Live_Saved_Layer_Modal_Device_ID},i(e.$Labels.Layers_Live_Saved_Layer_Modal_Device_ID),9,H)])):r("",!0),l.isUnmetCriteria?(a(),d("th",J,[t("div",{class:"slds-truncate",title:e.$Labels.Layers_Live_Saved_Layer_Modal_Not_Visible_Last_Report_Date_Time},i(e.$Labels.Layers_Live_Saved_Layer_Modal_Not_Visible_Last_Report_Date_Time),9,K)])):r("",!0),l.isUnmetCriteria?(a(),d("th",Z,[t("div",{class:"slds-truncate",title:e.$Labels.Layers_Live_Saved_Layer_Modal_Not_Visible_Why_Not_Visible},i(e.$Labels.Layers_Live_Saved_Layer_Modal_Not_Visible_Why_Not_Visible),9,x)])):r("",!0)])]),t("tbody",null,[(a(!0),d(f,null,S(l.badRecords,(s,b)=>(a(),d("tr",{key:b,class:"slds-hint-parent"},[t("th",{"data-label":e.$Labels.Layers_Live_Saved_Layer_Modal_Record,scope:"row",class:"slds-cell-wrap"},[t("div",X,[l.isBadPolyline?r("",!0):(a(),M(D,{key:0,modelValue:s.selected,"onUpdate:modelValue":h=>s.selected=h,labels:{name:" "}},null,8,["modelValue","onUpdate:modelValue"])),t("a",{href:"#",class:N(["slds-text-link",{"slds-p-left_small":!l.isBadPolyline}]),title:s.attributes.title,onClick:h=>o.openRecord(s.Id)},i(s.attributes.title),11,Y)])],8,G),l.isBadAddresses?(a(),d("td",{key:0,"data-label":e.$Labels.MA_Address,class:"slds-cell-wrap"},[t("div",{class:"slds-line-clamp",title:s.attributes.address},i(s.attributes.address),9,se)],8,ee)):r("",!0),l.isBadAddresses?(a(),d("td",{key:1,"data-label":e.$Labels.Layers_Saved_Layer_Modal_Button_Drop_Pin,class:"slds-cell-wrap"},[t("div",{class:"slds-line-clamp",title:e.$Labels.Layers_Saved_Layer_Modal_Button_Drop_Pin},[t("a",{href:"#","data-test-id":"drop-pin-link",class:"slds-text-link",onClick:h=>o.dropPin(s)},i(e.$Labels.Layers_Saved_Layer_Modal_Button_Drop_Pin),9,le)],8,ae)],8,te)):r("",!0),l.isBadDevices?(a(),d("td",{key:2,"data-label":e.$Labels.Layers_Live_Saved_Layer_Modal_Device_ID,class:"slds-cell-wrap"},[t("div",{class:"slds-line-clamp",title:s.deviceId},i(s.deviceId),9,de)],8,ie)):r("",!0),l.isUnmetCriteria?(a(),d("td",{key:3,"data-label":e.$Labels.Layers_Live_Saved_Layer_Modal_Not_Visible_Last_Report_Date_Time},[t("div",{class:"slds-truncate",title:o.formattedDateTime(s.device)},i(o.formattedDateTime(s.device)),9,re)],8,oe)):r("",!0),l.isUnmetCriteria?(a(),d("td",{key:4,"data-label":e.$Labels.Layers_Live_Saved_Layer_Modal_Not_Visible_Why_Not_Visible},[t("div",{class:"slds-truncate",title:e.$Labels.Layer_Configurations},i(e.$Labels.Layer_Configurations),9,ne)],8,_e)):r("",!0)]))),128))])])]),footer:n(()=>[t("div",ce,[t("div",be,[m(p,{variant:"neutral",onClick:c[0]||(c[0]=s=>e.$emit("close-modal"))},{default:n(()=>[A(i(e.$Labels.MA_Close),1)]),_:1})]),l.isBadPolyline?r("",!0):(a(),d(f,{key:0},[t("div",pe,[m(L,null,{button:n(()=>[m(p,{iconCategory:"utility",iconName:"down",iconPosition:"right",variant:"brand"},{default:n(()=>[A(i(e.$Labels.Layers_Saved_Layer_Modal_Button_Export_All),1)]),_:1})]),default:n(()=>[(a(!0),d(f,null,S(o.exportTypes,(s,b)=>(a(),M(v,{key:b,label:s.label,onClick:h=>o.processExport(s.type,!0)},null,8,["label","onClick"]))),128))]),_:1})]),t("div",Le,[m(L,null,{button:n(()=>[m(p,{iconCategory:"utility",iconName:"down",iconPosition:"right",variant:"brand"},{default:n(()=>[A(i(e.$Labels.Layers_Saved_Layer_Modal_Button_Export_Selected),1)]),_:1})]),default:n(()=>[(a(!0),d(f,null,S(o.exportTypes,(s,b)=>(a(),M(v,{key:b,label:s.label,onClick:h=>o.processExport(s.type,!1)},null,8,["label","onClick"]))),128))]),_:1})])],64))])]),_:1},8,["title"])}const ve=B(V,[["render",ye],["__scopeId","data-v-90d605cb"]]);export{ve as default};
