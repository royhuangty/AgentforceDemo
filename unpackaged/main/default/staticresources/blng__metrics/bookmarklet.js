!function(){"use strict";function e(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<1){var n=20+60*e;return["<li class='tick' style='height="+n+"%'></li>"]}for(var r=[],i=0;i<e;i++)t?r.push("<li class='tick processing'></li>"):r.push("<li class='tick'></li>");return r}function t(){return"undefined"==typeof document.currentScript&&(document.currentScript=function(){var e=document.getElementsByTagName("script");return e[e.length-1]}()),document.currentScript}function n(){if(!window.bptTracker){var e=new f,n=t().getAttribute("showSticker");n&&"false"!==n&&(e.showSticker=!0),window.bptTracker=e}}function r(){if(!window.metricsService){var e=new v(window.bptTracker),n=t().getAttribute("handlerObject"),r=t().getAttribute("handlerFunction");if(n){for(var i=n.split("."),o=void 0,a=0;a<i.length;a++){var s=i[a];if(!o){if("this"===s){o=this;continue}if(o=window,"window"===s)continue}o=o[s]}n=o}r&&(r=n?n[r]:this[r],e.addSendHandler(function(e){r(e)})),window.metricsService=e}}var i=(function(){var e="function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103;return function(t,n,r,i){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=i;else if(a>1){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+3];n.children=c}return{$$typeof:e,type:t,key:void 0===r?null:""+r,ref:null,props:n,_owner:null}}}(),function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,i){var s={key:e,arg:t,resolve:n,reject:i,next:null};a?a=a.next=s:(o=a=s,r(e,t))})}function r(n,o){try{var a=t[n](o),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(a.done?"return":"normal",a.value)}catch(c){i("throw",c)}}function i(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}o=o.next,o?r(o.key,o.arg):a=null}var o,a;this._invoke=n,"function"!=typeof t["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype["throw"]=function(e){return this._invoke("throw",e)},t.prototype["return"]=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c=(function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(c){i=!0,o=c}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),function(){function e(){i(this,e),this.listeners=new Map}return o(e,[{key:"addListener",value:function(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}},{key:"removeListener",value:function(e,t){var n=this.listeners.get(e),r=void 0;return!!(n&&n.length&&(r=n.reduce(function(e,n,r){return isFunction(n)&&n===t?e=r:e},-1),r>-1))&&(n.splice(r,1),this.listeners.set(e,n),!0)}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this.listeners.get(e);return!(!i||!i.length)&&(i.forEach(function(e){e.apply(void 0,n)}),!0)}}]),e}()),u=1e3/60,l=3e3,d=2.1,h=l/u,f=function(e){function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._init(),e.openXhrs=0;var n=e;return function(){var e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){n._onXhrChange(!0),this.addEventListener("readystatechange",function(){4==this.readyState&&n._onXhrChange(!1)},!1),e.apply(this,arguments)}}(XMLHttpRequest),window.addEventListener("load",function(){var e=document.getElementsByTagName("IFRAME");n.openFrames=e.length;for(var t=0;t<e.length;t++){var r=e[t],i=r.contentWindow||r.contentDocument;if(i.document&&(i=i.document),"complete"===i.readyState){var o=r.src.trim(),a=i.location.href;if("about:blank"===a&&"about:blank"!==o&&""!==o){r.addEventListener("load",n._onIFrameLoaded);var s=setInterval(function(){i.location.src||(clearInterval(s),n._onIFrameLoaded())},100)}else n.openFrames--}else r.addEventListener("load",n._onIFrameLoaded)}}),e}return a(t,e),o(t,[{key:"start",value:function(e){var t=this;e=e||{},e.resetOnClick===!0&&document.addEventListener("click",function(){t._start()},!0),this._start()}},{key:"_start",value:function(){window&&(window.cancelAnimationFrame(this.requestAnimationFrameId),this._init(),this._tracking=!0,this.emit("start-recording"),this._onRAF())}},{key:"stop",value:function(e){window&&(window.cancelAnimationFrame(this.requestAnimationFrameId),this._tracking&&(this._tracking=!1,this.emit("end-recording",e)))}},{key:"_uuidv4",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}},{key:"_init",value:function(){this.frameCounter=0,this.requestAnimationFrameId=0,this.processingPeriods=[],this.requestId=this._uuidv4();var e=performance.now();this.lastClickTS=e,this.lastRAFTS=e,this.eptCandidateTS=e,this.xhrRequestIds=[]}},{key:"_onXhrChange",value:function(e){this._tracking&&(e?this.openXhrs++:(this.openXhrs--,this._onRAF(performance.now(),!0)))}},{key:"_onIFrameLoaded",value:function(){this._tracking&&(this.openFrames--,this._onRAF(performance.now(),!0))}},{key:"_getEnvInfo",value:function(){if(!this.envInfo){var e=navigator.userAgent.toLowerCase(),t=/(edge)[ \/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],n=t[1]||"",r=t[2]||"0";"webkit"===n&&(n="safari"),this.envInfo={browser:n,version:r,osName:navigator.platform,language:navigator.language}}return this.envInfo}},{key:"_onRAF",value:function(e,t){var n=e;if(t||this.frameCounter++,n-u*d>this.lastRAFTS)this.processingPeriods.push({start:this.lastRAFTS,end:n}),this.eptCandidateTS=n;else if(n-this.eptCandidateTS>l&&this._isIdle())return void this._onFinish();t||(this.lastRAFTS=n,this.requestAnimationFrameId=window.requestAnimationFrame(this._onRAF.bind(this)))}},{key:"_onFinish",value:function(){if(window){var e=Math.max(Math.round(this.eptCandidateTS-this.lastClickTS),0),t=Math.max(Math.round(this.eptCandidateTS-this.lastClickTS-(this.frameCounter-h)*u),0);if(!t){for(var n=0,r=0;r<this.processingPeriods.length;r++){var i=this.processingPeriods[r];n+=i.end-i.start}t=Math.floor(e-n)}var o=this._getEnvInfo();this.stop({uri:window.location.href,uiRequestId:this.requestId,ept:e,bpt:t,browser:o.browser,browserVersion:o.version,osName:o.osName,language:o.language,start:this.lastClickTS,end:this.eptCandidateTS,processingPeriods:this.processingPeriods})}}},{key:"_isIdle",value:function(){return window.$A&&$A.clientService&&$A.clientService.$idle$?$A.clientService.$idle$():this.openXhrs<=0&&this.openFrames<=0}}]),t}(c),p=function(){for(var e=arguments,t={all:[],keys:e},n=0;n<e.length;n++)t[e[n]]=n,t.all[n]=n;return t};p.parse=function(e,t){for(var n=0;n<e.keys.length;n++)if(e.keys[n]===t)return e.all[n]};var m={EntryTypeEnum:p("navigation","paint","mark","measure","resource"),Resource:{InitiatorTypeEnum:p("xmlhttprequest","iframe","frame")}},v=function(){function e(t){i(this,e),this._sendHandlers=[],this._initLogs(),this._calcBootstrap=!0;var n={"start-recording":this._onStartRecording.bind(this),"end-recording":this._onEndRecording.bind(this)};Object.keys(n).forEach(function(e){t.addListener(e,function(t){n[e](t)})});var r=this;window.addEventListener("beforeunload",function(e){r.send()})}return o(e,[{key:"_initLogs",value:function(){this.performanceTimeline=[]}},{key:"_onStartRecording",value:function(){}},{key:"_onEndRecording",value:function(e){this._recordResourceTimings(e)}},{key:"_markNameSerialize",value:function(e,t){return JSON.stringify({name:e,data:t})}},{key:"_markNameDeserialize",value:function(e){if("{"===e.name.charAt(0)&&"}"===e.name.charAt(e.name.length-1)){var t=JSON.parse(e.name);e.data=t.data,e.name=t.name}}},{key:"mark",value:function(e,t){performance.mark(this._markNameSerialize(e,t))}},{key:"markStart",value:function(e){performance.mark(e+"_start")}},{key:"markEnd",value:function(e,t){performance.mark(e+"_end"),performance.measure(this._markNameSerialize(e,t),e+"_start",e+"_end")}},{key:"markBootstrapEnd",value:function(e){this._calcBootstrap=!1;var t="bootstrap";performance.mark(t+"_end"),performance.measure(this._markPlusData(t,e),"navigationStart",t+"_end")}},{key:"benchmark",value:function(e){var t=this;return function(){t.markStart(e.name);var n=e.apply(this,arguments);return t.markEnd(e.name),n}}},{key:"_recordResourceTimings",value:function(e){if(e){if(e.performanceEntries=[],void 0===performance)return void e.performanceEntries.push("Error: performance NOT supported");var t=performance.getEntries();if(void 0===t||t.length<=0)return void e.performanceEntries.push("Error: no resource type performance data");for(var n=0,r=t[0].startTime,i=0;i<t.length;i++){var o=t[i],a=p.parse(m.EntryTypeEnum,o.entryType);if("undefined"!=typeof a){var s=void 0;if(a!==m.EntryTypeEnum.resource||(s=p.parse(m.Resource.InitiatorTypeEnum,o.initiatorType),"undefined"!=typeof s)){if(!(o.startTime+o.duration<e.start)){this._calcBootstrap||a===m.EntryTypeEnum.measure&&"bootstrap"===o.name&&(n=o.duration);var c=this._summarizeResourcePerfInfo(o);[m.EntryTypeEnum.mark,m.EntryTypeEnum.measure].indexOf(a)!==-1&&this._markNameDeserialize(c),e.performanceEntries.push(c)}}else this._calcBootstrap&&(n=Math.max(n,o.startTime+o.duration))}}if(this._calcBootstrap){var u=this._summarizeResourcePerfInfo({duration:n,entryType:"measure",name:"bootstrap",startTime:r});e.performanceEntries.push(u)}e.bootstrapTimeMs=n-r,this.performanceTimeline.push(e),this.send()}}},{key:"_summarizeResourcePerfInfo",value:function(e){return{name:e.name,entryType:e.entryType,initiatorType:e.initiatorType,startTime:e.startTime,duration:e.duration,size:e.encodedBodySize?e.encodedBodySize:e.decodedBodySize,fetchStart:e.fetchStart,requestStart:e.requestStart,dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ttfb:e.responseStart-e.startTime,transfer:e.responseEnd-e.responseStart,transferSize:e.transferSize}}},{key:"send",value:function(){if(this._sendHandlers.length&&this.performanceTimeline.length>0){for(var e=0;e<this._sendHandlers.length;e++)this._sendHandlers[e](this.performanceTimeline);this._initLogs()}}},{key:"addSendHandler",value:function(e){this._sendHandlers.push(e)}}]),e}(),g={en:{legend:"Top bar: XHR processing, Bottom graph: rendering",status:"Status",toggleResults:"Toggle Results"}},y="",k=function(){function e(){throw i(this,e),new Error("Cannot construct singleton")}return o(e,null,[{key:"getLocale",value:function(){return y||(y=navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]),y}},{key:"setLocale",value:function(t){y=t,e.init()}},{key:"_init",value:function(){var t=this.getLocale();e.i18n=g[t],!e.i18n&&t.length>2&&(e.i18n=g[t.substring(0,2)]),e.i18n||(e.i18n=g[0])}}]),e}();k.type="localization",k._init();var b=150,w="\n.bpt-sticker {\n  position: fixed;\n  top: 5px;\n  right: 5px;\n  z-index: 1000;\n  border: 1px solid rgba(150,150,150,0.3);\n  border-radius: 3px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.07);\n  background: #F7F7F7;\n}\n\n.bpt-sticker .perf-sticker-hide {\n  display: none;\n}\n.bpt-sticker .perf-sticker-show {\n  display: block;\n}\n.bpt-sticker .perf-sticker-toggle {\n  text-decoration: none !important;\n}\n.bpt-sticker .font-waiting {\n  color: grey;\n}\n.bpt-sticker .font-ready {\n  color: blue;\n}\n\n.bpt-sticker header {\n  padding: 5px;\n  border-bottom: 1px solid rgba(150,150,150,0.3);\n}\n\n.bpt-sticker .metrics {\n  margin: 0;\n  padding: 5px;\n  list-style: none;\n  border-bottom: 1px solid rgba(150,150,150,0.3);\n}\n\n.bpt-sticker .timeline {\n  min-width: "+b+"px;\n  height: 40px;\n  list-style: none;\n  margin: 3px;\n  padding: 0;\n  background-color: #02A1E0;\n  position: relative;\n}\n\n.bpt-sticker .tick {\n  width: 1px;\n  height: 80%;\n  float: left;\n  background-color: #16325C;\n}\n\nli.xhr {\n  position: absolute;\n  background: yellow;\n  height: 2px;\n}\n\n.bpt-sticker .tick.processing {\n  height: 20%;\n}\n\n@keyframes changeColor {\n\t0% {\n\t\tbackground-color: #F44336;\n\t}\n\t100% {\n\t\tbackground-color: #EE7B72;\n\t}\n}\n\n.bpt-sticker .icon-record {\n  width: 15px;\n  height: 15px;\n  margin-left: 10px;\n  display: block;\n  float: right;\n  border-radius: 15px;\n  background-color: #C5C5C5;\n}\n\n.bpt-sticker .icon-record.recording {\n  animation: changeColor .7s infinite;\n}\n",_=function(){function t(e){var n=this;i(this,t),this.tracker=e,this.isRecording=!1,this.ept=0,this.bpt=0,this.timeline=null,this.stickerContainer=document.createElement("div"),this.stickerContainer.className="bpt-sticker",document.body.appendChild(this.stickerContainer);var r=document.createElement("style");r.innerText=w,document.body.appendChild(r);var o={"start-recording":this._onStartRecording.bind(this),"end-recording":this._onEndRecording.bind(this)};Object.keys(o).forEach(function(e){n.tracker.addListener(e,function(t){o[e](t),n._render()})}),this._render()}return o(t,[{key:"_onStartRecording",value:function(){this.isRecording=!0,this.ept=0,this.bpt=0,this.timeline=null}},{key:"_onEndRecording",value:function(e){this.isRecording=!1,this.ept=e.ept||0,this.bpt=e.bpt||0,this.timeline={start:e.start,end:e.end,processingPeriods:e.processingPeriods}}},{key:"_render",value:function(){var t=this,n="icon-record";n+=this.isRecording?" recording":"";var r="";if(this.timeline){var i=[],o=this.timeline.end-this.timeline.start,a=o/b,s=(this.timeline.processingPeriods[0].start-this.timeline.start)/a;i=i.concat(e(s)),this.timeline.processingPeriods.forEach(function(t,n,r){var o=(t.end-t.start)/a;if(i=i.concat(e(o,!0)),n!==r.length-1){var s=(r[n+1].start-t.end)/a;i=i.concat(e(s))}});for(var c=window.performance.getEntries().filter(function(e){return"xmlhttprequest"===e.initiatorType}).filter(function(e){return t.timeline.start<e.startTime&&t.timeline.end>e.startTime+e.duration}).sort(function(e,t){return e.startTime<t.startTime}).reduce(function(e,t){if(0===e.length)return[[t]];for(var n=0;n<e.length;n++){var r=e[n],i=r[r.length-1];if(t.startTime<i.startTime+i.duration)return r.push(t),e}return e.push([t]),e},[]),u=0;u<c.length;u++)for(var l=0;l<c[u].length;l++){var d=c[u][l],h=4*u+2,f=(d.startTime-this.timeline.start)/a,p=d.duration/a;i.push("<li class='xhr' style='top:"+h+"px; left:"+f+"px; width:"+p+"px;'></li>")}r='<ul class="timeline" title="'+k.i18n.legend+('">'+i.join("")+"</ul>")}var m='\n\t  <span class="perf-sticker-hide" id="bptStickerArea">\n        <header>'+k.i18n.status+('<span class="'+n+'"></span>\n        </header>\n        <ul class="metrics">\n          <li><b>EPT</b> '+this.ept+"ms</li>\n          <li><b>BPT</b> "+this.bpt+"ms</li>\n        </ul>\n      ")+r+'\n      </span>\n\t  <a href="#" title="'+k.i18n.toggleResults+'" class="perf-sticker-toggle" onclick="this.parentNode.showPerfResults()">\n\t    &#x23f1;\n      </a>\n    ';this.stickerContainer.innerHTML=m,this.stickerContainer.showPerfResults=function(){var e=document.getElementById("bptStickerArea");e.className="perf-sticker-hide"===e.className?"perf-sticker-show":"perf-sticker-hide"}}}]),t}(),x="undefined"!=typeof window.jasmine;n(),r(),window.bptTracker.start({resetOnClick:!0}),(window.bptTracker.showSticker||x)&&window.addEventListener("load",function(e){function t(){if(!window.bptSticker){var e=new _(window.bptTracker);window.bptSticker=e,e._render()}}t()})}();